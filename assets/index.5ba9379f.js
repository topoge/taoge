var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable,s=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,r=(e,r)=>{for(var l in r||(r={}))t.call(r,l)&&s(e,l,r[l]);if(a)for(var l of a(r))i.call(r,l)&&s(e,l,r[l]);return e};import{V as l,E as o,m as n,a as c,C as p,b as d,c as u,L as m,d as h,A as f,S as g,D as y,e as v,i as b,f as _,g as w,h as x,p as k}from"./vendor.2a5341aa.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const i=new URL(e,location),s=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,r)=>{const l=new URL(e,i);if(self[t].moduleMap[l])return a(self[t].moduleMap[l]);const o=new Blob([`import * as m from '${l}';`,`${t}.moduleMap['${l}']=m;`],{type:"text/javascript"}),n=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(o),onerror(){r(new Error(`Failed to import: ${e}`)),s(n)},onload(){a(self[t].moduleMap[l]),s(n)}});document.head.appendChild(n)})),self[t].moduleMap={}}}("/assets/");l.use(o);function $(e,t,a,i,s,r,l,o){var n,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=a,c._compiled=!0),i&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),l?(n=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},c._ssrRegister=n):s&&(n=o?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),n)if(c.functional){c._injectStyles=n;var p=c.render;c.render=function(e,t){return n.call(t),p(e,t)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,n):[n]}return{exports:e,options:c}}const C={};var L=$({name:"App"},(function(){var e=this.$createElement;return(this._self._c||e)("router-view")}),[],!1,(function(e){for(let t in C)this[t]=C[t]}),"c82d5c8e",null,null);L.options.__file="src/App.vue";var S=L.exports;const T={name:"Menu",props:["isHideAside"],data:()=>({User:[["用户管理","account_circle"],["角色管理","supervisor_account"],["分组管理","groups"],["权限管理","privacy_tip"]]}),mounted(){},computed:r(r({},n({user:e=>e.user})),{drawer:{get(){return this.isHideAside},set(e){this.$emit("update:isHideAside",e)}}})},A={};var z=$(T,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-aside",{class:{"hide-aside":e.isHideAside}},[a("div",{staticClass:"aside-header"},[a("div",{staticClass:"logo"},[a("img",{attrs:{src:"/logo.png",alt:""}})])]),a("k-menu")],1)}),[],!1,(function(e){for(let t in A)this[t]=A[t]}),"773534c2",null,null);z.options.__file="src/components/layout/Aside.vue";var P=z.exports;const I={name:"Header",props:["isHideAside"],data:()=>({}),inject:["reload"],methods:r({},c(["logout"]))},q={};var D=$(I,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"header",class:{"fold-header":e.isHideAside}},[a("el-header",[a("div",{staticClass:"app-bar"},[a("el-row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("el-col",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center"}},[a("div",{staticClass:"header-menu",staticStyle:{"margin-right":"5px"}},[a("span",{staticClass:"material-icons",on:{click:function(t){return e.$emit("click")}}},[e._v("menu")]),a("span",{staticClass:"material-icons",on:{click:function(t){return e.reload()}}},[e._v("refresh")])]),a("k-breadcrumb")],1),a("el-col",{staticClass:"text-right"},[e._t("right")],2)],1)],1)]),a("k-tabbar")],1)}),[],!1,(function(e){for(let t in q)this[t]=q[t]}),"50ba79b2",null,null);D.options.__file="src/components/layout/Header.vue";var O=D.exports;const j={name:"Table",props:{headers:{type:Array,required:!0},isPagination:{type:Boolean,default:!1},total:{type:Number},zoomHeight:{type:Number,default:0},loading:{type:Boolean,default:!1},showExpand:{type:Boolean,default:!1}},data:()=>({type:["index","selection"],pagination:{layout:"prev, pager, next, total,sizes, jumper",limit:10,currentPage:1,pageSizes:[10,20,30,40,50,100]},expandFlag:0,tableHeight:100}),computed:{maxHeight(){let e=182;return this.$slots.header&&(e+=57),this.isPagination&&(e+=25),e+this.zoomHeight+1},new$listeners(){return this.$listeners["expand-change"]?Object.assign(this.$listeners,{"expand-change":this.changeExpand}):this.$listeners}},mounted(){},methods:{changePage(e){this.$emit("changePage",{page:this.pagination.currentPage,limit:this.pagination.limit})},changeExpand(e,t){t.length>1&&this.$attrs.data.forEach((t=>{JSON.stringify(t)!==JSON.stringify(e)&&this.$refs.table.toggleRowExpansion(t,!1)}));let a=0===this.expandFlag||1===this.expandFlag;0===t.length&&(a=!1),this.expandFlag=t.length,this.$emit("expand-change",a,e)}}},F={};var E=$(j,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{ref:"wrap",staticClass:"table-card"},[e.$slots.header?a("div",{staticClass:"table-header",attrs:{slot:"header"},slot:"header"},[e._t("header")],2):e._e(),a("div",{staticClass:"table",style:{maxHeight:"calc(100vh - "+e.maxHeight+"px)"}},[a("el-table",e._g(e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",class:{"table-row-click":e.$listeners["row-click"]},staticStyle:{width:"100%"},attrs:{size:"small"}},"el-table",e.$attrs,!1),e.new$listeners),[e.showExpand?a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t("expand-item",null,{scope:t})]}}],null,!0)}):e._e(),e._l(e.headers,(function(t,i){return!0!==t.hidden?[e.type.includes(t.type)?a("el-table-column",{attrs:{label:t.label,type:t.type,index:t.index,width:t.width,align:t.align}}):a("el-table-column",{key:i,attrs:{prop:t.prop,label:t.label,width:t.width,align:t.align},scopedSlots:e._u([{key:"default",fn:function(i){return[e._t("item."+t.prop,[t.tooltip?a("el-tooltip",{attrs:{effect:"dark",content:"date"===t.type?e.$dayjs.unix(i.row[t.prop]).format(t.format?t.format:"YYYY-MM-DD HH:mm"):i.row[t.prop],placement:"top"}},[a("span",{staticClass:"text-overflow"},[e._v(" "+e._s("date"===t.type?e.$dayjs.unix(i.row[t.prop]).format(t.format?t.format:"YYYY-MM-DD HH:mm"):i.row[t.prop])+" ")])]):[a("span",{class:{"text-overflow":t.overflow}},[e._v(" "+e._s("date"===t.type?e.$dayjs.unix(i.row[t.prop]).format(t.format?t.format:"YYYY-MM-DD HH:mm"):i.row[t.prop])+" ")])]],{scope:i})]}}],null,!0)})]:e._e()}))],2)],1),a("div",{staticClass:"table-footer",class:{"close-page":!e.isPagination}},[e.isPagination?a("el-pagination",{attrs:{layout:e.pagination.layout,total:e.total,"current-page":e.pagination.currentPage,"page-size":e.pagination.limit,"page-sizes":e.pagination.pageSizes},on:{"update:currentPage":function(t){return e.$set(e.pagination,"currentPage",t)},"update:current-page":function(t){return e.$set(e.pagination,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.pagination,"limit",t)},"update:page-size":function(t){return e.$set(e.pagination,"limit",t)},"update:pageSizes":function(t){return e.$set(e.pagination,"pageSizes",t)},"update:page-sizes":function(t){return e.$set(e.pagination,"pageSizes",t)},"size-change":e.changePage,"current-change":e.changePage}}):e._e()],1)])}),[],!1,(function(e){for(let t in F)this[t]=F[t]}),"59a2aca1",null,null);E.options.__file="src/components/common/Table.vue";var N=E.exports;const B={};var R=$({name:"Sidebar",data:()=>({}),methods:{close(){this.$emit("update:visible",!1)}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-drawer",e._g(e._b({attrs:{"with-header":!1}},"el-drawer",e.$attrs,!1),e.$listeners),[a("i",{staticClass:"el-icon-close",on:{click:e.close}}),a("div",{staticClass:"wrap"},[e._t("default")],2)])}),[],!1,(function(e){for(let t in B)this[t]=B[t]}),"4e90e824",null,null);R.options.__file="src/components/common/Sidebar.vue";var U=R.exports;let V=!1;const H={};var M=$({name:"Cropper",props:{aspectRatio:{default:1},openCropper:{default:!1},croppedCanvas:{default:()=>({width:200,height:200})},fileType:{default:"image/jpeg"},quality:{default:1}},data:()=>({src:null,fullscreen:!1,image:null,cropper:null,cropImgBlob:null,cropImgDataUrl:null,tmpAspectRatio:null,tmpFinishCrop:null,tmpCancelCrop:null}),computed:{dialogVisible:{get(){return this.openCropper},set(e){this.closeCropper(e)}}},mounted(){},destroyed(){this.cropper=null},methods:{initCropper(){this.image=this.$refs.img,this.cropper=new p(this.image,{aspectRatio:this.aspectRatio,viewMode:1,zoomOnWheel:!1,cropBoxResizable:!0,minCropBoxWidth:10,minCropBoxHeight:10,ready(e){let t=document.getElementById("img").cloneNode();t.className="",t.style.cssText="display: block;width: 100%;min-width: 0;min-height: 0;max-width: none;max-height: none;",document.querySelectorAll(".preview").item(0).innerHTML="",document.querySelectorAll(".preview").item(0).appendChild(t.cloneNode()),V=!0},crop(e){if(!V)return;let t=e.detail,a=this.cropper.getImageData(),i=t.width/t.height,s=document.querySelectorAll(".preview").item(0);if(!s)return;let r=s.getElementsByTagName("img").item(0),l=s.offsetWidth,o=l/i,n=t.width/l;s.style.height=o+"px",r&&(r.style.width=a.naturalWidth/n+"px",r.style.height=a.naturalHeight/n+"px",r.style.marginLeft=-t.x/n+"px",r.style.marginTop=-t.y/n+"px")}})},openDialog(){this.fullscreen=!1},openedDialog(){this.cropper?this.cropper.replace(this.src):this.initCropper(),this.cropper.setAspectRatio(null!==this.tmpAspectRatio?this.tmpAspectRatio:this.aspectRatio)},switchFullscreen(){this.fullscreen=!this.fullscreen,this.cropper.replace(this.src),this.cropper.reset()},closeCropper(e=!1){e?this.tmpCancelCrop=null:(this.tmpAspectRatio=null,this.tmpFinishCrop=null,this.tmpCancelCrop?this.tmpCancelCrop():this.$emit("cancelCrop")),this.$emit("update:openCropper",e)},async saveCrop(){let e=await this.cropper.getCroppedCanvas(this.croppedCanvas);this.cropImgDataUrl=await e.toDataURL(this.fileType,this.quality),await e.toBlob((e=>{this.cropImgBlob=e,this.tmpFinishCrop?this.tmpFinishCrop():this.$emit("finishCrop"),this.dialogVisible=!1}),this.fileType,this.quality)}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",e._b({ref:"dialog",attrs:{visible:e.dialogVisible,width:"50%",fullscreen:e.fullscreen,"show-close":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},open:e.openDialog,opened:e.openedDialog}},"el-dialog",e.$attrs,!1),[a("el-row",{attrs:{slot:"title",type:"flex",justify:"space-between",align:"center"},slot:"title"},[a("span",{staticClass:"el-dialog__title"},[e._v("裁剪图片")]),a("div",[a("i",{staticClass:"el-icon-full-screen text-md header-btn",on:{click:e.switchFullscreen}}),a("i",{staticClass:"el-icon-close text-md header-btn",on:{click:function(t){e.dialogVisible=!1}}})])]),a("div",{staticClass:"cropper-box"},[a("div",{staticClass:"image-box"},[a("div",{staticClass:"image-cropper"},[a("img",{ref:"img",staticStyle:{display:"block","max-width":"100%"},attrs:{src:e.src,id:"img",alt:""}})])]),a("div",{ref:"preview-box",staticClass:"preview-box"},[a("div",{ref:"preview",staticClass:"preview"})])]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveCrop}},[e._v("确 定")])],1)],1)}),[],!1,(function(e){for(let t in H)this[t]=H[t]}),"29d7dfd6",null,null);M.options.__file="src/components/common/Cropper.vue";var Y=M.exports;const K={name:"UploadImage",props:{isCropper:{type:Boolean,default:!0},showBox:{type:Array,default:()=>[100,100]},upload:{type:Function,required:!0}},data:()=>({dialogVisible:!1,openCropper:!1,cropPreview:""}),computed:{showBoxSize(){return{width:this.showBox[0]+"px",height:this.showBox[1]+"px"}}},beforeDestroy(){this.cropPreview=""},methods:{cropImg(e){this.isCropper?(this.$refs.cropper.src=URL.createObjectURL(e.raw),this.$refs.cropper.dialogVisible=!0):(this.cropPreview=URL.createObjectURL(e.raw),this.upload(e.raw))},removeUploadImg(e){this.cropPreview="",this.$emit("delete")},async uploadImg(){try{let e=this.$refs.cropper.cropImgBlob,t=new File([e],"file.jpg",{type:e.type});this.cropPreview=this.$refs.cropper.cropImgDataUrl,this.upload(t)}catch(e){this.$message.error(e.message)}},async handleClick(){this.$refs.upload.disabled&&this.$emit("click")},async beforeUpload(){}}},Q={};var J=$(K,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"inline-block"},on:{click:function(t){return t.stopPropagation(),e.handleClick(t)}}},[a("el-upload",e._b({ref:"upload",staticClass:"avatar-uploader",attrs:{action:"#","auto-upload":!1,"show-file-list":!1,"on-change":e.cropImg}},"el-upload",e.$attrs,!1),[e.cropPreview?a("el-image",{staticClass:"avatar",style:e.showBoxSize,attrs:{src:e.cropPreview}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon",style:e.showBoxSize}),e.cropPreview?a("span",{staticClass:"el-upload-action"},[a("i",{staticClass:"el-icon-zoom-in avatar-uploader-icon el-upload-delete",on:{click:function(t){t.stopPropagation(),e.dialogVisible=!0}}}),a("i",{staticClass:"el-icon-delete avatar-uploader-icon el-upload-delete",on:{click:function(t){return t.stopPropagation(),e.removeUploadImg(t)}}})]):e._e()],1),a("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"preview"},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.cropPreview,alt:""}})])]),e.isCropper?a("k-cropper",e._b({ref:"cropper",attrs:{"append-to-body":!0,"open-cropper":e.openCropper},on:{"update:openCropper":function(t){e.openCropper=t},"update:open-cropper":function(t){e.openCropper=t},finishCrop:e.uploadImg}},"k-cropper",e.$attrs,!1)):e._e()],1)}),[],!1,(function(e){for(let t in Q)this[t]=Q[t]}),"56916e0c",null,null);J.options.__file="src/components/common/UploadImage.vue";var W=J.exports;const G={name:"UploadVideo",props:{isCropper:{type:Boolean,default:!0},showBox:{type:Array,default:()=>[100,100]},upload:{type:Function,required:!0},limit:{type:Number,default:1}},data:()=>({fullscreen:!1,item:{cropPreview:"",video:null,loading:!1,status:!1},list:[],dialogVisible:!1,openCropper:!1,cropPreview:"",progress:0,play:{}}),computed:{showBoxSize(){return{width:this.showBox[0]+"px",height:this.showBox[1]+"px"}}},mounted(){this.list.push(Object.assign({},this.item))},methods:{async cropVideo(e,t){let a=this.list[this.list.length-1];this.progress=0,a.video=e.raw,a.loading=!0,this.$libs.videoCover(e.raw).then((e=>{a.cropPreview=e})).catch((e=>{a.cropPreview=""})),await this.upload(e.raw).then((e=>{this.list[this.list.length-1].status=!0,this.list.length<this.limit&&this.list.push(Object.assign({},this.item))})).catch((e=>{a.cropPreview=""})),a.loading=!1},removeUploadImg(e){this.list.splice(e,1),0===this.list.length&&this.list.push(Object.assign({},this.item));let t=Object.assign({},this.list[e]);this.$emit("delete",{index:e,video:t})},clearVideo(){this.list=[],this.list.push(Object.assign({},this.item))},videoPlay(e){e.video instanceof File?this.play=URL.createObjectURL(e.video):this.play=e.video,this.dialogVisible=!0,this.$nextTick((()=>{this.$refs.video.play()}))},async initValue(e,t="video",a=""){let i=[];for(let s of e){let e=Object.assign({},this.item);e.video=a+s[t],(async()=>{e.cropPreview=await this.$libs.videoCover(e.video).then((e=>e)).catch((e=>""))})(),i.push(e)}this.list.length<this.limit&&i.push(Object.assign({},this.item)),this.list=i}}},X={};var Z=$(G,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"upload-wrap"},[a("el-row",{attrs:{type:"flex",gutter:15}},e._l(e.list,(function(t,i){return a("el-col",{key:i},[t.loading?a("div",{staticClass:"item-progress",style:e.showBoxSize},[a("el-progress",{attrs:{type:"circle",percentage:e.progress,width:e.showBox[0]-10}})],1):e._e(),t.loading?e._e():a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"#","auto-upload":!1,"show-file-list":!1,"on-change":e.cropVideo,accept:"video/mp4,video/webm"}},[t.cropPreview?a("el-image",{staticClass:"avatar",style:e.showBoxSize,attrs:{src:t.cropPreview}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon",style:e.showBoxSize}),t.status?a("label",{staticClass:"item-status-label"},[a("i",{staticClass:"el-icon-upload-success el-icon-check"})]):e._e(),t.video?a("label",{staticClass:"item-index-label"},[a("i",[e._v(e._s(i+1))])]):e._e(),t.cropPreview?a("span",{staticClass:"el-upload-action"},[a("i",{staticClass:"el-icon-video-play avatar-uploader-icon el-upload-delete",on:{click:function(a){return a.stopPropagation(),e.videoPlay(t)}}}),a("i",{staticClass:"el-icon-delete avatar-uploader-icon el-upload-delete",on:{click:function(t){return t.stopPropagation(),e.removeUploadImg(i)}}})]):e._e()],1)],1)})),1),a("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":!0,fullscreen:e.fullscreen,title:"预览"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-row",{attrs:{slot:"title",type:"flex",justify:"space-between",align:"center"},slot:"title"},[a("span",{staticClass:"el-dialog__title"},[e._v("预览")]),a("div",[a("i",{staticClass:"el-icon-full-screen text-md header-btn",on:{click:function(t){e.fullscreen=!e.fullscreen}}}),a("i",{staticClass:"el-icon-close text-md header-btn",on:{click:function(t){e.dialogVisible=!1}}})])]),a("div",{staticClass:"preview"},[a("video",{ref:"video",staticStyle:{"max-height":"50vh"},style:{maxHeight:e.fullscreen?"80vh":"50vh"},attrs:{src:e.play,controls:""}})])],1)],1)}),[],!1,(function(e){for(let t in X)this[t]=X[t]}),"4c14ca33",null,null);Z.options.__file="src/components/common/UploadVideo.vue";var ee=Z.exports;const te={name:"Preview",props:{show:{type:Boolean,default:!1},type:{type:String},src:{typ:String}},data:()=>({fullscreen:!1}),computed:{visible:{get(){return this.show},set(e){this.$emit("update:show",e)}}}},ae={};var ie=$(te,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",e._b({attrs:{visible:e.visible,"destroy-on-close":!1,"append-to-body":!0,fullscreen:e.fullscreen,title:"预览"},on:{"update:visible":function(t){e.visible=t}}},"el-dialog",e.$attrs,!1),[e.visible?a("el-row",{attrs:{slot:"title",type:"flex",justify:"space-between",align:"center"},slot:"title"},[a("span",{staticClass:"el-dialog__title"},[e._v("预览")]),e.$attrs.title?a("span",{staticClass:"el-dialog__title"},[e._v(e._s(e.$attrs.title))]):e._e(),a("div",[a("i",{staticClass:"el-icon-full-screen text-md header-btn",on:{click:function(t){e.fullscreen=!e.fullscreen}}}),a("i",{staticClass:"el-icon-close text-md header-btn",on:{click:function(t){e.visible=!1}}})])]):e._e(),a("div",{staticClass:"preview"},["image"===e.type&&e.visible?a("img",{attrs:{src:e.src,alt:""}}):e._e(),"video"===e.type&&e.visible?a("video",{ref:"video",staticStyle:{"max-height":"50vh"},style:{maxHeight:e.fullscreen?"80vh":"50vh"},attrs:{src:e.src,controls:""}}):e._e(),"audio"===e.type&&e.visible?a("audio",{ref:"audio",attrs:{src:e.src,controls:""}}):e._e()])],1)}),[],!1,(function(e){for(let t in ae)this[t]=ae[t]}),"e7cdc85a",null,null);ie.options.__file="src/components/common/Preview.vue";var se=ie.exports;const re={};var le=$({name:"checkbox"},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-checkbox",e._b({staticClass:"checkbox"},"el-checkbox",e.$attrs,!1),[e._t("default")],2)}),[],!1,(function(e){for(let t in re)this[t]=re[t]}),"52c33c81",null,null);le.options.__file="src/components/common/Checkbox.vue";var oe=le.exports;const ne={};var ce=$({name:"Radio"},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-radio",e._b({staticClass:"radio"},"el-radio",e.$attrs,!1),[e._t("default")],2)}),[],!1,(function(e){for(let t in ne)this[t]=ne[t]}),"e7b2d20a",null,null);ce.options.__file="src/components/common/Radio.vue";var pe=ce.exports;const de={name:"TabBar",data:()=>({}),computed:r({},n("tabBar",["tabs","currentTab"])),methods:r({async initTabs(){},async selectTab(e){await this.setCurrentTab(this.tabs[e.index]),this.currentTab.path!==this.$route.path&&await this.$router.push(this.tabs[e.index].path)},async removeTab(e){let t=this.tabs.findIndex((t=>t.name===e));await this.deleteTab(t),this.currentTab.path!==this.$route.path&&await this.$router.push(this.currentTab.path)}},c("tabBar",["addTab","setCurrentTab","deleteTab","fixedTab"]))},ue={};var me=$(de,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tabs"},[a("el-tabs",{on:{"tab-remove":e.removeTab,"tab-click":e.selectTab},model:{value:e.currentTab.name,callback:function(t){e.$set(e.currentTab,"name",t)},expression:"currentTab.name"}},e._l(e.tabs,(function(e,t){return a("el-tab-pane",{key:e.name,attrs:{label:e.title,name:e.name,closable:e.closable}})})),1)],1)}),[],!1,(function(e){for(let t in ue)this[t]=ue[t]}),"aac4a700",null,null);me.options.__file="src/components/common/TabBar.vue";var he=me.exports;const fe={};var ge=$({name:"Breadcrumb",data:()=>({breadcrumbList:[]}),watch:{$route(e){this.getBreadcrumb()}},mounted(){this.getBreadcrumb()},methods:{async getBreadcrumb(){this.breadcrumbList=this.$route.matched}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-breadcrumb",{attrs:{separator:"/"}},e._l(e.breadcrumbList,(function(t,i){return t.meta&&t.meta.title&&!1!==t.meta.breadcrumb?a("el-breadcrumb-item",{key:i},[a("router-link",{attrs:{to:{path:t.path}}},[e._v(e._s(t.meta.title))])],1):e._e()})),1)}),[],!1,(function(e){for(let t in fe)this[t]=fe[t]}),"3635a2ac",null,null);ge.options.__file="src/components/common/Breadcrumb.vue";var ye=ge.exports;const ve={};var be=$({name:"menu-item",props:{menus:{type:Array,default:()=>[]}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.menus,(function(t,i){return[""!==t.route?a("router-link",{attrs:{to:""+t.route}},[a("el-menu-item",{attrs:{index:""+t.route}},[a("i",{staticClass:"material-icons"},[e._v(e._s(t.menu_icon))]),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.permission_name))])])],1):a("el-submenu",{attrs:{index:t.id.toString()}},[a("template",{slot:"title"},[a("i",{staticClass:"material-icons"},[e._v(e._s(t.menu_icon))]),a("span",[e._v(e._s(t.permission_name))])]),a("menu-item",{attrs:{menus:t.children}})],2)]}))],2)}),[],!1,(function(e){for(let t in ve)this[t]=ve[t]}),"fd4bb98c",null,null);be.options.__file="src/components/common/menu/menu-item.vue";const _e={name:"Menu",components:{MenuItem:be.exports},computed:r({},n({user:e=>e.user,menus:e=>e.permission.menu}))},we={};var xe=$(_e,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-menu",{attrs:{"default-active":e.$route.path}},[a("menu-item",{attrs:{menus:e.menus}})],1)}),[],!1,(function(e){for(let t in we)this[t]=we[t]}),"6857054a",null,null);xe.options.__file="src/components/common/menu/Menu.vue";var ke=xe.exports;const $e={name:"Drawer",props:{visible:{type:Boolean},title:{type:String,default:""},size:{type:String}},computed:{show:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},data:()=>({isFullscreen:!1})},Ce={};var Le=$($e,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-drawer",e._g(e._b({attrs:{visible:e.show,withHeader:!1,size:e.isFullscreen?"100%":e.size,"append-to-body":"","destroy-on-close":""},on:{"update:visible":function(t){e.show=t}}},"el-drawer",e.$attrs,!1),e.$listeners),[a("div",{staticClass:"header"},[e._t("title",[a("div",[e._v(e._s(e.title))])]),a("div",[e.isFullscreen?a("span",{staticClass:"material-icons",on:{click:function(t){e.isFullscreen=!e.isFullscreen,e.$emit("fullscreen",!1)}}},[e._v("fullscreen_exit")]):a("span",{staticClass:"material-icons",on:{click:function(t){e.isFullscreen=!e.isFullscreen,e.$emit("fullscreen",!0)}}},[e._v("fullscreen")]),a("span",{staticClass:"material-icons",on:{click:function(t){e.show=!1}}},[e._v("close")])])],2),a("el-divider",{staticClass:"divider"}),a("div",{staticClass:"wrap"},[a("div",{staticClass:"content",style:{maxHeight:e.$slots.footer?"calc(100% - 64px)":"100%"}},[e._t("default")],2),e.$slots.footer?a("div",[a("el-divider",{staticClass:"divider"}),a("div",{staticClass:"footer"},[e._t("footer")],2)],1):e._e()])],1)}),[],!1,(function(e){for(let t in Ce)this[t]=Ce[t]}),"5f011783",null,null);Le.options.__file="src/components/common/Drawer.vue";var Se=Le.exports;const Te={name:"Descriptions",props:{title:{type:String},span:{type:Number},column:{type:Object,default:()=>({xs:24})},bottom:{type:String},divider:{type:Boolean,default:!1}}},Ae={};var ze=$(Te,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"descriptions"},[e.title?a("div",{staticClass:"descriptions-title"},[e._v(e._s(e.title))]):e._e(),a("div",{staticClass:"descriptions-view"},[a("el-row",{staticClass:"descriptions-row",staticStyle:{display:"flex","flex-flow":"row nowrap"},attrs:{gutter:20}},[Boolean(e.$slots.default)?e._t("default"):e._e()],2),e.divider?a("el-divider"):e._e()],1)])}),[],!1,(function(e){for(let t in Ae)this[t]=Ae[t]}),"cbfbfdba",null,null);ze.options.__file="src/components/common/Descriptions.vue";var Pe=ze.exports;const Ie={};var qe=$({name:"DescriptionsItem",props:{label:{type:String},span:{type:Number},column:{type:Object,default:()=>({xs:24})}},computed:{width(){return this.span?this.span:this.$parent.$parent.span},columnFlex(){return this.column?this.column:this.$parent.$parent.column}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-col",{attrs:{span:e.width,xs:e.columnFlex.xs,sm:e.columnFlex.sm,md:e.columnFlex.md,lg:e.columnFlex.lg,xl:e.columnFlex.xl}},[a("div",{staticClass:"descriptions-item",style:{paddingBottom:e.$parent.$parent.bottom}},[e.label?a("div",{staticClass:"descriptions-item-label",staticStyle:{width:"80px"}},[e._v(e._s(e.label)+"：")]):e._e(),a("div",{staticClass:"descriptions-item-value"},[Boolean(e.$slots.default)?e._t("default"):e._e()],2)])])}),[],!1,(function(e){for(let t in Ie)this[t]=Ie[t]}),"2306e080",null,null);qe.options.__file="src/components/common/DescriptionsItem.vue";var De=qe.exports,Oe={name:"RemoteScript",props:{src:{type:String,required:!0}},render(e,t){return e("script",{attrs:{type:"text/javascript",src:this.src}})}},je={inserted(e,t){t.value||e.remove()}},Fe={bind(e,t){let a,i=t.value,s=i&&void 0!==i.time?i.time:2e3,r=0;e.addEventListener(i&&i.event?i.event:"click",(e=>{a||0!==r?e&&e.stopImmediatePropagation():(r++,a=setTimeout((()=>{a=null,r=0}),s))}),!0)}};const Ee={};var Ne=$({name:"Login",data:()=>({loading:!1,captcha:"",form:{username:"",password:"",captcha:"",key:""},formRules:{mobile:[{pattern:/^1[3-9]\d{9}$/,required:!0,message:"请输入正确手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:18,message:"长度在6 到 18 个字符",trigger:"blur"}]}}),mounted(){this.getCaptcha()},methods:{async login(){this.loading=!0;try{await this.$store.dispatch("login",this.form)}catch(e){e&&await this.getCaptcha()}finally{this.loading=!1}},async getCaptcha(){this.$api.login.verify().then((e=>{this.captcha=window.atob(e.data),this.form.key=e.data.key}))}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"login-wrapper",attrs:{id:"particles-js"}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("唱片发行系统"),a("el-divider",{attrs:{direction:"vertical"}}),e._v("登录")],1)]),a("el-form",{attrs:{"label-position":"right"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login(t)}}},[a("el-form-item",[a("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"请输入您的用户名"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),a("el-form-item",[a("el-input",{attrs:{"prefix-icon":"el-icon-unlock",placeholder:"请输入密码",type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),a("el-form-item",[a("el-row",{attrs:{type:"flex",gutter:10,align:"center"}},[a("el-col",{attrs:{span:14}},[a("el-input",{attrs:{"prefix-icon":"el-icon-s-help",placeholder:"请输入验证码"},model:{value:e.form.captcha,callback:function(t){e.$set(e.form,"captcha",t)},expression:"form.captcha"}})],1),a("el-col",{attrs:{span:10}},[a("el-image",{staticClass:"capcha-image",attrs:{src:e.captcha,fit:"cover",lazy:""},on:{click:e.getCaptcha}})],1)],1)],1),a("el-form-item",[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],staticStyle:{width:"100%"},attrs:{type:"primary",loading:e.loading},on:{click:e.login}},[e._v("登录")])],1)],1)],1)],1)}),[],!1,(function(e){for(let t in Ee)this[t]=Ee[t]}),"d4cee6a8",null,null);Ne.options.__file="src/pages/Login.vue";var Be=Ne.exports;const Re={name:"Manage",mixins:[{data:()=>({isHideAside:!1,isRouterAlive:!0}),computed:r({},n("tabBar",["cachedViews","currentTab"])),provide(){return{reload:this.reload}},mounted(){this.init().then((e=>{}))},methods:r(r({},c("tabBar",["fixedTab","deleteTab","addTab","deleteCachedView","addCachedView"])),{async init(){},async reload(){let e=Object.assign({},this.currentTab);await this.deleteCachedView(e),this.isRouterAlive=!1,this.$nextTick((()=>{this.isRouterAlive=!0,this.addCachedView(e)}))}})}],methods:r({},c(["logout"]))},Ue={};var Ve=$(Re,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"application"},[a("k-aside",{attrs:{isHideAside:e.isHideAside}}),a("el-container",[a("k-header",{attrs:{"is-hide-aside":e.isHideAside},on:{click:function(t){e.isHideAside=!e.isHideAside}},scopedSlots:e._u([{key:"right",fn:function(){return[a("el-dropdown",{attrs:{trigger:"hover"}},[a("span",{staticClass:"el-dropdown-link"},[e._v(e._s(e.$store.state.user.username?e.$store.state.user.username:e.$store.state.user.mobile))]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("router-link",{attrs:{to:"/profile"}},[a("el-dropdown-item",{attrs:{icon:"el-icon-user"}},[e._v("个人中心")])],1),a("el-dropdown-item",{attrs:{icon:"el-icon-switch-button"},nativeOn:{click:function(t){return e.logout(t)}}},[e._v("退出")])],1)],1)]},proxy:!0}])}),a("el-main",{class:{"fold-main":e.isHideAside}},[a("div",{staticClass:"page-content"},[a("transition",{attrs:{name:"slide-fade",mode:"out-in"}},[a("keep-alive",{attrs:{include:e.cachedViews}},[e.isRouterAlive?a("router-view"):e._e()],1)],1)],1)])],1)],1)}),[],!1,(function(e){for(let t in Ue)this[t]=Ue[t]}),"7347d65a",null,null);Ve.options.__file="src/pages/Index.vue";var He=Ve.exports;const Me={};var Ye=$({name:"Permission",props:{checked:{type:Array,default:()=>[]}},data:()=>({permission:{api:[],menu:[],page:[],button:[],parentApi:[],parentMenu:[],parentPage:[],parentButton:[]}}),watch:{checked(e,t){JSON.parse(JSON.stringify(e)).sort().toString()!==t.sort().toString()&&this.filterCheckedKeys(JSON.parse(JSON.stringify(e)))}},mounted(){this.getPermission()},methods:{async getPermission(){this.$api.authPermission.queryAll().then((e=>{let t=e.data;this.handlePermission(t)}))},async handlePermission(e){let t=this.permission;t.api=[],t.menu=[],t.page=[],t.button=[];for(let a of e)switch(a.permission_type){case 1:t.api.push(a);break;case 2:t.menu.push(a);break;case 3:t.page.push(a);break;case 4:t.button.push(a)}t.api=this.$libs.formatTreeData(t.api,0,"label","permission_name"),t.parentApi=this.$libs.getTreeParent(t.api),t.menu=this.$libs.formatTreeData(t.menu,0,"label","permission_name"),t.parentMenu=this.$libs.getTreeParent(t.menu),t.page=this.$libs.formatTreeData(t.page,0,"label","permission_name"),t.parentPage=this.$libs.getTreeParent(t.page),t.button=this.$libs.formatTreeData(t.button,0,"label","permission_name"),t.parentButton=this.$libs.getTreeParent(t.button),this.checked&&this.filterCheckedKeys(this.checked)},filterCheckedKeys(e){this.$refs.apiTree.setCheckedKeys(e.filter((e=>this.permission.parentApi.findIndex((t=>t.id===e))<0))),this.$refs.menuTree.setCheckedKeys(e.filter((e=>this.permission.parentMenu.findIndex((t=>t.id===e))<0))),this.$refs.pageTree.setCheckedKeys(e.filter((e=>this.permission.parentPage.findIndex((t=>t.id===e))<0))),this.$refs.buttonTree.setCheckedKeys(e.filter((e=>this.permission.parentButton.findIndex((t=>t.id===e))<0)))},getCheckedKeys(){let e=[];return e=e.concat(this.$refs.apiTree.getCheckedKeys()),e=e.concat(this.$refs.apiTree.getHalfCheckedKeys()),e=e.concat(this.$refs.menuTree.getCheckedKeys()),e=e.concat(this.$refs.menuTree.getHalfCheckedKeys()),e=e.concat(this.$refs.pageTree.getCheckedKeys()),e=e.concat(this.$refs.pageTree.getHalfCheckedKeys()),e=e.concat(this.$refs.buttonTree.getCheckedKeys()),e=e.concat(this.$refs.buttonTree.getHalfCheckedKeys()),e},getCheckedNodes(){let e=[];return e=e.concat(this.$refs.apiTree.getCheckedNodes()),e=e.concat(this.$refs.apiTree.getHalfCheckedNodes()),e=e.concat(this.$refs.menuTree.getCheckedNodes()),e=e.concat(this.$refs.menuTree.getHalfCheckedNodes()),e=e.concat(this.$refs.pageTree.getCheckedNodes()),e=e.concat(this.$refs.pageTree.getHalfCheckedNodes()),e=e.concat(this.$refs.buttonTree.getCheckedNodes()),e=e.concat(this.$refs.buttonTree.getHalfCheckedNodes()),e}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tabs",{attrs:{type:"card"}},[a("el-tab-pane",{attrs:{label:"菜单"}},[a("el-tree",{key:"menu",ref:"menuTree",attrs:{data:e.permission.menu,"node-key":"id","show-checkbox":""}})],1),a("el-tab-pane",{attrs:{label:"页面"}},[a("el-tree",{key:"page",ref:"pageTree",attrs:{data:e.permission.page,"node-key":"id","show-checkbox":""}})],1),a("el-tab-pane",{attrs:{label:"按钮"}},[a("el-tree",{key:"button",ref:"buttonTree",attrs:{data:e.permission.button,"node-key":"id","show-checkbox":""}})],1),a("el-tab-pane",{attrs:{label:"接口"}},[a("el-tree",{key:"api",ref:"apiTree",attrs:{data:e.permission.api,"node-key":"id","show-checkbox":""}})],1)],1)}),[],!1,(function(e){for(let t in Me)this[t]=Me[t]}),"5d2d496e",null,null);Ye.options.__file="src/components/business/Permission.vue";var Ke=Ye.exports,Qe={data:()=>({drawer:{title:"",type:"",span:20,visible:!1},preview:{visible:!1},action:"",total:0,defaultForm:{},defaultQuery:{},query:{},form:{},loading:!1,btnLoading:!1,queryLoading:!1,saveLoading:!1,deleteLoading:!1,selectItem:{}}),mounted(){this.defaultForm=JSON.parse(JSON.stringify(this.form)),this.defaultQuery=JSON.parse(JSON.stringify(this.query))},methods:{resetForm(){this.form=Object.assign({},this.defaultForm)},resetQuery(){this.query=Object.assign({},this.defaultQuery)}}};const Je={};var We=$({name:"AuthAdmin",components:{Permission:Ke},mixins:[Qe],data:()=>({headers:[{label:"用户名",prop:"username"},{label:"手机号",prop:"mobile"},{label:"创建时间",prop:"created_at",type:"date"},{label:"状态",prop:"status"},{label:"操作",prop:"action"}],data:[],drawer:{title:"",type:"",span:20,visible:!1},form:{username:"",password:"",mobile:null,status:1,role:[],permission:[]},selectItem:{},roleList:[]}),mounted(){this.getAdminList()},methods:{handleAction(e,t=null){this.drawer.type=e,"create"===e?this.drawer.title="新增管理员":"update"===e&&(this.selectItem=t,this.getAdminInfo(),this.drawer.title="更新管理员"),this.drawer.visible=!0,this.getRoleList()},async getAdminInfo(){let e=(await this.$api.admin.query(this.selectItem.id)).data;this.$libs.getAssignKeyData(this.form,e)},async getAdminList(e={page:1,limit:10}){this.loading=!0;let t=Object.assign(e,this.$libs.filterNullObject(this.query));try{let e=await this.$api.admin.batchQuery(t);this.data=e.data.data,this.total=e.data.total}catch(a){}finally{this.loading=!1}},async getRoleList(){let e=await this.$api.authRole.queryAll();this.roleList=this.$libs.formatTreeData(e.data,0,"label","role_name")},async createAdmin(){this.saveLoading=!0,this.form.permission=this.$refs.permission.getCheckedKeys();try{let e=await this.$api.admin.create(this.form);this.$message.success("新增成功"),this.drawer.visible=!1,this.data.unshift(e.data)}catch(e){}finally{this.saveLoading=!1}},async updateAdmin(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id,e.permission=this.$refs.permission.getCheckedKeys();try{await this.$api.admin.update(e);this.$message.success("更新成功"),this.drawer.visible=!1;let t=this.data.findIndex((t=>t.id===e.id));this.$set(this.data,t,this.$libs.getAssignKeyData(this.selectItem,e))}catch(t){}finally{this.saveLoading=!1}},async deleteAdmin(e){let t=e.$index;e=e.row,this.$tool.confirmWarning("确定要删除"+e.username+"吗？").then((()=>{this.$api.admin.delete({id:e.id}).then((e=>{this.$message.success("删除成功"),this.data.splice(t,1)}))}))},async switchStatus(e,t){this.$api.admin.update({id:t.id,status:e}).then((e=>{this.$message.success("更新成功")})).catch((a=>{t.status=0===e?1:0}))}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-table",{attrs:{headers:t.headers,data:t.data,"is-pagination":"",total:t.total,loading:t.loading},on:{changePage:t.getAdminList},scopedSlots:t._u([{key:"header",fn:function(){return[i("el-row",{attrs:{type:"flex"}},[i("el-col",[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleAction("create")}}},[t._v("新增管理员")])],1)],1)]},proxy:!0},{key:"item.status",fn:function(e){var a=e.scope;return[i("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(e){return t.switchStatus(e,a.row)}},model:{value:a.row.status,callback:function(e){t.$set(a.row,"status",e)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(e){var a=e.scope;return[i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleAction("update",a.row)}}},[t._v("编辑")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.deleteAdmin(a)}}},[t._v("删除")])]}}])})],1),i("k-drawer",{attrs:{title:t.drawer.title,visible:t.drawer.visible,size:"35%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",loading:t.saveLoading},on:{click:function(e){"update"===t.drawer.type?t.updateAdmin():t.createAdmin()}}},[t._v("保存")])]},proxy:!0}])},[i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"用户名"}},[i("el-input",{model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1),i("el-form-item",{attrs:{label:"密码"}},[i("el-input",{model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),i("el-form-item",{attrs:{label:"手机号"}},[i("el-input",{model:{value:t.form.mobile,callback:function(e){t.$set(t.form,"mobile",e)},expression:"form.mobile"}})],1),i("el-form-item",{attrs:{label:"设置角色"}},[i("el-cascader",{attrs:{options:t.roleList,props:{multiple:!0,value:"id",checkStrictly:!0,emitPath:!1},"collapse-tags":"",clearable:""},model:{value:t.form.role,callback:function(e){t.$set(t.form,"role",e)},expression:"form.role"}})],1),i("el-form-item",{attrs:{label:"是否启用"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[i("el-radio",{attrs:{label:1}},[t._v("启用")]),i("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1),i("el-form-item",{attrs:{label:"设置权限"}},[i("Permission",{ref:"permission",attrs:{checked:t.form.permission}})],1)],1)],1)],1)],1)],1)}),[],!1,(function(e){for(let t in Je)this[t]=Je[t]}),"370fa4de",null,null);We.options.__file="src/pages/auth/Admin.vue";var Ge=We.exports;const Xe={};var Ze=$({name:"AuthRole",components:{Permission:Ke},mixins:[Qe],data:()=>({dialog:{title:"",type:"",visible:!1},form:{role_name:"",parent_id:0,role_level:1,role_type:1,desc:"",status:1,permission:[]},addRoleData:{parentRole:[]},headers:[{label:"角色名称",prop:"role_name"},{label:"级别",prop:"role_level"},{label:"分类",prop:"role_type"},{label:"创建时间",prop:"created_at",type:"date"},{label:"状态",prop:"status"},{label:"操作",prop:"action"}],tableData:[],permission:[],group:[],role:[],treeData:[],selectRole:{},total:0}),mounted(){this.getRoleList()},methods:{showDialog(e){this.dialog.type=e,this.dialog.visible=!0},handleAction(e="create",t=null){this.action=e,"create"===e?(this.form.parent_id=0,this.form.role_level=1,this.dialog.title="新增角色"):"edit"===e&&(this.selectRole=t,this.getRoleInfo(),this.dialog.title="编辑角色"),this.showDialog(e)},getRoleInfo(){this.$api.authRole.query(this.selectRole.id).then((e=>{let t=e.data;this.$libs.getAssignKeyData(this.form,t)}))},getRoleList(e={page:1,limit:10}){this.loading=!0;let t=Object.assign(e,this.$libs.filterNullObject(this.query));this.$api.authRole.batchQuery(t).then((e=>{this.tableData=e.data.data,this.total=e.data.total,this.loading=!1}))},createRole(){this.saveLoading=!0,this.form.permission=this.$refs.permission.getCheckedKeys(),this.$api.authRole.create(this.form).then((e=>{this.$message.success("新增成功"),this.dialog.visible=!1,this.tableData.unshift(e.data),this.saveLoading=!1})).catch((e=>{this.saveLoading=!1}))},updateRole(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectRole.id,e.permission=this.$refs.permission.getCheckedKeys(),this.$api.authRole.update(e).then((t=>{this.$message.success("更新成功"),this.dialog.visible=!1;let a=this.tableData.findIndex((t=>t.id===e.id));this.$set(this.tableData,a,this.$libs.getAssignKeyData(this.selectRole,e)),this.saveLoading=!1})).catch((e=>{this.saveLoading=!1}))},deleteRole(e){this.deleteLoading=!0;let t=e.row;this.$tool.confirmWarning("确定要删除"+t.role_name+"吗？").then((()=>{this.$api.authRole.delete({id:t.id}).then((t=>{this.$message.success("删除成功"),this.tableData.splice(e.$index,1),this.dialog.visible=!1,this.deleteLoading=!1})).catch((e=>{this.deleteLoading=!1}))}))},switchStatus(e,t){this.$api.authRole.update({id:t.id,status:e}).then((e=>{this.$message.success("更新成功")})).catch((a=>{t.status=0===e?1:0}))},resetForm(e){this.form=Object.assign({},this.temp)}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-table",{attrs:{headers:e.headers,data:e.tableData,"is-pagination":"",total:e.total},on:{changePage:e.getRoleList},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-row",{attrs:{type:"flex"}},[a("el-col",[a("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(t){return e.handleAction("create")}}},[e._v("新增角色")])],1)],1)]},proxy:!0},{key:"item.role_type",fn:function(t){return[1===t.scope.row.role_type?a("el-tag",{attrs:{size:"mini"}},[e._v("默认角色")]):e._e()]}},{key:"item.status",fn:function(t){var i=t.scope;return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(t){return e.switchStatus(t,i.row)}},model:{value:i.row.status,callback:function(t){e.$set(i.row,"status",t)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(t){var i=t.scope;return[a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleAction("edit",i.row)}}},[e._v("编辑")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.deleteRole(i)}}},[e._v("删除")])]}}])})],1),a("el-dialog",{attrs:{title:e.dialog.title,visible:e.dialog.visible,width:"30%"},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)},closed:e.resetForm}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"small"}},[a("el-form-item",{attrs:{label:"角色名称"}},[a("el-input",{model:{value:e.form.role_name,callback:function(t){e.$set(e.form,"role_name",t)},expression:"form.role_name"}})],1),a("el-form-item",{attrs:{label:"父级角色"}},[a("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.form.parent_id,callback:function(t){e.$set(e.form,"parent_id",t)},expression:"form.parent_id"}},[a("el-option",{attrs:{label:"顶级分组",value:0}}),e._l(e.addRoleData.parentRole,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],2)],1),a("el-form-item",{attrs:{label:"角色级别"}},[a("el-input",{attrs:{disabled:""},model:{value:e.form.role_level,callback:function(t){e.$set(e.form,"role_level",t)},expression:"form.role_level"}})],1),a("el-form-item",{attrs:{label:"角色类型"}},[a("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.form.role_type,callback:function(t){e.$set(e.form,"role_type",t)},expression:"form.role_type"}},[a("el-option",{attrs:{label:"默认类型",value:1}})],1)],1),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1),a("el-form-item",{attrs:{label:"功能权限"}},[a("Permission",{ref:"permission",attrs:{checked:e.form.permission}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialog.visible=!1}}},[e._v("取 消")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){"create"===e.dialog.type?e.createRole():e.updateRole()}}},[e._v("保 存")])],1)],1)],1)}),[],!1,(function(e){for(let t in Xe)this[t]=Xe[t]}),"08b43826",null,null);Ze.options.__file="src/pages/auth/Role.vue";var et=Ze.exports;const tt={};var at=$({name:"AuthPermission",mixins:[Qe],data:()=>({saveLoading:!1,deleteLoading:!1,drawer:{title:"",type:"",span:20,visible:!1},temp:{},form:{parent_id:0,permission_name:"",permission_level:1,permission_type:1,route:"",method:"",menu_show:1,menu_icon:"",page_name:"",page_title:"",page_component:"",button_key:"",sort:0,desc:"",status:1},headers:[{label:"权限名称",prop:"permission_name"},{label:"权限级别",prop:"permission_level",align:"center"},{label:"权限路由",prop:"route",align:"center",tooltip:!0},{label:"排序",prop:"sort",align:"center"},{label:"权限类型",prop:"permission_type",align:"center"},{label:"状态",prop:"status",align:"center"},{label:"操作",prop:"action",width:251}],data:[],permissionList:[],treeData:[],selectItem:{},action:"",query:{type:1}}),mounted(){this.getPermissionList()},methods:{handleAction(e="create",t=null){this.action=e,this.selectItem=t||{},"create"===e?(this.form.parent_id=0,this.form.permission_level=1,this.drawer.title="新增权限"):"createChild"===e?(this.form.parent_id=t.id,this.form.permission_level=t.permission_level+1,this.form.permission_type=t.permission_type,this.form.route=t.route,this.drawer.title="新增子权限"):"update"===e&&(this.$libs.getAssignKeyData(this.form,t),this.drawer.title="编辑权限"),this.drawer.visible=!0},async getPermissionList(){this.loading=!0,this.form.permission_type=this.query.type,this.$api.authPermission.queryAll(this.query).then((e=>{let t=e.data;this.permissionList=t,this.setTreeData(t),this.loading=!1}))},async createPermission(){this.saveLoading=!0;try{let e=await this.$api.authPermission.create(this.form);this.$message.success("创建成功"),this.drawer.visible=!1,e.data.status=1,this.permissionList.push(e.data),await this.setTreeData()}catch(e){}finally{this.saveLoading=!1}},updatePermission(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id,this.$api.authPermission.update(e).then((t=>{this.$message.success("更新成功"),this.drawer.visible=!1,this.saveLoading=!1,(async()=>{let t=this.permissionList,a=t.findIndex((t=>t.id===e.id));t[a]=e,await this.setTreeData(t)})()})).catch((e=>{this.saveLoading=!1}))},deletePermission(e){this.$tool.confirmWarning("确定要删除"+e.permission_name+"吗？将会连同子权限一起删除！").then((()=>{this.$api.authPermission.delete({id:e.id}).then((t=>{this.$message.success("删除成功"),this.drawer.visible=!1,this.deleteLoading=!1,(async()=>{let t=this.permissionList,a=t.findIndex((t=>t.id===e.id));t.splice(a,1),await this.setTreeData(t)})()}))}))},async setTreeData(e=this.permissionList){this.treeData=this.$libs.formatTreeData(JSON.parse(JSON.stringify(e)))},switchStatus(e,t){this.$api.authPermission.update({id:t.id,status:e}).then((e=>{this.$message.success("更新成功")})).catch((a=>{t.status=0===e?1:0}))},resetForm(){this.form=Object.assign({},this.defaultForm),this.form.permission_type=this.query.type}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("el-card",{staticClass:"search-card",staticStyle:{"margin-bottom":"20px"}},[i("el-form",{attrs:{inline:!0}},[i("el-form-item",{attrs:{label:"权限类型"}},[i("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:t.getPermissionList},model:{value:t.query.type,callback:function(e){t.$set(t.query,"type",e)},expression:"query.type"}},[i("el-option",{attrs:{label:"接口",value:1}}),i("el-option",{attrs:{label:"菜单",value:2}}),i("el-option",{attrs:{label:"页面",value:3}}),i("el-option",{attrs:{label:"按钮",value:4}})],1)],1)],1)],1),i("k-table",{attrs:{headers:t.headers,data:t.treeData,"row-key":"id","highlight-current-row":!0,"zoom-height":103,loading:t.loading},scopedSlots:t._u([{key:"header",fn:function(){return[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleAction("create")}}},[t._v("新增权限")])]},proxy:!0},{key:"item.permission_name",fn:function(e){var a=e.scope;return[i("el-link",{attrs:{underline:!1,type:"primary"}},[t._v(t._s(a.row.permission_name))])]}},{key:"item.permission_type",fn:function(e){var a=e.scope;return[1===a.row.permission_type?i("el-tag",{attrs:{size:"mini",type:"primay"}},[t._v("接口")]):t._e(),2===a.row.permission_type?i("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("菜单")]):t._e(),3===a.row.permission_type?i("el-tag",{attrs:{size:"mini",type:"warning"}},[t._v("页面")]):t._e(),4===a.row.permission_type?i("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("按钮")]):t._e()]}},{key:"item.status",fn:function(e){var a=e.scope;return[i("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(e){return t.switchStatus(e,a.row)}},model:{value:a.row.status,callback:function(e){t.$set(a.row,"status",e)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(e){var a=e.scope;return[i("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(e){return t.handleAction("createChild",a.row)}}},[t._v("新增子权限")]),i("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(e){return t.handleAction("update",a.row)}}},[t._v("编辑")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"danger",size:"mini",plain:""},on:{click:function(e){return t.deletePermission(a.row)}}},[t._v("删除")])]}}])})],1),i("k-drawer",{attrs:{title:t.drawer.title,visible:t.drawer.visible,size:"35%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取 消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary",loading:t.saveLoading},on:{click:function(e){"update"===t.action?t.updatePermission():t.createPermission()}}},[t._v("保 存")])]},proxy:!0}])},[i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"父级权限"}},[i("el-select",{attrs:{disabled:""},model:{value:t.form.parent_id,callback:function(e){t.$set(t.form,"parent_id",e)},expression:"form.parent_id"}},[i("el-option",{attrs:{label:"顶级权限",value:0}}),i("el-option",{attrs:{label:t.selectItem.permission_name,value:t.selectItem.id}})],1)],1),i("el-form-item",{attrs:{label:"权限级别"}},[i("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:t.form.permission_level,callback:function(e){t.$set(t.form,"permission_level",e)},expression:"form.permission_level"}},[i("el-option",{attrs:{label:"顶级权限",value:1}})],1)],1),i("el-form-item",{attrs:{label:"权限类型"}},[i("el-radio-group",{attrs:{disabled:"createChild"===t.action,disabled:""},model:{value:t.form.permission_type,callback:function(e){t.$set(t.form,"permission_type",e)},expression:"form.permission_type"}},[i("el-radio",{attrs:{label:1}},[t._v("接口")]),i("el-radio",{attrs:{label:2}},[t._v("菜单")]),i("el-radio",{attrs:{label:3}},[t._v("页面")]),i("el-radio",{attrs:{label:4}},[t._v("按钮")])],1)],1),i("el-form-item",{attrs:{label:"排序"}},[i("el-input-number",{attrs:{min:0,max:255,label:"排序",size:"mini"},model:{value:t.form.sort,callback:function(e){t.$set(t.form,"sort",e)},expression:"form.sort"}})],1),i("el-form-item",{attrs:{label:"权限名称",required:""}},[i("el-input",{model:{value:t.form.permission_name,callback:function(e){t.$set(t.form,"permission_name",e)},expression:"form.permission_name"}})],1),i("el-form-item",{attrs:{label:"路由"}},[i("el-input",{model:{value:t.form.route,callback:function(e){t.$set(t.form,"route",e)},expression:"form.route"}})],1),1===t.form.permission_type?[i("el-form-item",{attrs:{label:"请求方式"}},[i("el-select",{model:{value:t.form.method,callback:function(e){t.$set(t.form,"method",e)},expression:"form.method"}},[i("el-option",{attrs:{label:"get",value:"get"}}),i("el-option",{attrs:{label:"post",value:"post"}}),i("el-option",{attrs:{label:"put",value:"put"}}),i("el-option",{attrs:{label:"delete",value:"delete"}})],1)],1)]:t._e(),2===t.form.permission_type?[i("el-form-item",{attrs:{label:"显示菜单"}},[i("el-radio-group",{model:{value:t.form.menu_show,callback:function(e){t.$set(t.form,"menu_show",e)},expression:"form.menu_show"}},[i("el-radio",{attrs:{label:1}},[t._v("显示")]),i("el-radio",{attrs:{label:0}},[t._v("不显示")])],1)],1),i("el-form-item",{attrs:{label:"菜单图标"}},[i("el-input",{model:{value:t.form.menu_icon,callback:function(e){t.$set(t.form,"menu_icon",e)},expression:"form.menu_icon"}})],1)]:t._e(),3===t.form.permission_type?[i("el-form-item",{attrs:{label:"页面名称",required:""}},[i("el-input",{attrs:{placeholder:"对应组件name字段"},model:{value:t.form.page_name,callback:function(e){t.$set(t.form,"page_name",e)},expression:"form.page_name"}})],1),i("el-form-item",{attrs:{label:"页面标题",required:""}},[i("el-input",{model:{value:t.form.page_title,callback:function(e){t.$set(t.form,"page_title",e)},expression:"form.page_title"}})],1),i("el-form-item",{attrs:{label:"页面组件",required:""}},[i("el-input",{attrs:{placeholder:"组件路径"},model:{value:t.form.page_component,callback:function(e){t.$set(t.form,"page_component",e)},expression:"form.page_component"}})],1)]:t._e(),4===t.form.permission_type?[i("el-form-item",{attrs:{label:"按钮标识",required:""}},[i("el-input",{model:{value:t.form.button_key,callback:function(e){t.$set(t.form,"button_key",e)},expression:"form.button_key"}})],1)]:t._e(),i("el-form-item",{attrs:{label:"描述"}},[i("el-input",{model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1)],2)],1)],1)],1)],1)}),[],!1,(function(e){for(let t in tt)this[t]=tt[t]}),"e1b98808",null,null);at.options.__file="src/pages/auth/Permission.vue";var it=at.exports;const st={name:"NoPermission",data:()=>({noPermissionSvg:"/assets/403.cd155002.svg"}),methods:r({},c("tabBar",["deleteTab"]))},rt={};var lt=$(st,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"center",height:"calc(100vh - 100px)"}},[a("el-image",{attrs:{src:e.noPermissionSvg}}),a("div",{staticStyle:{"margin-left":"100px"}},[a("p",[e._v("抱歉，你无权访问该页面")]),a("router-link",{attrs:{to:"/"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.deleteTab("NoPermission")}}},[e._v("返回首页")])],1)],1)],1)}),[],!1,(function(e){for(let t in rt)this[t]=rt[t]}),"42641992",null,null);lt.options.__file="src/pages/403.vue";var ot=lt.exports;const nt={name:"Empty",data:()=>({emptySvg:"/assets/404.17896f5a.svg"}),computed:r({},n("tabBar",["tabs"])),methods:r(r({},c("tabBar",["deleteTab"])),{closePage(){this.tabs.filter((e=>{"Empty"!==e.name&&"AnyEmpty"!==e.name||this.deleteTab(e.name)}))}})},ct={};var pt=$(nt,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"center",height:"calc(100vh - 100px)"}},[a("el-image",{attrs:{src:e.emptySvg}}),a("div",{staticStyle:{"margin-left":"100px"}},[a("p",[e._v("抱歉，你访问的页面不存在")]),a("router-link",{attrs:{to:"/"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return t.stopPropagation(),e.closePage()}}},[e._v("返回首页")])],1)],1)],1)}),[],!1,(function(e){for(let t in ct)this[t]=ct[t]}),"eba75a5a",null,null);pt.options.__file="src/pages/404.vue";var dt=[{name:"NoPermission",path:"403",component:ot,meta:{title:"无访问权限"}},{name:"Empty",path:"404",component:pt.exports,meta:{title:"页面不存在"}}];const ut={name:"Profile",mixins:[Qe],data:()=>({dialog:{title:"修改密码",type:"",visible:!1},form:{oldPassword:"",password:""},password:""}),computed:r({},d(["getUser"])),methods:{resetPassword(){if(this.password!==this.form.password)return void this.$message.warning("两次密码不一致");this.saveLoading=!0;let e=Object.assign({},this.form);this.$api.login.resetPassword(e).then((e=>{this.dialog.visible=!1,this.saveLoading=!1,localStorage.removeItem("token"),this.$message.success("密码修改成功，请重新登录"),setTimeout((()=>{this.$router.push("/login")}),1e3)})).catch((e=>{this.saveLoading=!1}))}}},mt={};var ht=$(ut,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("el-card",[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"20px"}},[a("div",{staticStyle:{display:"flex","flex-flow":"column nowrap","justify-content":"space-between"}},[a("span",{staticClass:"merchant-name"},[e._v(e._s(e.getUser?e.getUser.mobile:""))]),a("el-button",{staticStyle:{"margin-top":"20px"},attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){e.dialog.visible=!0}}},[e._v("修改密码")])],1)])])],1),a("el-dialog",{attrs:{title:e.dialog.title,visible:e.dialog.visible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"small"}},[a("el-form-item",{attrs:{label:"原密码"}},[a("el-input",{attrs:{type:"password"},model:{value:e.form.oldPassword,callback:function(t){e.$set(e.form,"oldPassword",t)},expression:"form.oldPassword"}})],1),a("el-form-item",{attrs:{label:"新密码"}},[a("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),a("el-form-item",{attrs:{label:"确认密码"}},[a("el-input",{attrs:{type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialog.visible=!1}}},[e._v("取 消")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"primary",loading:e.saveLoading},on:{click:e.resetPassword}},[e._v("保 存")])],1)],1)],1)}),[],!1,(function(e){for(let t in mt)this[t]=mt[t]}),"7c05ee72",null,null);ht.options.__file="src/pages/Profile.vue";var ft=ht.exports,gt={data:()=>({timeRange:[],dateTime:[],pickerOptions:{shortcuts:[{text:"最近一周",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]}})},yt={mixins:[gt],props:{value:{type:Boolean,default:!1},type:{type:String,default:"add"},data:{type:Object}},computed:{visible:{get(){return this.value},set(e){this.$emit("input",e)}}},data:()=>({title:"",span:20,defaultForm:{},defaultQuery:{},form:{},query:{},selectItem:{},queryLoading:!1,saveLoading:!1}),mounted(){this.defaultForm=JSON.parse(JSON.stringify(this.form)),this.defaultQuery=JSON.parse(JSON.stringify(this.query))},methods:{resetForm(){this.form=Object.assign({},this.defaultForm)},resetQuery(){this.query=Object.assign({},this.defaultQuery)}}};const vt={};var bt=$({name:"AddEditPicture",mixins:[yt],data:()=>({form:{image_name:"",type:1,tag:[],file:null},tagList:[],inputVisible:!1,inputValue:"",showAllTag:!1}),watch:{async value(e,t){e?("add"===this.type?this.title="新增图片":"edit"===this.type&&(this.title="编辑图片",await this.getPictureInfo()),this.getTagAll()):this.resetForm()}},methods:{async getPictureInfo(){this.queryLoading=!0;let e=(await this.$api.picture.query(this.data.id)).data;this.$libs.getAssignKeyData(this.form,e),this.queryLoading=!1},async syncTagSelect(){for(let e of this.tagList){let t=this.form.tag.findIndex((t=>t===e.id));e.select=t>=0}},async getTagAll(){let e=await this.$api.tag.queryAll({type:"1"});this.tagList=e.data,this.syncTagSelect()},async selcetTag(e,t){if(e.select=!e.select,this.$set(this.tagList,t,e),e.select)this.form.tag.push(e.id);else{let t=this.form.tag.findIndex((t=>t===e.id));this.form.tag.splice(t,1)}},async showInput(){this.inputVisible=!0,this.$nextTick((e=>{this.$refs.saveTagInput.$refs.input.focus()}))},async addTag(){let e=this.inputValue;if(e){this.queryLoading=!0;let a={tag_name:e,type:1};try{let t=await this.$api.tag.create(a);this.tagList.unshift(t.data),this.$message.success(e+"添加成功")}catch(t){}finally{this.queryLoading=!1}}this.inputVisible=!1,this.inputValue="",this.queryLoading=!1},async deleteTag(e){this.$tool.confirmWarning("确定要删除 "+e.tag_name+"标签吗？").then((async()=>{this.queryLoading=!0;try{await this.$api.tag.delete({id:e.id});let t=this.tagList.findIndex((t=>t.id===e.id));this.tagList.splice(t,1),this.$message.success(e.tag_name+"删除成功")}catch(t){}finally{this.queryLoading=!1}})).catch((e=>{}))},async upload(e){this.form.file=e,this.form.image_name=e.name},async createImage(){this.saveLoading=!0;let e=this.$libs.formatFormData(this.form);try{let t=await this.$api.picture.create(e);this.$emit("success",this.type,t.data),this.visible=!1,this.$message.success("新增成功")}catch(t){}finally{this.saveLoading=!1}},async updateImage(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.data.id;try{await this.$api.picture.update(e);this.$emit("success",this.type,e),this.visible=!1,this.$message.success("更新成功")}catch(t){}finally{this.saveLoading=!1}}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("k-drawer",{attrs:{visible:t.visible,title:t.title,size:"45%","destroy-on-close":""},on:{"update:visible":function(e){t.visible=e},fullscreen:function(t){e.span=t?12:20},closed:function(e){t.resetForm(),t.showAllTag=!1}},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.visible=!1}}},[t._v("取消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",loading:t.saveLoading},on:{click:function(e){"edit"===t.type?t.updateImage():t.createImage()}}},[t._v("保存")])]},proxy:!0}])},[i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.queryLoading,expression:"queryLoading"}],attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"标签"}},[i("div",{staticStyle:{display:"flex","flex-flow":"row wrap","align-items":"center"}},[i("el-select",{attrs:{multiple:"",clearable:"",filterable:""},on:{change:t.syncTagSelect},model:{value:t.form.tag,callback:function(e){t.$set(t.form,"tag",e)},expression:"form.tag"}},t._l(t.tagList,(function(e,a){return i("el-option",{key:a,attrs:{label:e.tag_name,value:e.id}},[i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},[i("span",[t._v(t._s(e.tag_name))]),i("span",{staticClass:"el-icon-circle-close",staticStyle:{color:"#8492a6","font-size":"13px","vertical-align":"middle"},on:{click:function(a){return a.stopPropagation(),t.deleteTag(e)}}})])])})),1),t.inputVisible?i("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",staticStyle:{width:"90px"},attrs:{size:"small"},on:{blur:t.addTag},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addTag(e)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):i("el-button",{staticClass:"button-new-tag",attrs:{size:"mini"},on:{click:t.showInput}},[t._v("+ New Tag")]),i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.showAllTag=!t.showAllTag}}},[t._v(t._s(t.showAllTag?"关闭全部":"展开全部"))])],1),i("transition",{attrs:{name:"fade"}},[t.showAllTag?i("div",{staticClass:"all-tag",staticStyle:{display:"flex","flex-flow":"row wrap","align-items":"center",gap:"10px","margin-top":"10px"}},t._l(t.tagList,(function(e,a){return i("el-tag",{key:a,attrs:{closable:"",effect:e.select?"dark":"plain"},on:{close:function(a){return t.deleteTag(e)},click:function(i){return t.selcetTag(e,a)}}},[t._v(" "+t._s(e.tag_name)+" ")])})),1):t._e()])],1),i("el-form-item",{attrs:{label:"类别"}},[i("el-select",{model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[i("el-option",{attrs:{label:"歌曲封面",value:1}}),i("el-option",{attrs:{label:"推广图片",value:2}})],1)],1),"add"===t.type?i("el-form-item",{attrs:{label:"上传图片"}},[i("k-upload-image",{ref:"upload",attrs:{accept:"image/jpeg,image/png","is-cropper":!1,upload:t.upload}})],1):t._e(),i("el-form-item",{attrs:{label:"图片名称"}},[i("el-input",{model:{value:t.form.image_name,callback:function(e){t.$set(t.form,"image_name",e)},expression:"form.image_name"}})],1)],1)],1)],1)],1)}),[],!1,(function(e){for(let t in vt)this[t]=vt[t]}),"7add4d06",null,null);bt.options.__file="src/pages/picture/AddEditPicture.vue";var _t=bt.exports;const wt={name:"Attachment",components:{AddEditPicture:_t},mixins:[Qe],props:{visible:{type:Boolean}},computed:{show:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},data:()=>({showAllTag:!1,data:[],query:{type:null,tag:[]},tagList:[],pagination:{layout:"prev, pager, next, total,sizes, jumper",limit:10,currentPage:1,pageSizes:[10,20,30,40,50,100]}}),mounted(){this.getTagAll(),this.getPictureList()},methods:{handleAction(e,t=null){"add"===e&&this.data.unshift(t)},async getPictureList(){this.queryLoading=!0,this.loading=!0;let e={page:this.pagination.currentPage?this.pagination.currentPage:1,limit:this.pagination.limit?this.pagination.limit:10},t=Object.assign(e,this.$libs.filterNullObject(this.query));try{let e=await this.$api.picture.batchQuery(t);this.data=e.data.data,this.total=e.data.total}catch(a){}finally{this.queryLoading=!1,this.loading=!1}},async getTagAll(){let e=await this.$api.tag.queryAll({type:1});this.tagList=e.data},async selcetTag(e,t){if(e.select=!e.select,this.$set(this.tagList,t,e),e.select)this.query.tag.push(e.id);else{let t=this.query.tag.findIndex((t=>t===e.id));this.query.tag.splice(t,1)}},async syncTagSelect(){for(let e of this.tagList){let t=this.query.tag.findIndex((t=>t===e.id));e.select=t>=0}}}},xt={};var kt=$(wt,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",e._g(e._b({attrs:{visible:e.show,title:"选择封面"},on:{"update:visible":function(t){e.show=t}}},"el-dialog",e.$attrs,!1),e.$listeners),[a("el-row",[a("el-col",{staticStyle:{"margin-bottom":"20px"},attrs:{span:24}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"10px"}},[a("span",[e._v("选择标签")]),a("el-select",{attrs:{size:"mini",multiple:"",clearable:"",filterable:"","collapse-tags":""},on:{change:e.syncTagSelect},model:{value:e.query.tag,callback:function(t){e.$set(e.query,"tag",t)},expression:"query.tag"}},e._l(e.tagList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.tag_name,value:e.id}})})),1),a("el-button",{attrs:{size:"mini",plain:""},on:{click:function(t){e.showAllTag=!e.showAllTag}}},[e._v(e._s(e.showAllTag?"关闭全部":"展开全部"))])],1),a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center"}},[a("el-form",{attrs:{inline:""}},[a("el-form-item",{attrs:{label:"选择类别",size:"small"}},[a("el-select",{staticStyle:{width:"100px"},model:{value:e.query.type,callback:function(t){e.$set(e.query,"type",t)},expression:"query.type"}},[a("el-option",{attrs:{label:"歌曲封面",value:1}}),a("el-option",{attrs:{label:"推广图片",value:2}})],1)],1)],1),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{icon:"el-icon-search",size:"small",type:"primary",loading:e.queryLoading},on:{click:function(t){return e.getPictureList()}}},[e._v("查询")]),a("el-button",{attrs:{icon:"el-icon-plus",size:"small",type:"primary"},on:{click:function(t){e.drawer.visible=!0}}},[e._v("新增图片")])],1)]),a("transition",{attrs:{name:"fade"}},[e.showAllTag?a("div",{staticClass:"all-tag",staticStyle:{display:"flex","flex-flow":"row wrap","align-items":"center",gap:"10px","margin-top":"10px"}},e._l(e.tagList,(function(t,i){return a("el-tag",{key:i,attrs:{effect:t.select?"dark":"plain"},on:{click:function(a){return e.selcetTag(t,i)}}},[e._v(e._s(t.tag_name))])})),1):e._e()])],1),a("el-col",{attrs:{span:24}},[a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},e._l(e.data,(function(t,i){return a("el-col",{key:i,staticClass:"item-image",attrs:{xs:8,sm:6,md:4,lg:3,xl:4},nativeOn:{click:function(a){e.$emit("select",Object.assign({},t)),e.show=!1}}},[a("el-image",{staticStyle:{width:"100%",height:"100%","margin-bottom":"5px"},attrs:{src:e.$config.staticUrl()+t.path,lazy:"",fit:"contain"}}),a("span",[e._v(e._s(t.image_name))])],1)})),1)],1),a("el-col",{attrs:{span:24}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end","margin-top":"20px"}},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"current-page":e.pagination.currentPage,"page-size":e.pagination.limit,"page-sizes":e.pagination.pageSizes},on:{"update:currentPage":function(t){return e.$set(e.pagination,"currentPage",t)},"update:current-page":function(t){return e.$set(e.pagination,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.pagination,"limit",t)},"update:page-size":function(t){return e.$set(e.pagination,"limit",t)},"update:pageSizes":function(t){return e.$set(e.pagination,"pageSizes",t)},"update:page-sizes":function(t){return e.$set(e.pagination,"pageSizes",t)},"size-change":function(t){return e.getPictureList()},"current-change":function(t){return e.getPictureList()}}})],1)])],1),a("add-edit-picture",{attrs:{type:"add"},on:{success:e.handleAction},model:{value:e.drawer.visible,callback:function(t){e.$set(e.drawer,"visible",t)},expression:"drawer.visible"}})],1)}),[],!1,(function(e){for(let t in xt)this[t]=xt[t]}),"7a28412e",null,null);kt.options.__file="src/components/business/Attachment.vue";var $t=kt.exports;const Ct={};var Lt=$({name:"TreeSelect",data:()=>({data:[]})},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-popover",[a("el-tree"),a("el-select",{attrs:{slot:"reference",disabled:""},slot:"reference",model:{value:e.data,callback:function(t){e.data=t},expression:"data"}})],1)}),[],!1,(function(e){for(let t in Ct)this[t]=Ct[t]}),"6b7003d8",null,null);Lt.options.__file="src/components/common/TreeSelect.vue";var St=Lt.exports;const Tt={name:"Song",components:{TreeSelect:St,Attachment:$t},mixins:[Qe,gt],props:{isComponent:{type:Boolean,default:!1},buyId:{type:Number}},data(){return{headers:[{label:"id",prop:"id",width:50},{label:"歌曲",prop:"song_name",tooltip:!0},{label:"封面",prop:"song_cover",width:50},{label:"音乐",prop:"file",width:50},{label:"演唱",prop:"singer"},{label:"作词",prop:"lyricist"},{label:"作曲",prop:"composer"},{label:"创建时间",prop:"created_at",type:"date"},{label:"价格",prop:"price"},{label:"是否已售",prop:"is_buy"},{label:"是否上架",prop:"status"},{label:"操作",prop:"action",hidden:this.isComponent}],data:[],query:{is_buy:null,start_time:null,end_time:null,song_name:null},form:{song_name:"",song_cover:"",singer:"",lyricist:"",composer:"",lyrics:"",price:null,status:1,desc:"",category:[],file:{}},preview:{visible:!1},attachment:{visible:!1},categoryList:[],fileList:[]}},mounted(){this.isComponent&&this.headers.unshift({label:"选择",prop:"select"}),this.getSongList()},methods:{handleAction(e,t=null){this.drawer.type=e,"create"===e?this.drawer.title="新增歌曲":"update"===e&&(this.selectItem=t,this.getSongInfo(),this.drawer.title="更新歌曲"),this.getCategoryList(),this.drawer.visible=!0},async getCategoryList(){this.queryLoading=!0;try{let e=await this.$api.category.queryAll({type:1});this.categoryList=this.$libs.formatTreeData(JSON.parse(JSON.stringify(e.data)),0,"title","cate_name")}catch(e){}finally{this.queryLoading=!1}},async getSongInfo(){this.queryLoading=!0;let e=(await this.$api.song.query(this.selectItem.id)).data;this.$libs.getAssignKeyData(this.form,e),this.$refs.upload.cropPreview=e.song_cover?this.$config.staticUrl()+e.song_cover:"",this.queryLoading=!1},async getSongList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.song.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},async createSong(){this.saveLoading=!0;let e=Object.assign({},this.form);e.category=this.$refs.tree.getCheckedKeys();let t=new this.$libs.formatFormData(e);try{let a=await this.$api.song.create(t);this.data.unshift(this.$libs.getAssignKeyData(e,a.data)),this.drawer.visible=!1,this.$message.success("新增成功")}catch(a){}finally{this.saveLoading=!1}},async updateSong(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id,e.category=this.$refs.tree.getCheckedKeys();try{await this.$api.song.update(e);let t=this.data.findIndex((t=>t.id===e.id));this.$set(this.data,t,this.$libs.getAssignKeyData(this.selectItem,e)),this.drawer.visible=!1,this.$message.success("更新成功")}catch(t){}finally{this.saveLoading=!1}},async deleteSong(e){let t=e.$index;e=e.row,this.$tool.confirmWarning("确定要删除"+e.song_name+"吗？").then((()=>{this.$api.song.delete({id:e.id}).then((e=>{this.data.splice(t,1),this.$message.success("删除成功")}))})).catch((e=>{}))},async uploadCover(){this.attachment.visible=!0},async selcetImage(e){this.form.song_cover=e.path,this.$refs.upload.cropPreview=this.$config.staticUrl()+e.path},async switchStatus(e,t,a){let i={id:a.id};i[e]=t,this.$api.song.update(i).then((e=>{this.$message.success("更新成功")})).catch((e=>{a.status=0===t?1:0}))},async uploadFile(e){this.form.song_name=e.raw.name,this.form.file=e.raw},async removeFile(e){this.form.song_name="",this.form.file={}}}},At={};var zt=$(Tt,(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("el-card",{staticClass:"search-card",staticStyle:{"margin-bottom":"20px"}},[i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},[i("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"是否已售"}},[i("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:t.query.is_buy,callback:function(e){t.$set(t.query,"is_buy",e)},expression:"query.is_buy"}},[i("el-option",{attrs:{label:"未售",value:0}}),i("el-option",{attrs:{label:"已售",value:1}})],1)],1),i("el-form-item",{attrs:{label:"选择时间"}},[i("el-date-picker",{attrs:{type:"datetimerange","picker-options":t.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:t.dateTime,callback:function(e){t.dateTime=e},expression:"dateTime"}})],1),i("el-form-item",{attrs:{label:"歌曲名称"}},[i("el-input",{attrs:{maxlength:"32"},model:{value:t.query.song_name,callback:function(e){t.$set(t.query,"song_name",e)},expression:"query.song_name"}})],1)],1),i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap"}},[i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.getSongList()}}},[t._v("查询")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(e){t.resetQuery(),t.dateTime=[],t.getSongList()}}},[t._v("重置")])],1)],1)]),i("k-table",{attrs:{headers:t.headers,data:t.data,"is-pagination":"",total:t.total,"zoom-height":96,loading:t.loading},on:{changePage:t.getSongList},scopedSlots:t._u([{key:"header",fn:function(){return[i("el-row",{attrs:{type:"flex"}},[i("el-col",[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleAction("create")}}},[t._v("新增歌曲")])],1)],1)]},proxy:!0},{key:"item.select",fn:function(e){var a=e.scope;return[i("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"primary"},on:{click:function(e){t.$emit("select",Object.assign({},a.row))}}},[t._v("选择")])]}},{key:"item.song_cover",fn:function(e){var a=e.scope;return[a.row.song_cover?i("el-image",{staticClass:"table-logo",attrs:{src:t.$config.staticUrl()+a.row.song_cover,fit:"contain",previewSrcList:[t.$config.staticUrl()+a.row.song_cover]}}):t._e()]}},{key:"item.file",fn:function(e){var a=e.scope;return[i("span",{staticClass:"material-icons",on:{click:function(e){t.selectItem=a.row,t.preview.visible=!0}}},[t._v("play_circle_outline")])]}},{key:"item.price",fn:function(e){var a=e.scope;return[i("el-tag",{attrs:{type:"warning",size:"mini"}},[t._v(t._s(a.row.price))])]}},{key:"item.is_buy",fn:function(e){var a=e.scope;return[0===a.row.is_buy?i("el-tag",{attrs:{type:"success",size:"mini"}},[t._v("未售")]):t._e(),1===a.row.is_buy?i("el-tag",{attrs:{type:"danger",size:"mini"}},[t._v("已售")]):t._e()]}},{key:"item.status",fn:function(e){var a=e.scope;return[i("el-switch",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{"active-value":1,"inactive-value":0},on:{change:function(e){return t.switchStatus("status",e,a.row)}},model:{value:a.row.status,callback:function(e){t.$set(a.row,"status",e)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(e){var a=e.scope;return[i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleAction("update",a.row)}}},[t._v("编辑")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.deleteSong(a)}}},[t._v("删除")])]}}])})],1),i("k-preview",{attrs:{show:t.preview.visible,title:t.selectItem.song_name,type:"audio",src:t.selectItem.file},on:{"update:show":function(e){return t.$set(t.preview,"visible",e)}}}),i("Attachment",{attrs:{visible:t.attachment.visible},on:{"update:visible":function(e){return t.$set(t.attachment,"visible",e)},select:t.selcetImage}}),i("k-drawer",{attrs:{visible:t.drawer.visible,title:t.drawer.title,size:"45%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",loading:t.saveLoading},on:{click:function(e){"update"===t.drawer.type?t.updateSong():t.createSong()}}},[t._v("保存")])]},proxy:!0}])},[i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.queryLoading,expression:"queryLoading"}],attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"歌曲类别"}},[i("div",{staticStyle:{"max-height":"200px",overflow:"auto","line-height":"1"}},[i("el-tree",{ref:"tree",attrs:{"default-checked-keys":t.form.category,props:{label:"cate_name"},data:t.categoryList,"node-key":"id","show-checkbox":""}})],1)]),i("el-form-item",{attrs:{label:"歌曲封面"},on:{click:function(e){e.stopPropagation()}}},[i("k-upload-image",{ref:"upload",attrs:{upload:function(){},disabled:!0},on:{delete:function(e){t.form.song_cover=""},click:t.uploadCover}})],1),"create"===t.drawer.type?i("el-form-item",{attrs:{label:"歌曲文件"}},[i("el-upload",{attrs:{action:"#","auto-upload":!1,"show-file-list":"","on-change":t.uploadFile,"on-remove":t.removeFile,accept:"audio/mpeg","file-list":t.fileList}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传mp3文件，且不超过5M")])],1)],1):t._e(),i("el-form-item",{attrs:{label:"歌曲名称"}},[i("el-input",{model:{value:t.form.song_name,callback:function(e){t.$set(t.form,"song_name",e)},expression:"form.song_name"}})],1),i("el-form-item",{attrs:{label:"歌曲介绍"}},[i("el-input",{model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),i("el-form-item",{attrs:{label:"演唱"}},[i("el-input",{model:{value:t.form.singer,callback:function(e){t.$set(t.form,"singer",e)},expression:"form.singer"}})],1),i("el-form-item",{attrs:{label:"作词"}},[i("el-input",{model:{value:t.form.lyricist,callback:function(e){t.$set(t.form,"lyricist",e)},expression:"form.lyricist"}})],1),i("el-form-item",{attrs:{label:"作曲"}},[i("el-input",{model:{value:t.form.composer,callback:function(e){t.$set(t.form,"composer",e)},expression:"form.composer"}})],1),i("el-form-item",{attrs:{label:"价格"}},[i("el-input",{model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}})],1),i("el-form-item",{attrs:{label:"歌词"}},[i("el-input",{attrs:{type:"textarea",maxlength:"2048","show-word-limit":"",rows:5},model:{value:t.form.lyrics,callback:function(e){t.$set(t.form,"lyrics",e)},expression:"form.lyrics"}})],1),i("el-form-item",{attrs:{label:"是否上架"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[i("el-radio",{attrs:{label:1}},[t._v("上架")]),i("el-radio",{attrs:{label:0}},[t._v("下架")])],1)],1)],1)],1)],1)],1)],1)}),[],!1,(function(e){for(let t in At)this[t]=At[t]}),"33e288eb",null,null);zt.options.__file="src/pages/song/Song.vue";var Pt=zt.exports;const It={};var qt=$({name:"Picture",components:{AddEditPicture:_t},mixins:[Qe],data:()=>({headers:[{label:"序号",type:"index",align:"center"},{label:"id",prop:"id",align:"center"},{label:"类别",prop:"type"},{label:"图片",prop:"path"},{label:"图片名称",prop:"image_name"},{label:"操作",prop:"action"}],data:[],form:{image_name:"",type:1,tag:[],file:null},query:{type:null},tagList:[],inputVisible:!1,inputValue:""}),mounted(){this.getPictureList()},methods:{handleAction(e,t=null){if("add"===e)this.data.unshift(t);else if("edit"===e){let e=this.data.findIndex((e=>e.id===t.id));this.$set(this.data,e,this.$libs.getAssignKeyData(this.selectItem,t))}},async getPictureInfo(){this.queryLoading=!0;let e=(await this.$api.picture.query(this.selectItem.id)).data;this.$libs.getAssignKeyData(this.form,e),this.queryLoading=!1},async getPictureList(e={page:1,limit:10}){this.loading=!0;let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.picture.batchQuery(t);this.data=a.data.data,this.total=a.data.total,this.loading=!1},async getTagAll(){let e=await this.$api.tag.queryAll({type:"1"});this.tagList=e.data,(async()=>{for(let e of this.form.tag){let t=this.tagList.findIndex((t=>t.id===e));this.tagList[t].select=!0}})()},async selcetTag(e,t){if(e.select=!e.select,this.$set(this.tagList,t,e),e.select)this.form.tag.push(e.id);else{let t=this.form.tag.findIndex((t=>t===e.id));this.form.tag.splice(t,1)}},async showInput(){this.inputVisible=!0,this.$nextTick((e=>{this.$refs.saveTagInput.$refs.input.focus()}))},async addTag(){let e=this.inputValue;if(e){this.queryLoading=!0;let a={tag_name:e,type:1};try{let t=await this.$api.tag.create(a);this.tagList.push(t.data),this.$message.success(e+"添加成功")}catch(t){}finally{this.queryLoading=!1}}this.inputVisible=!1,this.inputValue="",this.queryLoading=!1},async deleteTag(e){this.$tool.confirmWarning("确定要删除 "+e.tag_name+"标签吗？").then((async()=>{this.queryLoading=!0;try{await this.$api.tag.delete({id:e.id});let t=this.tagList.findIndex((t=>t.id===e.id));this.tagList.splice(t,1),this.$message.success(e.tag_name+"删除成功")}catch(t){}finally{this.queryLoading=!1}})).catch((e=>{}))},async upload(e){this.form.file=e,console.log(e),this.form.image_name=e.name},async createImage(){this.saveLoading=!0;let e=this.$libs.formatFormData(this.form);try{let t=await this.$api.picture.create(e);this.data.unshift(t.data),this.drawer.visible=!1,this.$message.success("新增成功")}catch(t){}finally{this.saveLoading=!1}},async updateImage(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id;try{await this.$api.picture.update(e);let t=this.data.findIndex((t=>t.id===e.id));this.$set(this.data,t,this.$libs.getAssignKeyData(this.selectItem,e)),this.drawer.visible=!1,this.$message.success("更新成功")}catch(t){}finally{this.saveLoading=!1}},async deleteImage(e){let t=e.$index;e=e.row,this.$tool.confirmWarning("确定要删除"+e.image_name+"吗？").then((()=>{this.$api.picture.delete({id:e.id}).then((e=>{this.data.splice(t,1),this.$message.success("删除成功")}))})).catch((e=>{}))}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("el-card",{staticClass:"search-card",staticStyle:{"margin-bottom":"20px"}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"图片类别"}},[a("el-select",{staticStyle:{width:"100px"},model:{value:e.query.type,callback:function(t){e.$set(e.query,"type",t)},expression:"query.type"}},[a("el-option",{attrs:{label:"歌曲封面",value:1}}),a("el-option",{attrs:{label:"推广图片",value:2}})],1)],1)],1),a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap"}},[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getPictureList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.getPictureList()}}},[e._v("重置")])],1)],1)]),a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,loading:e.loading},on:{changePage:e.getPictureList},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-row",{attrs:{type:"flex"}},[a("el-col",[a("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(t){e.action="add",e.drawer.visible=!0}}},[e._v("新增图片")])],1)],1)]},proxy:!0},{key:"item.type",fn:function(t){var i=t.scope;return[1===i.row.type?a("el-tag",{attrs:{size:"mini",type:"primary"}},[e._v("歌曲封面")]):e._e(),2===i.row.type?a("el-tag",{attrs:{size:"mini"}},[e._v("推广图片")]):e._e()]}},{key:"item.path",fn:function(t){var i=t.scope;return[a("el-image",{staticClass:"table-logo",attrs:{src:e.$config.staticUrl()+i.row.path,fit:"contain",previewSrcList:[e.$config.staticUrl()+i.row.path]}})]}},{key:"item.action",fn:function(t){var i=t.scope;return[a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){e.action="edit",e.selectItem=i.row,e.drawer.visible=!0}}},[e._v("编辑")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.deleteImage(i)}}},[e._v("删除")])]}}])})],1),a("add-edit-picture",{attrs:{type:e.action,data:e.selectItem},on:{success:e.handleAction},model:{value:e.drawer.visible,callback:function(t){e.$set(e.drawer,"visible",t)},expression:"drawer.visible"}})],1)}),[],!1,(function(e){for(let t in It)this[t]=It[t]}),"31a84319",null,null);qt.options.__file="src/pages/picture/Picture.vue";var Dt=qt.exports;const Ot={};var jt=$({name:"SongCategory",mixins:[Qe],data:()=>({headers:[{label:"分类名称",prop:"cate_name"},{label:"分类级别",prop:"level"},{label:"置顶显示",prop:"is_top"},{label:"描述",prop:"desc",tooltip:!0},{label:"操作",prop:"action"}],treeData:[],categoryList:[],form:{type:1,cate_name:"",desc:"",parent_id:"",level:1,sort:0,is_top:0,status:1}}),mounted(){this.getCategoryList()},methods:{handleAction(e="create",t=null){this.drawer.type=e,this.selectItem=t||{},"create"===e?(this.form.parent_id=0,this.form.level=1,this.drawer.title="新增分类"):"createChild"===e?(this.form.parent_id=t.id,this.form.level=t.level+1,this.drawer.title="新增子分类"):"update"===e&&(this.$libs.getAssignKeyData(this.form,t),this.drawer.title="编辑分类"),this.drawer.visible=!0},async getCategoryList(){this.loading=!0;let e=(await this.$api.category.queryAll({type:1})).data;this.categoryList=e,this.setTreeData(e),this.loading=!1},async createCategory(){this.saveLoading=!0;try{let e=await this.$api.category.create(this.form);this.categoryList.push(e.data),await this.setTreeData(),this.drawer.visible=!1,this.$message.success("创建成功")}catch(e){}finally{this.saveLoading=!1}},async updateCategory(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id;try{await this.$api.category.update(e);(async()=>{let t=this.categoryList,a=t.findIndex((t=>t.id===e.id));t[a]=e,await this.setTreeData(t)})(),this.drawer.visible=!1,this.$message.success("更新成功")}catch(t){}finally{this.saveLoading=!1}},async deleteCategory(e){this.$tool.confirmWarning("确定要删除"+e.cate_name+"吗？将会连同子分类一起删除！").then((()=>{this.$api.category.delete({id:e.id}).then((t=>{(async()=>{let t=this.categoryList,a=t.findIndex((t=>t.id===e.id));t.splice(a,1),await this.setTreeData(t)})(),this.drawer.visible=!1,this.$message.success("删除成功")}))})).catch((e=>{}))},async setTreeData(e=this.categoryList){this.treeData=this.$libs.formatTreeData(JSON.parse(JSON.stringify(e)))},async switchStatus(e,t,a){let i={id:a.id};i[e]=t,this.$api.category.update(i).then((e=>{this.$message.success("更新成功")})).catch((e=>{a.status=0===t?1:0}))}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-table",{attrs:{headers:t.headers,data:t.treeData,"row-key":"id","highlight-current-row":!0,"is-pagination":"",total:t.total},scopedSlots:t._u([{key:"header",fn:function(){return[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleAction("create")}}},[t._v("新增分类")])]},proxy:!0},{key:"item.is_top",fn:function(e){var a=e.scope;return[i("el-switch",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{"active-color":"#f56c6c","active-value":1,"inactive-value":0},on:{change:function(e){return t.switchStatus("is_top",e,a.row)}},model:{value:a.row.is_top,callback:function(e){t.$set(a.row,"is_top",e)},expression:"scope.row.is_top"}})]}},{key:"item.action",fn:function(e){var a=e.scope;return[i("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(e){return t.handleAction("createChild",a.row)}}},[t._v("新增子分类")]),i("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(e){return t.handleAction("update",a.row)}}},[t._v("编辑")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"danger",size:"mini",plain:""},on:{click:function(e){return t.deleteCategory(a.row)}}},[t._v("删除")])]}}])})],1),i("k-drawer",{attrs:{visible:t.drawer.visible,title:t.drawer.title,size:"35%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取 消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary",loading:t.saveLoading},on:{click:function(e){"update"===t.drawer.type?t.updateCategory():t.createCategory()}}},[t._v("保 存")])]},proxy:!0}])},[i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"父级分类"}},[i("el-select",{attrs:{disabled:""},model:{value:t.form.parent_id,callback:function(e){t.$set(t.form,"parent_id",e)},expression:"form.parent_id"}},[i("el-option",{attrs:{label:"顶级分类",value:0}}),i("el-option",{attrs:{label:t.selectItem.cate_name,value:t.selectItem.id}})],1)],1),i("el-form-item",{attrs:{label:"分类级别"}},[i("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:t.form.level,callback:function(e){t.$set(t.form,"level",e)},expression:"form.level"}},[i("el-option",{attrs:{label:"顶级权限",value:1}})],1)],1),i("el-form-item",{attrs:{label:"排序"}},[i("el-input-number",{attrs:{min:0,max:255,label:"排序",size:"mini"},model:{value:t.form.sort,callback:function(e){t.$set(t.form,"sort",e)},expression:"form.sort"}})],1),i("el-form-item",{attrs:{label:"置顶显示"}},[i("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.form.is_top,callback:function(e){t.$set(t.form,"is_top",e)},expression:"form.is_top"}})],1),i("el-form-item",{attrs:{label:"分类名称",required:""}},[i("el-input",{model:{value:t.form.cate_name,callback:function(e){t.$set(t.form,"cate_name",e)},expression:"form.cate_name"}})],1),i("el-form-item",{attrs:{label:"描述"}},[i("el-input",{model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),i("el-form-item",{attrs:{label:"是否启用"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[i("el-radio",{attrs:{label:1}},[t._v("启用")]),i("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1)],1)],1)],1)],1)],1)}),[],!1,(function(e){for(let t in Ot)this[t]=Ot[t]}),"66f2bcae",null,null);jt.options.__file="src/pages/song/SongCategory.vue";var Ft=jt.exports;const Et={name:"Order",mixins:[Qe,gt],props:{isComponent:{type:Boolean,default:!1},buyId:{type:Number},userMobile:{type:String}},data(){return{preview:{visible:!1},headers:[{label:"id",prop:"id",width:50},{label:"订单类型",prop:"order_type",width:80},{label:"订单编号",prop:"order_no",tooltip:!0},{label:"订单标题",prop:"subject",tooltip:!0},{label:"订单金额",prop:"total_amount"},{label:"支付金额",prop:"pay_amount"},{label:"创建人",prop:"nickname"},{label:"创建时间",prop:"created_at",type:"date",format:"YYYY-MM-DD HH:mm:ss",tooltip:this.isComponent},{label:"订单状态",prop:"order_status"},{label:"操作",prop:"action"}],data:[],dateTime:[],query:{buy_id:this.buyId?this.buyId:null,order_type:null,order_status:null,order_no:null,start_time:null,end_time:null,subject:null,mobile:this.userMobile?this.userMobile:null},orderStatus:[{label:"创建",value:"CREATE"},{label:"等待支付",value:"WAITPAY"},{label:"完成",value:"SUCCESS"},{label:"取消",value:"CANCEL"},{label:"退款",value:"REFUND"}],orderLog:[],orderGoods:[],expandLoading:!1}},mounted(){this.getOrderList()},methods:{async getOrderList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.order.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},async cancelOrder(e){this.$tool.confirmWarning("确定要取消"+e.subject+"订单吗？").then((async()=>{try{await this.$api.order.cancel({id:e.id});e.order_status="CANCEL",this.$message.success("订单取消成功")}catch(t){console.log(t)}})).catch((e=>{}))},async showOrderLog(e,t){e&&(this.expandLoading=!0,await this.getOrderLog(t.id),await this.getOrderGoods(t.id),this.expandLoading=!1)},async getOrderLog(e){try{let t=await this.$api.orderLog.batchQuery({order_id:e});this.orderLog=t.data.data}catch(t){}},async getOrderGoods(e){try{let t=await this.$api.orderGoods.batchQuery({order_id:e});this.orderGoods=t.data.data}catch(t){}}}},Nt={};var Bt=$(Et,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("el-card",{staticClass:"search-card",staticStyle:{"margin-bottom":"20px"}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"订单类型"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.query.order_type,callback:function(t){e.$set(e.query,"order_type",t)},expression:"query.order_type"}},[a("el-option",{attrs:{label:"普通订单",value:1}}),a("el-option",{attrs:{label:"代付订单",value:2}})],1)],1),a("el-form-item",{attrs:{label:"订单状态"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.query.order_status,callback:function(t){e.$set(e.query,"order_status",t)},expression:"query.order_status"}},e._l(e.orderStatus,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"订单编号"}},[a("el-input",{attrs:{maxlength:"64"},model:{value:e.query.order_no,callback:function(t){e.$set(e.query,"order_no",t)},expression:"query.order_no"}})],1),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}})],1),a("el-form-item",{attrs:{label:"订单标题"}},[a("el-input",{attrs:{maxlength:"32"},model:{value:e.query.subject,callback:function(t){e.$set(e.query,"subject",t)},expression:"query.subject"}})],1),a("el-form-item",{attrs:{label:"用户手机号"}},[a("el-input",{model:{value:e.query.mobile,callback:function(t){e.$set(e.query,"mobile",t)},expression:"query.mobile"}})],1)],1),a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap"}},[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getOrderList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getOrderList()}}},[e._v("重置")])],1)],1)]),a("k-table",{attrs:{headers:e.headers,data:e.data,"show-expand":"","is-pagination":"",total:e.total,"zoom-height":e.isComponent?140:130,loading:e.loading},on:{changePage:e.getOrderList,"expand-change":e.showOrderLog},scopedSlots:e._u([{key:"item.order_type",fn:function(t){var i=t.scope;return[1===i.row.order_type?a("el-tag",{attrs:{size:"mini"}},[e._v("普通订单")]):e._e(),2===i.row.order_type?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("代付订单")]):e._e()]}},{key:"item.nickname",fn:function(t){var i=t.scope;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.row.mobile,placement:"top-start"}},[a("span",[e._v(e._s(i.row.nickname?i.row.nickname:i.row.mobile))])])]}},{key:"item.order_status",fn:function(t){var i=t.scope;return["CREATE"===i.row.order_status?a("el-tag",{attrs:{size:"mini",type:""}},[e._v("创建")]):e._e(),"SUCCESS"===i.row.order_status?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("完成")]):e._e(),"WAITPAY"===i.row.order_status?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("等待支付")]):e._e(),"CANCEL"===i.row.order_status?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("取消")]):e._e(),"REFUND"===i.row.order_status?a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("退款")]):e._e()]}},{key:"item.action",fn:function(t){var i=t.scope;return[a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",plain:"",type:"warning",disabled:"CREATE"!==i.row.order_status&&"WAITPAY"!==i.row.order_status},on:{click:function(t){return e.cancelOrder(i.row)}}},[e._v("取消订单")])]}},{key:"expand-item",fn:function(t){return t.scope,[a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.expandLoading,expression:"expandLoading"}]},[a("el-divider",{attrs:{"content-position":"left"}},[e._v("订单日志")]),e._l(e.orderLog,(function(t,i){return a("k-descriptions",{key:i,attrs:{bottom:"2px",divider:e.orderLog.length!==i+1}},[a("k-descriptions-item",{attrs:{label:"时间"}},[e._v(e._s(e.$dayjs.unix(t.created_at).format("YYYY-MM-DD HH:mm:ss")))]),a("k-descriptions-item",{attrs:{label:"状态"}},["CREATE"===t.order_status?a("el-tag",{attrs:{size:"mini",type:""}},[e._v("创建")]):e._e(),"SUCCESS"===t.order_status?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("完成")]):e._e(),"WAITPAY"===t.order_status?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("等待支付")]):e._e(),"CANCEL"===t.order_status?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("取消")]):e._e(),"REFUND"===t.order_status?a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("退款")]):e._e()],1),a("k-descriptions-item",{attrs:{label:"操作"}},[e._v(e._s(t.action))]),t.admin_id?a("k-descriptions-item",{attrs:{label:"操作人"}},[e._v(e._s("管理员-"+t.username))]):e._e(),t.user_id?a("k-descriptions-item",{attrs:{label:"操作人"}},[e._v(e._s("用户-"+(t.nickname?t.nickname:t.mobile)))]):e._e(),t.user_id||t.admin_id?e._e():a("k-descriptions-item",{attrs:{label:"操作人"}},[e._v("系统")])],1)})),a("el-divider",{attrs:{"content-position":"left"}},[e._v("订单歌曲")]),e._l(e.orderGoods,(function(t,i){return a("k-descriptions",{key:"goods"+i,attrs:{bottom:"0"}},[a("k-descriptions-item",{attrs:{label:"歌曲名称"}},[e._v(e._s(t.song_name))]),a("k-descriptions-item",{attrs:{label:"价格"}},[a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.goods_price))])],1),a("k-descriptions-item",{attrs:{label:"音乐"}},[a("span",{staticClass:"material-icons",on:{click:function(a){e.selectItem=t,e.preview.visible=!0}}},[e._v("play_circle_outline")])])],1)}))],2)]}}])})],1),a("k-preview",{attrs:{show:e.preview.visible,title:e.selectItem.song_name,type:"audio",src:e.selectItem.file},on:{"update:show":function(t){return e.$set(e.preview,"visible",t)}}})],1)}),[],!1,(function(e){for(let t in Nt)this[t]=Nt[t]}),"50468098",null,null);Bt.options.__file="src/pages/order/Order.vue";var Rt=Bt.exports;const Ut={};var Vt=$({name:"Buy",components:{Order:Rt},mixins:[Qe,gt],data:()=>({previewVoice:{visible:!1},headers:[{label:"id",prop:"id",width:50},{label:"代付编号",prop:"buy_no",tooltip:!0},{label:"代付标题",prop:"subject",tooltip:!0},{label:"代付总金额",prop:"total_amount"},{label:"支付金额",prop:"pay_amount"},{label:"未付款金额",prop:"unpaid_amount"},{label:"锁定金额",prop:"lock_amount"},{label:"代付每份金额",prop:"each_amount"},{label:"参与人次",prop:"orders_count"},{label:"完成人次",prop:"orders_success"},{label:"发起人",prop:"nickname"},{label:"创建时间",prop:"created_at",tooltip:!0,type:"date",format:"YYYY-MM-DD HH:mm:ss"},{label:"状态",prop:"buy_status"},{label:"操作",prop:"action"}],buyStatus:[{label:"创建",value:"CREATE"},{label:"等待支付",value:"WAITPAY"},{label:"完成",value:"SUCCESS"},{label:"取消",value:"CANCEL"},{label:"退款",value:"REFUND"}],data:[],query:{buy_status:null,buy_no:null,start_time:null,end_time:null,subject:null}}),mounted(){this.getBuyList()},methods:{async getBuyList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.buy.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},async showBuyInfo(e,t){e&&(this.selectItem=t)}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("el-card",{staticClass:"search-card",staticStyle:{"margin-bottom":"20px"}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"代购状态"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.query.buy_status,callback:function(t){e.$set(e.query,"buy_status",t)},expression:"query.buy_status"}},e._l(e.buyStatus,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"代购编号"}},[a("el-input",{attrs:{maxlength:"64"},model:{value:e.query.buy_no,callback:function(t){e.$set(e.query,"buy_no",t)},expression:"query.buy_no"}})],1),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}})],1),a("el-form-item",{attrs:{label:"代购标题"}},[a("el-input",{attrs:{maxlength:"32"},model:{value:e.query.subject,callback:function(t){e.$set(e.query,"subject",t)},expression:"query.subject"}})],1)],1),a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap"}},[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getBuyList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getBuyList()}}},[e._v("重置")])],1)],1)]),a("k-table",{attrs:{headers:e.headers,data:e.data,"show-expand":"","is-pagination":"","zoom-height":94,total:e.total,loading:e.loading},on:{"expand-change":e.showBuyInfo,changePage:e.getBuyList},scopedSlots:e._u([{key:"item.nickname",fn:function(t){var i=t.scope;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.row.mobile,placement:"top-start"}},[a("span",[e._v(e._s(i.row.nickname?i.row.nickname:i.row.mobile))])])]}},{key:"item.buy_status",fn:function(t){var i=t.scope;return["CREATE"===i.row.buy_status?a("el-tag",{attrs:{size:"mini",type:""}},[e._v("创建")]):e._e(),"SUCCESS"===i.row.buy_status?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("完成")]):e._e(),"WAITPAY"===i.row.buy_status?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("等待支付")]):e._e(),"CANCEL"===i.row.buy_status?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("取消")]):e._e(),"REFUND"===i.row.buy_status?a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("退款")]):e._e()]}},{key:"expand-item",fn:function(){return[e.selectItem.song_name?a("k-descriptions",[a("k-descriptions-item",{attrs:{label:"歌曲名称"}},[e._v(e._s(e.selectItem.song_name))]),a("k-descriptions-item",{attrs:{label:"价格"}},[a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.selectItem.price))])],1),a("k-descriptions-item",{attrs:{label:"音乐"}},[a("span",{staticClass:"material-icons",on:{click:function(t){e.preview.visible=!0}}},[e._v("play_circle_outline")])]),e.selectItem.voice?a("k-descriptions-item",{attrs:{label:"语音"}},[a("span",{staticClass:"material-icons",on:{click:function(t){e.previewVoice.visible=!0}}},[e._v("play_circle_outline")])]):e._e()],1):e._e()]},proxy:!0},{key:"item.action",fn:function(t){var i=t.scope;return[a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){e.selectItem=i.row,e.drawer.title=e.selectItem.subject,e.drawer.visible=!0}}},[e._v("查看订单")])]}}])})],1),a("k-preview",{attrs:{show:e.preview.visible,title:e.selectItem.song_name,type:"audio",src:e.selectItem.file},on:{"update:show":function(t){return e.$set(e.preview,"visible",t)}}}),a("k-preview",{attrs:{show:e.previewVoice.visible,title:e.selectItem.subject,type:"audio",src:e.selectItem.voice},on:{"update:show":function(t){return e.$set(e.previewVoice,"visible",t)}}}),a("k-drawer",{attrs:{visible:e.drawer.visible,title:e.drawer.title+"/代付订单",size:"55%","destroy-on-close":""},on:{"update:visible":function(t){return e.$set(e.drawer,"visible",t)}}},[e.selectItem.id?a("order",{attrs:{"buy-id":e.selectItem.id,"is-component":""}}):e._e()],1)],1)}),[],!1,(function(e){for(let t in Ut)this[t]=Ut[t]}),"47cd41b4",null,null);Vt.options.__file="src/pages/order/Buy.vue";var Ht=Vt.exports;const Mt={};var Yt=$({name:"KEditor",components:{Editor:u},data:()=>({data:"",tinymceInit:{selector:"#tiny",branding:!1,language_url:"/tinymce/langs/zh_CN.js",language:"zh_CN",plugins:["emoticons","image","imagetools","code","link","preview"],menubar:!1,toolbar_sticky:!0,toolbar:"code |undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media template link anchor codesample | ltr rtl",quickbars_selection_toolbar:"bold italic | quicklink h2 h3 blockquote quickimage quicktable",automatic_uploads:!0,paste_data_images:!0,block_unsupported_drop:!1,imagetools_toolbar:"rotateleft rotateright | flipv fliph | imageoptions",file_picker_types:"image",file_picker_callback:function(e,t,a){a.filetype},mobile:{theme:"mobile",plugins:["autosave","lists","autolink"]}}})},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("editor",e._g(e._b({attrs:{id:"tiny",init:e.tinymceInit}},"editor",e.$attrs,!1),e.$listeners))],1)}),[],!1,(function(e){for(let t in Mt)this[t]=Mt[t]}),"70348d61",null,null);Yt.options.__file="src/components/common/Editor.vue";var Kt=Yt.exports;const Qt={};var Jt=$({name:"Promote",components:{Song:Pt,Attachment:$t,KEditor:Kt},mixins:[Qe],data:()=>({attachment:{visible:!1},songDrawer:{visible:!1},headers:[{label:"id",prop:"id"},{label:"类型",prop:"type"},{label:"位置",prop:"position"},{label:"标题",prop:"title"},{label:"图片",prop:"image"},{label:"是否启用",prop:"status"},{label:"操作",prop:"action"}],data:[],form:{type:1,platform:1,position:1,title:"",image:"",content:"",url:"",song_id:null,status:1},selectSong:{}}),mounted(){this.getPromoteList()},methods:{handleAction(e,t=null){this.drawer.type=e,"create"===e?this.drawer.title="新增广告":"update"===e&&(this.selectItem=t,this.drawer.title="更新广告",this.getPromoteInfo()),this.drawer.visible=!0},async getPromoteInfo(){this.queryLoading=!0;try{let e=(await this.$api.promote.query(this.selectItem.id)).data;this.$libs.getAssignKeyData(this.form,e),this.$refs.upload.cropPreview=this.$config.staticUrl()+e.image,this.selectSong={id:e.song_id,song_name:e.song_name}}catch(e){}finally{this.queryLoading=!1}},async getPromoteList(e={page:1,limit:10}){this.loading=!0;let t=Object.assign(e,this.$libs.filterNullObject(this.query));try{let e=await this.$api.promote.batchQuery(t);this.data=e.data.data,this.total=e.data.total}catch(a){}finally{this.loading=!1}},async createPromote(){this.saveLoading=!0;try{let e=Object.assign({},this.form);e.id=0;let t=await this.$api.promote.create(e);this.data.unshift(this.$libs.getAssignKeyData(e,t.data)),this.drawer.visible=!1,this.$refs.upload.cropPreview="",this.$message.success("新增成功")}catch(e){}finally{this.saveLoading=!1}},async updatePromote(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id;try{await this.$api.promote.update(e);let t=this.data.findIndex((t=>t.id===e.id));this.$set(this.data,t,this.$libs.getAssignKeyData(this.selectItem,e)),this.drawer.visible=!1,this.$message.success("更新成功")}catch(t){}finally{this.saveLoading=!1}},async deletePromote(e){let t=e.$index;e=e.row,this.$tool.confirmWarning("确定要删除"+e.title+"吗？").then((()=>{this.$api.promote.delete({id:e.id}).then((e=>{this.data.splice(t,1),this.$message.success("删除成功")}))})).catch((e=>{}))},async switchStatus(e,t,a){let i={id:a.id};i[e]=t,this.$api.promote.update(i).then((e=>{this.$message.success("更新成功")})).catch((e=>{a.status=0===t?1:0}))},async selcetImage(e){this.form.image=e.path,this.$refs.upload.cropPreview=this.$config.staticUrl()+e.path},resetForm(){this.form=Object.assign({},this.defaultForm)}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-table",{attrs:{headers:t.headers,data:t.data,"is-pagination":"",total:t.total,loading:t.loading},on:{changePage:t.getPromoteList},scopedSlots:t._u([{key:"header",fn:function(){return[i("el-row",{attrs:{type:"flex"}},[i("el-col",[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleAction("create")}}},[t._v("新增推广")])],1)],1)]},proxy:!0},{key:"item.type",fn:function(e){var a=e.scope;return[1===a.row.type?i("el-tag",{attrs:{size:"mini",type:"primary"}},[t._v("内容")]):t._e(),2===a.row.type?i("el-tag",{attrs:{size:"mini",type:"warning"}},[t._v("链接")]):t._e(),3===a.row.type?i("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("歌曲")]):t._e()]}},{key:"item.position",fn:function(e){return[1===e.scope.row.position?i("span",[t._v("Banner")]):t._e()]}},{key:"item.image",fn:function(e){var a=e.scope;return[a.row.image?i("el-image",{staticClass:"table-logo",attrs:{src:t.$config.staticUrl()+a.row.image,lazy:"",fit:"contain",previewSrcList:[t.$config.staticUrl()+a.row.image]}}):t._e()]}},{key:"item.status",fn:function(e){var a=e.scope;return[i("el-switch",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{"active-value":1,"inactive-value":0},on:{change:function(e){return t.switchStatus("status",e,a.row)}},model:{value:a.row.status,callback:function(e){t.$set(a.row,"status",e)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(e){var a=e.scope;return[i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleAction("update",a.row)}}},[t._v("编辑")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.deletePromote(a)}}},[t._v("删除")])]}}])})],1),i("k-drawer",{attrs:{visible:t.drawer.visible,title:t.drawer.title,size:"45%"},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",disabled:t.saveLoading,loading:t.saveLoading},on:{click:function(e){"update"===t.drawer.type?t.updatePromote():t.createPromote()}}},[t._v("保存")])]},proxy:!0}])},[i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.queryLoading,expression:"queryLoading"}],attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"推广位置"}},[i("el-select",{model:{value:t.form.position,callback:function(e){t.$set(t.form,"position",e)},expression:"form.position"}},[i("el-option",{attrs:{value:1,label:"Banner"}})],1)],1),i("el-form-item",{attrs:{label:"广告类型"}},[i("el-select",{model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[i("el-option",{attrs:{value:1,label:"内容"}}),i("el-option",{attrs:{value:2,label:"链接"}}),i("el-option",{attrs:{value:3,label:"歌曲"}})],1)],1),i("el-form-item",{attrs:{label:"标题"}},[i("el-input",{model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),i("el-form-item",{attrs:{label:"图片"}},[i("k-upload-image",{ref:"upload",attrs:{accept:"image/jpeg,image/png","is-cropper":!1,disabled:!0,upload:function(){}},on:{delete:function(e){t.form.image=""},click:function(e){t.attachment.visible=!0}}})],1),3===t.form.type?i("el-form-item",{attrs:{label:"选择歌曲"}},[!1===this.songDrawer.visible?i("el-select",{on:{"visible-change":function(t){t&&(e.songDrawer.visible=!0)}},model:{value:t.form.song_id,callback:function(e){t.$set(t.form,"song_id",e)},expression:"form.song_id"}},[i("el-option",{attrs:{label:t.selectSong.song_name,value:t.selectSong.id}})],1):t._e()],1):t._e(),i("el-form-item",{attrs:{label:"链接"}},[i("el-input",{model:{value:t.form.url,callback:function(e){t.$set(t.form,"url",e)},expression:"form.url"}})],1),i("el-form-item",{attrs:{label:"内容"}},[t.drawer.visible?i("k-editor",{model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}}):t._e()],1),i("el-form-item",{attrs:{label:"是否启用"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[i("el-radio",{attrs:{label:1}},[t._v("启用")]),i("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1)],1)],1)],1)],1),i("attachment",{attrs:{visible:t.attachment.visible},on:{"update:visible":function(e){return t.$set(t.attachment,"visible",e)},select:t.selcetImage}}),i("k-drawer",{attrs:{visible:t.songDrawer.visible,size:"55%"},on:{"update:visible":function(e){return t.$set(t.songDrawer,"visible",e)}}},[i("song",{attrs:{"is-component":""},on:{select:function(t){e.selectSong=t,e.form.song_id=t.id,e.songDrawer.visible=!1}}})],1)],1)}),[],!1,(function(e){for(let t in Qt)this[t]=Qt[t]}),"56ee6626",null,null);Jt.options.__file="src/pages/Promote.vue";var Wt=Jt.exports;const Gt={};var Xt=$({name:"UserLog",mixins:[Qe],data:()=>({headers:[{label:"手机号",prop:"mobile"},{label:"用户昵称",prop:"nickname"},{label:"url",prop:"url",tooltip:!0},{label:"操作",prop:"action",tooltip:!0},{label:"内容",prop:"content",tooltip:!0},{label:"ip",prop:"ip"},{label:"ua",prop:"ua",tooltip:!0},{label:"时间",prop:"created_at",type:"date",format:"YYYY-MM-DD HH:mm:ss"}],data:[]}),mounted(){this.getUserLogList()},methods:{async getUserLogList(e={page:1,limit:10}){this.loading=!0;try{let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.userLog.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total},on:{changePage:e.getUserLogList}})],1)],1)}),[],!1,(function(e){for(let t in Gt)this[t]=Gt[t]}),"3ff5c25a",null,null);Xt.options.__file="src/pages/log/UserLog.vue";var Zt=Xt.exports;const ea={};var ta=$({name:"ExceptionLog",mixins:[Qe],data:()=>({headers:[{label:"异常类型",prop:"type"},{label:"错误代码",prop:"code"},{label:"错误信息",prop:"message",tooltip:!0},{label:"请求路径",prop:"path",tooltip:!0},{label:"详细记录",prop:"desc",tooltip:!0},{label:"请求内容",prop:"request",tooltip:!0},{label:"时间",prop:"created_at",type:"date",format:"YYYY-MM-DD HH:mm:ss"}],data:[]}),mounted(){this.getExceptionLogList()},methods:{async getExceptionLogList(e={page:1,limit:10}){this.loading=!0;try{let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.exceptionLog.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},showPayload(e){this.selectItem=e;try{let t=JSON.parse(e.desc);this.selectItem.content=JSON.stringify(t,null,2)}catch(t){this.selectItem.content=e.desc.split("-")}this.drawer.visible=!0}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-table",{attrs:{headers:t.headers,data:t.data,"is-pagination":"",total:t.total,loading:t.loading},on:{changePage:t.getExceptionLogList,"row-click":t.showPayload},scopedSlots:t._u([{key:"item.type",fn:function(e){var a=e.scope;return["system"===a.row.type?i("el-tag",{attrs:{type:"danger",size:"mini"}},[t._v(t._s(a.row.type))]):i("el-tag",{attrs:{type:"primary",size:"mini"}},[t._v(t._s(a.row.type))])]}}])})],1),i("k-drawer",{attrs:{visible:t.drawer.visible,size:"45%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20}}},[i("pre",[t._v(t._s(t.selectItem.content))])])],1)}),[],!1,(function(e){for(let t in ea)this[t]=ea[t]}),"69840158",null,null);ta.options.__file="src/pages/log/ExceptionLog.vue";var aa=ta.exports;const ia={};var sa=$({name:"AdminLog",mixins:[Qe],data:()=>({headers:[{label:"用户名",prop:"username"},{label:"url",prop:"url",tooltip:!0},{label:"操作",prop:"action",tooltip:!0},{label:"内容",prop:"content",tooltip:!0},{label:"ip",prop:"ip"},{label:"ua",prop:"ua",tooltip:!0},{label:"时间",prop:"created_at",type:"date",format:"YYYY-MM-DD HH:mm:ss"}],data:[]}),mounted(){this.getAdminLogList()},methods:{async getAdminLogList(e={page:1,limit:10}){this.loading=!0;try{let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.adminLog.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total},on:{changePage:e.getAdminLogList}})],1)],1)}),[],!1,(function(e){for(let t in ia)this[t]=ia[t]}),"0e739f84",null,null);sa.options.__file="src/pages/log/AdminLog.vue";var ra=sa.exports;const la={};var oa=$({name:"User",components:{Order:Rt},mixins:[Qe,gt],data:()=>({headers:[{label:"id",prop:"id"},{label:"手机号",prop:"mobile"},{label:"昵称",prop:"nickname"},{label:"性别",prop:"gender"},{label:"头像",prop:"avatar"},{label:"所在地",prop:"city"},{label:"消费金额",prop:"sum_amount"},{label:"创建时间",prop:"created_at",type:"date"},{label:"用户订单",prop:"order"},{label:"操作",prop:"action"}],data:[],query:{nickname:null,mobile:null,start_time:null,end_time:null}}),mounted(){this.getUserList()},methods:{async getUserList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.user.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},async disabledUser(e){this.$tool.confirmWarning(`确定要禁用${e.nickname?e.nickname:e.mobile}这个用户吗？`).then((()=>{this.switchStatus("status",0,e)})).catch((()=>{}))},async switchStatus(e,t,a){let i={id:a.id};i[e]=t,this.$api.user.disable(i).then((i=>{a[e]=t,this.$message.success("更新成功")})).catch((e=>{a.status=0===t?1:0}))}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("el-card",{staticClass:"search-card",staticStyle:{"margin-bottom":"20px"}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"手机号"}},[a("el-input",{model:{value:e.query.mobile,callback:function(t){e.$set(e.query,"mobile",t)},expression:"query.mobile"}})],1),a("el-form-item",{attrs:{label:"昵称"}},[a("el-input",{attrs:{maxlength:"32"},model:{value:e.query.nickname,callback:function(t){e.$set(e.query,"nickname",t)},expression:"query.nickname"}})],1),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}})],1)],1),a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap"}},[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getUserList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getUserList()}}},[e._v("重置")])],1)],1)]),a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,loading:e.loading},on:{changePage:e.getUserList},scopedSlots:e._u([{key:"item.gender",fn:function(t){var i=t.scope;return[0===i.row.gender?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("未知")]):e._e(),1===i.row.gender?a("el-tag",{attrs:{size:"mini",type:"primary"}},[e._v("男")]):e._e(),2===i.row.gender?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("女")]):e._e()]}},{key:"item.avatar",fn:function(t){var i=t.scope;return[i.row.avatar?a("el-image",{staticClass:"table-logo",attrs:{src:i.row.avatar,lazy:"",fit:"contain",previewSrcList:[i.row.avatar]}}):e._e()]}},{key:"item.city",fn:function(t){var i=t.scope;return[a("span",[e._v(e._s(i.row.province+"/"+i.row.city))])]}},{key:"item.sum_amount",fn:function(t){var i=t.scope;return[a("el-tag",{attrs:{type:i.row.sum_amount?"success":"info",size:"mini"}},[e._v(e._s(i.row.sum_amount?i.row.sum_amount:0))])]}},{key:"item.order",fn:function(t){var i=t.scope;return[a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){e.selectItem=i.row,e.drawer.visible=!0}}},[e._v("查看订单")])]}},{key:"item.action",fn:function(t){var i=t.scope;return[1===i.row.status?a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.disabledUser(i.row)}}},[e._v(" 禁用用户 ")]):e._e(),0===i.row.status?a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"success",plain:""},on:{click:function(t){return e.switchStatus("status",1,i.row)}}},[e._v("启用用户")]):e._e()]}}])})],1),a("k-drawer",{attrs:{visible:e.drawer.visible,title:(e.selectItem.nickname?e.selectItem.nickname:e.selectItem.mobile)+"/用户订单",size:"55%","destroy-on-close":""},on:{"update:visible":function(t){return e.$set(e.drawer,"visible",t)}}},[a("order",{attrs:{"is-component":"","user-mobile":e.selectItem.mobile}})],1)],1)}),[],!1,(function(e){for(let t in la)this[t]=la[t]}),"4cc49fbc",null,null);oa.options.__file="src/pages/user/User.vue";var na=oa.exports,ca={props:{header:{type:String},data:{type:Array,default:()=>[]},xField:{type:String},yField:{type:String},seriesField:{type:String},meta:{type:Object},height:{type:Number},color:{type:String}},data:()=>({chartId:"",chart:{},defaultTheme:{styleSheet:{brandColor:"#5B8FF9",paletteQualitative10:["#5B8FF9","#61DDAA","#65789B","#F6BD16","#7262fd","#78D3F8","#9661BC","#F6903D","#008685","#F08BB4"],paletteQualitative20:["#5B8FF9","#CDDDFD","#61DDAA","#CDF3E4","#65789B","#CED4DE","#F6BD16","#FCEBB9","#7262fd","#D3CEFD","#78D3F8","#D3EEF9","#9661BC","#DECFEA","#F6903D","#FFE0C7","#008685","#BBDEDE","#F08BB4","#FFE0ED"]}}}),created(){this.chartId="chart"+Math.round(1e3*Math.random())+(new Date).getTime()},mounted(){this.init()},watch:{data(e,t){this.chart.changeData(e),this.chart.render()}}};const pa={};var da=$({name:"LineChart",mixins:[ca],methods:{init(){const e=new m(this.chartId,{data:this.data,height:this.height,xField:this.xField,yField:this.yField,seriesField:this.seriesField,meta:this.meta,label:{},point:{size:5,shape:"diamond",style:{fill:"white",stroke:"#5B8FF9",lineWidth:2}},tooltip:{showMarkers:!1},state:{active:{style:{shadowBlur:4,stroke:"#000",fill:"red"}}},interactions:[{type:"marker-active"}]});e.update({theme:{styleSheet:{brandColor:this.color?this.color:"#5B8FF9"}}}),e.render(),this.chart=e}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"chart",attrs:{shadow:"hover",header:e.header},scopedSlots:e._u([{key:"header",fn:function(){return[e._t("header")]},proxy:!0}],null,!0)},[a("div",{ref:"chart",attrs:{id:e.chartId}}),e.data&&e.data.length?e._e():a("div",{staticClass:"tip"},[a("p",[e._v("暂无数据")])])])}),[],!1,(function(e){for(let t in pa)this[t]=pa[t]}),"662e2afa",null,null);da.options.__file="src/components/chart/LineChart.vue";var ua=da.exports;const ma={};var ha=$({name:"ColumnChart",mixins:[ca],methods:{init(){const e=new h(this.chartId,{data:this.data,height:this.height,xField:this.xField,yField:this.yField,label:{position:"middle",style:{fill:"#FFFFFF",opacity:.6}},xAxis:{label:{autoHide:!0,autoRotate:!1}},meta:this.meta});e.update({theme:{styleSheet:{brandColor:this.color?this.color:"#5B8FF9"}}}),e.render(),this.chart=e}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"chart",attrs:{shadow:"hover",header:e.header},scopedSlots:e._u([{key:"header",fn:function(){return[e._t("header")]},proxy:!0}],null,!0)},[a("div",{ref:"chart",attrs:{id:e.chartId}}),e.data&&e.data.length?e._e():a("div",{staticClass:"tip"},[a("p",[e._v("暂无数据")])])])}),[],!1,(function(e){for(let t in ma)this[t]=ma[t]}),"06bedc34",null,null);ha.options.__file="src/components/chart/ColumnChart.vue";var fa=ha.exports;const ga={};var ya=$({name:"AreaChart",mixins:[ca],methods:{init(){const e=new f(this.chartId,{data:this.data,height:this.height,smooth:!0,xField:this.xField,yField:this.yField,xAxis:{range:[0,1]},point:{size:5,shape:"diamond",style:{fill:"white",stroke:"#5B8FF9",lineWidth:2}},label:{},meta:this.meta});e.update({theme:{styleSheet:{brandColor:this.color?this.color:"#5B8FF9"}}}),e.render(),this.chart=e}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"chart",attrs:{shadow:"hover",header:e.header},scopedSlots:e._u([{key:"header",fn:function(){return[e._t("header")]},proxy:!0}],null,!0)},[a("div",{ref:"chart",attrs:{id:e.chartId}}),e.data.length?e._e():a("div",{staticClass:"tip"},[a("p",[e._v("暂无数据")])])])}),[],!1,(function(e){for(let t in ga)this[t]=ga[t]}),"2c235f39",null,null);ya.options.__file="src/components/chart/AreaChart.vue";var va=ya.exports;const ba={};var _a=$({name:"Analytics",components:{TreeSelect:St,AreaChart:va,ColumnChart:fa,LineChart:ua,AStatistic:g},data:()=>({loading:!1,data:{day_sales:[],month_sales:[],day_order_num:[],month_order_num:[]}}),mounted(){this.getAnalysis()},methods:{async getAnalysis(){this.loading=!0;try{let e=await this.$api.analysis.index();this.data=e.data}catch(e){}finally{this.loading=!1}}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-col",{attrs:{span:24}},[a("el-row",{attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{attrs:{title:"总销售额",prefix:"￥",property:2,value:e.data.sales}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{attrs:{title:"订单数量",value:e.data.order_num}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{staticStyle:{"margin-right":"50px"},attrs:{title:"用户数量",value:e.data.user_num}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{attrs:{title:"歌曲数量",value:e.data.song_num}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{attrs:{title:"已售歌曲",value:e.data.song_sales_num}})],1)],1)],1),a("el-row",{attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:12}},[a("area-chart",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.data.day_sales,"x-field":"date","y-field":"sales",meta:{sales:{alias:"金额"}},height:220,header:"最近30天销售额"}})],1),a("el-col",{attrs:{span:12}},[a("area-chart",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.data.month_sales,"x-field":"date","y-field":"sales",meta:{sales:{alias:"金额"}},height:220,header:"最近12月销售额"}})],1)],1),a("el-row",{attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:12}},[a("column-chart",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.data.day_order_num,"x-field":"date","y-field":"num",meta:{num:{alias:"数量"}},color:"#1AAF8B",height:220,header:"最近30天订单量"}})],1),a("el-col",{attrs:{span:12}},[a("column-chart",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.data.month_order_num,"x-field":"date","y-field":"num",meta:{num:{alias:"数量"}},color:"#F6BD16",height:220,header:"最近12月订单量"}})],1)],1)],1)],1)}),[],!1,(function(e){for(let t in ba)this[t]=ba[t]}),"ade5ed02",null,null);_a.options.__file="src/pages/dashboard/Analysis.vue";var wa=_a.exports;const xa={};var ka=$({name:"SystemSetting"},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("h1",[e._v("系统设置")])}),[],!1,(function(e){for(let t in xa)this[t]=xa[t]}),"5239fe4e",null,null);ka.options.__file="src/pages/system/Setting.vue";const $a=[{name:"Login",path:"/login",component:Be,meta:{tab:!1}},{path:"/",component:He,redirect:"/analysis",meta:{title:"首页"},children:[{name:"Analytics",path:"analysis",component:wa,meta:{title:"首页",breadcrumb:!1,closable:!1}},{name:"Profile",path:"profile",component:ft,meta:{title:"个人中心"}},{name:"Song",path:"song",component:Pt,meta:{title:"歌曲管理"}},{name:"SongCategory",path:"song/category",component:Ft,meta:{title:"歌曲分类"}},{name:"User",path:"user",component:na,meta:{title:"用户管理"}},{name:"Picture",path:"picture",component:Dt,meta:{title:"图片管理"}},{name:"Buy",path:"buy",component:Ht,meta:{title:"代付管理"}},{name:"Order",path:"order",component:Rt,meta:{title:"订单管理"}},{name:"Promote",path:"promote",component:Wt,meta:{title:"推广管理"}},{name:"AuthAdmin",path:"auth/admin",component:Ge,meta:{title:"管理员管理"}},{name:"AuthRole",path:"auth/role",component:et,meta:{title:"角色管理"}},{name:"AuthPermission",path:"auth/permission",component:it,meta:{title:"权限管理"}},{name:"AdminLog",path:"system/AdminLog",component:ra,meta:{title:"管理员日志"}},{name:"UserLog",path:"system/userLog",component:Zt,meta:{title:"用户日志"}},{name:"ExceptionLog",path:"system/exceptionLog",component:aa,meta:{title:"异常日志"}},{name:"SystemSetting",path:"system/setting",component:ka.exports,meta:{title:"系统设置"}},...dt]}],Ca={baseUrl:()=>"https://music.maxxiang.com/",apiUrl(){return this.baseUrl()+"api/manage/"},staticUrl:()=>"https://max-sound.oss-cn-shanghai.aliyuncs.com/"},La=y.create({baseURL:Ca.apiUrl(),timeout:6e4});La.interceptors.request.use((e=>(e.headers.Authorization=window.btoa(localStorage.getItem("token")),e)),(e=>Promise.reject(e))),La.interceptors.response.use((e=>e.data),(e=>{if(e.response){let t=e.response.data;return v.Message.error(t.message),10011===t.code&&setTimeout((()=>{localStorage.removeItem("token"),location.reload()}),1e3),Promise.reject(t)}return v.Message.error(e.message),Promise.reject(!1)}));class Sa{constructor(e=""){this.path=e}query(e){return La.get(`${this.path}/query`,{params:{id:e}})}batchQuery(e){return La.get(`${this.path}/batchQuery`,{params:e})}queryAll(e){return La.get(`${this.path}/queryAll`,{params:e})}create(e){return La.post(`${this.path}/create`,e)}update(e){return La.post(`${this.path}/update`,e)}delete(e){return La.post(`${this.path}/delete`,e)}}var Ta=new class extends Sa{}("admin");var Aa=new class extends Sa{queryAll(e){return La.get(`${this.path}/queryAll`,{params:e})}}("authPermission");var za=new class extends Sa{queryAll(e){return La.get(`${this.path}/queryAll`,{params:e})}}("authRole");var Pa=new class extends Sa{verify(){return La.get(`${this.path}/captcha`)}login(e){return La.post(`${this.path}/login`,e)}logout(){return La.get(`${this.path}/logout`)}profile(){return La.get(`${this.path}/profile`)}resetPassword(e){return La.post(`${this.path}/resetPassword`,e)}};var Ia=new class extends Sa{}("song");var qa=new class extends Sa{}("picture");var Da=new class extends Sa{}("tag");var Oa=new class extends Sa{}("category");var ja=new class extends Sa{cancel(e){return La.post(`${this.path}/cancel`,e)}}("order");var Fa=new class extends Sa{}("promote");var Ea=new class extends Sa{}("buy");var Na=new class extends Sa{}("orderLog");var Ba=new class extends Sa{}("orderGoods");var Ra=new class extends Sa{}("adminLog");var Ua=new class extends Sa{}("userLog");var Va=new class extends Sa{}("exceptionLog");var Ha=new class extends Sa{disable(e){return La.post(`${this.path}/disable`,e)}}("user");var Ma={login:Pa,admin:Ta,authPermission:Aa,authRole:za,song:Ia,picture:qa,tag:Da,category:Oa,order:ja,promote:Fa,buy:Ea,orderLog:Na,orderGoods:Ba,adminLog:Ra,userLog:Ua,exceptionLog:Va,user:Ha,analysis:new class extends Sa{index(){return La.get(`${this.path}`)}}("analysis")};var Ya={namespaced:!0,state:{tabs:[],cachedViews:[],currentTab:{}},mutations:{},actions:{async fixedTab({state:e},t){e.tabs.find((e=>e.name===t.name))||(e.tabs.splice(0,0,t),e.cachedViews.push(t.cacheTab))},async addTab({state:e,dispatch:t},a){let i=e.tabs.find((e=>e.name===a.name));i||(e.tabs.push(a),e.cachedViews.push(a.cacheTab)),t("setCurrentTab",i||a)},async setCurrentTab({state:e},t){e.currentTab=Object.assign({},t)},async deleteTab({state:e,commit:t,dispatch:a},i){let s="number"==typeof i?i:e.tabs.findIndex((e=>e.name===i)),r=e.tabs,l=e.currentTab;if(r[s].name===l.name){let e=r[s+1]||r[s-1];e&&a("setCurrentTab",e)}e.tabs.splice(s,1),e.cachedViews.splice(s,1)},async deleteCachedView({state:e,dispatch:t},a){let i="number"==typeof a?a:e.cachedViews.findIndex((e=>e===a.name));e.cachedViews.splice(i,1)},async addCachedView({state:e,dispatch:t},a){e.cachedViews.find((e=>e===a.name))||e.cachedViews.push(a.cacheTab)}}};const Ka={formatTreeData:function e(t,a=0,i=null,s=null){let r=[];for(let l of t){let o=JSON.parse(JSON.stringify(l));if(o.parent_id===a){i&&(o[i]=o[s],o.key=o.id,o.value=o.id);let a=e(t,o.id,i,s);a.length&&(o.children=a),r.push(o)}}return r},getTreeParent:function(e){let t=[],a=e=>{for(let i of e)i.children&&i.children.length>0&&(t.push(i),a(i.children))};return a(e),t},formatSecond:function(e,t=" "){let a=[[7,5],[30,3],[91,4],[365,1e9]],i=["周","月","季","年"];for(let r=0;r<a.length;r++){let s=Math.round(e/86400/a[r][0]*100)/100;if(s>=1&&s<a[r][1])return{str:s+t+i[r],value:s,key:a[r][0]}}let s=Math.round(e/86400*1e3)/1e3;return s?{str:s+t+"天",value:s,key:7}:{str:"0"+t+"天",value:s,key:365}},getAssignKeyData:function(e,t){for(let a of Object.keys(e))a in t&&(e[a]=t[a]);return e},arrayMerge:function e(t){return[].concat(...t.map((t=>Array.isArray(t)?e(t):t)))},uniqueArray:function(e){return Array.from(new Set(e))},filterNonUnique:function(e){return e=>e.filter((t=>e.indexOf(t)===e.lastIndexOf(t)))},filterUnique:function(e){return e.filter((t=>e.indexOf(t)!==e.lastIndexOf(t)))},filterNullObject:function(e,t=!1){let a={};for(let i in e)e.hasOwnProperty(i)&&null!=e[i]&&(t||!1===e[i]||(a[i]=e[i]));return a},videoCover:async function(e,t=0,a=0,i=!1){return new Promise(((s,r)=>{try{let l=document.createElement("video");l.setAttribute("crossOrigin","anonymous"),l.currentTime=t,l.autoplay=!0,l.muted=!0,l.loop=!0,e instanceof File?l.src=window.URL.createObjectURL(e):l.src=e,l.play().then((e=>{})).catch((e=>{r(e)})),l.addEventListener("loadeddata",(function(){setTimeout((()=>{let e=document.createElement("canvas"),t=l.videoWidth/l.videoHeight;e.width=l.videoWidth/2,e.height=e.width/t,e.getContext("2d").drawImage(l,0,0,e.width,e.height);let a=null;i?e.toBlob((e=>{a=new File([e],"cover.png",{type:e.type}),s(a)})):(a=e.toDataURL(),s(a)),l.pause(),l=null,e=null}),a)}),!0)}catch(l){r(l)}}))},formatBr:function(e){return e.replace(/(\r\n)|(\n)/g,"<br>")},formatFormData:function(e){let t=new FormData;for(let a in e)if(Array.isArray(e[a]))for(let i of e[a])t.append(a+"[]",i);else t.append(a,e[a]);return t}},Qa={menu:[{id:2,parent_id:0,route:"",permission_name:"权限管理",menu_icon:"business",children:[{id:201,parent_id:2,route:"auth/admin",permission_name:"管理员管理",menu_icon:""},{id:202,parent_id:2,route:"auth/role",permission_name:"角色管理",menu_icon:""},{id:203,parent_id:2,route:"auth/permission",permission_name:"权限规则",menu_icon:""}]}]};l.use(b);const Ja={Authorization:{token:""},user:{},permission:{route:[],menu:[...Qa.menu],button:[]},home:"/",default:{}},Wa={checkRoute:e=>t=>e.permission.route.includes(t)||"root"===e.user.username||"/"===t||"/403"===t||"/404"===t,checkButton:e=>t=>e.permission.button.includes(t)||"root"===e.user.username,getUser:e=>!!Object.keys(e.user).length&&e.user},Ga={setToken(e,t){e.Authorization.token=t},setUser(e,t){e.user=r(r({},e.user),t)},setPermission(e){if("root"===e.user.username)e.permission.menu=Qa.menu;else{let t=Object.values(e.user.permission),a=t.filter((e=>2===e.permission_type&&1===e.menu_show)),i=t.filter((e=>3===e.permission_type)),s=t.filter((e=>4===e.permission_type));e.permission.menu=Ka.formatTreeData(a,0),e.permission.route=i.map((e=>e.route)),e.permission.button=s.map((e=>e.button_key)),e.home=e.permission.route[0]}},setPermissionMenu(e,t){e.permission.menu=t},setPermissionRoute(e,t){e.permission.route=t},setPermissionButton(e,t){e.permission.button=t},setStoreDefault(e){console.log(e),e.default=JSON.parse(JSON.stringify(e))},resetStoreDefault(e){for(let t in e.default)t in e&&(e[t]=e.default[t])}},Xa={async userInfo({commit:e,state:t}){try{e("setUser",(await Ma.login.profile()).data),e("setPermission")}catch(a){return Promise.reject(a)}},async login({dispatch:e,commit:t,state:a},i){try{let s=(await Ma.login.login(i)).data;if(localStorage.setItem("token",s),t("setToken",s),v.Message.success("登录成功"),await e("userInfo"),!a.permission.route.length&&"root"!==a.user.username)return void v.Message.warning("无权限，请联系管理员");await ei.push(a.home)}catch(s){return Promise.reject(s)}},async logout({dispatch:e,commit:t,state:a}){try{await Ma.login.logout();localStorage.removeItem("token"),v.Message.success("退出成功"),setTimeout((()=>{location.reload()}),1e3)}catch(i){console.log(i)}}},Za=new b.Store({state:Ja,getters:Wa,mutations:Ga,actions:Xa,modules:{tabBar:Ya}});l.use(_);const ei=new _({routes:[...$a],mode:"history"});ei.beforeEach(((e,t,a)=>{let i=localStorage.getItem("token");if("/login"===e.path&&!i)return a();if(!i)return a("/login");if(0!==Object.keys(Za.state.user).length)return"/login"===e.path?a("/"):Za.getters.checkRoute(e.path)?a():a("/404");{let t=v.Loading.service({background:"#FFFFFF"});Za.dispatch("userInfo").then((()=>Za.getters.checkRoute(e.path)?a():a("/404"))).catch((e=>{})).finally((()=>{t.close()}))}})),ei.afterEach(((e,t)=>{if(e.meta&&!1===e.meta.tab)return;let a={title:e.meta.title,name:e.name,path:e.path,closable:!(e.meta&&!1===e.meta.closable),cacheTab:e.name};Za.dispatch("tabBar/addTab",Object.assign({},a)).then((e=>{}))}));var ti={confirmWarning:function(e=""){return v.MessageBox.confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})},qrcode:async function(e){try{return await w.toDataURL(e)}catch(t){return console.log(t),""}}};l.use((e=>{e.component("k-aside",P),e.component("k-header",O),e.component("k-breadcrumb",ye),e.component("k-menu",ke),e.component("k-table",N),e.component("k-sidebar",U),e.component("k-tabbar",he),e.component("k-cropper",Y),e.component("k-preview",se),e.component("k-checkbox",oe),e.component("k-radio",pe),e.component("k-drawer",Se),e.component("k-descriptions",Pe),e.component("k-descriptions-item",De),e.component("k-upload-image",W),e.component("k-upload-video",ee),e.component("remote-script",Oe)})),l.use((e=>{e.directive("permission",je),e.directive("throttle",Fe)})),x.locale("zh-cn"),l.prototype.$dayjs=x,l.prototype.$xss=k,l.prototype.$config=Ca,l.prototype.$tool=ti,l.prototype.$libs=Ka,l.prototype.$api=Ma,new l({el:"#app",store:Za,router:ei,render:e=>e(S)});
