var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,o=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&l(e,a,t[a]);if(i)for(var a of i(t))r.call(t,a)&&l(e,a,t[a]);return e},n=(e,i)=>t(e,a(i));import{V as c,E as d,m as p,a as u,b as m,C as h,D as _,e as f,c as g,L as b,d as y,A as v,S as w,i as k,f as x,g as $,h as C,j as S,p as L}from"./vendor.7d22d96c.js";c.use(d);function T(e,t,a,i,s,r,l,o){var n,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=a,c._compiled=!0),i&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),l?(n=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},c._ssrRegister=n):s&&(n=o?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),n)if(c.functional){c._injectStyles=n;var d=c.render;c.render=function(e,t){return n.call(t),d(e,t)}}else{var p=c.beforeCreate;c.beforeCreate=p?[].concat(p,n):[n]}return{exports:e,options:c}}const z={};var q=T({name:"App",metaInfo(){return{title:this.$store.state.config.site_name?this.$store.state.config.site_name:""}}},(function(){var e=this.$createElement;return(this._self._c||e)("router-view")}),[],!1,(function(e){for(let t in z)this[t]=z[t]}),"3c9078c2",null,null).exports;const A={name:"Menu",props:["isHideAside"],data:()=>({User:[["用户管理","account_circle"],["角色管理","supervisor_account"],["分组管理","groups"],["权限管理","privacy_tip"]]}),mounted(){},computed:n(o({},p({user:e=>e.user,config:e=>e.config})),{drawer:{get(){return this.isHideAside},set(e){this.$emit("update:isHideAside",e)}}})},I={};var D=T(A,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-aside",{class:{"hide-aside":e.isHideAside,"aside-dark":e.$store.getters["settings/asideTheme"]}},[a("router-link",{attrs:{to:"/"}},[a("div",{staticClass:"aside-header"},[a("img",{staticClass:"logo",attrs:{src:e.$config.staticUrl()+e.config.site_logo,alt:""}}),a("h1",[e._v(e._s(e.config.site_name))])])]),a("k-menu")],1)}),[],!1,(function(e){for(let t in I)this[t]=I[t]}),"49a5bf8b",null,null).exports;const P={name:"Header",props:["isHideAside"],data:()=>({drawer:{visible:!1}}),inject:["reload"],computed:o({},u("settings",["asideTheme"])),methods:o({},m(["logout"]))},N={};var O=T(P,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"header",class:{"fold-header":e.isHideAside}},[a("el-header",[a("div",{staticClass:"app-bar"},[a("el-row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("el-col",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center"}},[a("div",{staticClass:"header-menu",staticStyle:{"margin-right":"5px"}},[a("span",{staticClass:"material-icons",on:{click:function(t){return e.$emit("click")}}},[e._v("menu")]),a("span",{staticClass:"material-icons",on:{click:function(t){return e.reload()}}},[e._v("refresh")])]),a("k-breadcrumb")],1),a("el-col",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"flex-end",gap:"10px"}},[e._t("right"),a("span",{staticClass:"material-icons",staticStyle:{"font-size":"20px"},on:{click:function(t){e.drawer.visible=!0}}},[e._v("settings")])],2)],1)],1)]),a("k-tabbar"),a("k-drawer",{attrs:{visible:e.drawer.visible,size:"350px","is-header":!1,"destroy-on-close":""},on:{"update:visible":function(t){return e.$set(e.drawer,"visible",t)}}},[a("el-divider",{attrs:{"content-position":"center"}},[e._v("菜单风格")]),a("div",{staticClass:"aside-menu-theme-wrap"},[a("div",{staticClass:"item",class:{active:!e.asideTheme},on:{click:function(t){return e.$store.commit("settings/setAsideTheme",!1)}}}),a("div",{staticClass:"item dark",class:{active:e.asideTheme},on:{click:function(t){return e.$store.commit("settings/setAsideTheme",!0)}}})])],1)],1)}),[],!1,(function(e){for(let t in N)this[t]=N[t]}),"43b7cb0c",null,null).exports;const j={name:"Table",props:{isCard:{type:Boolean,default:!0},headers:{type:Array,required:!0},isPagination:{type:Boolean,default:!1},total:{type:Number},zoomHeight:{type:Number,default:0},loading:{type:Boolean,default:!1},showExpand:{type:Boolean,default:!1},align:{type:String},toolbar:{type:Boolean,default:!1},reload:{type:Function}},data(){return{tableSize:"small",showAllColumn:!0,showColumn:this.headers.length>0?Object.keys(this.headers).map(Number):[],isReload:!1,type:["index","selection"],pagination:{layout:"prev, pager, next, total,sizes, jumper",limit:10,currentPage:1,pageSizes:[10,20,30,40,50,100]},expandFlag:0,tableHeight:100,column:Object.assign({},this.headers),route:"",isTask:this.isReload}},computed:{maxHeight(){let e=182;return this.$slots.header&&(e+=57),this.isPagination&&(e+=25),e+this.zoomHeight+1},new$listeners(){return this.$listeners["expand-change"]?Object.assign(this.$listeners,{"expand-change":this.changeExpand}):this.$listeners}},watch:{isReload(e){this.isTask=e},"$route.path"(e,t){this.isTask=e===this.route&&this.isReload}},mounted(){this.route=this.$route.path,this.taskReload()},methods:{changePage(e){this.$emit("changePage",{page:this.pagination.currentPage,limit:this.pagination.limit})},changeExpand(e,t){t.length>1&&this.$attrs.data.forEach((t=>{JSON.stringify(t)!==JSON.stringify(e)&&this.$refs.table.toggleRowExpansion(t,!1)}));let a=0===this.expandFlag||1===this.expandFlag;0===t.length&&(a=!1),this.expandFlag=t.length,this.$emit("expand-change",a,e)},filterColumn(e){e.sort();let t=[];for(let a of e)t.push(this.headers[a]);this.showAllColumn=e.length===this.headers.length,this.column=t},async taskReload(){setTimeout((async()=>{this.isTask&&await this.reload({page:this.pagination.currentPage,limit:this.pagination.limit}),this.taskReload()}),2e3)}}},E={};var F=T(j,(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-card",{ref:"wrap",staticClass:"table-card",style:{border:t.isCard?"":"none"},attrs:{shadow:"never","body-style":{padding:t.isCard?"":"0"}}},[t.$slots.header||t.toolbar?i("div",{staticClass:"table-header",attrs:{slot:"header"},slot:"header"},[i("div",[t._t("header")],2),t.toolbar?i("div",{staticClass:"toolbar"},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"重载数据",placement:"top","open-delay":500}},[t.reload?i("span",{staticClass:"material-icons",on:{click:function(e){return t.reload({page:t.pagination.currentPage,limit:t.pagination.limit})}}},[t._v("autorenew")]):t._e()]),i("el-dropdown",{attrs:{trigger:"click","hide-on-click":!1,size:"small"},on:{command:function(t){e.tableSize=t}}},[i("span",{staticClass:"material-icons"},[t._v("unfold_more")]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{class:{"el-dropdown-menu__item-select":"medium"===t.tableSize},attrs:{command:"medium"}},[t._v("中等")]),i("el-dropdown-item",{class:{"el-dropdown-menu__item-select":"small"===t.tableSize},attrs:{command:"small"}},[t._v("默认")]),i("el-dropdown-item",{class:{"el-dropdown-menu__item-select":"mini"===t.tableSize},attrs:{command:"mini"}},[t._v("紧凑")])],1)],1),i("el-dropdown",{attrs:{trigger:"click",size:"small","hide-on-click":!1}},[i("span",{staticClass:"material-icons"},[t._v("tune")]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t.reload?i("el-dropdown-item",[i("el-checkbox",{model:{value:t.isReload,callback:function(e){t.isReload=e},expression:"isReload"}},[t._v("自动重载")])],1):t._e(),i("el-dropdown-item",[i("el-checkbox",{on:{change:function(t){e.showColumn=t?Object.keys(e.headers).map(Number):[],0===e.showColumn.length?e.column=[]:e.column=e.headers}},model:{value:t.showAllColumn,callback:function(e){t.showAllColumn=e},expression:"showAllColumn"}},[t._v("展示的列 ")])],1),i("el-checkbox-group",{on:{change:t.filterColumn},model:{value:t.showColumn,callback:function(e){t.showColumn=e},expression:"showColumn"}},t._l(t.headers,(function(e,a){return i("el-dropdown-item",{key:a,attrs:{divided:0===a}},[i("el-checkbox",{attrs:{label:a}},[t._v(t._s(e.label))])],1)})),1)],1)],1)],1):t._e()]):t._e(),i("div",{staticClass:"table",style:{maxHeight:"calc(100vh - "+t.maxHeight+"px)"}},[i("el-table",t._g(t._b({directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"table",class:{"table-row-click":t.$listeners["row-click"]},staticStyle:{width:"100%"},attrs:{size:t.tableSize}},"el-table",t.$attrs,!1),t.new$listeners),[t.showExpand?i("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._t("expand-item",null,{scope:e})]}}],null,!0)}):t._e(),t._l(t.column,(function(e,a){return!0!==e.hidden?[t.type.includes(e.type)?i("el-table-column",{attrs:{label:e.label,type:e.type,index:e.index,width:e.width,align:e.align}}):i("el-table-column",{key:a,attrs:{prop:e.prop,label:e.label,width:e.width,align:e.align?e.align:t.align},scopedSlots:t._u([{key:"default",fn:function(a){return[t._t("item."+e.prop,(function(){return[e.tooltip?i("el-tooltip",{attrs:{effect:"dark","open-delay":500,content:"date"===e.type?t.$dayjs.unix(a.row[e.prop]).format(e.format?e.format:"YYYY-MM-DD HH:mm"):a.row[e.prop],placement:"top"}},[i("span",{staticClass:"text-overflow"},[t._v(" "+t._s("date"===e.type?t.$dayjs.unix(a.row[e.prop]).format(e.format?e.format:"YYYY-MM-DD HH:mm"):a.row[e.prop])+" ")])]):[i("span",{class:{"text-overflow":e.overflow}},[t._v(" "+t._s("date"===e.type?t.$dayjs.unix(a.row[e.prop]).format(e.format?e.format:"YYYY-MM-DD HH:mm"):a.row[e.prop])+" ")])]]}),{scope:a})]}}],null,!0)})]:t._e()}))],2)],1),t.isPagination?i("div",{staticClass:"table-footer",class:{"close-page":!t.isPagination}},[t.isPagination?i("el-pagination",{attrs:{layout:t.pagination.layout,total:t.total,"current-page":t.pagination.currentPage,"page-size":t.pagination.limit,"page-sizes":t.pagination.pageSizes},on:{"update:currentPage":function(e){return t.$set(t.pagination,"currentPage",e)},"update:current-page":function(e){return t.$set(t.pagination,"currentPage",e)},"update:pageSize":function(e){return t.$set(t.pagination,"limit",e)},"update:page-size":function(e){return t.$set(t.pagination,"limit",e)},"update:pageSizes":function(e){return t.$set(t.pagination,"pageSizes",e)},"update:page-sizes":function(e){return t.$set(t.pagination,"pageSizes",e)},"size-change":t.changePage,"current-change":t.changePage}}):t._e()],1):t._e()])}),[],!1,(function(e){for(let t in E)this[t]=E[t]}),"b9e12bae",null,null).exports;const U={};var B=T({name:"Sidebar",data:()=>({}),methods:{close(){this.$emit("update:visible",!1)}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-drawer",e._g(e._b({attrs:{"with-header":!1}},"el-drawer",e.$attrs,!1),e.$listeners),[a("i",{staticClass:"el-icon-close",on:{click:e.close}}),a("div",{staticClass:"wrap"},[e._t("default")],2)])}),[],!1,(function(e){for(let t in U)this[t]=U[t]}),"4e90e824",null,null).exports;let R=!1;const W={};var V=T({name:"Cropper",props:{aspectRatio:{default:1},openCropper:{default:!1},croppedCanvas:{default:()=>({width:200,height:200})},fileType:{default:"image/jpeg"},quality:{default:1}},data:()=>({src:null,raw:null,fullscreen:!1,image:null,cropper:null,cropImgBlob:null,cropImgDataUrl:null,tmpAspectRatio:null,tmpFinishCrop:null,tmpCancelCrop:null}),computed:{dialogVisible:{get(){return this.openCropper},set(e){this.closeCropper(e)}}},mounted(){},destroyed(){this.cropper=null},methods:{initCropper(){this.image=this.$refs.img,this.cropper=new h(this.image,{aspectRatio:this.aspectRatio,viewMode:1,zoomOnWheel:!1,cropBoxResizable:!0,minCropBoxWidth:10,minCropBoxHeight:10,ready(e){let t=document.getElementById("img").cloneNode();t.className="",t.style.cssText="display: block;width: 100%;min-width: 0;min-height: 0;max-width: none;max-height: none;",document.querySelectorAll(".preview").item(0).innerHTML="",document.querySelectorAll(".preview").item(0).appendChild(t.cloneNode()),R=!0},crop(e){if(!R)return;let t=e.detail,a=this.cropper.getImageData(),i=t.width/t.height,s=document.querySelectorAll(".preview").item(0);if(!s)return;let r=s.getElementsByTagName("img").item(0),l=s.offsetWidth,o=l/i,n=t.width/l;s.style.height=o+"px",r&&(r.style.width=a.naturalWidth/n+"px",r.style.height=a.naturalHeight/n+"px",r.style.marginLeft=-t.x/n+"px",r.style.marginTop=-t.y/n+"px")}})},openDialog(){this.fullscreen=!1},openedDialog(){this.cropper?this.cropper.replace(this.src):this.initCropper(),this.cropper.setAspectRatio(null!==this.tmpAspectRatio?this.tmpAspectRatio:this.aspectRatio)},switchFullscreen(){this.fullscreen=!this.fullscreen,this.cropper.replace(this.src),this.cropper.reset()},closeCropper(e=!1){e?this.tmpCancelCrop=null:(this.tmpAspectRatio=null,this.tmpFinishCrop=null,this.tmpCancelCrop?this.tmpCancelCrop():this.$emit("cancelCrop")),this.$emit("update:openCropper",e)},async saveCrop(){let e=this.croppedCanvas;"image/jpeg"===this.raw.type&&(e=Object.assign(this.croppedCanvas,{fillColor:"#FFFFFF"}));let t=await this.cropper.getCroppedCanvas(e);this.cropImgDataUrl=await t.toDataURL(this.raw.type,this.quality),await t.toBlob((e=>{this.cropImgBlob=e,this.tmpFinishCrop?this.tmpFinishCrop():this.$emit("finishCrop"),this.dialogVisible=!1}),this.raw.type,this.quality)}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",e._b({ref:"dialog",attrs:{visible:e.dialogVisible,width:"50%",fullscreen:e.fullscreen,"show-close":!1,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},open:e.openDialog,opened:e.openedDialog}},"el-dialog",e.$attrs,!1),[a("el-row",{attrs:{slot:"title",type:"flex",justify:"space-between",align:"center"},slot:"title"},[a("span",{staticClass:"el-dialog__title"},[e._v("裁剪图片")]),a("div",[a("i",{staticClass:"el-icon-full-screen text-md header-btn",on:{click:e.switchFullscreen}}),a("i",{staticClass:"el-icon-close text-md header-btn",on:{click:function(t){e.dialogVisible=!1}}})])]),a("div",{staticClass:"cropper-box"},[a("div",{staticClass:"image-box"},[a("div",{staticClass:"image-cropper"},[a("img",{ref:"img",staticStyle:{display:"block","max-width":"100%"},attrs:{src:e.src,id:"img",alt:""}})])]),a("div",{ref:"preview-box",staticClass:"preview-box"},[a("div",{ref:"preview",staticClass:"preview"})])]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveCrop}},[e._v("确 定")])],1)],1)}),[],!1,(function(e){for(let t in W)this[t]=W[t]}),"08389f64",null,null).exports;const H={name:"UploadImage",props:{isCropper:{type:Boolean,default:!0},showBox:{type:Array,default:()=>[100,100]},upload:{type:Function,required:!0}},data:()=>({dialogVisible:!1,openCropper:!1,cropPreview:""}),computed:{showBoxSize(){return{width:this.showBox[0]+"px",height:this.showBox[1]+"px"}}},beforeDestroy(){this.cropPreview=""},methods:{cropImg(e){this.isCropper?(this.$refs.cropper.src=URL.createObjectURL(e.raw),this.$refs.cropper.raw=e.raw,this.$refs.cropper.dialogVisible=!0):(this.cropPreview=URL.createObjectURL(e.raw),this.upload(e.raw))},removeUploadImg(e){this.cropPreview="",this.$emit("delete")},async uploadImg(){try{let e=this.$refs.cropper.cropImgBlob,t=new File([e],"file.jpg",{type:e.type});this.cropPreview=this.$refs.cropper.cropImgDataUrl,this.upload(t)}catch(e){this.$message.error(e.message)}},async handleClick(){this.$refs.upload.disabled&&this.$emit("click")},async beforeUpload(){}}},Y={};var M=T(H,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"inline-block"},on:{click:function(t){return t.stopPropagation(),e.handleClick.apply(null,arguments)}}},[a("el-upload",e._b({ref:"upload",class:{"avatar-uploader":!e.$slots.trigger},attrs:{action:"#","auto-upload":!1,"show-file-list":!1,"on-change":e.cropImg},scopedSlots:e._u([{key:"trigger",fn:function(){return[e._t("trigger",(function(){return[e.cropPreview?a("el-image",{staticClass:"avatar",style:e.showBoxSize,attrs:{src:e.cropPreview}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon",style:e.showBoxSize}),e.cropPreview?a("span",{staticClass:"el-upload-action"},[a("i",{staticClass:"el-icon-zoom-in avatar-uploader-icon el-upload-delete",on:{click:function(t){t.stopPropagation(),e.dialogVisible=!0}}}),a("i",{staticClass:"el-icon-delete avatar-uploader-icon el-upload-delete",on:{click:function(t){return t.stopPropagation(),e.removeUploadImg.apply(null,arguments)}}})]):e._e()]}))]},proxy:!0},{key:"tip",fn:function(){return[e._t("tip")]},proxy:!0}],null,!0)},"el-upload",e.$attrs,!1)),a("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"preview"},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.cropPreview,alt:""}})])]),e.isCropper?a("k-cropper",e._b({ref:"cropper",attrs:{"append-to-body":!0,"open-cropper":e.openCropper},on:{"update:openCropper":function(t){e.openCropper=t},"update:open-cropper":function(t){e.openCropper=t},finishCrop:e.uploadImg}},"k-cropper",e.$attrs,!1)):e._e()],1)}),[],!1,(function(e){for(let t in Y)this[t]=Y[t]}),"020d2dba",null,null).exports;const Q={name:"UploadVideo",props:{isCropper:{type:Boolean,default:!0},showBox:{type:Array,default:()=>[100,100]},upload:{type:Function,required:!0},limit:{type:Number,default:1}},data:()=>({fullscreen:!1,item:{cropPreview:"",video:null,loading:!1,status:!1},list:[],dialogVisible:!1,openCropper:!1,cropPreview:"",progress:0,play:{}}),computed:{showBoxSize(){return{width:this.showBox[0]+"px",height:this.showBox[1]+"px"}}},mounted(){this.list.push(Object.assign({},this.item))},methods:{async cropVideo(e,t){let a=this.list[this.list.length-1];this.progress=0,a.video=e.raw,a.loading=!0,this.$libs.videoCover(e.raw).then((e=>{a.cropPreview=e})).catch((e=>{a.cropPreview=""})),await this.upload(e.raw).then((e=>{this.list[this.list.length-1].status=!0,this.list.length<this.limit&&this.list.push(Object.assign({},this.item))})).catch((e=>{a.cropPreview=""})),a.loading=!1},removeUploadImg(e){this.list.splice(e,1),0===this.list.length&&this.list.push(Object.assign({},this.item));let t=Object.assign({},this.list[e]);this.$emit("delete",{index:e,video:t})},clearVideo(){this.list=[],this.list.push(Object.assign({},this.item))},videoPlay(e){e.video instanceof File?this.play=URL.createObjectURL(e.video):this.play=e.video,this.dialogVisible=!0,this.$nextTick((()=>{this.$refs.video.play()}))},async initValue(e,t="video",a=""){let i=[];for(let s of e){let e=Object.assign({},this.item);e.video=a+s[t],(async()=>{e.cropPreview=await this.$libs.videoCover(e.video).then((e=>e)).catch((e=>""))})(),i.push(e)}this.list.length<this.limit&&i.push(Object.assign({},this.item)),this.list=i}}},J={};var K=T(Q,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"upload-wrap"},[a("el-row",{attrs:{type:"flex",gutter:15}},e._l(e.list,(function(t,i){return a("el-col",{key:i},[t.loading?a("div",{staticClass:"item-progress",style:e.showBoxSize},[a("el-progress",{attrs:{type:"circle",percentage:e.progress,width:e.showBox[0]-10}})],1):e._e(),t.loading?e._e():a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"#","auto-upload":!1,"show-file-list":!1,"on-change":e.cropVideo,accept:"video/mp4,video/webm"}},[t.cropPreview?a("el-image",{staticClass:"avatar",style:e.showBoxSize,attrs:{src:t.cropPreview}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon",style:e.showBoxSize}),t.status?a("label",{staticClass:"item-status-label"},[a("i",{staticClass:"el-icon-upload-success el-icon-check"})]):e._e(),t.video?a("label",{staticClass:"item-index-label"},[a("i",[e._v(e._s(i+1))])]):e._e(),t.cropPreview?a("span",{staticClass:"el-upload-action"},[a("i",{staticClass:"el-icon-video-play avatar-uploader-icon el-upload-delete",on:{click:function(a){return a.stopPropagation(),e.videoPlay(t)}}}),a("i",{staticClass:"el-icon-delete avatar-uploader-icon el-upload-delete",on:{click:function(t){return t.stopPropagation(),e.removeUploadImg(i)}}})]):e._e()],1)],1)})),1),a("el-dialog",{attrs:{visible:e.dialogVisible,"append-to-body":!0,fullscreen:e.fullscreen,title:"预览"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-row",{attrs:{slot:"title",type:"flex",justify:"space-between",align:"center"},slot:"title"},[a("span",{staticClass:"el-dialog__title"},[e._v("预览")]),a("div",[a("i",{staticClass:"el-icon-full-screen text-md header-btn",on:{click:function(t){e.fullscreen=!e.fullscreen}}}),a("i",{staticClass:"el-icon-close text-md header-btn",on:{click:function(t){e.dialogVisible=!1}}})])]),a("div",{staticClass:"preview"},[a("video",{ref:"video",staticStyle:{"max-height":"50vh"},style:{maxHeight:e.fullscreen?"80vh":"50vh"},attrs:{src:e.play,controls:""}})])],1)],1)}),[],!1,(function(e){for(let t in J)this[t]=J[t]}),"4c14ca33",null,null).exports;const G={name:"Preview",props:{show:{type:Boolean,default:!1},type:{type:String},src:{typ:String}},data:()=>({fullscreen:!1}),computed:{visible:{get(){return this.show},set(e){this.$emit("update:show",e)}}}},X={};var Z=T(G,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",e._b({attrs:{visible:e.visible,"destroy-on-close":!1,"append-to-body":!0,fullscreen:e.fullscreen,title:"预览"},on:{"update:visible":function(t){e.visible=t}}},"el-dialog",e.$attrs,!1),[e.visible?a("el-row",{attrs:{slot:"title",type:"flex",justify:"space-between",align:"center"},slot:"title"},[a("span",{staticClass:"el-dialog__title"},[e._v("预览")]),e.$attrs.title?a("span",{staticClass:"el-dialog__title"},[e._v(e._s(e.$attrs.title))]):e._e(),a("div",[a("i",{staticClass:"el-icon-full-screen text-md header-btn",on:{click:function(t){e.fullscreen=!e.fullscreen}}}),a("i",{staticClass:"el-icon-close text-md header-btn",on:{click:function(t){e.visible=!1}}})])]):e._e(),a("div",{staticClass:"preview"},["image"===e.type&&e.visible?a("img",{attrs:{src:e.src,alt:""}}):e._e(),"video"===e.type&&e.visible?a("video",{ref:"video",staticStyle:{"max-height":"50vh"},style:{maxHeight:e.fullscreen?"80vh":"50vh"},attrs:{src:e.src,controls:""}}):e._e(),"audio"===e.type&&e.visible?a("audio",{ref:"audio",attrs:{src:e.src,controls:""}}):e._e()])],1)}),[],!1,(function(e){for(let t in X)this[t]=X[t]}),"e7cdc85a",null,null).exports;const ee={};var te=T({name:"checkbox"},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-checkbox",e._b({staticClass:"checkbox"},"el-checkbox",e.$attrs,!1),[e._t("default")],2)}),[],!1,(function(e){for(let t in ee)this[t]=ee[t]}),"52c33c81",null,null).exports;const ae={};var ie=T({name:"Radio"},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-radio",e._b({staticClass:"radio"},"el-radio",e.$attrs,!1),[e._t("default")],2)}),[],!1,(function(e){for(let t in ae)this[t]=ae[t]}),"e7b2d20a",null,null).exports;const se={name:"TabBar",data:()=>({}),computed:o({},p("tabBar",["tabs","currentTab"])),methods:o({async initTabs(){},async selectTab(e){await this.setCurrentTab(this.tabs[e.index]),this.currentTab.path!==this.$route.path&&await this.$router.push(this.tabs[e.index].path)},async removeTab(e){await this.deleteTab(e),this.currentTab.path!==this.$route.path&&await this.$router.push(this.currentTab.path)},async closeTab(e){let t=this.tabs.findIndex((e=>e.name===this.currentTab.name));switch(e){case"left":for(let e=t-1;e>0;e--)await this.deleteTab(e);break;case"right":for(let e=t+1;e<this.tabs.length;)await this.deleteTab(e);break;case"other":{let e=this.tabs.filter((e=>e.name!==this.currentTab.name));for(let t of e)await this.deleteTab(t.name);break}case"all":{let e=JSON.parse(JSON.stringify(this.tabs));for(let t of e)await this.deleteTab(t.name);break}}}},m("tabBar",["addTab","setCurrentTab","deleteTab","fixedTab"]))},re={};var le=T(se,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tabs"},[a("el-tabs",{on:{"tab-remove":e.removeTab,"tab-click":e.selectTab},model:{value:e.currentTab.name,callback:function(t){e.$set(e.currentTab,"name",t)},expression:"currentTab.name"}},e._l(e.tabs,(function(e,t){return a("el-tab-pane",{key:e.name,attrs:{label:e.title,name:e.name,closable:e.closable}})})),1),a("el-dropdown",{attrs:{size:"small"},on:{command:e.closeTab}},[a("span",{staticClass:"material-icons expand"},[e._v("expand_more")]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{icon:"el-icon-arrow-left",command:"left"}},[e._v("关闭左侧")]),a("el-dropdown-item",{attrs:{icon:"el-icon-arrow-right",command:"right"}},[e._v("关闭右侧")]),a("el-dropdown-item",{attrs:{icon:"el-icon-close",command:"other"}},[e._v("关闭其他")]),a("el-dropdown-item",{attrs:{icon:"el-icon-error",command:"all"}},[e._v("关闭全部")])],1)],1)],1)}),[],!1,(function(e){for(let t in re)this[t]=re[t]}),"4ae07044",null,null).exports;const oe={};var ne=T({name:"Breadcrumb",data:()=>({breadcrumbList:[]}),watch:{$route(e){this.getBreadcrumb()}},mounted(){this.getBreadcrumb()},methods:{async getBreadcrumb(){this.breadcrumbList=this.$route.matched}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-breadcrumb",{attrs:{separator:"/"}},e._l(e.breadcrumbList,(function(t,i){return t.meta&&t.meta.title&&!1!==t.meta.breadcrumb?a("el-breadcrumb-item",{key:i},[a("router-link",{attrs:{to:{path:t.path}}},[e._v(e._s(t.meta.title))])],1):e._e()})),1)}),[],!1,(function(e){for(let t in oe)this[t]=oe[t]}),"3635a2ac",null,null).exports;const ce={};const de={name:"Menu",components:{MenuItem:T({name:"menu-item",props:{menus:{type:Array,default:()=>[]}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.menus,(function(t,i){return[""!==t.route?a("router-link",{attrs:{to:""+t.route}},[a("el-menu-item",{attrs:{index:""+t.route}},[a("i",{staticClass:"material-icons"},[e._v(e._s(t.menu_icon))]),a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.permission_name))])])],1):a("el-submenu",{attrs:{index:t.id.toString()}},[a("template",{slot:"title"},[a("i",{staticClass:"material-icons"},[e._v(e._s(t.menu_icon))]),a("span",[e._v(e._s(t.permission_name))])]),a("menu-item",{attrs:{menus:t.children}})],2)]}))],2)}),[],!1,(function(e){for(let t in ce)this[t]=ce[t]}),"fd4bb98c",null,null).exports},computed:o({},p({user:e=>e.user,menus:e=>e.permission.menu}))},pe={};var ue=T(de,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-menu",{attrs:{"default-active":e.$route.path,"unique-opened":""}},[a("menu-item",{attrs:{menus:e.menus}})],1)}),[],!1,(function(e){for(let t in pe)this[t]=pe[t]}),"fc94ae10",null,null).exports;const me={name:"Drawer",props:{isHeader:{type:Boolean,default:!0},isPin:{type:Boolean,default:!0},visible:{type:Boolean},title:{type:String,default:""},size:{type:String}},computed:{show:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},data:()=>({isFullscreen:!1}),methods:{}},he={};var _e=T(me,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-drawer",e._g(e._b({attrs:{visible:e.show,withHeader:!1,size:e.isFullscreen?"100%":e.size,"append-to-body":"","destroy-on-close":""},on:{"update:visible":function(t){e.show=t}}},"el-drawer",e.$attrs,!1),e.$listeners),[e.isHeader?a("div",{staticClass:"header"},[e._t("title",(function(){return[a("div",[e._v(e._s(e.title))])]})),a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center"}},[e.isFullscreen?a("span",{staticClass:"material-icons",on:{click:function(t){e.isFullscreen=!e.isFullscreen,e.$emit("fullscreen",!1)}}},[e._v("fullscreen_exit")]):a("span",{staticClass:"material-icons",on:{click:function(t){e.isFullscreen=!e.isFullscreen,e.$emit("fullscreen",!0)}}},[e._v("fullscreen")]),a("span",{staticClass:"material-icons",on:{click:function(t){e.show=!1}}},[e._v("close")])])],2):e._e(),a("el-divider",{staticClass:"divider"}),a("div",{staticClass:"wrap"},[a("div",{staticClass:"content",style:{maxHeight:e.$slots.footer?"calc(100% - 64px)":"100%"}},[e._t("default")],2),e.$slots.footer?a("div",[a("el-divider",{staticClass:"divider"}),a("div",{staticClass:"footer"},[e._t("footer")],2)],1):e._e()])],1)}),[],!1,(function(e){for(let t in he)this[t]=he[t]}),"5d8941d4",null,null).exports;const fe={name:"Descriptions",props:{title:{type:String},span:{type:Number},column:{type:Object,default:()=>({xs:24})},bottom:{type:String},divider:{type:Boolean,default:!1}}},ge={};var be=T(fe,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"descriptions"},[e.title?a("div",{staticClass:"descriptions-title"},[e._v(e._s(e.title))]):e._e(),a("div",{staticClass:"descriptions-view"},[a("el-row",{staticClass:"descriptions-row",staticStyle:{display:"flex","flex-flow":"row nowrap"},attrs:{gutter:10}},[Boolean(e.$slots.default)?e._t("default"):e._e()],2),e.divider?a("el-divider"):e._e()],1)])}),[],!1,(function(e){for(let t in ge)this[t]=ge[t]}),"8f338378",null,null).exports;const ye={};var ve=T({name:"DescriptionsItem",props:{label:{type:String},labelWidth:{type:String,default:""},span:{type:Number},column:{type:Object,default:()=>({xs:24})}},computed:{width(){return this.span?this.span:this.$parent.$parent.span},columnFlex(){return this.column?this.column:this.$parent.$parent.column}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-col",{attrs:{span:e.width,xs:e.columnFlex.xs,sm:e.columnFlex.sm,md:e.columnFlex.md,lg:e.columnFlex.lg,xl:e.columnFlex.xl}},[a("div",{staticClass:"descriptions-item",style:{paddingBottom:e.$parent.$parent.bottom}},[e.label?a("div",{staticClass:"descriptions-item-label",style:{width:e.labelWidth}},[e._v(e._s(e.label)+"：")]):e._e(),a("div",{staticClass:"descriptions-item-value"},[Boolean(e.$slots.default)?e._t("default"):e._e()],2)])])}),[],!1,(function(e){for(let t in ye)this[t]=ye[t]}),"40d50410",null,null).exports,we={name:"RemoteScript",props:{src:{type:String,required:!0}},render(e,t){return e("script",{attrs:{type:"text/javascript",src:this.src}})}};const ke={};var xe=T({name:"SearchCard"},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"search-card",staticStyle:{"margin-bottom":"20px"},attrs:{shadow:"never"}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},[e._t("default"),a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap"}},[e._t("footer")],2)],2)])}),[],!1,(function(e){for(let t in ke)this[t]=ke[t]}),"5806cfc2",null,null).exports;const $e={};var Ce=T({name:"Card"},(function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-card",e._b({attrs:{shadow:"never"},scopedSlots:e._u([{key:"header",fn:function(){return[e._t("header-icon"),e._t("header")]},proxy:!0}],null,!0)},"el-card",e.$attrs,!1),[e._t("default")],2)}),[],!1,(function(e){for(let t in $e)this[t]=$e[t]}),"42368ef6",null,null).exports,Se={inserted(e,t){t.value||e.remove()}},Le={bind(e,t){let a,i=t.value,s=i&&void 0!==i.time?i.time:2e3,r=0;e.addEventListener(i&&i.event?i.event:"click",(e=>{a||0!==r?e&&e.stopImmediatePropagation():(r++,a=setTimeout((()=>{a=null,r=0}),s))}),!0)}};const Te={};var ze=T({name:"Login",data:()=>({loading:!1,captcha:"",form:{username:"",password:"",captcha:"",key:""},formRules:{mobile:[{pattern:/^1[3-9]\d{9}$/,required:!0,message:"请输入正确手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:18,message:"长度在6 到 18 个字符",trigger:"blur"}]}}),mounted(){this.getCaptcha()},methods:{async login(){this.loading=!0;try{await this.$store.dispatch("login",this.form)}catch(e){e&&await this.getCaptcha()}finally{this.loading=!1}},async getCaptcha(){this.$api.login.verify().then((e=>{this.captcha=window.atob(e.data),this.form.key=e.data.key}))}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"login-wrapper",attrs:{id:"particles-js"}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("唱片发行系统"),a("el-divider",{attrs:{direction:"vertical"}}),e._v("登录")],1)]),a("el-form",{attrs:{"label-position":"right"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login.apply(null,arguments)}}},[a("el-form-item",[a("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"请输入您的用户名"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),a("el-form-item",[a("el-input",{attrs:{"prefix-icon":"el-icon-unlock",placeholder:"请输入密码",type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),a("el-form-item",[a("el-row",{attrs:{type:"flex",gutter:10,align:"center"}},[a("el-col",{attrs:{span:14}},[a("el-input",{attrs:{"prefix-icon":"el-icon-s-help",placeholder:"请输入验证码"},model:{value:e.form.captcha,callback:function(t){e.$set(e.form,"captcha",t)},expression:"form.captcha"}})],1),a("el-col",{attrs:{span:10}},[a("el-image",{staticClass:"capcha-image",attrs:{src:e.captcha,fit:"cover",lazy:""},on:{click:e.getCaptcha}})],1)],1)],1),a("el-form-item",[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],staticStyle:{width:"100%"},attrs:{type:"primary",loading:e.loading},on:{click:e.login}},[e._v("登录")])],1)],1)],1)],1)}),[],!1,(function(e){for(let t in Te)this[t]=Te[t]}),"d4cee6a8",null,null).exports;const qe={name:"Manage",mixins:[{data:()=>({isHideAside:!1,isRouterAlive:!0}),computed:o({},p("tabBar",["cachedViews","currentTab"])),provide(){return{reload:this.reload}},mounted(){this.init().then((e=>{}))},methods:n(o({},m("tabBar",["fixedTab","deleteTab","addTab","deleteCachedView","addCachedView"])),{async init(){await this.fixedTab({title:"首页",name:"Analysis",path:"/analysis",cacheTab:"Analysis",closable:!1})},async reload(){let e=Object.assign({},this.currentTab);await this.deleteCachedView(e),this.isRouterAlive=!1,this.$nextTick((()=>{this.isRouterAlive=!0,this.addCachedView(e)}))}})}],methods:o({},m(["logout"]))},Ae={};var Ie=T(qe,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"application"},[a("k-aside",{attrs:{isHideAside:e.isHideAside}}),a("el-container",[a("k-header",{attrs:{"is-hide-aside":e.isHideAside},on:{click:function(t){e.isHideAside=!e.isHideAside}},scopedSlots:e._u([{key:"right",fn:function(){return[a("el-dropdown",{attrs:{trigger:"hover"}},[a("span",{staticClass:"el-dropdown-link"},[e._v(e._s(e.$store.state.user.username?e.$store.state.user.username:e.$store.state.user.mobile))]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("router-link",{attrs:{to:"/profile"}},[a("el-dropdown-item",{attrs:{icon:"el-icon-user"}},[e._v("个人中心")])],1),a("el-dropdown-item",{attrs:{icon:"el-icon-switch-button"},nativeOn:{click:function(t){return e.logout.apply(null,arguments)}}},[e._v("退出")])],1)],1)]},proxy:!0}])}),a("el-main",{class:{"fold-main":e.isHideAside}},[a("div",{staticClass:"page-content"},[a("transition",{attrs:{name:"slide-fade",mode:"out-in"}},[a("keep-alive",{attrs:{include:e.cachedViews}},[e.isRouterAlive?a("router-view"):e._e()],1)],1)],1)])],1)],1)}),[],!1,(function(e){for(let t in Ae)this[t]=Ae[t]}),"7347d65a",null,null).exports;const De={};var Pe=T({name:"Permission",props:{checked:{type:Array,default:()=>[]}},data:()=>({loading:!1,permission:{api:[],menu:[],page:[],button:[],parentApi:[],parentMenu:[],parentPage:[],parentButton:[]}}),watch:{checked(e,t){JSON.parse(JSON.stringify(e)).sort().toString()!==t.sort().toString()&&this.filterCheckedKeys(JSON.parse(JSON.stringify(e)))}},mounted(){this.getPermission()},methods:{async getPermission(){this.loading=!0;try{let e=(await this.$api.authPermission.queryAll()).data;this.handlePermission(e)}catch(e){}finally{this.loading=!1}},async handlePermission(e){let t=this.permission;t.api=[],t.menu=[],t.page=[],t.button=[];for(let a of e)switch(a.permission_type){case 1:t.api.push(a);break;case 2:t.menu.push(a);break;case 3:t.page.push(a);break;case 4:t.button.push(a)}t.api=this.$libs.formatTreeData(t.api,0,"label","permission_name"),t.parentApi=this.$libs.getTreeParent(t.api),t.menu=this.$libs.formatTreeData(t.menu,0,"label","permission_name"),t.parentMenu=this.$libs.getTreeParent(t.menu),t.page=this.$libs.formatTreeData(t.page,0,"label","permission_name"),t.parentPage=this.$libs.getTreeParent(t.page),t.button=this.$libs.formatTreeData(t.button,0,"label","permission_name"),t.parentButton=this.$libs.getTreeParent(t.button),this.checked&&this.filterCheckedKeys(this.checked)},filterCheckedKeys(e){this.$refs.apiTree.setCheckedKeys(e.filter((e=>this.permission.parentApi.findIndex((t=>t.id===e))<0))),this.$refs.menuTree.setCheckedKeys(e.filter((e=>this.permission.parentMenu.findIndex((t=>t.id===e))<0))),this.$refs.pageTree.setCheckedKeys(e.filter((e=>this.permission.parentPage.findIndex((t=>t.id===e))<0))),this.$refs.buttonTree.setCheckedKeys(e.filter((e=>this.permission.parentButton.findIndex((t=>t.id===e))<0)))},getCheckedKeys(){let e=[];return e=e.concat(this.$refs.apiTree.getCheckedKeys()),e=e.concat(this.$refs.apiTree.getHalfCheckedKeys()),e=e.concat(this.$refs.menuTree.getCheckedKeys()),e=e.concat(this.$refs.menuTree.getHalfCheckedKeys()),e=e.concat(this.$refs.pageTree.getCheckedKeys()),e=e.concat(this.$refs.pageTree.getHalfCheckedKeys()),e=e.concat(this.$refs.buttonTree.getCheckedKeys()),e=e.concat(this.$refs.buttonTree.getHalfCheckedKeys()),e},getCheckedNodes(){let e=[];return e=e.concat(this.$refs.apiTree.getCheckedNodes()),e=e.concat(this.$refs.apiTree.getHalfCheckedNodes()),e=e.concat(this.$refs.menuTree.getCheckedNodes()),e=e.concat(this.$refs.menuTree.getHalfCheckedNodes()),e=e.concat(this.$refs.pageTree.getCheckedNodes()),e=e.concat(this.$refs.pageTree.getHalfCheckedNodes()),e=e.concat(this.$refs.buttonTree.getCheckedNodes()),e=e.concat(this.$refs.buttonTree.getHalfCheckedNodes()),e}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"card"}},[a("el-tab-pane",{attrs:{label:"菜单"}},[a("el-tree",{key:"menu",ref:"menuTree",attrs:{data:e.permission.menu,"node-key":"id","show-checkbox":""}})],1),a("el-tab-pane",{attrs:{label:"页面"}},[a("el-tree",{key:"page",ref:"pageTree",attrs:{data:e.permission.page,"node-key":"id","show-checkbox":""}})],1),a("el-tab-pane",{attrs:{label:"按钮"}},[a("el-tree",{key:"button",ref:"buttonTree",attrs:{data:e.permission.button,"node-key":"id","show-checkbox":""}})],1),a("el-tab-pane",{attrs:{label:"接口"}},[a("el-tree",{key:"api",ref:"apiTree",attrs:{data:e.permission.api,"node-key":"id","show-checkbox":""}})],1)],1)}),[],!1,(function(e){for(let t in De)this[t]=De[t]}),"370688b6",null,null).exports,Ne={data:()=>({drawer:{title:"",type:"",span:20,visible:!1},preview:{visible:!1},action:"",total:0,defaultForm:{},defaultQuery:{},query:{},form:{},loading:!1,btnLoading:!1,queryLoading:!1,saveLoading:!1,deleteLoading:!1,selectItem:{}}),mounted(){this.defaultForm=JSON.parse(JSON.stringify(this.form)),this.defaultQuery=JSON.parse(JSON.stringify(this.query))},methods:{async resetForm(){this.form=JSON.parse(JSON.stringify(this.defaultForm))},async resetQuery(){this.query=JSON.parse(JSON.stringify(this.defaultQuery))}}};const Oe={};var je=T({name:"AuthAdmin",components:{Permission:Pe},mixins:[Ne],data:()=>({headers:[{label:"用户名",prop:"username"},{label:"手机号",prop:"mobile"},{label:"创建时间",prop:"created_at",type:"date"},{label:"状态",prop:"status"},{label:"操作",prop:"action"}],data:[],drawer:{title:"",type:"",span:20,visible:!1},form:{username:"",password:"",mobile:null,status:1,role:[],permission:[]},selectItem:{},roleList:[]}),mounted(){this.getAdminList()},methods:{handleAction(e,t=null){this.drawer.type=e,"create"===e?this.drawer.title="新增管理员":"update"===e&&(this.selectItem=t,this.getAdminInfo(),this.drawer.title="更新管理员"),this.drawer.visible=!0,this.getRoleList()},async getAdminInfo(){let e=(await this.$api.admin.query(this.selectItem.id)).data;this.$libs.getAssignKeyData(this.form,e)},async getAdminList(e={page:1,limit:10}){this.loading=!0;let t=Object.assign(e,this.$libs.filterNullObject(this.query));try{let e=await this.$api.admin.batchQuery(t);this.data=e.data.data,this.total=e.data.total}catch(a){}finally{this.loading=!1}},async getRoleList(){let e=await this.$api.authRole.queryAll();this.roleList=this.$libs.formatTreeData(e.data,0,"label","role_name")},async createAdmin(){this.saveLoading=!0,this.form.permission=this.$refs.permission.getCheckedKeys();try{let e=await this.$api.admin.create(this.form);this.$message.success("新增成功"),this.drawer.visible=!1,this.data.unshift(e.data)}catch(e){}finally{this.saveLoading=!1}},async updateAdmin(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id,e.permission=this.$refs.permission.getCheckedKeys();try{await this.$api.admin.update(e);this.$message.success("更新成功"),this.drawer.visible=!1;let t=this.data.findIndex((t=>t.id===e.id));this.$set(this.data,t,this.$libs.getAssignKeyData(this.selectItem,e))}catch(t){}finally{this.saveLoading=!1}},async deleteAdmin(e){let t=e.$index;e=e.row,this.$tool.confirmWarning("确定要删除"+e.username+"吗？").then((()=>{this.$api.admin.delete({id:e.id}).then((e=>{this.$message.success("删除成功"),this.data.splice(t,1)}))}))},async switchStatus(e,t){this.$api.admin.update({id:t.id,status:e}).then((e=>{this.$message.success("更新成功")})).catch((a=>{t.status=0===e?1:0}))}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-table",{attrs:{headers:t.headers,data:t.data,"is-pagination":"",total:t.total,loading:t.loading},on:{changePage:t.getAdminList},scopedSlots:t._u([{key:"header",fn:function(){return[i("el-row",{attrs:{type:"flex"}},[i("el-col",[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleAction("create")}}},[t._v("新增管理员")])],1)],1)]},proxy:!0},{key:"item.status",fn:function(e){var a=e.scope;return[i("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(e){return t.switchStatus(e,a.row)}},model:{value:a.row.status,callback:function(e){t.$set(a.row,"status",e)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(e){var a=e.scope;return[i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleAction("update",a.row)}}},[t._v("编辑")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.deleteAdmin(a)}}},[t._v("删除")])]}}])})],1),i("k-drawer",{attrs:{title:t.drawer.title,visible:t.drawer.visible,size:"35%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",loading:t.saveLoading},on:{click:function(e){"update"===t.drawer.type?t.updateAdmin():t.createAdmin()}}},[t._v("保存")])]},proxy:!0}])},[i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"用户名"}},[i("el-input",{model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1),i("el-form-item",{attrs:{label:"密码"}},[i("el-input",{model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),i("el-form-item",{attrs:{label:"手机号"}},[i("el-input",{model:{value:t.form.mobile,callback:function(e){t.$set(t.form,"mobile",e)},expression:"form.mobile"}})],1),i("el-form-item",{attrs:{label:"设置角色"}},[i("el-cascader",{attrs:{options:t.roleList,props:{multiple:!0,value:"id",checkStrictly:!0,emitPath:!1},"collapse-tags":"",clearable:""},model:{value:t.form.role,callback:function(e){t.$set(t.form,"role",e)},expression:"form.role"}})],1),i("el-form-item",{attrs:{label:"是否启用"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[i("el-radio",{attrs:{label:1}},[t._v("启用")]),i("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1),i("el-form-item",{attrs:{label:"设置权限"}},[i("Permission",{ref:"permission",attrs:{checked:t.form.permission}})],1)],1)],1)],1)],1)],1)}),[],!1,(function(e){for(let t in Oe)this[t]=Oe[t]}),"370fa4de",null,null).exports;const Ee={};var Fe=T({name:"AuthRole",components:{Permission:Pe},mixins:[Ne],data:()=>({dialog:{title:"",type:"",visible:!1},form:{role_name:"",parent_id:0,role_level:1,role_type:1,desc:"",status:1,permission:[]},addRoleData:{parentRole:[]},headers:[{label:"角色名称",prop:"role_name"},{label:"级别",prop:"role_level"},{label:"分类",prop:"role_type"},{label:"创建时间",prop:"created_at",type:"date"},{label:"状态",prop:"status"},{label:"操作",prop:"action"}],tableData:[],permission:[],group:[],role:[],treeData:[],selectRole:{},total:0}),mounted(){this.getRoleList()},methods:{showDialog(e){this.dialog.type=e,this.dialog.visible=!0},handleAction(e="create",t=null){this.action=e,"create"===e?(this.form.parent_id=0,this.form.role_level=1,this.dialog.title="新增角色"):"edit"===e&&(this.selectRole=t,this.getRoleInfo(),this.dialog.title="编辑角色"),this.showDialog(e)},async getRoleInfo(){this.queryLoading=!0;try{let e=await this.$api.authRole.query(this.selectRole.id);console.log(e.data);let t=e.data;this.$libs.getAssignKeyData(this.form,t)}catch(e){console.log(e)}finally{this.queryLoading=!1}},async getRoleList(e={page:1,limit:10}){this.loading=!0;let t=Object.assign(e,this.$libs.filterNullObject(this.query));try{let e=await this.$api.authRole.batchQuery(t);this.tableData=e.data.data,this.total=e.data.total,this.loading=!1}catch(a){}finally{this.loading=!1}},createRole(){this.saveLoading=!0,this.form.permission=this.$refs.permission.getCheckedKeys(),this.$api.authRole.create(this.form).then((e=>{this.$message.success("新增成功"),this.dialog.visible=!1,this.tableData.unshift(e.data),this.saveLoading=!1})).catch((e=>{this.saveLoading=!1}))},updateRole(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectRole.id,e.permission=this.$refs.permission.getCheckedKeys(),this.$api.authRole.update(e).then((t=>{this.$message.success("更新成功"),this.dialog.visible=!1;let a=this.tableData.findIndex((t=>t.id===e.id));this.$set(this.tableData,a,this.$libs.getAssignKeyData(this.selectRole,e)),this.saveLoading=!1})).catch((e=>{this.saveLoading=!1}))},deleteRole(e){this.deleteLoading=!0;let t=e.row;this.$tool.confirmWarning("确定要删除"+t.role_name+"吗？").then((()=>{this.$api.authRole.delete({id:t.id}).then((t=>{this.$message.success("删除成功"),this.tableData.splice(e.$index,1),this.dialog.visible=!1,this.deleteLoading=!1})).catch((e=>{this.deleteLoading=!1}))}))},switchStatus(e,t){this.$api.authRole.update({id:t.id,status:e}).then((e=>{this.$message.success("更新成功")})).catch((a=>{t.status=0===e?1:0}))}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-table",{attrs:{headers:e.headers,data:e.tableData,"is-pagination":"",total:e.total,loading:e.loading},on:{changePage:e.getRoleList},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-row",{attrs:{type:"flex"}},[a("el-col",[a("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(t){return e.handleAction("create")}}},[e._v("新增角色")])],1)],1)]},proxy:!0},{key:"item.role_type",fn:function(t){return[1===t.scope.row.role_type?a("el-tag",{attrs:{size:"mini"}},[e._v("默认角色")]):e._e()]}},{key:"item.status",fn:function(t){var i=t.scope;return[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(t){return e.switchStatus(t,i.row)}},model:{value:i.row.status,callback:function(t){e.$set(i.row,"status",t)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(t){var i=t.scope;return[a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleAction("edit",i.row)}}},[e._v("编辑")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.deleteRole(i)}}},[e._v("删除")])]}}])})],1),a("el-dialog",{attrs:{title:e.dialog.title,visible:e.dialog.visible,width:"30%"},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)},closed:e.resetForm}},[a("el-row",[a("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.queryLoading,expression:"queryLoading"}],attrs:{span:24}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"small"}},[a("el-form-item",{attrs:{label:"角色名称"}},[a("el-input",{model:{value:e.form.role_name,callback:function(t){e.$set(e.form,"role_name",t)},expression:"form.role_name"}})],1),a("el-form-item",{attrs:{label:"父级角色"}},[a("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.form.parent_id,callback:function(t){e.$set(e.form,"parent_id",t)},expression:"form.parent_id"}},[a("el-option",{attrs:{label:"顶级分组",value:0}}),e._l(e.addRoleData.parentRole,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],2)],1),a("el-form-item",{attrs:{label:"角色级别"}},[a("el-input",{attrs:{disabled:""},model:{value:e.form.role_level,callback:function(t){e.$set(e.form,"role_level",t)},expression:"form.role_level"}})],1),a("el-form-item",{attrs:{label:"角色类型"}},[a("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.form.role_type,callback:function(t){e.$set(e.form,"role_type",t)},expression:"form.role_type"}},[a("el-option",{attrs:{label:"默认类型",value:1}})],1)],1),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),a("el-form-item",{attrs:{label:"状态"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1),a("el-form-item",{attrs:{label:"功能权限"}},[a("Permission",{ref:"permission",attrs:{checked:e.form.permission}})],1)],1)],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialog.visible=!1}}},[e._v("取 消")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"primary",loading:e.saveLoading},on:{click:function(t){"create"===e.dialog.type?e.createRole():e.updateRole()}}},[e._v("保 存")])],1)],1)],1)}),[],!1,(function(e){for(let t in Ee)this[t]=Ee[t]}),"569d03cd",null,null).exports,Ue={Action:["search","home","settings","done","account_circle","info","check_circle","delete","shopping_cart","favorite","visibility","face","logout","description","fingerprint","favorite_border","lock","help_outline","language","schedule","manage_accounts","thumb_up","filter_alt","event","verified","dashboard","list","calendar_today","login","lightbulb","visibility_off","check_circle_outline","date_range","question_answer","highlight_off","help","paid","article","trending_up","task_alt","account_balance","shopping_bag","open_in_new","perm_identity","credit_card","arrow_right_alt","history","star_rate","fact_check","assignment","delete_outline","verified_user","build","report_problem","pets","analytics","autorenew","work","print","savings","account_balance_wallet","view_list","code","store","delete_forever","today","lock_open","add_shopping_cart","admin_panel_settings","grade","room","update","watch_later","power_settings_new","android","receipt","contact_support","explore","done_all","flutter_dash","bookmark","account_box","shopping_basket","accessibility","reorder","note_add","thumb_up_off_alt","launch","touch_app","supervisor_account","bookmark_border","payment","drag_indicator","done_outline","pending_actions","assessment","exit_to_app","zoom_in","view_in_ar","leaderboard","feedback","timeline","pan_tool","open_in_full","pending","bug_report","preview","work_outline","assignment_ind","stars","flight_takeoff","accessibility_new","published_with_changes","card_giftcard","alarm","dns","book","add_task","assignment_turned_in","supervised_user_circle","cached","swap_horiz","gavel","get_app","record_voice_over","extension","contact_page","label","3d_rotation","sync_alt","translate","space_dashboard","minimize","thumb_down","help_center","trending_flat","hourglass_empty","nightlight_round","edit_calendar","loyalty","dashboard_customize","support","sticky_note_2","rule","group_work","announcement","settings_applications","euro_symbol","view_headline","privacy_tip","grading","book_online","source","arrow_circle_up","sensors","close_fullscreen","find_in_page","compare_arrows","copyright","api","query_builder","dangerous","restore","swap_vert","track_changes","table_view","redeem","subject","bookmarks","settings_phone","input","backup","build_circle","disabled_by_default","toc","https","circle_notifications","perm_media","arrow_circle_down","zoom_out","swipe","ads_click","open_with","perm_phone_msg","label_important","file_present","wysiwyg","g_translate","pageview","speaker_notes","perm_contact_calendar","view_module","card_membership","trending_down","integration_instructions","tips_and_updates","accessible","model_training","settings_accessibility","upgrade","production_quantity_limits","offline_bolt","change_history","thumbs_up_down","calendar_view_month","invert_colors","bookmark_add","expand","class","donut_large","aspect_ratio","settings_backup_restore","thumb_down_off_alt","segment","important_devices","settings_ethernet","youtube_searched_for","alarm_on","maximize","schedule_send","theaters","opacity","view_column","commute","mark_as_unread","open_in_browser","no_accounts","addchart","mediation","view_agenda","unpublished","system_update_alt","saved_search","contactless","turned_in","bookmark_added","not_started","settings_input_antenna","add_to_drive","tour","shop","view_week","anchor","history_toggle_off","hide_source","camera_enhance","flight_land","turned_in_not","accessible_forward","flaky","search_off","fit_screen","view_carousel","assignment_late","plagiarism","settings_input_component","settings_remote","settings_voice","highlight_alt","pregnant_woman","hourglass_full","donut_small","edit_off","all_inbox","next_plan","remove_shopping_cart","online_prediction","toll","lock_clock","tab","view_sidebar","assignment_return","restore_from_trash","dynamic_form","offline_pin","swap_horizontal_circle","event_seat","markunread_mailbox","request_page","settings_power","outlet","try","view_quilt","gif","rowing","smart_button","vertical_split","calendar_view_week","hotel_class","play_for_work","card_travel","alarm_add","remove_done","calendar_view_day","chrome_reader_mode","compress","outbox","settings_input_composite","settings_overscan","wifi_protected_setup","find_replace","http","settings_brightness","quickreply","polymer","data_exploration","comment_bank","spellcheck","view_stream","settings_bluetooth","backup_table","new_label","outbound","restore_page","batch_prediction","view_day","assignment_returned","credit_card_off","bookmark_remove","generating_tokens","swap_vertical_circle","picture_in_picture","line_weight","code_off","horizontal_split","settings_cell","send_and_archive","perm_scan_wifi","flip_to_front","cancel_schedule_send","shop_two","perm_data_setting","settings_input_hdmi","app_blocking","alarm_off","eject","speaker_notes_off","line_style","sensors_off","perm_device_information","work_off","free_cancellation","picture_in_picture_alt","disabled_visible","subtitles_off","settings_input_svideo","hourglass_disabled","update_disabled","voice_over_off","open_in_new_off","all_out","view_array","flip_to_back","private_connectivity","tab_unselected","label_off","rounded_corner","explore_off","pin_invoke","text_rotation_none","text_rotate_vertical","shop_2","perm_camera_mic","not_accessible","text_rotation_angledown","extension_off","pin_end","text_rotation_angleup","text_rotate_up","text_rotation_down","gif_box","switch_access_shortcut_add","switch_access_shortcut"],Navigation:["close","menu","expand_more","arrow_back","chevron_right","arrow_forward_ios","arrow_back_ios","arrow_drop_down","cancel","more_vert","arrow_forward","chevron_left","expand_less","check","more_horiz","refresh","apps","arrow_upward","payments","arrow_back_ios_new","east","campaign","arrow_downward","arrow_right","menu_open","double_arrow","fullscreen","maps_home_work","unfold_more","arrow_drop_up","west","south","arrow_left","home_work","north","first_page","arrow_drop_down_circle","fullscreen_exit","north_east","last_page","unfold_less","subdirectory_arrow_right","assistant_direction","legend_toggle","app_settings_alt","south_east","north_west","subdirectory_arrow_left","switch_left","waterfall_chart","south_west","switch_right","pivot_table_chart","expand_circle_down","offline_share","apps_outage"],Content:["add","add_circle_outline","add_circle","send","content_copy","clear","mail","save","link","filter_list","remove","inventory_2","insights","remove_circle_outline","sort","create","bolt","inventory","flag","remove_circle","reply","add_box","push_pin","block","calculate","how_to_reg","undo","content_paste","file_copy","report","shield","archive","backspace","save_alt","policy","change_circle","tag","content_cut","redo","forward","inbox","biotech","ballot","link_off","drafts","outlined_flag","stacked_bar_chart","markunread","delete_sweep","report_gmailerrorred","square_foot","stream","add_link","waves","where_to_vote","dynamic_feed","copy_all","move_to_inbox","unarchive","reply_all","text_format","select_all","low_priority","how_to_vote","font_download","weekend","upcoming","gesture","attribution","next_week","content_paste_off","report_off","font_download_off"],Social:["person","facebook","notifications","groups","people","share","person_outline","school","person_add","public","emoji_events","group","notifications_active","engineering","construction","people_alt","psychology","health_and_safety","emoji_emotions","travel_explore","group_add","notifications_none","thumb_up_alt","sentiment_satisfied","sentiment_very_satisfied","coronavirus","emoji_objects","location_city","precision_manufacturing","ios_share","sports_esports","science","military_tech","person_add_alt","cake","water_drop","sentiment_dissatisfied","history_edu","self_improvement","emoji_people","sentiment_very_dissatisfied","person_remove","female","poll","sports_soccer","mood","male","domain","masks","whatshot","recommend","people_outline","connect_without_contact","sentiment_neutral","person_off","person_add_alt_1","catching_pokemon","hiking","architecture","notifications_off","recycling","back_hand","emoji_nature","emoji_symbols","waving_hand","luggage","mood_bad","thumb_down_alt","front_hand","switch_account","nights_stay","notification_add","sports_basketball","king_bed","sports_kabaddi","emoji_flags","sports","social_distance","emoji_food_beverage","sick","emoji_transportation","deck","clean_hands","sports_tennis","reduce_capacity","outdoor_grill","transgender","follow_the_signs","elderly","sanitizer","real_estate_agent","fireplace","add_reaction","plus_one","add_moderator","edit_notifications","surfing","sports_motorsports","workspace_premium","sports_baseball","sports_handball","pages","piano","kayaking","skateboarding","sports_football","sports_volleyball","single_bed","downhill_skiing","cruelty_free","compost","public_off","6_ft_apart","remove_moderator","safety_divider","personal_injury","person_remove_alt_1","nordic_walking","notifications_paused","paragliding","sports_cricket","sports_mma","group_off","snowboarding","party_mode","sports_golf","kitesurfing","snowshoeing","ice_skating","sports_rugby","sports_hockey","sledding","interests","no_luggage","piano_off","group_remove","co2"],Image:["edit","navigate_next","photo_camera","image","picture_as_pdf","tune","circle","receipt_long","timer","auto_stories","navigate_before","add_a_photo","auto_awesome","collections","remove_red_eye","palette","music_note","wb_sunny","add_photo_alternate","brush","flash_on","euro","auto_fix_high","looks_one","camera_alt","camera","audiotrack","style","control_point","adjust","straighten","photo_library","portrait","video_camera_front","color_lens","grid_on","rotate_right","crop_free","crop_square","landscape","timelapse","collections_bookmark","slideshow","lens","filter_vintage","crop","panorama_fish_eye","auto_awesome_motion","filter_drama","image_search","looks_two","healing","blur_on","wb_incandescent","rotate_left","looks_3","compare","dehaze","wb_cloudy","face_retouching_natural","flare","center_focus_strong","brightness_4","assistant","colorize","broken_image","auto_awesome_mosaic","cases","filter_none","nature_people","tag_faces","photo","brightness_5","crop_original","filter_center_focus","flash_off","grain","flip_camera_android","details","movie_creation","loupe","brightness_6","flip","filter_1","brightness_1","flip_camera_ios","add_to_photos","panorama","nature","center_focus_weak","image_not_supported","brightness_7","animation","auto_fix_normal","filter","bedtime","photo_size_select_actual","texture","view_comfy","crop_din","looks_4","control_point_duplicate","movie_filter","transform","video_camera_back","motion_photos_on","photo_camera_front","timer_off","leak_add","view_compact","music_off","mic_external_on","thermostat_auto","shutter_speed","looks_5","gradient","rotate_90_degrees_ccw","filter_tilt_shift","photo_album","assistant_photo","exposure_plus_1","hide_image","looks","vrpano","flash_auto","filter_2","tonality","hdr_strong","motion_photos_auto","wb_twilight","iso","blur_circular","photo_filter","brightness_3","crop_16_9","filter_hdr","looks_6","crop_7_5","exposure","linked_camera","incomplete_circle","crop_rotate","hdr_weak","brightness_2","camera_front","photo_size_select_small","filter_3","photo_size_select_large","filter_frames","crop_portrait","burst_mode","camera_roll","filter_b_and_w","blur_linear","crop_5_4","crop_landscape","crop_3_2","switch_camera","filter_7","monochrome_photos","exposure_zero","photo_camera_back","filter_9_plus","switch_video","exposure_plus_2","filter_5","filter_4","grid_off","face_retouching_off","motion_photos_paused","wb_shade","auto_fix_off","wb_iridescent","filter_9","filter_8","video_stable","hdr_on","leak_remove","motion_photos_off","24mp","panorama_photosphere","blur_off","filter_6","timer_3","exposure_neg_1","timer_10","vignette","dirty_lens","panorama_wide_angle_select","raw_on","30fps_select","60fps_select","camera_rear","image_aspect_ratio","panorama_horizontal","panorama_photosphere_select","exposure_neg_2","motion_photos_pause","wb_auto","panorama_horizontal_select","mic_external_off","autofps_select","23mp","panorama_wide_angle","panorama_vertical_select","hdr_plus","panorama_vertical","12mp","hdr_enhanced_select","hevc","mp","20mp","18mp","hdr_off","13mp","16mp","11mp","6mp","raw_off","10mp","15mp","3mp","21mp","22mp","14mp","8mp","5mp","19mp","2mp","4mp","7mp","9mp","17mp"],Communication:["email","location_on","call","phone","business","chat","mail_outline","vpn_key","list_alt","qr_code_scanner","chat_bubble_outline","alternate_email","chat_bubble","forum","contact_mail","textsms","qr_code_2","sentiment_satisfied_alt","message","person_search","qr_code","comment","contacts","app_registration","live_help","contact_phone","import_contacts","rss_feed","import_export","forward_to_inbox","hourglass_bottom","hourglass_top","mark_email_read","read_more","call_end","document_scanner","mark_email_unread","more_time","clear_all","dialpad","phone_enabled","3p","mark_chat_unread","screen_share","cancel_presentation","present_to_all","call_split","call_made","unsubscribe","stay_current_portrait","phonelink_ring","mark_chat_read","stay_primary_portrait","domain_verification","add_ic_call","duo","phonelink_lock","phone_disabled","call_received","phonelink_setup","ring_volume","swap_calls","location_off","call_merge","mobile_screen_share","voicemail","cell_wifi","speaker_phone","call_missed_outgoing","person_add_disabled","phonelink_erase","desktop_access_disabled","call_missed","domain_disabled","stop_screen_share","pause_presentation","portable_wifi_off","print_disabled","rtt","wifi_calling","invert_colors_off","dialer_sip","sip","stay_current_landscape","stay_primary_landscape","nat","no_sim","comments_disabled"],File:["file_download","file_upload","download","folder","grid_view","upload_file","cloud_upload","cloud","folder_open","text_snippet","cloud_download","request_quote","attachment","drive_file_rename_outline","upload","download_for_offline","create_new_folder","downloading","folder_shared","cloud_done","topic","cloud_queue","download_done","workspaces","approval","cloud_off","drive_file_move","drive_folder_upload","file_download_done","attach_email","rule_folder","cloud_circle","snippet_folder","file_download_off","drive_file_move_rtl"],Maps:["local_shipping","place","menu_book","local_offer","map","category","badge","restaurant","directions_car","volunteer_activism","local_fire_department","my_location","flight","local_mall","directions_run","near_me","handyman","restaurant_menu","medical_services","layers","directions_walk","local_hospital","park","pin_drop","local_library","celebration","lunch_dining","directions_bike","local_cafe","delivery_dining","local_atm","local_activity","person_pin","design_services","miscellaneous_services","rate_review","directions_car_filled","directions_bus","local_grocery_store","fastfood","local_police","local_phone","home_repair_service","zoom_out_map","hotel","local_florist","person_pin_circle","cleaning_services","navigation","money","local_parking","directions","local_post_office","train","traffic","local_gas_station","two_wheeler","electrical_services","alt_route","local_bar","pedal_bike","directions_boat","360","add_business","beenhere","liquor","agriculture","local_dining","sailing","local_airport","moving","ramen_dining","add_location_alt","local_taxi","local_drink","local_printshop","add_location","hail","maps_ugc","not_listed_location","local_laundry_service","theater_comedy","wine_bar","local_pizza","terrain","dinner_dining","directions_bus_filled","trip_origin","bakery_dining","multiple_stop","local_pharmacy","icecream","transfer_within_a_station","store_mall_directory","museum","takeout_dining","set_meal","emergency","nightlife","departure_board","local_see","festival","car_rental","edit_location","plumbing","edit_road","hardware","add_road","local_convenience_store","electric_car","satellite","layers_clear","ev_station","pest_control","run_circle","attractions","edit_location_alt","directions_boat_filled","local_movies","moped","dry_cleaning","tram","car_repair","wrong_location","edit_attributes","breakfast_dining","taxi_alert","subway","directions_transit","brunch_dining","hvac","atm","electric_scooter","transit_enterexit","bus_alert","local_car_wash","electric_bike","streetview","local_hotel","directions_subway","compass_calibration","directions_railway","electric_moped","local_play","no_meals","pest_control_rodent","bike_scooter","electric_rickshaw","near_me_disabled","railway_alert","directions_transit_filled","snowmobile","no_transfer","directions_subway_filled","directions_railway_filled","soup_kitchen","mode_of_travel","airline_stops","airlines","connecting_airports","flight_class"],"Audio & Video":["play_arrow","play_circle_filled","videocam","mic","play_circle","volume_up","pause","play_circle_outline","volume_off","replay","skip_next","library_books","stop","speed","movie","skip_previous","fiber_manual_record","new_releases","playlist_add","equalizer","loop","fast_forward","web","mic_off","video_library","playlist_add_check","library_add","volume_mute","pause_circle","video_call","stop_circle","repeat","shuffle","subscriptions","mic_none","library_music","sort_by_alpha","not_interested","fast_rewind","videocam_off","pause_circle_filled","volume_down","hearing","queue_music","subtitles","recent_actors","album","pause_circle_outline","radio","library_add_check","note","av_timer","fiber_new","web_asset","games","playlist_play","forward_10","branding_watermark","replay_10","replay_circle_filled","queue","closed_caption","video_settings","featured_play_list","control_camera","slow_motion_video","airplay","add_to_queue","closed_caption_off","high_quality","replay_30","repeat_on","5g","snooze","hd","repeat_one","call_to_action","shuffle_on","music_video","forward_30","featured_video","replay_5","hearing_disabled","forward_5","queue_play_next","art_track","explicit","4k","video_label","fiber_smart_record","play_disabled","repeat_one_on","remove_from_queue","surround_sound","closed_caption_disabled","web_asset_off","10k","missed_video_call","sd","4k_plus","fiber_pin","2k","1k","fiber_dvr","8k","9k","9k_plus","1k_plus","2k_plus","5k_plus","3k","5k","3k_plus","7k_plus","8k_plus","6k","6k_plus","7k"],Toggle:["star","check_box","check_box_outline_blank","radio_button_unchecked","radio_button_checked","toggle_on","star_border","star_outline","toggle_off","star_half","indeterminate_check_box","star_purple500","star_border_purple500"],Alert:["warning","error","error_outline","warning_amber","notification_important","add_alert","auto_delete"],Editor:["attach_money","mode_edit","format_list_bulleted","monetization_on","attach_file","edit_note","post_add","bar_chart","checklist","insert_drive_file","drag_handle","show_chart","format_quote","insert_photo","format_list_numbered","border_color","table_chart","notes","pie_chart","mode","format_bold","insert_emoticon","auto_graph","text_fields","table_rows","publish","title","insert_chart_outlined","query_stats","checklist_rtl","mode_edit_outline","mode_comment","insert_link","insert_invitation","functions","format_italic","format_align_left","format_color_fill","draw","linear_scale","insert_chart","add_comment","format_size","bubble_chart","horizontal_rule","stacked_line_chart","insert_comment","format_underlined","money_off","vertical_align_bottom","format_align_center","vertical_align_top","format_paint","height","format_color_text","schema","format_align_right","merge_type","scatter_plot","format_list_numbered_rtl","format_align_justify","highlight","area_chart","add_chart","format_shapes","pie_chart_outline","short_text","money_off_csred","align_horizontal_left","format_color_reset","format_indent_increase","multiline_chart","strikethrough_s","vertical_align_center","score","border_all","format_line_spacing","format_clear","format_indent_decrease","format_strikethrough","align_vertical_bottom","horizontal_distribute","space_bar","align_horizontal_center","align_horizontal_right","vertical_distribute","superscript","subscript","margin","align_vertical_top","border_clear","wrap_text","align_vertical_center","border_outer","border_style","padding","border_horizontal","border_vertical","border_inner","format_textdirection_l_to_r","border_right","border_bottom","border_left","border_top","format_textdirection_r_to_l"],Notification:["support_agent","wifi","account_tree","event_available","sync","priority_high","phone_in_talk","event_note","sms","confirmation_number","live_tv","ondemand_video","wifi_off","wc","do_not_disturb_on","event_busy","drive_eta","more","power","do_not_disturb","time_to_leave","vpn_lock","sync_problem","do_disturb_on","enhanced_encryption","folder_special","running_with_errors","network_check","do_disturb","phone_callback","sms_failed","power_off","system_update","voice_chat","phone_forwarded","adb","personal_video","vibration","do_disturb_alt","airline_seat_recline_normal","do_not_disturb_alt","sd_card","no_encryption","sync_disabled","tap_and_play","phone_missed","imagesearch_roller","airline_seat_recline_extra","mms","no_encryption_gmailerrorred","disc_full","bluetooth_audio","airline_seat_individual_suite","network_locked","phone_paused","sd_card_alert","phone_locked","do_not_disturb_off","airline_seat_flat","do_disturb_off","airline_seat_flat_angled","sim_card_alert","phone_bluetooth_speaker","tv_off","airline_seat_legroom_extra","airline_seat_legroom_normal","directions_off","airline_seat_legroom_reduced"],Hardware:["keyboard_arrow_down","phone_iphone","smartphone","keyboard_arrow_right","computer","security","desktop_windows","smart_display","phone_android","keyboard_arrow_up","keyboard_backspace","smart_toy","laptop","keyboard_arrow_left","tv","headphones","keyboard","headset_mic","memory","point_of_sale","keyboard_return","mouse","developer_board","keyboard_voice","videogame_asset","router","device_hub","cast_for_education","headset","laptop_mac","cast","watch","laptop_chromebook","devices_other","tablet_mac","monitor","keyboard_tab","desktop_mac","phonelink","speaker","keyboard_alt","gamepad","toys","connected_tv","sim_card","tablet_android","cast_connected","device_unknown","laptop_windows","scanner","keyboard_hide","earbuds","tablet","headset_off","keyboard_capslock","speaker_group","headphones_battery","home_max","smart_screen","earbuds_battery","dock","home_mini","browser_not_supported","power_input","phonelink_off","developer_board_off","videogame_asset_off","browser_updated"],Device:["light_mode","restart_alt","dark_mode","task","password","summarize","sell","devices","signal_cellular_alt","settings_suggest","quiz","widgets","thermostat","battery_full","storage","credit_score","gps_fixed","price_check","medication","pin","battery_charging_full","price_change","gpp_good","tungsten","air","note_alt","reviews","fmd_good","graphic_eq","access_time","bluetooth","water","sports_score","dvr","nightlight","share_location","device_thermostat","gpp_maybe","cameraswitch","monitor_weight","radar","location_searching","shortcut","battery_std","cable","bloodtype","airplane_ticket","signal_wifi_4_bar","wifi_tethering","data_usage","mode_night","wallpaper","developer_mode","signal_cellular_4_bar","gpp_bad","network_wifi","lens_blur","airplanemode_active","fmd_bad","access_time_filled","flashlight_on","splitscreen","signal_wifi_statusbar_4_bar","battery_alert","usb","send_to_mobile","mobile_friendly","screen_search_desktop","sim_card_download","gps_not_fixed","remember_me","bluetooth_connected","system_security_update_good","signal_wifi_statusbar_connected_no_internet_4","screen_rotation","nfc","pattern","storm","battery_saver","play_lesson","brightness_high","mode_standby","network_cell","data_saver_off","signal_wifi_0_bar","screenshot","data_saver_on","brightness_low","bluetooth_searching","ad_units","grid_4x4","hdr_auto","bluetooth_disabled","mobiledata_off","battery_unknown","aod","security_update_good","signal_wifi_off","brightness_medium","access_alarms","signal_wifi_bad","settings_system_daydream","wifi_calling_3","gps_off","flourescent","security_update","signal_wifi_connected_no_internet_4","signal_cellular_0_bar","add_to_home_screen","4g_mobiledata","wifi_lock","grid_3x3","sd_storage","access_alarm","do_not_disturb_on_total_silence","signal_wifi_statusbar_null","wifi_tethering_error_rounded","reset_tv","flashlight_off","airplanemode_inactive","brightness_auto","screen_lock_portrait","signal_wifi_4_bar_lock","nearby_error","signal_cellular_connected_no_internet_4_bar","system_security_update","security_update_warning","1x_mobiledata","edgesensor_high","system_security_update_warning","30fps","signal_cellular_connected_no_internet_0_bar","add_alarm","lte_mobiledata","media_bluetooth_on","4g_plus_mobiledata","wifi_tethering_off","60fps","bluetooth_drive","location_disabled","signal_cellular_off","signal_cellular_nodata","signal_cellular_null","grid_goldenratio","rsvp","timer_10_select","mobile_off","edgesensor_low","screen_lock_rotation","3g_mobiledata","lte_plus_mobiledata","timer_3_select","usb_off","screen_lock_landscape","g_mobiledata","signal_cellular_no_sim","media_bluetooth_off","h_mobiledata","hdr_on_select","hdr_auto_select","e_mobiledata","r_mobiledata","h_plus_mobiledata","nearby_off","hdr_off_select"],Places:["storefront","apartment","fitness_center","spa","business_center","house","meeting_room","cottage","corporate_fare","ac_unit","family_restroom","other_houses","checkroom","grass","all_inclusive","airport_shuttle","child_care","pool","beach_access","kitchen","holiday_village","roofing","casino","sports_bar","room_service","room_preferences","free_breakfast","gite","escalator_warning","foundation","bathtub","child_friendly","food_bank","villa","night_shelter","golf_course","stairs","microwave","wash","backpack","house_siding","countertops","cabin","smoking_rooms","water_damage","no_photography","fire_extinguisher","elevator","soap","hot_tub","carpenter","charging_station","baby_changing_station","crib","rv_hookup","umbrella","tapas","smoke_free","rice_bowl","do_not_touch","fence","no_food","balcony","bungalow","wheelchair_pickup","bento","houseboat","iron","chalet","tty","escalator","dry","do_not_step","no_meeting_room","stroller","no_drinks","no_flash","no_cell","no_backpack","no_stroller"],Search:["feed","manage_search","bed","chair","podcasts","shower","coffee","yard","window","door_front","light","garage","dining","flatware","coffee_maker","blender","camera_indoor","bathroom","bedroom_parent","bedroom_baby","chair_alt","doorbell","door_back","bedroom_child","camera_outdoor","living","door_sliding"],Home:["sensor_door","sensor_window"]};const Be={name:"IconSelector",props:{visible:{type:Boolean,default:!1}},computed:{show:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},data:()=>({iconList:Ue,activeName:Object.keys(Ue)[0]})},Re={};var We=T(Be,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"选择图标",visible:e.show,"close-on-click-modal":""},on:{"update:visible":function(t){e.show=t}}},[a("el-tabs",{attrs:{type:"card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.iconList,(function(t,i){return a("el-tab-pane",{key:i,attrs:{label:i,name:i}},[a("div",{staticClass:"icon-list"},e._l(t,(function(t,i){return a("div",{key:i,staticClass:"icon-list-item",on:{click:function(a){e.$emit("select",t),e.show=!1}}},[a("el-tooltip",{attrs:{"popper-class":"tooltip",effect:"light","visible-arrow":!1,"open-delay":1e3,content:t,placement:"bottom"}},[a("span",{staticClass:"material-icons icon"},[e._v(e._s(t))])])],1)})),0)])})),1)],1)}),[],!1,(function(e){for(let t in Re)this[t]=Re[t]}),"5b5b51e7",null,null).exports;const Ve={};var He=T({name:"AuthPermission",components:{IconSelector:We},mixins:[Ne],data:()=>({iconSelector:!1,saveLoading:!1,deleteLoading:!1,drawer:{title:"",type:"",span:20,visible:!1},temp:{},form:{parent_id:0,permission_name:"",permission_level:1,permission_type:1,route:"",method:"",menu_show:1,menu_icon:"",page_name:"",page_title:"",page_component:"",button_key:"",sort:0,desc:"",status:1},headers:[{label:"权限名称",prop:"permission_name"},{label:"权限级别",prop:"permission_level",align:"center"},{label:"权限路由",prop:"route",align:"center",tooltip:!0},{label:"排序",prop:"sort",align:"center"},{label:"权限类型",prop:"permission_type",align:"center"},{label:"状态",prop:"status",align:"center"},{label:"操作",prop:"action",width:251}],data:[],permissionList:[],treeData:[],selectItem:{},action:"",query:{type:1}}),mounted(){this.getPermissionList()},methods:{handleAction(e="create",t=null){this.action=e,this.selectItem=t||{},"create"===e?(this.form.parent_id=0,this.form.permission_level=1,this.drawer.title="新增权限"):"createChild"===e?(this.form.parent_id=t.id,this.form.permission_level=t.permission_level+1,this.form.permission_type=t.permission_type,this.form.route=t.route,this.drawer.title="新增子权限"):"update"===e&&(this.$libs.getAssignKeyData(this.form,t),this.drawer.title="编辑权限"),this.drawer.visible=!0},async getPermissionList(){this.loading=!0,this.form.permission_type=this.query.type,this.$api.authPermission.queryAll(this.query).then((e=>{let t=e.data;this.permissionList=t,this.setTreeData(t),this.loading=!1}))},async createPermission(){this.saveLoading=!0;try{let e=await this.$api.authPermission.create(this.form);this.$message.success("创建成功"),this.drawer.visible=!1,e.data.status=1,this.permissionList.push(e.data),await this.setTreeData()}catch(e){}finally{this.saveLoading=!1}},updatePermission(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id,this.$api.authPermission.update(e).then((t=>{this.$message.success("更新成功"),this.drawer.visible=!1,this.saveLoading=!1,(async()=>{let t=this.permissionList,a=t.findIndex((t=>t.id===e.id));t[a]=e,await this.setTreeData(t)})()})).catch((e=>{this.saveLoading=!1}))},deletePermission(e){this.$tool.confirmWarning("确定要删除"+e.permission_name+"吗？将会连同子权限一起删除！").then((()=>{this.$api.authPermission.delete({id:e.id}).then((t=>{this.$message.success("删除成功"),this.drawer.visible=!1,this.deleteLoading=!1,(async()=>{let t=this.permissionList,a=t.findIndex((t=>t.id===e.id));t.splice(a,1),await this.setTreeData(t)})()}))}))},async setTreeData(e=this.permissionList){this.treeData=this.$libs.formatTreeData(JSON.parse(JSON.stringify(e)))},switchStatus(e,t){this.$api.authPermission.update({id:t.id,status:e}).then((e=>{this.$message.success("更新成功")})).catch((a=>{t.status=0===e?1:0}))},resetForm(){this.form=Object.assign({},this.defaultForm),this.form.permission_type=this.query.type}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-search-card",[i("el-form",{attrs:{inline:!0}},[i("el-form-item",{attrs:{label:"权限类型"}},[i("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:t.getPermissionList},model:{value:t.query.type,callback:function(e){t.$set(t.query,"type",e)},expression:"query.type"}},[i("el-option",{attrs:{label:"接口",value:1}}),i("el-option",{attrs:{label:"菜单",value:2}}),i("el-option",{attrs:{label:"页面",value:3}}),i("el-option",{attrs:{label:"按钮",value:4}})],1)],1)],1)],1),i("k-table",{attrs:{headers:t.headers,data:t.treeData,"row-key":"id","highlight-current-row":!0,"zoom-height":103,loading:t.loading},scopedSlots:t._u([{key:"header",fn:function(){return[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleAction("create")}}},[t._v("新增权限")])]},proxy:!0},{key:"item.permission_name",fn:function(e){var a=e.scope;return[i("el-link",{attrs:{underline:!1,type:"primary"}},[t._v(t._s(a.row.permission_name))])]}},{key:"item.permission_type",fn:function(e){var a=e.scope;return[1===a.row.permission_type?i("el-tag",{attrs:{size:"mini",type:"primay"}},[t._v("接口")]):t._e(),2===a.row.permission_type?i("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("菜单")]):t._e(),3===a.row.permission_type?i("el-tag",{attrs:{size:"mini",type:"warning"}},[t._v("页面")]):t._e(),4===a.row.permission_type?i("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("按钮")]):t._e()]}},{key:"item.status",fn:function(e){var a=e.scope;return[i("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(e){return t.switchStatus(e,a.row)}},model:{value:a.row.status,callback:function(e){t.$set(a.row,"status",e)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(e){var a=e.scope;return[i("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(e){return t.handleAction("createChild",a.row)}}},[t._v("新增子权限")]),i("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(e){return t.handleAction("update",a.row)}}},[t._v("编辑")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"danger",size:"mini",plain:""},on:{click:function(e){return t.deletePermission(a.row)}}},[t._v("删除")])]}}])})],1),i("k-drawer",{attrs:{title:t.drawer.title,visible:t.drawer.visible,size:"35%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取 消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary",loading:t.saveLoading},on:{click:function(e){"update"===t.action?t.updatePermission():t.createPermission()}}},[t._v("保 存")])]},proxy:!0}])},[i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"父级权限"}},[i("el-select",{attrs:{disabled:""},model:{value:t.form.parent_id,callback:function(e){t.$set(t.form,"parent_id",e)},expression:"form.parent_id"}},[i("el-option",{attrs:{label:"顶级权限",value:0}}),i("el-option",{attrs:{label:t.selectItem.permission_name,value:t.selectItem.id}})],1)],1),i("el-form-item",{attrs:{label:"权限级别"}},[i("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:t.form.permission_level,callback:function(e){t.$set(t.form,"permission_level",e)},expression:"form.permission_level"}},[i("el-option",{attrs:{label:"顶级权限",value:1}})],1)],1),i("el-form-item",{attrs:{label:"权限类型"}},[i("el-radio-group",{attrs:{disabled:"createChild"===t.action,disabled:""},model:{value:t.form.permission_type,callback:function(e){t.$set(t.form,"permission_type",e)},expression:"form.permission_type"}},[i("el-radio",{attrs:{label:1}},[t._v("接口")]),i("el-radio",{attrs:{label:2}},[t._v("菜单")]),i("el-radio",{attrs:{label:3}},[t._v("页面")]),i("el-radio",{attrs:{label:4}},[t._v("按钮")])],1)],1),i("el-form-item",{attrs:{label:"排序"}},[i("el-input-number",{attrs:{min:0,max:255,label:"排序",size:"mini"},model:{value:t.form.sort,callback:function(e){t.$set(t.form,"sort",e)},expression:"form.sort"}})],1),i("el-form-item",{attrs:{label:"权限名称",required:""}},[i("el-input",{model:{value:t.form.permission_name,callback:function(e){t.$set(t.form,"permission_name",e)},expression:"form.permission_name"}})],1),i("el-form-item",{attrs:{label:"路由"}},[i("el-input",{model:{value:t.form.route,callback:function(e){t.$set(t.form,"route",e)},expression:"form.route"}})],1),1===t.form.permission_type?[i("el-form-item",{attrs:{label:"请求方式"}},[i("el-select",{model:{value:t.form.method,callback:function(e){t.$set(t.form,"method",e)},expression:"form.method"}},[i("el-option",{attrs:{label:"get",value:"get"}}),i("el-option",{attrs:{label:"post",value:"post"}}),i("el-option",{attrs:{label:"put",value:"put"}}),i("el-option",{attrs:{label:"delete",value:"delete"}})],1)],1)]:t._e(),2===t.form.permission_type?[i("el-form-item",{attrs:{label:"显示菜单"}},[i("el-radio-group",{model:{value:t.form.menu_show,callback:function(e){t.$set(t.form,"menu_show",e)},expression:"form.menu_show"}},[i("el-radio",{attrs:{label:1}},[t._v("显示")]),i("el-radio",{attrs:{label:0}},[t._v("不显示")])],1)],1),i("el-form-item",{attrs:{label:"菜单图标"}},[i("el-input",{attrs:{placeholder:"选择图标"},on:{focus:function(e){t.iconSelector=!0}},model:{value:t.form.menu_icon,callback:function(e){t.$set(t.form,"menu_icon",e)},expression:"form.menu_icon"}},[i("span",{staticClass:"material-icons",attrs:{slot:"prepend"},slot:"prepend"},[t._v(t._s(t.form.menu_icon))])])],1)]:t._e(),3===t.form.permission_type?[i("el-form-item",{attrs:{label:"页面名称",required:""}},[i("el-input",{attrs:{placeholder:"对应组件name字段"},model:{value:t.form.page_name,callback:function(e){t.$set(t.form,"page_name",e)},expression:"form.page_name"}})],1),i("el-form-item",{attrs:{label:"页面标题",required:""}},[i("el-input",{model:{value:t.form.page_title,callback:function(e){t.$set(t.form,"page_title",e)},expression:"form.page_title"}})],1),i("el-form-item",{attrs:{label:"页面组件",required:""}},[i("el-input",{attrs:{placeholder:"组件路径"},model:{value:t.form.page_component,callback:function(e){t.$set(t.form,"page_component",e)},expression:"form.page_component"}})],1)]:t._e(),4===t.form.permission_type?[i("el-form-item",{attrs:{label:"按钮标识",required:""}},[i("el-input",{model:{value:t.form.button_key,callback:function(e){t.$set(t.form,"button_key",e)},expression:"form.button_key"}})],1)]:t._e(),i("el-form-item",{attrs:{label:"描述"}},[i("el-input",{model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1)],2)],1)],1)],1),i("icon-selector",{attrs:{visible:t.iconSelector},on:{"update:visible":function(e){t.iconSelector=e},select:function(t){e.form.menu_icon=t}}})],1)}),[],!1,(function(e){for(let t in Ve)this[t]=Ve[t]}),"abc1ce50",null,null).exports;const Ye={name:"NoPermission",data:()=>({noPermissionSvg:"https://cdn.jsdelivr.net/gh/topoge/taoge@master/assets/403.cd155002.svg"}),methods:o({},m("tabBar",["deleteTab"]))},Me={};var Qe=T(Ye,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"center",height:"calc(100vh - 100px)"}},[a("el-image",{attrs:{src:e.noPermissionSvg}}),a("div",{staticStyle:{"margin-left":"100px"}},[a("p",[e._v("抱歉，你无权访问该页面")]),a("router-link",{attrs:{to:"/"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.deleteTab("NoPermission")}}},[e._v("返回首页")])],1)],1)],1)}),[],!1,(function(e){for(let t in Me)this[t]=Me[t]}),"42641992",null,null).exports;const Je={name:"Empty",data:()=>({emptySvg:"https://cdn.jsdelivr.net/gh/topoge/taoge@master/assets/404.17896f5a.svg"}),computed:o({},p("tabBar",["tabs"])),methods:n(o({},m("tabBar",["deleteTab"])),{closePage(){this.tabs.filter((e=>{"Empty"!==e.name&&"AnyEmpty"!==e.name||this.deleteTab(e.name)}))}})},Ke={};var Ge=[{name:"NoPermission",path:"403",component:Qe,meta:{title:"无访问权限"}},{name:"Empty",path:"404",component:T(Je,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"center",height:"calc(100vh - 100px)"}},[a("el-image",{attrs:{src:e.emptySvg}}),a("div",{staticStyle:{"margin-left":"100px"}},[a("p",[e._v("抱歉，你访问的页面不存在")]),a("router-link",{attrs:{to:"/"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return t.stopPropagation(),e.closePage()}}},[e._v("返回首页")])],1)],1)],1)}),[],!1,(function(e){for(let t in Ke)this[t]=Ke[t]}),"eba75a5a",null,null).exports,meta:{title:"页面不存在"}}];const Xe={baseUrl:()=>"https://music.maxxiang.com/",apiUrl(){return this.baseUrl()+"api/manage/"},staticUrl:()=>"https://max-sound.oss-cn-shanghai.aliyuncs.com/"},Ze=_.create({baseURL:Xe.apiUrl(),timeout:6e4});Ze.interceptors.request.use((e=>(e.headers.Authorization=window.btoa(localStorage.getItem("token")),e)),(e=>Promise.reject(e))),Ze.interceptors.response.use((e=>e.data),(e=>{if(e.response){let t=e.response.data;return f.exports.Message.error(t.message),10011===t.code&&setTimeout((()=>{localStorage.removeItem("token"),location.reload()}),1e3),Promise.reject(t)}return f.exports.Message.error(e.message),Promise.reject(!1)}));class et{constructor(e=""){this.path=e}query(e){return Ze.get(`${this.path}/query`,{params:{id:e}})}batchQuery(e){return Ze.get(`${this.path}/batchQuery`,{params:e})}queryAll(e){return Ze.get(`${this.path}/queryAll`,{params:e})}create(e){return Ze.post(`${this.path}/create`,e)}update(e){return Ze.post(`${this.path}/update`,e)}delete(e){return Ze.post(`${this.path}/delete`,e)}}var tt=new class extends et{setAvatar(e){return Ze.post(`${this.path}/setAvatar`,e)}}("profile");const at={name:"Profile",mixins:[Ne],data:()=>({dialog:{title:"修改密码",type:"",visible:!1},uploading:!1,form:{avatar:null,oldPassword:"",password:""},password:""}),computed:o({},u(["getUser"])),methods:{resetPassword(){if(this.password!==this.form.password)return void this.$message.warning("两次密码不一致");this.saveLoading=!0;let e=Object.assign({},this.form);this.$api.login.resetPassword(e).then((e=>{this.dialog.visible=!1,this.saveLoading=!1,localStorage.removeItem("token"),this.$message.success("密码修改成功，请重新登录"),setTimeout((()=>{this.$router.push("/login")}),1e3)})).catch((e=>{this.saveLoading=!1}))},async uploadImage(e){this.uploading=!0;try{let t=new FormData;t.append("avatar",e);let a=await tt.setAvatar(t);this.$store.commit("setUser",a.data),this.$message.success("修改成功")}catch(t){}finally{this.uploading=!1}}}},it={};var st=T(at,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("el-card",{attrs:{shadow:"nover"}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"20px"}},[a("div",{staticClass:"avatar"}),a("div",{staticClass:"avatar"},[a("el-image",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],staticStyle:{width:"100px",height:"100px"},attrs:{src:e.getUser.avatar?e.$config.staticUrl()+e.getUser.avatar:"",onerror:"this.src='/default_avatar.png'","preview-src-list":[e.getUser.avatar?e.$config.staticUrl()+e.getUser.avatar:"/default_avatar.png"]}}),a("div",{staticClass:"btn"},[a("k-upload-image",{ref:"upload",attrs:{accept:"image/jpeg,image/png,image/gif",upload:e.uploadImage,croppedCanvas:{width:100,height:100}},scopedSlots:e._u([{key:"trigger",fn:function(){return[a("div",{staticClass:"edit"},[a("span",{staticClass:"material-icons"},[e._v("edit")]),e._v("修改 ")])]},proxy:!0}])})],1)],1),a("div",[a("h2",[e._v(e._s(e.$libs.getDayTimeSlot())+"好 "+e._s(e.getUser.nickname?e.getUser.nickname:e.getUser.username))])])]),a("div",[a("span",{staticClass:"merchant-name"},[e._v(e._s(e.getUser?e.getUser.mobile:""))]),a("el-button",{staticStyle:{"margin-top":"20px"},attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){e.dialog.visible=!0}}},[e._v("修改密码")])],1)])],1),a("k-cropper"),a("el-dialog",{attrs:{title:e.dialog.title,visible:e.dialog.visible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"small"}},[a("el-form-item",{attrs:{label:"原密码"}},[a("el-input",{attrs:{type:"password"},model:{value:e.form.oldPassword,callback:function(t){e.$set(e.form,"oldPassword",t)},expression:"form.oldPassword"}})],1),a("el-form-item",{attrs:{label:"新密码"}},[a("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),a("el-form-item",{attrs:{label:"确认密码"}},[a("el-input",{attrs:{type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialog.visible=!1}}},[e._v("取 消")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"primary",loading:e.saveLoading},on:{click:e.resetPassword}},[e._v("保 存")])],1)],1)],1)}),[],!1,(function(e){for(let t in it)this[t]=it[t]}),"8bc2dada",null,null).exports,rt={data:()=>({timeRange:[],dateTime:[],pickerOptions:{shortcuts:[{text:"最近一周",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick(e){const t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]}})},lt={mixins:[rt],props:{value:{type:Boolean,default:!1},type:{type:String,default:"add"},data:{type:Object}},computed:{visible:{get(){return this.value},set(e){this.$emit("input",e)}}},data:()=>({title:"",span:20,defaultForm:{},defaultQuery:{},form:{},query:{},selectItem:{},queryLoading:!1,saveLoading:!1}),mounted(){this.defaultForm=JSON.parse(JSON.stringify(this.form)),this.defaultQuery=JSON.parse(JSON.stringify(this.query))},methods:{resetForm(){this.form=Object.assign({},this.defaultForm)},resetQuery(){this.query=Object.assign({},this.defaultQuery)}}};var ot=new class extends et{putObject(e,t,a){return Ze.put(e,t,a)}imagePutSignedUrl(e){return Ze.get(`${this.path}/imagePutSignedUrl`,{params:e})}songPutSignedUrl(){return Ze.get(`${this.path}/songPutSignedUrl`)}}("oss");const nt={};var ct=T({name:"AddEditPicture",mixins:[lt],data:()=>({form:{att_name:"",business_type:1,tag:[],file:null},rules:{file:[{required:!0,message:"请选择文件",trigger:"blur"}]},tagList:[],inputVisible:!1,inputValue:"",showAllTag:!1}),watch:{async value(e,t){e?("add"===this.type?this.title="新增图片":"edit"===this.type&&(this.title="编辑图片",await this.getPictureInfo()),this.getTagAll()):this.resetForm()}},methods:{async getPictureInfo(){this.queryLoading=!0;let e=(await this.$api.picture.query(this.data.id)).data;this.$libs.getAssignKeyData(this.form,e),this.queryLoading=!1},async syncTagSelect(){for(let e of this.tagList){let t=this.form.tag.findIndex((t=>t===e.id));e.select=t>=0}},async getTagAll(){let e=await this.$api.tag.queryAll({type:"1"});this.tagList=e.data,this.syncTagSelect()},async selcetTag(e,t){if(e.select=!e.select,this.$set(this.tagList,t,e),e.select)this.form.tag.push(e.id);else{let t=this.form.tag.findIndex((t=>t===e.id));this.form.tag.splice(t,1)}},async showInput(){this.inputVisible=!0,this.$nextTick((e=>{this.$refs.saveTagInput.$refs.input.focus()}))},async addTag(){let e=this.inputValue;if(e){this.queryLoading=!0;let a={tag_name:e,type:1};try{let t=await this.$api.tag.create(a);this.tagList.unshift(t.data),this.$message.success(e+"添加成功")}catch(t){}finally{this.queryLoading=!1}}this.inputVisible=!1,this.inputValue="",this.queryLoading=!1},async deleteTag(e){this.$tool.confirmWarning("确定要删除 "+e.tag_name+"标签吗？").then((async()=>{this.queryLoading=!0;try{await this.$api.tag.delete({id:e.id});let t=this.tagList.findIndex((t=>t.id===e.id));this.tagList.splice(t,1),this.$message.success(e.tag_name+"删除成功")}catch(t){}finally{this.queryLoading=!1}})).catch((e=>{}))},async upload(e){e.size/1024/1024>2?this.$message.warning("文件不能超过2M"):(this.form.file=e,this.form.att_name=e.name)},async createImage(){let e;if(this.$refs.form.validate((t=>{e=t})),!e)return;this.saveLoading=!0;let t=Object.assign({},this.form),a="";try{const e=new Blob([t.file],{type:t.file.type});(new FormData).append("file",e,t.file.name);let i=await ot.imagePutSignedUrl({mime:t.file.type}),s=i.data.url;await ot.putObject(s,e,{headers:{"Content-Type":t.file.type}}),a=i.data.path}catch(i){return void this.$message.error("文件上传失败")}finally{this.saveLoading=!1}try{t.file=a;let e=this.$libs.formatFormData(t),i=await this.$api.picture.create(e);this.$emit("success",this.type,i.data),this.visible=!1,this.$message.success("新增成功")}catch(i){}finally{this.saveLoading=!1}},async updateImage(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.data.id;try{await this.$api.picture.update(e);this.$emit("success",this.type,e),this.visible=!1,this.$message.success("更新成功")}catch(t){}finally{this.saveLoading=!1}}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("k-drawer",{attrs:{visible:t.visible,title:t.title,size:"45%","destroy-on-close":""},on:{"update:visible":function(e){t.visible=e},fullscreen:function(t){e.span=t?12:20},closed:function(e){t.resetForm(),t.showAllTag=!1}},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.visible=!1}}},[t._v("取消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",loading:t.saveLoading},on:{click:function(e){"edit"===t.type?t.updateImage():t.createImage()}}},[t._v("保存")])]},proxy:!0}])},[i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.queryLoading,expression:"queryLoading"}],attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.span}},[i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"80px",size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"标签"}},[i("div",{staticStyle:{display:"flex","flex-flow":"row wrap","align-items":"center"}},[i("el-select",{attrs:{multiple:"",clearable:"",filterable:""},on:{change:t.syncTagSelect},model:{value:t.form.tag,callback:function(e){t.$set(t.form,"tag",e)},expression:"form.tag"}},t._l(t.tagList,(function(e,a){return i("el-option",{key:a,attrs:{label:e.tag_name,value:e.id}},[i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},[i("span",[t._v(t._s(e.tag_name))]),i("span",{staticClass:"el-icon-circle-close",staticStyle:{color:"#8492a6","font-size":"13px","vertical-align":"middle"},on:{click:function(a){return a.stopPropagation(),t.deleteTag(e)}}})])])})),1),t.inputVisible?i("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",staticStyle:{width:"90px"},attrs:{size:"small"},on:{blur:t.addTag},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addTag.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):i("el-button",{staticClass:"button-new-tag",attrs:{size:"mini"},on:{click:t.showInput}},[t._v("+ New Tag")]),i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.showAllTag=!t.showAllTag}}},[t._v(t._s(t.showAllTag?"关闭全部":"展开全部"))])],1),i("transition",{attrs:{name:"fade"}},[t.showAllTag?i("div",{staticClass:"all-tag",staticStyle:{display:"flex","flex-flow":"row wrap","align-items":"center",gap:"10px","margin-top":"10px"}},t._l(t.tagList,(function(e,a){return i("el-tag",{key:a,attrs:{closable:"",effect:e.select?"dark":"plain"},on:{close:function(a){return t.deleteTag(e)},click:function(i){return t.selcetTag(e,a)}}},[t._v(" "+t._s(e.tag_name)+" ")])})),1):t._e()])],1),i("el-form-item",{attrs:{label:"类别"}},[i("el-select",{model:{value:t.form.business_type,callback:function(e){t.$set(t.form,"business_type",e)},expression:"form.business_type"}},t._l(t.$dict.pictureType,(function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),"add"===t.type?i("el-form-item",{attrs:{label:"上传图片",prop:"file"}},[i("k-upload-image",{ref:"upload",attrs:{accept:"image/jpeg,image/png","is-cropper":!1,upload:t.upload},on:{delete:function(){e.form.file=null}},scopedSlots:t._u([{key:"tip",fn:function(){return[i("div",[t._v("只能上传jpg,png,gif文件，且不超过2M")])]},proxy:!0}],null,!1,1849799124)})],1):t._e(),i("el-form-item",{attrs:{label:"图片名称"}},[i("el-input",{model:{value:t.form.att_name,callback:function(e){t.$set(t.form,"att_name",e)},expression:"form.att_name"}})],1)],1)],1)],1)],1)}),[],!1,(function(e){for(let t in nt)this[t]=nt[t]}),"1044a531",null,null).exports;const dt={name:"Attachment",components:{AddEditPicture:ct},mixins:[Ne],props:{visible:{type:Boolean}},computed:{show:{get(){return this.visible},set(e){this.$emit("update:visible",e)}}},data:()=>({showAllTag:!1,data:[],query:{type:null,tag:[]},tagList:[],pagination:{layout:"prev, pager, next, total,sizes, jumper",limit:10,currentPage:1,pageSizes:[10,20,30,40,50,100]}}),mounted(){this.getTagAll(),this.getPictureList()},methods:{handleAction(e,t=null){"add"===e&&this.data.unshift(t)},async getPictureList(){this.queryLoading=!0,this.loading=!0;let e={page:this.pagination.currentPage?this.pagination.currentPage:1,limit:this.pagination.limit?this.pagination.limit:10},t=Object.assign(e,this.$libs.filterNullObject(this.query));try{let e=await this.$api.picture.batchQuery(t);this.data=e.data.data,this.total=e.data.total}catch(a){}finally{this.queryLoading=!1,this.loading=!1}},async getTagAll(){let e=await this.$api.tag.queryAll({type:1});this.tagList=e.data},async selcetTag(e,t){if(e.select=!e.select,this.$set(this.tagList,t,e),e.select)this.query.tag.push(e.id);else{let t=this.query.tag.findIndex((t=>t===e.id));this.query.tag.splice(t,1)}},async syncTagSelect(){for(let e of this.tagList){let t=this.query.tag.findIndex((t=>t===e.id));e.select=t>=0}},async resetQuery(){this.query=JSON.parse(JSON.stringify(this.defaultQuery)),this.syncTagSelect()}}},pt={};var ut=T(dt,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",e._g(e._b({attrs:{visible:e.show,title:"选择封面","append-to-body":""},on:{"update:visible":function(t){e.show=t}}},"el-dialog",e.$attrs,!1),e.$listeners),[a("el-row",[a("el-col",{staticStyle:{"margin-bottom":"20px"},attrs:{span:24}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"10px"}},[a("span",[e._v("选择标签")]),a("el-select",{attrs:{size:"mini",multiple:"",clearable:"",filterable:"","collapse-tags":""},on:{change:e.syncTagSelect},model:{value:e.query.tag,callback:function(t){e.$set(e.query,"tag",t)},expression:"query.tag"}},e._l(e.tagList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.tag_name,value:e.id}})})),1),a("el-button",{attrs:{size:"mini",plain:""},on:{click:function(t){e.showAllTag=!e.showAllTag}}},[e._v(e._s(e.showAllTag?"关闭全部":"展开全部"))])],1),a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center"}},[a("el-form",{attrs:{inline:""}},[a("el-form-item",{attrs:{label:"选择类别",size:"small"}},[a("el-select",{staticStyle:{width:"100px"},model:{value:e.query.type,callback:function(t){e.$set(e.query,"type",t)},expression:"query.type"}},e._l(e.$dict.pictureType,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{icon:"el-icon-search",size:"small",type:"primary",loading:e.queryLoading},on:{click:function(t){return e.getPictureList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{icon:"el-icon-refresh",size:"small",plain:"",type:"",loading:e.queryLoading},on:{click:function(t){e.resetQuery(),e.getPictureList()}}},[e._v("重置")]),a("el-button",{attrs:{icon:"el-icon-plus",size:"small",type:"primary"},on:{click:function(t){e.drawer.visible=!0}}},[e._v("新增图片")])],1)]),a("transition",{attrs:{name:"fade"}},[e.showAllTag?a("div",{staticClass:"all-tag",staticStyle:{display:"flex","flex-flow":"row wrap","align-items":"center",gap:"10px","margin-top":"10px"}},e._l(e.tagList,(function(t,i){return a("el-tag",{key:i,attrs:{effect:t.select?"dark":"plain"},on:{click:function(a){return e.selcetTag(t,i)}}},[e._v(e._s(t.tag_name))])})),1):e._e()])],1),a("el-col",{attrs:{span:24}},[a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},e._l(e.data,(function(t,i){return a("el-col",{key:i,staticClass:"item-image",attrs:{xs:8,sm:6,md:4,lg:3,xl:4},nativeOn:{click:function(a){e.$emit("select",Object.assign({},t)),e.show=!1}}},[a("el-image",{staticStyle:{width:"100%",height:"100%","margin-bottom":"5px"},attrs:{src:e.$config.staticUrl()+t.path,lazy:"",fit:"contain"}},[a("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[e._v(" 加载中"),a("span",{staticClass:"dot"},[e._v("...")])])]),a("span",[e._v(e._s(t.image_name))])],1)})),1)],1),a("el-col",{attrs:{span:24}},[a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"flex-end","margin-top":"20px"}},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"current-page":e.pagination.currentPage,"page-size":e.pagination.limit,"page-sizes":e.pagination.pageSizes},on:{"update:currentPage":function(t){return e.$set(e.pagination,"currentPage",t)},"update:current-page":function(t){return e.$set(e.pagination,"currentPage",t)},"update:pageSize":function(t){return e.$set(e.pagination,"limit",t)},"update:page-size":function(t){return e.$set(e.pagination,"limit",t)},"update:pageSizes":function(t){return e.$set(e.pagination,"pageSizes",t)},"update:page-sizes":function(t){return e.$set(e.pagination,"pageSizes",t)},"size-change":function(t){return e.getPictureList()},"current-change":function(t){return e.getPictureList()}}})],1)])],1),a("add-edit-picture",{attrs:{type:"add"},on:{success:e.handleAction},model:{value:e.drawer.visible,callback:function(t){e.$set(e.drawer,"visible",t)},expression:"drawer.visible"}})],1)}),[],!1,(function(e){for(let t in pt)this[t]=pt[t]}),"81786600",null,null).exports;const mt={};var ht=T({name:"TreeSelect",data:()=>({data:[]})},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-popover",[a("el-tree"),a("el-select",{attrs:{slot:"reference",disabled:""},slot:"reference",model:{value:e.data,callback:function(t){e.data=t},expression:"data"}})],1)}),[],!1,(function(e){for(let t in mt)this[t]=mt[t]}),"6b7003d8",null,null).exports;var _t=new class extends et{batchDelete(e){return Ze.post(`${this.path}/batchDelete`,e)}}("song");const ft={name:"Song",components:{TreeSelect:ht,Attachment:ut},mixins:[Ne,rt],props:{isComponent:{type:Boolean,default:!1},buyId:{type:Number}},data(){return{headers:[{label:"选择",type:"selection"},{label:"id",prop:"id",width:50},{label:"歌曲",prop:"song_name",tooltip:!0},{label:"封面",prop:"song_cover",width:50},{label:"音乐",prop:"file",width:50},{label:"演唱",prop:"singer"},{label:"作词",prop:"lyricist"},{label:"作曲",prop:"composer"},{label:"创建时间",prop:"created_at",type:"date"},{label:"价格",prop:"price"},{label:"是否已售",prop:"is_buy"},{label:"是否上架",prop:"status"},{label:"操作",prop:"action",hidden:this.isComponent}],data:[],query:{is_buy:null,start_time:null,end_time:null,song_name:null,start_price:null,end_price:null},form:{song_name:"",song_cover:"",singer:"",lyricist:"",composer:"",lyrics:"",price:null,status:1,desc:"",category:[],file:null},rules:{category:[{required:!0,message:"请选择歌曲分类",trigger:"blur"}],file:[{required:!0,message:"请选择歌曲文件",trigger:"blur"}],song_cover:[{required:!0,message:"请选择歌曲封面",trigger:"blur"}],price:[{required:!0,message:"请设置歌曲价格",trigger:"blur"}]},preview:{visible:!1},attachment:{visible:!1},categoryList:[],fileList:[],multipleSelection:[]}},mounted(){this.isComponent,this.getSongList()},methods:{handleAction(e,t=null){this.drawer.type=e,"create"===e?this.drawer.title="新增歌曲":"update"===e&&(this.selectItem=t,this.getSongInfo(),this.drawer.title="更新歌曲"),this.getCategoryList(),this.drawer.visible=!0},async getCategoryList(){this.queryLoading=!0;try{let e=await this.$api.category.queryAll({type:1});this.categoryList=this.$libs.formatTreeData(JSON.parse(JSON.stringify(e.data)),0,"title","cate_name")}catch(e){}finally{this.queryLoading=!1}},async getSongInfo(){this.queryLoading=!0;let e=(await this.$api.song.query(this.selectItem.id)).data;this.$libs.getAssignKeyData(this.form,e),this.$refs.upload.cropPreview=e.song_cover?this.$config.staticUrl()+e.song_cover:"",this.queryLoading=!1},async getSongList(e={page:1,limit:10}){this.loading=!0;try{if(0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3),this.query.end_price>this.query.start_price){let e=this.query.start_price;this.query.start_price=this.query.end_price,this.query.end_price=e}let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.song.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},async createSong(){let e;if(this.form.category=this.$refs.tree.getCheckedKeys(),this.$refs.form.validate((t=>{e=t})),!e)return;this.saveLoading=!0;let t=Object.assign({},this.form),a="";try{const e=new Blob([t.file],{type:t.file.type});(new FormData).append("file",e,t.file.name);let i=await ot.songPutSignedUrl(),s=i.data.url;await ot.putObject(s,e,{headers:{"Content-Type":t.file.type}}),a=i.data.path}catch(i){return void this.$message.error("文件上传失败")}finally{this.saveLoading=!1}try{t.file=a;let e=this.$libs.formatFormData(t),i=(await this.$api.song.create(e)).data;i.status=Number(i.status),t.is_buy=0,this.data.unshift(Object.assign(t,i)),this.drawer.visible=!1,this.$message.success("新增成功")}catch(i){}finally{this.saveLoading=!1}},async updateSong(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id,e.category=this.$refs.tree.getCheckedKeys();try{await this.$api.song.update(e);let t=this.data.findIndex((t=>t.id===e.id));this.$set(this.data,t,this.$libs.getAssignKeyData(this.selectItem,e)),this.drawer.visible=!1,this.$message.success("更新成功")}catch(t){}finally{this.saveLoading=!1}},async deleteSong(e){let t=e.$index;e=e.row,this.$tool.confirmWarning("确定要删除"+e.song_name+"吗？").then((()=>{this.$api.song.delete({id:e.id}).then((e=>{this.data.splice(t,1),this.$message.success("删除成功")}))})).catch((e=>{}))},async uploadCover(){this.attachment.visible=!0},async selcetImage(e){this.form.song_cover=e.path,this.$refs.upload.cropPreview=this.$config.staticUrl()+e.path},async switchStatus(e,t,a){let i={id:a.id};i[e]=t,this.$api.song.update(i).then((e=>{this.$message.success("更新成功")})).catch((e=>{a.status=0===t?1:0}))},async uploadFile(e){e.raw.size/1024/1024>5?this.$message.warning("文件不能超过5M"):(this.form.song_name=e.raw.name,this.form.file=e.raw)},async removeFile(e){this.form.song_name="",this.form.file={}},async batchDelete(){this.multipleSelection.length<=0?this.$message.warning("请先选择歌曲"):this.$tool.confirmWarning("确定要删除选中的歌曲吗？").then((async()=>{this.deleteLoading=!0;try{let e=this.multipleSelection.map((e=>e.id));await _t.batchDelete({ids:e});this.data=this.data.filter((t=>-1===e.indexOf(t.id))),this.$message.success("批量删除成功")}catch(e){}finally{this.deleteLoading=!1}})).catch((()=>{}))}}},gt={};var bt=T(ft,(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-search-card",{scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.getSongList()}}},[t._v("查询")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(e){t.resetQuery(),t.dateTime=[],t.getSongList()}}},[t._v("重置")])]},proxy:!0}])},[i("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"是否已售"}},[i("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:t.query.is_buy,callback:function(e){t.$set(t.query,"is_buy",e)},expression:"query.is_buy"}},[i("el-option",{attrs:{label:"未售",value:0}}),i("el-option",{attrs:{label:"已售",value:1}})],1)],1),i("el-form-item",{attrs:{label:"选择时间"}},[i("el-date-picker",{attrs:{type:"datetimerange","picker-options":t.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:t.dateTime,callback:function(e){t.dateTime=e},expression:"dateTime"}})],1),i("el-form-item",{attrs:{label:"歌曲名称"}},[i("el-input",{attrs:{maxlength:"32"},model:{value:t.query.song_name,callback:function(e){t.$set(t.query,"song_name",e)},expression:"query.song_name"}})],1),i("el-form-item",{attrs:{label:"价格区间"}},[i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap",gap:"10px"}},[i("el-input",{staticStyle:{width:"100px"},attrs:{type:"number"},model:{value:t.query.start_price,callback:function(e){t.$set(t.query,"start_price",t._n("string"==typeof e?e.trim():e))},expression:"query.start_price"}}),t._v(" — "),i("el-input",{staticStyle:{width:"100px"},attrs:{type:"number"},model:{value:t.query.end_price,callback:function(e){t.$set(t.query,"end_price",t._n("string"==typeof e?e.trim():e))},expression:"query.end_price"}})],1)])],1)],1),i("k-table",{attrs:{headers:t.headers,data:t.data,"is-pagination":"",total:t.total,"zoom-height":96,loading:t.loading,toolbar:"",reload:t.getSongList},on:{changePage:t.getSongList,"selection-change":function(t){e.multipleSelection=t}},scopedSlots:t._u([{key:"header",fn:function(){return[i("el-row",{attrs:{type:"flex"}},[i("el-col",[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleAction("create")}}},[t._v("新增歌曲")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"danger",size:"small",plain:"",disabled:t.deleteLoading,loading:t.deleteLoading},on:{click:t.batchDelete}},[t._v("批量删除")])],1)],1)]},proxy:!0},{key:"item.select",fn:function(e){var a=e.scope;return[i("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"primary"},on:{click:function(e){t.$emit("select",Object.assign({},a.row))}}},[t._v("选择")])]}},{key:"item.song_cover",fn:function(e){var a=e.scope;return[a.row.song_cover?i("el-image",{staticClass:"table-logo",attrs:{src:t.$config.staticUrl()+a.row.song_cover,fit:"contain",previewSrcList:[t.$config.staticUrl()+a.row.song_cover]}}):t._e()]}},{key:"item.file",fn:function(e){var a=e.scope;return[i("span",{staticClass:"material-icons",on:{click:function(e){t.selectItem=a.row,t.preview.visible=!0}}},[t._v("play_circle_outline")])]}},{key:"item.price",fn:function(e){var a=e.scope;return[i("el-tag",{attrs:{type:"warning",size:"mini"}},[t._v(t._s(a.row.price))])]}},{key:"item.is_buy",fn:function(e){var a=e.scope;return[0===a.row.is_buy?i("el-tag",{attrs:{type:"success",size:"mini"}},[t._v("未售")]):t._e(),1===a.row.is_buy?i("el-tag",{attrs:{type:"danger",size:"mini"}},[t._v("已售")]):t._e()]}},{key:"item.status",fn:function(e){var a=e.scope;return[i("el-switch",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{"active-value":1,"inactive-value":0},on:{change:function(e){return t.switchStatus("status",e,a.row)}},model:{value:a.row.status,callback:function(e){t.$set(a.row,"status",e)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(e){var a=e.scope;return[i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleAction("update",a.row)}}},[t._v("编辑")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.deleteSong(a)}}},[t._v("删除")])]}}])})],1),i("k-preview",{attrs:{show:t.preview.visible,title:t.selectItem.song_name,type:"audio",src:t.selectItem.file},on:{"update:show":function(e){return t.$set(t.preview,"visible",e)}}}),i("Attachment",{attrs:{visible:t.attachment.visible},on:{"update:visible":function(e){return t.$set(t.attachment,"visible",e)},select:t.selcetImage}}),i("k-drawer",{attrs:{visible:t.drawer.visible,title:t.drawer.title,size:"45%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",loading:t.saveLoading},on:{click:function(e){"update"===t.drawer.type?t.updateSong():t.createSong()}}},[t._v("保存")])]},proxy:!0}])},[i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.queryLoading,expression:"queryLoading"}],attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"歌曲类别",prop:"category"}},[i("div",{staticStyle:{"max-height":"200px",overflow:"auto","line-height":"1"}},[i("el-tree",{ref:"tree",attrs:{"default-checked-keys":t.form.category,props:{label:"cate_name"},data:t.categoryList,"node-key":"id","show-checkbox":""}})],1)]),i("el-form-item",{attrs:{label:"歌曲封面",prop:"song_cover"},on:{click:function(e){e.stopPropagation()}}},[i("k-upload-image",{ref:"upload",attrs:{upload:function(){},disabled:!0},on:{delete:function(e){t.form.song_cover=""},click:t.uploadCover}})],1),"create"===t.drawer.type?i("el-form-item",{attrs:{label:"歌曲文件",prop:"file"}},[i("el-upload",{attrs:{action:"#","auto-upload":!1,"show-file-list":"","on-change":t.uploadFile,"on-remove":t.removeFile,accept:"audio/mpeg","file-list":t.fileList}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传mp3文件，且不超过5M")])],1)],1):t._e(),i("el-form-item",{attrs:{label:"歌曲名称",prop:"song_name"}},[i("el-input",{model:{value:t.form.song_name,callback:function(e){t.$set(t.form,"song_name",e)},expression:"form.song_name"}})],1),i("el-form-item",{attrs:{label:"歌曲介绍"}},[i("el-input",{model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),i("el-form-item",{attrs:{label:"演唱"}},[i("el-input",{model:{value:t.form.singer,callback:function(e){t.$set(t.form,"singer",e)},expression:"form.singer"}})],1),i("el-form-item",{attrs:{label:"作词"}},[i("el-input",{model:{value:t.form.lyricist,callback:function(e){t.$set(t.form,"lyricist",e)},expression:"form.lyricist"}})],1),i("el-form-item",{attrs:{label:"作曲"}},[i("el-input",{model:{value:t.form.composer,callback:function(e){t.$set(t.form,"composer",e)},expression:"form.composer"}})],1),i("el-form-item",{attrs:{label:"价格",prop:"price"}},[i("el-input",{attrs:{type:"number"},model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",t._n(e))},expression:"form.price"}})],1),i("el-form-item",{attrs:{label:"歌词"}},[i("el-input",{attrs:{type:"textarea",maxlength:"2048","show-word-limit":"",rows:5},model:{value:t.form.lyrics,callback:function(e){t.$set(t.form,"lyrics",e)},expression:"form.lyrics"}})],1),i("el-form-item",{attrs:{label:"是否上架"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[i("el-radio",{attrs:{label:1}},[t._v("上架")]),i("el-radio",{attrs:{label:0}},[t._v("下架")])],1)],1)],1)],1)],1)],1)],1)}),[],!1,(function(e){for(let t in gt)this[t]=gt[t]}),"b22c794e",null,null).exports;const yt={};var vt=T({name:"Picture",components:{AddEditPicture:ct},mixins:[Ne],data:()=>({headers:[{label:"序号",type:"index",align:"center"},{label:"id",prop:"id",align:"center"},{label:"类别",prop:"business_type"},{label:"图片",prop:"path"},{label:"图片名称",prop:"att_name"},{label:"操作",prop:"action"}],data:[],form:{att_name:"",type:1,tag:[],file:null},query:{business_type:null},tagList:[],inputVisible:!1,inputValue:""}),mounted(){this.getPictureList()},methods:{handleAction(e,t=null){if("add"===e)this.data.unshift(t);else if("edit"===e){let e=this.data.findIndex((e=>e.id===t.id));this.$set(this.data,e,this.$libs.getAssignKeyData(this.selectItem,t))}},async getPictureInfo(){this.queryLoading=!0;let e=(await this.$api.picture.query(this.selectItem.id)).data;this.$libs.getAssignKeyData(this.form,e),this.queryLoading=!1},async getPictureList(e={page:1,limit:10}){this.loading=!0;try{let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.picture.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},async getTagAll(){let e=await this.$api.tag.queryAll({type:"1"});this.tagList=e.data,(async()=>{for(let e of this.form.tag){let t=this.tagList.findIndex((t=>t.id===e));this.tagList[t].select=!0}})()},async selcetTag(e,t){if(e.select=!e.select,this.$set(this.tagList,t,e),e.select)this.form.tag.push(e.id);else{let t=this.form.tag.findIndex((t=>t===e.id));this.form.tag.splice(t,1)}},async showInput(){this.inputVisible=!0,this.$nextTick((e=>{this.$refs.saveTagInput.$refs.input.focus()}))},async addTag(){let e=this.inputValue;if(e){this.queryLoading=!0;let a={tag_name:e,type:1};try{let t=await this.$api.tag.create(a);this.tagList.push(t.data),this.$message.success(e+"添加成功")}catch(t){}finally{this.queryLoading=!1}}this.inputVisible=!1,this.inputValue="",this.queryLoading=!1},async deleteTag(e){this.$tool.confirmWarning("确定要删除 "+e.tag_name+"标签吗？").then((async()=>{this.queryLoading=!0;try{await this.$api.tag.delete({id:e.id});let t=this.tagList.findIndex((t=>t.id===e.id));this.tagList.splice(t,1),this.$message.success(e.tag_name+"删除成功")}catch(t){}finally{this.queryLoading=!1}})).catch((e=>{}))},async upload(e){this.form.file=e,console.log(e),this.form.att_name=e.name},async createImage(){this.saveLoading=!0;let e=this.$libs.formatFormData(this.form);try{let t=await this.$api.picture.create(e);this.data.unshift(t.data),this.drawer.visible=!1,this.$message.success("新增成功")}catch(t){}finally{this.saveLoading=!1}},async updateImage(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id;try{await this.$api.picture.update(e);let t=this.data.findIndex((t=>t.id===e.id));this.$set(this.data,t,this.$libs.getAssignKeyData(this.selectItem,e)),this.drawer.visible=!1,this.$message.success("更新成功")}catch(t){}finally{this.saveLoading=!1}},async deleteImage(e){let t=e.$index;e=e.row,this.$tool.confirmWarning("确定要删除"+e.att_name+"吗？").then((()=>{this.$api.picture.delete({id:e.id}).then((e=>{this.data.splice(t,1),this.$message.success("删除成功")}))})).catch((e=>{}))}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getPictureList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.getPictureList()}}},[e._v("重置")])]},proxy:!0}])},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"图片类别"}},[a("el-select",{staticStyle:{width:"100px"},model:{value:e.query.business_type,callback:function(t){e.$set(e.query,"business_type",t)},expression:"query.business_type"}},[a("el-option",{attrs:{label:"歌曲封面",value:1}}),a("el-option",{attrs:{label:"推广图片",value:2}})],1)],1)],1)],1),a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,"zoom-height":130,loading:e.loading,toolbar:"",reload:e.getPictureList},on:{changePage:e.getPictureList},scopedSlots:e._u([{key:"header",fn:function(){return[a("el-row",{attrs:{type:"flex"}},[a("el-col",[a("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(t){e.action="add",e.drawer.visible=!0}}},[e._v("新增图片")])],1)],1)]},proxy:!0},{key:"item.business_type",fn:function(t){var i=t.scope;return[1===Number(i.row.business_type)?a("el-tag",{attrs:{size:"mini",type:"primary"}},[e._v("歌曲封面")]):e._e(),2===Number(i.row.business_type)?a("el-tag",{attrs:{size:"mini"}},[e._v("推广图片")]):e._e(),3===Number(i.row.business_type)?a("el-tag",{attrs:{size:"mini"}},[e._v("Logo类")]):e._e()]}},{key:"item.path",fn:function(t){var i=t.scope;return[a("el-image",{staticClass:"table-logo",attrs:{src:e.$config.staticUrl()+i.row.path,fit:"contain",previewSrcList:[e.$config.staticUrl()+i.row.path]}})]}},{key:"item.action",fn:function(t){var i=t.scope;return[a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){e.action="edit",e.selectItem=i.row,e.drawer.visible=!0}}},[e._v("编辑")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.deleteImage(i)}}},[e._v("删除")])]}}])})],1),a("add-edit-picture",{attrs:{type:e.action,data:e.selectItem},on:{success:e.handleAction},model:{value:e.drawer.visible,callback:function(t){e.$set(e.drawer,"visible",t)},expression:"drawer.visible"}})],1)}),[],!1,(function(e){for(let t in yt)this[t]=yt[t]}),"53b55dc8",null,null).exports;const wt={};var kt=T({name:"SongCategory",mixins:[Ne],data:()=>({headers:[{label:"分类名称",prop:"cate_name"},{label:"分类级别",prop:"level"},{label:"置顶显示",prop:"is_top"},{label:"描述",prop:"desc",tooltip:!0},{label:"操作",prop:"action"}],treeData:[],categoryList:[],form:{type:1,cate_name:"",desc:"",parent_id:"",level:1,sort:0,is_top:0,status:1}}),mounted(){this.getCategoryList()},methods:{handleAction(e="create",t=null){this.drawer.type=e,this.selectItem=t||{},"create"===e?(this.form.parent_id=0,this.form.level=1,this.drawer.title="新增分类"):"createChild"===e?(this.form.parent_id=t.id,this.form.level=t.level+1,this.drawer.title="新增子分类"):"update"===e&&(this.$libs.getAssignKeyData(this.form,t),this.drawer.title="编辑分类"),this.drawer.visible=!0},async getCategoryList(){this.loading=!0;let e=(await this.$api.category.queryAll({type:1})).data;this.categoryList=e,this.setTreeData(e),this.loading=!1},async createCategory(){this.saveLoading=!0;try{let e=await this.$api.category.create(this.form);this.categoryList.push(e.data),await this.setTreeData(),this.drawer.visible=!1,this.$message.success("创建成功")}catch(e){}finally{this.saveLoading=!1}},async updateCategory(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id;try{await this.$api.category.update(e);(async()=>{let t=this.categoryList,a=t.findIndex((t=>t.id===e.id));t[a]=e,await this.setTreeData(t)})(),this.drawer.visible=!1,this.$message.success("更新成功")}catch(t){}finally{this.saveLoading=!1}},async deleteCategory(e){this.$tool.confirmWarning("确定要删除"+e.cate_name+"吗？将会连同子分类一起删除！").then((()=>{this.$api.category.delete({id:e.id}).then((t=>{(async()=>{let t=this.categoryList,a=t.findIndex((t=>t.id===e.id));t.splice(a,1),await this.setTreeData(t)})(),this.drawer.visible=!1,this.$message.success("删除成功")}))})).catch((e=>{}))},async setTreeData(e=this.categoryList){this.treeData=this.$libs.formatTreeData(JSON.parse(JSON.stringify(e)))},async switchStatus(e,t,a){let i={id:a.id};i[e]=t,this.$api.category.update(i).then((e=>{this.$message.success("更新成功")})).catch((e=>{a.status=0===t?1:0}))}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-table",{attrs:{headers:t.headers,data:t.treeData,"row-key":"id","highlight-current-row":!0,"is-pagination":"",total:t.total},scopedSlots:t._u([{key:"header",fn:function(){return[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleAction("create")}}},[t._v("新增分类")])]},proxy:!0},{key:"item.is_top",fn:function(e){var a=e.scope;return[i("el-switch",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{"active-color":"#f56c6c","active-value":1,"inactive-value":0},on:{change:function(e){return t.switchStatus("is_top",e,a.row)}},model:{value:a.row.is_top,callback:function(e){t.$set(a.row,"is_top",e)},expression:"scope.row.is_top"}})]}},{key:"item.action",fn:function(e){var a=e.scope;return[i("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(e){return t.handleAction("createChild",a.row)}}},[t._v("新增子分类")]),i("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(e){return t.handleAction("update",a.row)}}},[t._v("编辑")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"danger",size:"mini",plain:""},on:{click:function(e){return t.deleteCategory(a.row)}}},[t._v("删除")])]}}])})],1),i("k-drawer",{attrs:{visible:t.drawer.visible,title:t.drawer.title,size:"35%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取 消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary",loading:t.saveLoading},on:{click:function(e){"update"===t.drawer.type?t.updateCategory():t.createCategory()}}},[t._v("保 存")])]},proxy:!0}])},[i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"父级分类"}},[i("el-select",{attrs:{disabled:""},model:{value:t.form.parent_id,callback:function(e){t.$set(t.form,"parent_id",e)},expression:"form.parent_id"}},[i("el-option",{attrs:{label:"顶级分类",value:0}}),i("el-option",{attrs:{label:t.selectItem.cate_name,value:t.selectItem.id}})],1)],1),i("el-form-item",{attrs:{label:"分类级别"}},[i("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:t.form.level,callback:function(e){t.$set(t.form,"level",e)},expression:"form.level"}},[i("el-option",{attrs:{label:"顶级权限",value:1}})],1)],1),i("el-form-item",{attrs:{label:"排序"}},[i("el-input-number",{attrs:{min:0,max:255,label:"排序",size:"mini"},model:{value:t.form.sort,callback:function(e){t.$set(t.form,"sort",e)},expression:"form.sort"}})],1),i("el-form-item",{attrs:{label:"置顶显示"}},[i("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.form.is_top,callback:function(e){t.$set(t.form,"is_top",e)},expression:"form.is_top"}})],1),i("el-form-item",{attrs:{label:"分类名称",required:""}},[i("el-input",{model:{value:t.form.cate_name,callback:function(e){t.$set(t.form,"cate_name",e)},expression:"form.cate_name"}})],1),i("el-form-item",{attrs:{label:"描述"}},[i("el-input",{model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),i("el-form-item",{attrs:{label:"是否启用"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[i("el-radio",{attrs:{label:1}},[t._v("启用")]),i("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1)],1)],1)],1)],1)],1)}),[],!1,(function(e){for(let t in wt)this[t]=wt[t]}),"66f2bcae",null,null).exports;const xt={name:"Order",mixins:[Ne,rt],props:{isComponent:{type:Boolean,default:!1},crowdfundingId:{type:Number},userMobile:{type:String}},data(){return{preview:{visible:!1},headers:[{label:"id",prop:"id",width:50},{label:"订单类型",prop:"order_type",width:80},{label:"订单编号",prop:"order_no",tooltip:!0},{label:"订单标题",prop:"subject",tooltip:!0},{label:"订单金额",prop:"total_amount"},{label:"支付金额",prop:"pay_amount"},{label:"创建人",prop:"nickname"},{label:"创建时间",prop:"created_at",type:"date",format:"YYYY-MM-DD HH:mm:ss",tooltip:this.isComponent},{label:"订单状态",prop:"order_status"},{label:"操作",prop:"action"}],data:[],dateTime:[],query:{crowdfunding_id:this.crowdfundingId?this.crowdfundingId:null,order_type:null,order_status:null,order_no:null,start_time:null,end_time:null,subject:null,mobile:this.userMobile?this.userMobile:null},orderStatus:[{label:"创建",value:"CREATE"},{label:"等待支付",value:"WAITPAY"},{label:"完成",value:"SUCCESS"},{label:"取消",value:"CANCEL"},{label:"退款",value:"REFUND"}],orderLog:[],orderGoods:[],paymentList:[],expandLoading:!1,previewSong:{}}},mounted(){this.getOrderList()},methods:{async getOrderList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.order.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},async cancelOrder(e){this.$tool.confirmWarning("确定要取消"+e.subject+"订单吗？").then((async()=>{try{await this.$api.order.cancel({id:e.id});e.order_status="CANCEL",this.$message.success("订单取消成功")}catch(t){console.log(t)}})).catch((e=>{}))},async showOrderLog(e,t){e&&(this.selectItem=t,this.expandLoading=!0,await this.getOrderLog(t.id),1===t.order_type&&await this.getOrderGoods(t.id),await this.getOrderPayment(t.id),this.expandLoading=!1)},async getOrderLog(e){try{let t=await this.$api.orderLog.batchQuery({order_id:e});this.orderLog=t.data.data}catch(t){}},async getOrderGoods(e){try{let t=await this.$api.orderGoods.batchQuery({order_id:e});this.orderGoods=t.data.data}catch(t){}},async getOrderPayment(e){try{let t=await this.$api.payment.batchQuery({order_id:e});this.paymentList=t.data.data}catch(t){}}}},$t={};var Ct=T(xt,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getOrderList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getOrderList()}}},[e._v("重置")])]},proxy:!0}])},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"订单类型"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.query.order_type,callback:function(t){e.$set(e.query,"order_type",t)},expression:"query.order_type"}},[a("el-option",{attrs:{label:"普通订单",value:1}}),a("el-option",{attrs:{label:"代付订单",value:2}})],1)],1),a("el-form-item",{attrs:{label:"订单状态"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.query.order_status,callback:function(t){e.$set(e.query,"order_status",t)},expression:"query.order_status"}},e._l(e.orderStatus,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"订单编号"}},[a("el-input",{attrs:{maxlength:"64"},model:{value:e.query.order_no,callback:function(t){e.$set(e.query,"order_no",t)},expression:"query.order_no"}})],1),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}})],1),a("el-form-item",{attrs:{label:"订单标题"}},[a("el-input",{attrs:{maxlength:"32"},model:{value:e.query.subject,callback:function(t){e.$set(e.query,"subject",t)},expression:"query.subject"}})],1),a("el-form-item",{attrs:{label:"用户手机号"}},[a("el-input",{model:{value:e.query.mobile,callback:function(t){e.$set(e.query,"mobile",t)},expression:"query.mobile"}})],1)],1)],1),a("k-table",{attrs:{headers:e.headers,data:e.data,"show-expand":"","is-pagination":"",total:e.total,"zoom-height":e.isComponent?140:130,toolbar:"",reload:e.getOrderList,loading:e.loading},on:{changePage:e.getOrderList,"expand-change":e.showOrderLog},scopedSlots:e._u([{key:"item.order_type",fn:function(t){var i=t.scope;return[1===i.row.order_type?a("el-tag",{attrs:{size:"mini"}},[e._v("普通订单")]):e._e(),2===i.row.order_type?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("众筹订单")]):e._e()]}},{key:"item.nickname",fn:function(t){var i=t.scope;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.row.mobile,placement:"top-start"}},[a("span",[e._v(e._s(i.row.nickname?i.row.nickname:i.row.mobile))])])]}},{key:"item.order_status",fn:function(t){var i=t.scope;return["CREATE"===i.row.order_status?a("el-tag",{attrs:{size:"mini",type:""}},[e._v("创建")]):e._e(),"SUCCESS"===i.row.order_status?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("完成")]):e._e(),"WAITPAY"===i.row.order_status?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("等待支付")]):e._e(),"CANCEL"===i.row.order_status?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("取消")]):e._e(),"REFUND"===i.row.order_status?a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("退款")]):e._e()]}},{key:"item.action",fn:function(t){var i=t.scope;return[a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",plain:"",type:"warning",disabled:"CREATE"!==i.row.order_status&&"WAITPAY"!==i.row.order_status},on:{click:function(t){return e.cancelOrder(i.row)}}},[e._v("取消订单")])]}},{key:"expand-item",fn:function(t){return t.scope,[a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.expandLoading,expression:"expandLoading"}]},[a("el-divider",{attrs:{"content-position":"left"}},[e._v("订单日志")]),e._l(e.orderLog,(function(t,i){return a("k-descriptions",{key:i,attrs:{bottom:"2px",divider:e.orderLog.length!==i+1}},[a("k-descriptions-item",{attrs:{label:"时间"}},[e._v(e._s(e.$dayjs.unix(t.created_at).format("YYYY-MM-DD HH:mm:ss")))]),a("k-descriptions-item",{attrs:{label:"状态"}},["CREATE"===t.order_status?a("el-tag",{attrs:{size:"mini",type:""}},[e._v("创建")]):e._e(),"SUCCESS"===t.order_status?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("完成")]):e._e(),"WAITPAY"===t.order_status?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("等待支付")]):e._e(),"CANCEL"===t.order_status?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("取消")]):e._e(),"REFUND"===t.order_status?a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("退款")]):e._e()],1),a("k-descriptions-item",{attrs:{label:"操作"}},[e._v(e._s(t.action))]),t.admin_id?a("k-descriptions-item",{attrs:{label:"操作人"}},[e._v(e._s("管理员-"+t.username))]):e._e(),t.user_id?a("k-descriptions-item",{attrs:{label:"操作人"}},[e._v(e._s("用户-"+(t.nickname?t.nickname:t.mobile)))]):e._e(),t.user_id||t.admin_id?e._e():a("k-descriptions-item",{attrs:{label:"操作人"}},[e._v("系统")])],1)})),1===e.selectItem.order_type?[a("el-divider",{attrs:{"content-position":"left"}},[e._v("订单歌曲")]),e._l(e.orderGoods,(function(t,i){return a("k-descriptions",{key:"goods"+i,attrs:{bottom:"0"}},[a("k-descriptions-item",{attrs:{label:"歌曲名称"}},[e._v(e._s(t.song_name))]),a("k-descriptions-item",{attrs:{label:"价格"}},[a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.goods_price))])],1),a("k-descriptions-item",{attrs:{label:"音乐"}},[a("span",{staticClass:"material-icons",on:{click:function(a){e.previewSong=t,e.preview.visible=!0}}},[e._v("play_circle_outline")])])],1)}))]:e._e(),2===e.selectItem.order_type?[a("el-divider",{attrs:{"content-position":"left"}},[e._v("众筹信息")]),a("k-descriptions",{attrs:{bottom:"0"}},[a("k-descriptions-item",{attrs:{label:"众筹标题"}},[e._v(e._s(e.selectItem.crowdfunding.subject))]),a("k-descriptions-item",{attrs:{label:"众筹编号"}},[e._v(e._s(e.selectItem.crowdfunding.crowdfunding_no))]),a("k-descriptions-item",{attrs:{label:"众筹金额"}},[a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.selectItem.crowdfunding.amount))])],1),a("k-descriptions-item",{attrs:{label:"已筹金额"}},[a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(e.selectItem.crowdfunding.amount-(e.selectItem.crowdfunding.unpaid_amount-e.selectItem.crowdfunding.lock_amount)))])],1)],1)]:e._e(),a("el-divider",{attrs:{"content-position":"left"}},[e._v("支付信息")]),e._l(e.paymentList,(function(t,i){return a("k-descriptions",{key:i+"payInfo",attrs:{bottom:"0"}},[a("k-descriptions-item",{attrs:{label:"支付方式"}},e._l(e.$dict.payType,(function(i,s){return t.pay_type===i.value?a("span",{key:s+"payType"},[e._v(e._s(i.label))]):e._e()})),0),a("k-descriptions-item",{attrs:{label:"支付交易号","label-width":"85px"}},[e._v(e._s(t.trade_no))]),a("k-descriptions-item",{attrs:{label:"支付金额"}},[a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(t.pay_amount))])],1),a("k-descriptions-item",{attrs:{label:"支付状态"}},e._l(e.$dict.payStatus,(function(i,s){return t.pay_status===i?a("span",{key:s+"payStatus"},[e._v(e._s(i))]):e._e()})),0)],1)}))],2)]}}])})],1),a("k-preview",{attrs:{show:e.preview.visible,title:e.previewSong.song_name,type:"audio",src:e.previewSong.file},on:{"update:show":function(t){return e.$set(e.preview,"visible",t)}}})],1)}),[],!1,(function(e){for(let t in $t)this[t]=$t[t]}),"142c71e1",null,null).exports;const St={};var Lt=T({name:"Crowdfunding",components:{Order:Ct},mixins:[Ne,rt],data:()=>({previewVoice:{visible:!1},headers:[{label:"id",prop:"id",width:50},{label:"众筹编号",prop:"crowdfunding_no",tooltip:!0},{label:"众筹标题",prop:"subject",tooltip:!0},{label:"众筹金额",prop:"amount"},{label:"未付款金额",prop:"unpaid_amount"},{label:"锁定金额",prop:"lock_amount"},{label:"众筹每份金额",prop:"each_amount"},{label:"参与人次",prop:"orders_count"},{label:"完成人次",prop:"orders_success"},{label:"发起人",prop:"nickname"},{label:"创建时间",prop:"created_at",tooltip:!0,type:"date",format:"YYYY-MM-DD HH:mm:ss"},{label:"状态",prop:"crowdfunding_status"},{label:"操作",prop:"action"}],crowdfundingStatus:[{label:"创建",value:"CREATE"},{label:"等待支付",value:"WAITPAY"},{label:"完成",value:"SUCCESS"},{label:"取消",value:"CANCEL"},{label:"退款",value:"REFUND"}],data:[],query:{crowdfunding_status:null,crowdfunding_no:null,start_time:null,end_time:null,subject:null}}),mounted(){this.getCrowdfundingList()},methods:{async getCrowdfundingList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.crowdfunding.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},async showBuyInfo(e,t){e&&(this.selectItem=t)}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getCrowdfundingList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getCrowdfundingList()}}},[e._v("重置")])]},proxy:!0}])},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"众筹状态"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.query.crowdfunding_status,callback:function(t){e.$set(e.query,"crowdfunding_status",t)},expression:"query.crowdfunding_status"}},e._l(e.crowdfundingStatus,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"众筹编号"}},[a("el-input",{attrs:{maxlength:"64"},model:{value:e.query.crowdfunding_no,callback:function(t){e.$set(e.query,"crowdfunding_no",t)},expression:"query.crowdfunding_no"}})],1),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}})],1),a("el-form-item",{attrs:{label:"众筹标题"}},[a("el-input",{attrs:{maxlength:"32"},model:{value:e.query.subject,callback:function(t){e.$set(e.query,"subject",t)},expression:"query.subject"}})],1)],1)],1),a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"","zoom-height":94,total:e.total,loading:e.loading,toolbar:"",reload:e.getCrowdfundingList},on:{"expand-change":e.showBuyInfo,changePage:e.getCrowdfundingList},scopedSlots:e._u([{key:"item.nickname",fn:function(t){var i=t.scope;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.row.mobile,placement:"top-start"}},[a("span",[e._v(e._s(i.row.nickname?i.row.nickname:i.row.mobile))])])]}},{key:"item.crowdfunding_status",fn:function(t){var i=t.scope;return["CREATE"===i.row.crowdfunding_status?a("el-tag",{attrs:{size:"mini",type:""}},[e._v("创建")]):e._e(),"SUCCESS"===i.row.crowdfunding_status?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("完成")]):e._e(),"WAITPAY"===i.row.crowdfunding_status?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("等待支付")]):e._e(),"CANCEL"===i.row.crowdfunding_status?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("取消")]):e._e(),"REFUND"===i.row.crowdfunding_status?a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("退款")]):e._e()]}},{key:"item.action",fn:function(t){var i=t.scope;return[a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(t){e.selectItem=i.row,e.drawer.title=e.selectItem.subject,e.drawer.visible=!0}}},[e._v("查看订单")])]}}])})],1),a("k-preview",{attrs:{show:e.preview.visible,title:e.selectItem.song_name,type:"audio",src:e.selectItem.file},on:{"update:show":function(t){return e.$set(e.preview,"visible",t)}}}),a("k-preview",{attrs:{show:e.previewVoice.visible,title:e.selectItem.subject,type:"audio",src:e.selectItem.voice},on:{"update:show":function(t){return e.$set(e.previewVoice,"visible",t)}}}),a("k-drawer",{attrs:{visible:e.drawer.visible,title:e.drawer.title+"/众筹订单",size:"55%","destroy-on-close":""},on:{"update:visible":function(t){return e.$set(e.drawer,"visible",t)}}},[e.drawer.visible?a("order",{attrs:{"crowdfunding-id":e.selectItem.id,"is-component":""}}):e._e()],1)],1)}),[],!1,(function(e){for(let t in St)this[t]=St[t]}),"362942b3",null,null).exports;const Tt={name:"KEditor",components:{Attachment:ut,Editor:g},props:{upload:{type:Function},cropper:{type:Boolean}},watch:{visible(e){e?document.documentElement.style.setProperty("--tox-tinymce-index","2000"):document.documentElement.style.setProperty("--tox-tinymce-index","99999999")}},data(){return{visible:!1,openCropper:!1,data:"",picker_callback:null,tinymceInit:{selector:"#tiny",branding:!1,language_url:"https://cdn.jsdelivr.net/gh/topoge/taoge@master/tinymce/langs/zh_CN.js",language:"zh_CN",plugins:["emoticons","image","imagetools","code","link","preview"],menubar:!1,toolbar_sticky:!0,toolbar:"code |undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media template link anchor codesample | ltr rtl",quickbars_selection_toolbar:"bold italic | quicklink h2 h3 blockquote quickimage quicktable",automatic_uploads:!0,paste_data_images:!0,block_unsupported_drop:!1,imagetools_toolbar:"rotateleft rotateright | flipv fliph | imageoptions",file_picker_types:"image",file_picker_callback:(e,t,a)=>{"image"===a.filetype&&(this.visible=!0,this.picker_callback=e)},mobile:{theme:"mobile",plugins:["autosave","lists","autolink"]}}}},methods:{async selectImage(e){this.picker_callback(this.$config.staticUrl()+e.path,{title:e.att_name})}}},zt={};var qt=T(Tt,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("editor",e._g(e._b({attrs:{id:"tiny",init:e.tinymceInit}},"editor",e.$attrs,!1),e.$listeners)),a("k-cropper",{ref:"cropper",attrs:{openCropper:e.openCropper},on:{finishCrop:function(e){}}}),a("Attachment",{attrs:{visible:e.visible},on:{"update:visible":function(t){e.visible=t},select:e.selectImage}})],1)}),[],!1,(function(e){for(let t in zt)this[t]=zt[t]}),"1499d71f",null,null).exports;const At={};var It=T({name:"Promote",components:{Song:bt,Attachment:ut,KEditor:qt},mixins:[Ne],data:()=>({attachment:{visible:!1},songDrawer:{visible:!1},headers:[{label:"id",prop:"id"},{label:"类型",prop:"type"},{label:"位置",prop:"position"},{label:"标题",prop:"title"},{label:"图片",prop:"image"},{label:"是否启用",prop:"status"},{label:"操作",prop:"action"}],data:[],form:{type:1,platform:1,position:1,title:"",image:"",content:"",url:"",song_id:null,status:1},selectSong:{}}),mounted(){this.getPromoteList()},methods:{handleAction(e,t=null){this.drawer.type=e,"create"===e?this.drawer.title="新增广告":"update"===e&&(this.selectItem=t,this.drawer.title="更新广告",this.getPromoteInfo()),this.drawer.visible=!0},async getPromoteInfo(){this.queryLoading=!0;try{let e=(await this.$api.promote.query(this.selectItem.id)).data;this.$libs.getAssignKeyData(this.form,e),this.$refs.upload.cropPreview=this.$config.staticUrl()+e.image,this.selectSong={id:e.song_id,song_name:e.song_name}}catch(e){}finally{this.queryLoading=!1}},async getPromoteList(e={page:1,limit:10}){this.loading=!0;let t=Object.assign(e,this.$libs.filterNullObject(this.query));try{let e=await this.$api.promote.batchQuery(t);this.data=e.data.data,this.total=e.data.total}catch(a){}finally{this.loading=!1}},async createPromote(){this.saveLoading=!0;try{let e=Object.assign({},this.form);e.id=0;let t=await this.$api.promote.create(e);this.data.unshift(this.$libs.getAssignKeyData(e,t.data)),this.drawer.visible=!1,this.$refs.upload.cropPreview="",this.$message.success("新增成功")}catch(e){}finally{this.saveLoading=!1}},async updatePromote(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id;try{await this.$api.promote.update(e);let t=this.data.findIndex((t=>t.id===e.id));this.$set(this.data,t,this.$libs.getAssignKeyData(this.selectItem,e)),this.drawer.visible=!1,this.$message.success("更新成功")}catch(t){}finally{this.saveLoading=!1}},async deletePromote(e){let t=e.$index;e=e.row,this.$tool.confirmWarning("确定要删除"+e.title+"吗？").then((()=>{this.$api.promote.delete({id:e.id}).then((e=>{this.data.splice(t,1),this.$message.success("删除成功")}))})).catch((e=>{}))},async switchStatus(e,t,a){let i={id:a.id};i[e]=t,this.$api.promote.update(i).then((e=>{this.$message.success("更新成功")})).catch((e=>{a.status=0===t?1:0}))},async selcetImage(e){this.form.image=e.path,this.$refs.upload.cropPreview=this.$config.staticUrl()+e.path},resetForm(){this.form=Object.assign({},this.defaultForm)},async upload(e,t,a){console.log(e.blobUri())}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-table",{attrs:{headers:t.headers,data:t.data,"is-pagination":"",total:t.total,loading:t.loading,toolbar:"",reload:t.getPromoteList},on:{changePage:t.getPromoteList},scopedSlots:t._u([{key:"header",fn:function(){return[i("el-row",{attrs:{type:"flex"}},[i("el-col",[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleAction("create")}}},[t._v("新增推广")])],1)],1)]},proxy:!0},{key:"item.type",fn:function(e){var a=e.scope;return[1===a.row.type?i("el-tag",{attrs:{size:"mini",type:"primary"}},[t._v("内容")]):t._e(),2===a.row.type?i("el-tag",{attrs:{size:"mini",type:"warning"}},[t._v("链接")]):t._e(),3===a.row.type?i("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("歌曲")]):t._e()]}},{key:"item.position",fn:function(e){return[1===e.scope.row.position?i("span",[t._v("Banner")]):t._e()]}},{key:"item.image",fn:function(e){var a=e.scope;return[a.row.image?i("el-image",{staticClass:"table-logo",attrs:{src:t.$config.staticUrl()+a.row.image,lazy:"",fit:"contain",previewSrcList:[t.$config.staticUrl()+a.row.image]}}):t._e()]}},{key:"item.status",fn:function(e){var a=e.scope;return[i("el-switch",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{"active-value":1,"inactive-value":0},on:{change:function(e){return t.switchStatus("status",e,a.row)}},model:{value:a.row.status,callback:function(e){t.$set(a.row,"status",e)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(e){var a=e.scope;return[i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleAction("update",a.row)}}},[t._v("编辑")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.deletePromote(a)}}},[t._v("删除")])]}}])})],1),i("k-drawer",{attrs:{visible:t.drawer.visible,title:t.drawer.title,size:"45%"},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",disabled:t.saveLoading,loading:t.saveLoading},on:{click:function(e){"update"===t.drawer.type?t.updatePromote():t.createPromote()}}},[t._v("保存")])]},proxy:!0}])},[i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.queryLoading,expression:"queryLoading"}],attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"推广位置"}},[i("el-select",{model:{value:t.form.position,callback:function(e){t.$set(t.form,"position",e)},expression:"form.position"}},[i("el-option",{attrs:{value:1,label:"Banner"}})],1)],1),i("el-form-item",{attrs:{label:"广告类型"}},[i("el-select",{model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[i("el-option",{attrs:{value:1,label:"内容"}}),i("el-option",{attrs:{value:2,label:"链接"}}),i("el-option",{attrs:{value:3,label:"歌曲"}})],1)],1),i("el-form-item",{attrs:{label:"标题"}},[i("el-input",{model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),i("el-form-item",{attrs:{label:"图片"}},[i("k-upload-image",{ref:"upload",attrs:{accept:"image/jpeg,image/png","is-cropper":!1,disabled:!0,upload:function(){}},on:{delete:function(e){t.form.image=""},click:function(e){t.attachment.visible=!0}}})],1),3===t.form.type?i("el-form-item",{attrs:{label:"选择歌曲"}},[!1===this.songDrawer.visible?i("el-select",{on:{"visible-change":function(t){t&&(e.songDrawer.visible=!0)}},model:{value:t.form.song_id,callback:function(e){t.$set(t.form,"song_id",e)},expression:"form.song_id"}},[i("el-option",{attrs:{label:t.selectSong.song_name,value:t.selectSong.id}})],1):t._e()],1):t._e(),i("el-form-item",{attrs:{label:"链接"}},[i("el-input",{model:{value:t.form.url,callback:function(e){t.$set(t.form,"url",e)},expression:"form.url"}})],1),i("el-form-item",{attrs:{label:"内容"}},[t.drawer.visible?i("k-editor",{attrs:{upload:t.upload,cropper:""},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}}):t._e()],1),i("el-form-item",{attrs:{label:"是否启用"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[i("el-radio",{attrs:{label:1}},[t._v("启用")]),i("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1)],1)],1)],1)],1),i("attachment",{attrs:{visible:t.attachment.visible},on:{"update:visible":function(e){return t.$set(t.attachment,"visible",e)},select:t.selcetImage}}),i("k-drawer",{attrs:{visible:t.songDrawer.visible,size:"55%"},on:{"update:visible":function(e){return t.$set(t.songDrawer,"visible",e)}}},[i("song",{attrs:{"is-component":""},on:{select:function(t){e.selectSong=t,e.form.song_id=t.id,e.songDrawer.visible=!1}}})],1)],1)}),[],!1,(function(e){for(let t in At)this[t]=At[t]}),"fae7dff8",null,null).exports;const Dt={};var Pt=T({name:"UserLog",mixins:[Ne,rt],data:()=>({headers:[{label:"手机号",prop:"mobile"},{label:"用户昵称",prop:"nickname"},{label:"url",prop:"url",tooltip:!0},{label:"操作",prop:"action",tooltip:!0},{label:"内容",prop:"content",tooltip:!0},{label:"ip",prop:"ip"},{label:"ua",prop:"ua",tooltip:!0},{label:"时间",prop:"created_at",type:"date",format:"YYYY-MM-DD HH:mm:ss"}],data:[]}),mounted(){this.getUserLogList()},methods:{async getUserLogList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.userLog.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getUserLogList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getUserLogList()}}},[e._v("重置")])]},proxy:!0}])},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"用户昵称"}},[a("el-input",{model:{value:e.query.nickname,callback:function(t){e.$set(e.query,"nickname",t)},expression:"query.nickname"}})],1),a("el-form-item",{attrs:{label:"手机号"}},[a("el-input",{model:{value:e.query.mobile,callback:function(t){e.$set(e.query,"mobile",e._n("string"==typeof t?t.trim():t))},expression:"query.mobile"}})],1),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}})],1)],1)],1),a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,loading:e.loading,toolbar:"",reload:e.getUserLogList},on:{changePage:e.getUserLogList}})],1)],1)}),[],!1,(function(e){for(let t in Dt)this[t]=Dt[t]}),"f40478d8",null,null).exports;const Nt={};var Ot=T({name:"ExceptionLog",mixins:[Ne,rt],data:()=>({headers:[{label:"异常类型",prop:"type"},{label:"错误代码",prop:"code"},{label:"错误信息",prop:"message",overflow:!0},{label:"请求路径",prop:"path",overflow:!0},{label:"详细记录",prop:"desc",overflow:!0},{label:"请求内容",prop:"request",overflow:!0},{label:"时间",prop:"created_at",type:"date",format:"YYYY-MM-DD HH:mm:ss"}],data:[]}),mounted(){this.getExceptionLogList()},methods:{async getExceptionLogList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.exceptionLog.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},showPayload(e){this.selectItem=e;try{let t=JSON.parse(e.desc),a=JSON.parse(e.request);this.selectItem.content=JSON.stringify(t,null,2),this.selectItem.request=JSON.stringify(a,null,2)}catch(t){this.selectItem.content=e.desc.split("-"),this.selectItem.request=e.desc.split("-")}this.drawer.visible=!0}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-search-card",{scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.getExceptionLogList()}}},[t._v("查询")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(e){t.resetQuery(),t.dateTime=[],t.getExceptionLogList()}}},[t._v("重置")])]},proxy:!0}])},[i("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"选择时间"}},[i("el-date-picker",{attrs:{type:"datetimerange","picker-options":t.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:t.dateTime,callback:function(e){t.dateTime=e},expression:"dateTime"}})],1)],1)],1),i("k-table",{attrs:{headers:t.headers,data:t.data,"is-pagination":"",total:t.total,loading:t.loading,toolbar:"",reload:t.getExceptionLogList},on:{changePage:t.getExceptionLogList,"row-click":t.showPayload},scopedSlots:t._u([{key:"item.type",fn:function(e){var a=e.scope;return["system"===a.row.type?i("el-tag",{attrs:{type:"danger",size:"mini"}},[t._v(t._s(a.row.type))]):i("el-tag",{attrs:{type:"primary",size:"mini"}},[t._v(t._s(a.row.type))])]}}])})],1),i("k-drawer",{attrs:{visible:t.drawer.visible,size:"45%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20}}},[i("pre",[t._v(t._s(t.selectItem.content))]),i("pre",[t._v(t._s(t.selectItem.request))])])],1)}),[],!1,(function(e){for(let t in Nt)this[t]=Nt[t]}),"80009a84",null,null).exports;const jt={};var Et=T({name:"AdminLog",mixins:[Ne,rt],data:()=>({headers:[{label:"用户名",prop:"username"},{label:"url",prop:"url",tooltip:!0},{label:"操作",prop:"action",tooltip:!0},{label:"内容",prop:"content",tooltip:!0},{label:"ip",prop:"ip"},{label:"ua",prop:"ua",tooltip:!0},{label:"时间",prop:"created_at",type:"date",format:"YYYY-MM-DD HH:mm:ss"}],data:[]}),mounted(){this.getAdminLogList()},methods:{async getAdminLogList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.adminLog.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getAdminLogList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getAdminLogList()}}},[e._v("重置")])]},proxy:!0}])},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{model:{value:e.query.username,callback:function(t){e.$set(e.query,"username",t)},expression:"query.username"}})],1),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}})],1)],1)],1),a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,toolbar:"",reload:e.getAdminLogList,loading:e.loading},on:{changePage:e.getAdminLogList}})],1)],1)}),[],!1,(function(e){for(let t in jt)this[t]=jt[t]}),"88cc1e04",null,null).exports;const Ft={name:"WalletTrade",mixins:[Ne,rt],props:{isComponent:{type:Boolean,default:!1},walletNo:{type:String}},data(){return{headers:[{label:"id",prop:"id",width:50},{label:"钱包编号",prop:"wallet_no",tooltip:!0},{label:"交易号",prop:"trade_no",tooltip:!0},{label:"交易类型",prop:"trade_type"},{label:"外部订单号",prop:"out_trade_no",tooltip:!0},{label:"支付类型",prop:"pay_type"},{label:"交易标题",prop:"subject",tooltip:!0},{label:"交易状态",prop:"trade_status"},{label:"支付金额",prop:"pay_amount"},{label:"用户",prop:"user"},{label:"支付时间",prop:"pay_time",tooltip:this.isComponent,type:"date",formart:"YYYY-MM-DD HH:mm:ss"},{label:"创建时间",prop:"created_at",tooltip:this.isComponent,type:"date",formart:"YYYY-MM-DD HH:mm:ss"}],data:[],query:{trade_type:null,trade_status:null,trade_no:null,subject:null,wallet_no:this.walletNo?this.walletNo:null,start_time:null,end_time:null,mobile:null}}},mounted(){this.getWalletTradeList()},methods:{async getWalletTradeList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.walletTrade.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}}}},Ut={};var Bt=T(Ft,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getWalletTradeList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getWalletTradeList()}}},[e._v("重置")])]},proxy:!0}])},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"交易类型"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.query.trade_type,callback:function(t){e.$set(e.query,"trade_type",t)},expression:"query.trade_type"}},e._l(e.$dict.tradeType,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"交易状态"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.query.trade_status,callback:function(t){e.$set(e.query,"trade_status",t)},expression:"query.trade_status"}},e._l(e.$dict.tradeStatus,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"交易编号"}},[a("el-input",{attrs:{maxlength:"64"},model:{value:e.query.trade_no,callback:function(t){e.$set(e.query,"trade_no",t)},expression:"query.trade_no"}})],1),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}})],1),a("el-form-item",{attrs:{label:"交易标题"}},[a("el-input",{attrs:{maxlength:"32"},model:{value:e.query.subject,callback:function(t){e.$set(e.query,"subject",t)},expression:"query.subject"}})],1),a("el-form-item",{attrs:{label:"钱包编号"}},[a("el-input",{model:{value:e.query.wallet_no,callback:function(t){e.$set(e.query,"wallet_no",t)},expression:"query.wallet_no"}})],1),a("el-form-item",{attrs:{label:"用户手机号"}},[a("el-input",{model:{value:e.query.mobile,callback:function(t){e.$set(e.query,"mobile",t)},expression:"query.mobile"}})],1)],1)],1),a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,loading:e.loading,"zoom-height":e.isComponent?140:130,toolbar:"",reload:e.getWalletTradeList},on:{changePage:e.getWalletTradeList},scopedSlots:e._u([{key:"item.trade_type",fn:function(t){var i=t.scope;return[1===i.row.trade_type?a("el-tag",{attrs:{size:"mini"}},[e._v("充值")]):e._e(),2===i.row.trade_type?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("提现")]):e._e(),3===i.row.trade_type?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("付款")]):e._e(),4===i.row.trade_type?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("收款")]):e._e(),5===i.row.trade_type?a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("众筹充值")]):e._e()]}},{key:"item.pay_type",fn:function(t){return[1===t.scope.row.pay_type?a("span",[e._v("微信")]):e._e()]}},{key:"item.trade_status",fn:function(t){var i=t.scope;return["CREATE"===i.row.trade_status?a("el-tag",{attrs:{size:"mini"}},[e._v("创建")]):e._e(),"WAITPAY"===i.row.trade_status?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("等待支付")]):e._e(),"SUCCESS"===i.row.trade_status?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("完成")]):e._e(),"CANCEL"===i.row.trade_status?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("取消")]):e._e(),"REFUND"===i.row.trade_status?a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("退款")]):e._e()]}},{key:"item.user",fn:function(t){var i=t.scope;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.row.mobile,placement:"top-start"}},[a("span",[e._v(e._s(i.row.nickname?i.row.nickname:i.row.mobile))])])]}}])})],1)],1)}),[],!1,(function(e){for(let t in Ut)this[t]=Ut[t]}),"afc45568",null,null).exports;const Rt={name:"WalletDetail",mixins:[Ne,rt],props:{isComponent:{type:Boolean,default:!1},walletNo:{type:String}},data(){return{headers:[{label:"id",prop:"id",width:80},{label:"钱包编号",prop:"wallet_no",tooltip:!0},{label:"交易号",prop:"trade_no",tooltip:!0},{label:"交易类型",prop:"trade_type"},{label:"变动金额",prop:"change_amount"},{label:"变动前金额",prop:"before_balance"},{label:"变动后金额",prop:"after_balance"},{label:"交易说明",prop:"desc",tooltip:!0},{label:"用户",prop:"user"},{label:"操作人",prop:"admin_username"},{label:"创建时间",prop:"created_at",tooltip:this.isComponent,type:"date",formar:"YYYY-MM-DD HH:mm:ss"}],data:[],query:{trade_type:null,trade_no:null,wallet_no:this.walletNo?this.walletNo:null,start_time:null,end_time:null,mobile:null}}},mounted(){this.getWalletDetailList()},methods:{async getWalletDetailList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.walletDetail.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}}}},Wt={};var Vt=T(Rt,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getWalletDetailList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getWalletDetailList()}}},[e._v("重置")])]},proxy:!0}])},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"钱包编号"}},[a("el-input",{model:{value:e.query.wallet_no,callback:function(t){e.$set(e.query,"wallet_no",t)},expression:"query.wallet_no"}})],1),a("el-form-item",{attrs:{label:"交易类型"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择",size:"small"},model:{value:e.query.trade_type,callback:function(t){e.$set(e.query,"trade_type",t)},expression:"query.trade_type"}},e._l(e.$dict.tradeType,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"交易编号"}},[a("el-input",{attrs:{maxlength:"64"},model:{value:e.query.trade_no,callback:function(t){e.$set(e.query,"trade_no",t)},expression:"query.trade_no"}})],1),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}})],1),a("el-form-item",{attrs:{label:"用户手机号"}},[a("el-input",{model:{value:e.query.mobile,callback:function(t){e.$set(e.query,"mobile",t)},expression:"query.mobile"}})],1)],1)],1),a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,loading:e.loading,"zoom-height":e.isComponent?140:130,toolbar:"",reload:e.getWalletDetailList},on:{changePage:e.getWalletDetailList},scopedSlots:e._u([{key:"item.trade_type",fn:function(t){var i=t.scope;return[1===i.row.trade_type?a("el-tag",{attrs:{size:"mini"}},[e._v("充值")]):e._e(),2===i.row.trade_type?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("提现")]):e._e(),3===i.row.trade_type?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("付款")]):e._e(),4===i.row.trade_type?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("收款")]):e._e(),5===i.row.trade_type?a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("众筹充值")]):e._e(),6===i.row.trade_type?a("el-tag",{attrs:{size:"mini",type:"danger",color:"rgba(255,0,0,1)",effect:"dark"}},[e._v("手动增加余额")]):e._e(),7===i.row.trade_type?a("el-tag",{attrs:{size:"mini",type:"danger",color:"rgba(255,0,0,1)",effect:"dark"}},[e._v("手动减少余额")]):e._e()]}},{key:"item.trade_status",fn:function(t){var i=t.scope;return["CREATE"===i.row.trade_status?a("el-tag",{attrs:{size:"mini"}},[e._v("创建")]):e._e(),"WAITPAY"===i.row.trade_status?a("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("等待支付")]):e._e(),"SUCCESS"===i.row.trade_status?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("完成")]):e._e(),"CANCEL"===i.row.trade_status?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("取消")]):e._e(),"REFUND"===i.row.trade_status?a("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("退款")]):e._e()]}},{key:"item.user",fn:function(t){var i=t.scope;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.row.mobile,placement:"top-start"}},[a("span",[e._v(e._s(i.row.nickname?i.row.nickname:i.row.mobile))])])]}}])})],1)],1)}),[],!1,(function(e){for(let t in Wt)this[t]=Wt[t]}),"1bbcae3f",null,null).exports;var Ht=new class extends et{increment(e){return Ze.post(`${this.path}/increment`,e)}decrement(e){return Ze.post(`${this.path}/decrement`,e)}}("wallet");const Yt={name:"Wallet",components:{WalletDetail:Vt,WalletTrade:Bt},mixins:[Ne],props:{isComponent:{type:Boolean,default:!1},mobile:{type:String}},data(){return{dialogAmount:{type:!0,title:"",visible:!1},drawerTrade:{visible:!1,title:""},drawerDetail:{visible:!1,title:""},headers:[{label:"id",prop:"id",width:80},{label:"钱包编号",prop:"wallet_no",tooltip:!0},{label:"钱包余额",prop:"balance"},{label:"总收入",prop:"income_amount"},{label:"总支付出",prop:"outcome_amount"},{label:"冻结金额",prop:"frozen_amount"},{label:"所属用户",prop:"user"},{label:"操作",prop:"action",width:this.isComponent?155:"auto"}],data:[],query:{mobile:this.mobile?this.mobile:null},form:{amount:0},walletData:{}}},mounted(){this.getWalletList(),this.getAnalysisWallet()},methods:{async getWalletList(e={page:1,limit:10}){this.loading=!0;try{let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.wallet.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},async getAnalysisWallet(){try{let e=await this.$api.analysis.wallet();this.walletData=e.data}catch(e){}},async addBalance(){if(this.form.amount<=0)this.$message.warning("金额必须大于0");else{this.saveLoading=!0;try{await Ht.increment({user_id:this.selectItem.user_id,amount:this.form.amount});this.selectItem.balance=Number(this.selectItem.balance)+this.form.amount,this.dialogAmount.visible=!1,this.$message.success("增加成功")}catch(e){}finally{this.saveLoading=!1}}},async subtractBalance(){if(this.form.amount<=0)this.$message.warning("金额必须大于0");else{this.saveLoading=!0;try{await Ht.decrement({user_id:this.selectItem.user_id,amount:this.form.amount});this.selectItem.balance=this.selectItem.balance-this.form.amount,this.dialogAmount.visible=!1,this.$message.success("减少成功")}catch(e){}finally{this.saveLoading=!1}}}}},Mt={};var Qt=T(Yt,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getWalletList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getWalletList()}}},[e._v("重置")])]},proxy:!0}])},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"用户手机号"}},[a("el-input",{model:{value:e.query.mobile,callback:function(t){e.$set(e.query,"mobile",t)},expression:"query.mobile"}})],1)],1)],1),a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,loading:e.loading,"zoom-height":130,toolbar:"",reload:e.getWalletList},on:{changePage:e.getWalletList},scopedSlots:e._u([{key:"header",fn:function(){return[a("span",[e._v("总余额："+e._s(e.walletData.sum_balance))]),a("el-divider",{attrs:{direction:"vertical"}}),a("span",[e._v("总冻结金额："+e._s(e.walletData.frozen_amount))])]},proxy:!0},{key:"item.balance",fn:function(t){var i=t.scope;return[a("div",{staticClass:"balance-action"},[a("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){e.selectItem=i.row,e.dialogAmount.type=!1,e.dialogAmount.visible=!0}}}),a("span",[e._v(e._s(i.row.balance))]),a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){e.selectItem=i.row,e.dialogAmount.type=!0,e.dialogAmount.visible=!0}}})])]}},{key:"item.user",fn:function(t){var i=t.scope;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.row.mobile,placement:"top-start"}},[a("span",[e._v(e._s(i.row.nickname?i.row.nickname:i.row.mobile))])])]}},{key:"item.action",fn:function(t){var i=t.scope;return[a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){e.selectItem=i.row,e.drawerDetail.title=e.selectItem.wallet_no,e.drawerDetail.visible=!0}}},[e._v("钱包明细")]),a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"success",plain:""},on:{click:function(t){e.selectItem=i.row,e.drawerTrade.title=e.selectItem.wallet_no,e.drawerTrade.visible=!0}}},[e._v("交易流水")])]}}])})],1),a("k-drawer",{attrs:{visible:e.drawerTrade.visible,title:e.drawer.title+"/交易流水",size:"55%","destroy-on-close":""},on:{"update:visible":function(t){return e.$set(e.drawerTrade,"visible",t)}}},[e.drawerTrade.visible?a("wallet-trade",{attrs:{"is-component":"","wallet-no":e.selectItem.wallet_no}}):e._e()],1),a("k-drawer",{attrs:{visible:e.drawerDetail.visible,title:e.drawer.title+"/余额明细",size:"55%","destroy-on-close":""},on:{"update:visible":function(t){return e.$set(e.drawerDetail,"visible",t)}}},[e.drawerDetail.visible?a("wallet-detail",{attrs:{"is-component":"","wallet-no":e.selectItem.wallet_no}}):e._e()],1),a("el-dialog",{attrs:{title:e.dialogAmount.title,visible:e.dialogAmount.visible,width:"20%","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){return e.$set(e.dialogAmount,"visible",t)},closed:function(t){e.form.amount=0}}},[a("el-form",{attrs:{"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:e.dialogAmount.type?"增加余额":"减少余额"}},[a("el-input-number",{attrs:{min:0,precision:2,max:e.dialogAmount.type?1e4:e.selectItem.balance-e.selectItem.frozen_amount,step:100,label:"描述文字"},model:{value:e.form.amount,callback:function(t){e.$set(e.form,"amount",t)},expression:"form.amount"}})],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogAmount.visible=!1}}},[e._v("取 消")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"primary",disabled:e.saveLoading,loading:e.saveLoading},on:{click:function(t){e.dialogAmount.type?e.addBalance():e.subtractBalance()}}},[e._v("保 存")])],1)],1)],1)}),[],!1,(function(e){for(let t in Mt)this[t]=Mt[t]}),"2c741788",null,null).exports;const Jt={};var Kt=T({name:"User",components:{Wallet:Qt,Order:Ct},mixins:[Ne,rt],data:()=>({drawerWallet:{visible:!1,title:""},headers:[{label:"id",prop:"id"},{label:"手机号",prop:"mobile"},{label:"昵称",prop:"nickname"},{label:"性别",prop:"gender"},{label:"头像",prop:"avatar"},{label:"所在地",prop:"city"},{label:"消费金额",prop:"sum_amount"},{label:"钱包余额",prop:"wallet"},{label:"创建时间",prop:"created_at",type:"date"},{label:"用户订单",prop:"order"},{label:"操作",prop:"action",width:160}],data:[],query:{nickname:null,mobile:null,start_time:null,end_time:null}}),mounted(){this.getUserList()},methods:{async getUserList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let t=Object.assign(e,this.$libs.filterNullObject(this.query)),a=await this.$api.user.batchQuery(t);this.data=a.data.data,this.total=a.data.total}catch(t){}finally{this.loading=!1}},async disabledUser(e){this.$tool.confirmWarning(`确定要禁用${e.nickname?e.nickname:e.mobile}这个用户吗？`).then((()=>{this.switchStatus("status",0,e)})).catch((()=>{}))},async logout(e){this.$tool.confirmWarning(`确定要强制退出此${e.nickname?e.nickname:e.mobile}这个用户吗？可能会中断当前用户操作!`).then((()=>{this.$api.user.logout({id:e.id}).then((e=>{this.$message.success("操作成功")}))})).catch((()=>{}))},async switchStatus(e,t,a){let i={id:a.id};i[e]=t,this.$api.user.disable(i).then((i=>{a[e]=t,this.$message.success("更新成功")})).catch((e=>{a.status=0===t?1:0}))}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.getUserList()}}},[e._v("查询")]),a("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(t){e.resetQuery(),e.dateTime=[],e.getUserList()}}},[e._v("重置")])]},proxy:!0}])},[a("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"手机号"}},[a("el-input",{model:{value:e.query.mobile,callback:function(t){e.$set(e.query,"mobile",t)},expression:"query.mobile"}})],1),a("el-form-item",{attrs:{label:"昵称"}},[a("el-input",{attrs:{maxlength:"32"},model:{value:e.query.nickname,callback:function(t){e.$set(e.query,"nickname",t)},expression:"query.nickname"}})],1),a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(t){e.dateTime=t},expression:"dateTime"}})],1)],1)],1),a("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,loading:e.loading,toolbar:"",reload:e.getUserList},on:{changePage:e.getUserList},scopedSlots:e._u([{key:"item.gender",fn:function(t){var i=t.scope;return[0===i.row.gender?a("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("未知")]):e._e(),1===i.row.gender?a("el-tag",{attrs:{size:"mini",type:"primary"}},[e._v("男")]):e._e(),2===i.row.gender?a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("女")]):e._e()]}},{key:"item.avatar",fn:function(t){var i=t.scope;return[i.row.avatar?a("el-image",{staticClass:"table-logo",attrs:{src:e.$config.staticUrl()+i.row.avatar,lazy:"",fit:"contain",previewSrcList:[e.$config.staticUrl()+i.row.avatar]}}):e._e()]}},{key:"item.city",fn:function(t){var i=t.scope;return[a("span",[e._v(e._s(i.row.province+"/"+i.row.city))])]}},{key:"item.sum_amount",fn:function(t){var i=t.scope;return[a("el-tag",{attrs:{type:i.row.sum_amount?"success":"info",size:"mini"}},[e._v(e._s(i.row.sum_amount?i.row.sum_amount:0))])]}},{key:"item.wallet",fn:function(t){var i=t.scope;return[i.row.wallet?a("el-popover",{attrs:{placement:"bottom",width:"100",trigger:"hover"}},[a("div",[a("div",{staticClass:"list-item"},[a("span",[e._v("钱包余额")]),a("span",[e._v(e._s(i.row.wallet.balance))])]),a("div",{staticClass:"list-item"},[a("span",[e._v("总收入金额")]),a("span",[e._v(e._s(i.row.wallet.income_amount))])]),a("div",{staticClass:"list-item"},[a("span",[e._v("总支出金额")]),a("span",[e._v(e._s(i.row.wallet.outcome_amount))])]),a("div",{staticClass:"list-item"},[a("span",[e._v("冻结金额")]),a("span",[e._v(e._s(i.row.wallet.frozen_amount))])])]),a("span",{staticStyle:{cursor:"pointer"},attrs:{slot:"reference"},on:{click:function(t){e.selectItem=i.row,e.drawerWallet.visible=!0}},slot:"reference"},[e._v(e._s(i.row.wallet.balance))])]):e._e()]}},{key:"item.order",fn:function(t){var i=t.scope;return[a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){e.selectItem=i.row,e.drawer.visible=!0}}},[e._v("查看订单")])]}},{key:"item.action",fn:function(t){var i=t.scope;return[a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"warning",plain:""},on:{click:function(t){return e.logout(i.row)}}},[e._v(" 强制登出 ")]),1===i.row.status?a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.disabledUser(i.row)}}},[e._v(" 禁用用户 ")]):e._e(),0===i.row.status?a("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"success",plain:""},on:{click:function(t){return e.switchStatus("status",1,i.row)}}},[e._v("启用用户")]):e._e()]}}])})],1),a("k-drawer",{attrs:{visible:e.drawer.visible,title:(e.selectItem.nickname?e.selectItem.nickname:e.selectItem.mobile)+"/用户订单",size:"55%","destroy-on-close":""},on:{"update:visible":function(t){return e.$set(e.drawer,"visible",t)}}},[a("order",{attrs:{"is-component":"","user-mobile":e.selectItem.mobile}})],1),a("k-drawer",{attrs:{visible:e.drawerWallet.visible,title:(e.selectItem.nickname?e.selectItem.nickname:e.selectItem.mobile)+"/用户钱包",size:"55%","destroy-on-close":""},on:{"update:visible":function(t){return e.$set(e.drawerWallet,"visible",t)}}},[a("wallet",{attrs:{"is-component":"",mobile:e.selectItem.mobile}})],1)],1)}),[],!1,(function(e){for(let t in Jt)this[t]=Jt[t]}),"0c15fdf6",null,null).exports,Gt={props:{header:{type:String},data:{type:Array,default:()=>[]},xField:{type:String},yField:{type:String},seriesField:{type:String},meta:{type:Object},height:{type:Number},color:{type:String},options:{type:Object}},data:()=>({chartId:"",chart:{},defaultTheme:{styleSheet:{brandColor:"#5B8FF9",paletteQualitative10:["#5B8FF9","#61DDAA","#65789B","#F6BD16","#7262fd","#78D3F8","#9661BC","#F6903D","#008685","#F08BB4"],paletteQualitative20:["#5B8FF9","#CDDDFD","#61DDAA","#CDF3E4","#65789B","#CED4DE","#F6BD16","#FCEBB9","#7262fd","#D3CEFD","#78D3F8","#D3EEF9","#9661BC","#DECFEA","#F6903D","#FFE0C7","#008685","#BBDEDE","#F08BB4","#FFE0ED"]}},start:!0}),created(){this.chartId="chart"+Math.round(1e3*Math.random())+(new Date).getTime()},mounted(){this.init()},watch:{data(e,t){this.start?(0!==e.length&&(this.start=!1),this.chart.changeData(e),this.chart.render()):this.chart.changeData(e)}}};const Xt={};var Zt=T({name:"LineChart",mixins:[Gt],methods:{init(){const e=new b(this.chartId,{data:this.data,height:this.height,xField:this.xField,yField:this.yField,seriesField:this.seriesField,meta:this.meta,label:{},point:{size:5,shape:"diamond",style:{fill:"white",stroke:"#5B8FF9",lineWidth:2}},tooltip:{showMarkers:!1},state:{active:{style:{shadowBlur:4,stroke:"#000",fill:"red"}}},interactions:[{type:"marker-active"}]});e.update({theme:{styleSheet:{brandColor:this.color?this.color:"#5B8FF9"}}}),e.render(),this.chart=e}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("k-card",{staticClass:"chart",attrs:{shadow:"hover",header:e.header},scopedSlots:e._u([{key:"header",fn:function(){return[e._t("header")]},proxy:!0}],null,!0)},[a("div",{ref:"chart",attrs:{id:e.chartId}}),e.data&&e.data.length?e._e():a("div",{staticClass:"tip"},[a("p",[e._v("暂无数据")])])])}),[],!1,(function(e){for(let t in Xt)this[t]=Xt[t]}),"1c49b397",null,null).exports;const ea={};var ta=T({name:"ColumnChart",mixins:[Gt],methods:{init(){const e=new y(this.chartId,{data:this.data,height:this.height,xField:this.xField,yField:this.yField,label:{position:"middle",style:{fill:"#FFFFFF",opacity:.6}},xAxis:{label:{autoHide:!0,autoRotate:!1}},meta:this.meta});e.update({theme:{styleSheet:{brandColor:this.color?this.color:"#5B8FF9"}}}),e.render(),this.chart=e}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("k-card",{staticClass:"chart",attrs:{shadow:"hover",header:e.header},scopedSlots:e._u([{key:"header",fn:function(){return[e._t("header")]},proxy:!0}],null,!0)},[a("div",{ref:"chart",attrs:{id:e.chartId}}),e.data&&e.data.length?e._e():a("div",{staticClass:"tip"},[a("p",[e._v("暂无数据")])])])}),[],!1,(function(e){for(let t in ea)this[t]=ea[t]}),"7de5437a",null,null).exports;const aa={};var ia=T({name:"AreaChart",mixins:[Gt],methods:{init(){const e=new v(this.chartId,{data:this.data,height:this.height,smooth:!0,xField:this.xField,yField:this.yField,xAxis:{range:[0,1]},yAxis:this.options&&this.options.hasOwnProperty("yAxis")?this.options.yAxis:{},point:{size:5,shape:"diamond",style:{fill:"white",stroke:"#5B8FF9",lineWidth:2}},label:{},meta:this.meta});e.update({theme:{styleSheet:{brandColor:this.color?this.color:"#5B8FF9"}}}),e.render(),this.chart=e}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("k-card",{staticClass:"chart",attrs:{shadow:"hover",header:e.header},scopedSlots:e._u([{key:"header",fn:function(){return[e._t("header")]},proxy:!0}],null,!0)},[a("div",{ref:"chart",attrs:{id:e.chartId}}),e.data.length?e._e():a("div",{staticClass:"tip"},[a("p",[e._v("暂无数据")])])])}),[],!1,(function(e){for(let t in aa)this[t]=aa[t]}),"5e767863",null,null).exports;const sa={};var ra=T({name:"Analysis",components:{TreeSelect:ht,AreaChart:ia,ColumnChart:ta,LineChart:Zt,AStatistic:w},data:()=>({loading:!1,data:{day_sales:[],month_sales:[],day_order_num:[],month_order_num:[]},walletData:{},walletTop:[],walletTopHeaders:[{label:"排名",prop:"top"},{label:"头像",prop:"avatar"},{label:"昵称",prop:"nickname"},{label:"余额",prop:"balance"}],route:"",isTask:!0}),mounted(){this.route=this.$route.path,this.init()},watch:{"$route.path"(e,t){this.isTask=e===this.route}},methods:{test:e=>Number(parseFloat(e)),async init(){this.loading=!0,await this.getAnalysis(),await this.getAnalysisWallet(),await this.getAnalysisWalletTop(),this.loading=!1,this.task()},async getAnalysis(){try{let e=(await this.$api.analysis.index()).data;for(let t of e.day_sales)t.sales=Number(t.sales);for(let t of e.month_sales)t.sales=Number(t.sales);this.data=e}catch(e){}},async getAnalysisWallet(){try{let e=await this.$api.analysis.wallet();this.walletData=e.data}catch(e){}},async getAnalysisWalletTop(){try{let e=await this.$api.analysis.walletTop();this.walletTop=e.data}catch(e){}},async task(){setTimeout((async()=>{this.isTask&&(await this.getAnalysis(),await this.getAnalysisWallet(),await this.getAnalysisWalletTop()),this.task()}),5e3)}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-col",{attrs:{span:24}},[a("el-row",{attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{attrs:{title:"总销售额",prefix:"￥",property:2,value:e.data.sales}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{attrs:{title:"订单数量",value:e.data.order_num}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{staticStyle:{"margin-right":"50px"},attrs:{title:"用户数量",value:e.data.user_num}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{attrs:{title:"钱包总余额",prefix:"￥",property:2,value:e.walletData.sum_balance}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{attrs:{title:"歌曲数量",value:e.data.song_num}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("a-statistic",{attrs:{title:"已售歌曲",value:e.data.song_sales_num}})],1)],1)],1),a("el-row",{attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:8}},[a("area-chart",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.data.day_sales,"x-field":"date","y-field":"sales",meta:{sales:{alias:"金额"}},options:{yAxis:function(e){return e.toFixed(2)}},height:220,header:"最近30天销售额"}})],1),a("el-col",{attrs:{span:8}},[a("area-chart",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.data.month_sales,"x-field":"date","y-field":"sales",meta:{sales:{alias:"金额"}},options:{yAxis:function(e){return e.toFixed(2)}},height:220,header:"最近12月销售额"}})],1),a("el-col",{attrs:{span:8}},[a("k-card",{attrs:{"body-style":{height:"220px",overflowY:"auto"}},scopedSlots:e._u([{key:"header-icon",fn:function(){return[a("span",{staticClass:"material-icons-outlined"},[e._v("align_vertical_top")]),e._v(" 钱包余额排行 ")]},proxy:!0}])},[a("k-table",{attrs:{"show-header":!1,"is-card":!1,headers:e.walletTopHeaders,data:e.walletTop},scopedSlots:e._u([{key:"item.top",fn:function(t){var i=t.scope;return[i.$index+1===1?a("el-tag",{staticStyle:{"border-radius":"50%"},attrs:{size:"small",type:"danger",effect:"dark"}},[e._v(e._s(i.$index+1))]):e._e(),i.$index+1===2?a("el-tag",{staticStyle:{"border-radius":"50%"},attrs:{size:"small",type:"warning",effect:"dark"}},[e._v(e._s(i.$index+1))]):e._e(),i.$index+1===3?a("el-tag",{staticStyle:{"border-radius":"50%"},attrs:{size:"small",type:"",effect:"dark"}},[e._v(e._s(i.$index+1))]):e._e(),i.$index+1===4?a("el-tag",{staticStyle:{"border-radius":"50%"},attrs:{size:"small",type:"success",effect:"dark"}},[e._v(e._s(i.$index+1))]):e._e(),i.$index+1===5?a("el-tag",{staticStyle:{"border-radius":"50%"},attrs:{size:"small",type:"info",effect:"dark"}},[e._v(e._s(i.$index+1))]):e._e(),i.$index+1>5?a("el-tag",{staticStyle:{"border-radius":"50%"},attrs:{size:"small",type:"info",effect:"dark"}},[e._v(e._s(i.$index+1))]):e._e()]}},{key:"item.avatar",fn:function(t){var i=t.scope;return[i.row.avatar?a("el-image",{staticClass:"table-logo",attrs:{src:e.$config.staticUrl()+i.row.avatar,fit:"contain",previewSrcList:[e.$config.staticUrl()+i.row.avatar]}}):e._e()]}},{key:"item.nickname",fn:function(t){var i=t.scope;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.row.mobile,placement:"top-start"}},[a("span",[e._v(e._s(i.row.nickname?i.row.nickname:i.row.mobile))])])]}}])})],1)],1)],1),a("el-row",{attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:12}},[a("column-chart",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.data.day_order_num,"x-field":"date","y-field":"num",meta:{num:{alias:"数量"}},color:"#1AAF8B",height:220,header:"最近30天订单量"}})],1),a("el-col",{attrs:{span:12}},[a("column-chart",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.data.month_order_num,"x-field":"date","y-field":"num",meta:{num:{alias:"数量"}},color:"#F6BD16",height:220,header:"最近12月订单量"}})],1)],1)],1)],1)}),[],!1,(function(e){for(let t in sa)this[t]=sa[t]}),"71bb67e0",null,null).exports;const la={};var oa=T({name:"ImageSelect",components:{Attachment:ut},model:{prop:"value",event:"input"},props:{value:{required:!0,type:String}},data:()=>({attachment:{visible:!1}}),mounted(){this.$refs.upload.cropPreview=this.$config.staticUrl()+this.value},methods:{async uploadCover(){this.attachment.visible=!0},async selcetImage(e){this.$emit("input",e.path),this.$refs.upload.cropPreview=this.$config.staticUrl()+e.path}}},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("k-upload-image",{ref:"upload",attrs:{upload:function(){},disabled:!0},on:{delete:function(t){return e.$emit("input","")},click:e.uploadCover}}),a("Attachment",{attrs:{visible:e.attachment.visible},on:{"update:visible":function(t){return e.$set(e.attachment,"visible",t)},select:e.selcetImage}})],1)}),[],!1,(function(e){for(let t in la)this[t]=la[t]}),"ee3b3cfc",null,null).exports;const na={};var ca=T({name:"SystemSetting",components:{ImageSelect:oa},mixins:[Ne],data:()=>({drawer:{visible:!1,title:"添加配置",type:"create",span:20},queryLoading:!1,saveLoading:!1,loading:!1,visible:!1,settingType:[],activeName:null,setting:[],form:{type:1,name:"",prop:"",value:"",element:"",option:[],rule:null,desc:""},selectItem:{},valueForm:{}}),mounted(){this.getSettingList()},methods:{handleAction(e,t=null){this.drawer.type=e,"create"===e?this.drawer.title="新增配置":"update"===e&&(this.selectItem=t,this.getSettingInfo(t),this.drawer.title="更新配置"),this.drawer.visible=!0},async getSettingInfo(e){this.queryLoading=!0;try{let t=(await this.$api.setting.query(e.id)).data;t.option.length>0&&(t.option=JSON.parse(t.option)),this.$libs.getAssignKeyData(this.form,t)}catch(t){console.log(t)}finally{this.queryLoading=!1}},async getSettingList(){this.loading=!0;try{let e=(await this.$api.setting.queryAll()).data;for(let a of e)a.option.length>0&&(a.option=JSON.parse(a.option));this.setting=e.map((e=>({id:e.id,type:e.type,name:e.name,element:e.element,desc:e.desc,option:e.option,value:e.value})));let t=this.setting.map((e=>e.type));this.settingType=Array.from(new Set(t)),this.activeName=this.settingType[0].toString()}catch(e){console.log(e)}finally{this.loading=!1}},async createSetting(){this.saveLoading=!0;let e=Object.assign({},this.form);try{let t=await this.$api.setting.create(e);this.settingType.push(e.type),this.settingType=Array.from(new Set(this.settingType)),this.setting.push(t.data),this.drawer.visible=!1,this.$message.success("新增成功")}catch(t){}finally{this.saveLoading=!1}},async updateSetting(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectItem.id;try{await this.$api.setting.update(e);let t=this.setting.findIndex((t=>t.id===e.id));this.$set(this.setting,t,this.$libs.getAssignKeyData(this.selectItem,e)),this.drawer.visible=!1,this.$message.success("更新成功")}catch(t){console.log(t)}finally{this.saveLoading=!1}},async updateSettingValue(){this.$tool.confirmWarning("你确定要更新系统设置吗？可能会影响到系统运行!").then((async()=>{this.saveLoading=!0;try{let e=Object.assign({},this.setting);await this.$api.setting.updateValue(e);this.$message.success("更新成功")}catch(e){}finally{this.saveLoading=!1}})).catch((e=>{}))}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("k-card",[i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between"}},[i("el-tabs",{attrs:{"tab-position":"left"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.settingType,(function(e,a){return i("el-tab-pane",{key:a,attrs:{lazy:"",label:t.$dict.settingType[t.$dict.settingType.findIndex((function(t){return t.value===e}))].label,name:e.toString()}},[i("el-form",{ref:"valueForm",refInFor:!0,attrs:{model:t.valueForm,size:"small","label-width":"120px"}},t._l(t.setting,(function(a,s){return a.type===e?i("el-form-item",{key:s,staticStyle:{"padding-right":"100px"},attrs:{label:a.name}},["input"===a.element?i("el-input",{model:{value:a.value,callback:function(e){t.$set(a,"value",e)},expression:"settingItem.value"}}):t._e(),a.desc?i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center","font-size":"12px",gap:"5px"}},[i("span",{staticClass:"material-icons-outlined",staticStyle:{"font-size":"12px"}},[t._v("info")]),t._v(" "+t._s(a.desc)+" ")]):t._e(),"select"===a.element?i("el-select",{model:{value:a.value,callback:function(e){t.$set(a,"value",e)},expression:"settingItem.value"}},t._l(a.option,(function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1):t._e(),"imageSelect"===a.element?i("image-select",{model:{value:a.value,callback:function(e){t.$set(a,"value",e)},expression:"settingItem.value"}}):t._e(),i("el-button",{staticStyle:{position:"absolute",top:"1px",right:"-30px"},attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleAction("update",a)}}},[t._v("编辑")])],1):t._e()})),1)],1)})),1),i("div",[i("el-button",{attrs:{slot:"reference",size:"mini",type:"primary",plain:""},on:{click:function(e){t.drawer.type="create",t.drawer.visible=!0}},slot:"reference"},[t._v("新增配置")])],1)],1),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],staticStyle:{display:"inline-block","margin-left":"120px","margin-top":"20px"},attrs:{size:"mini",type:"primary",loading:t.saveLoading,disabled:t.saveLoading},on:{click:t.updateSettingValue}},[t._v("保存")]),i("k-drawer",{attrs:{visible:t.drawer.visible,title:""+t.drawer.title,size:"35%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20},closed:t.resetForm},scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.drawer.visible=!1}}},[t._v("取消")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",disabled:t.saveLoading,loading:t.saveLoading},on:{click:function(e){"update"===t.drawer.type?t.updateSetting():t.createSetting()}}},[t._v("保存")])]},proxy:!0}])},[i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.queryLoading,expression:"queryLoading"}],attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:t.drawer.span}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"类别"}},[i("el-select",{model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},t._l(t.$dict.settingType,(function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",{attrs:{label:"设置名称"}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"设置属性"}},[i("el-input",{model:{value:t.form.prop,callback:function(e){t.$set(t.form,"prop",e)},expression:"form.prop"}})],1),i("el-form-item",{attrs:{label:"组件元素"}},[i("el-select",{model:{value:t.form.element,callback:function(e){t.$set(t.form,"element",e)},expression:"form.element"}},t._l(t.$dict.element,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),"select"===t.form.element?i("el-form-item",{attrs:{label:"配置项"}},[t._l(t.form.option,(function(e,a){return i("el-form-item",{key:a},[i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap",gap:"10px","justify-content":"flex-start"}},[i("span",{staticStyle:{display:"inline-block",width:"60px"}},[t._v("配置名")]),i("el-input",{staticStyle:{width:"200px"},model:{value:e.label,callback:function(a){t.$set(e,"label",a)},expression:"item.label"}}),i("span",{staticStyle:{display:"inline-block",width:"20px"}},[t._v("值")]),i("el-input",{staticStyle:{width:"200px"},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"item.value"}}),i("el-button",{on:{click:function(a){a.preventDefault(),t.form.option.splice(t.form.option.indexOf(e),1)}}},[t._v("删除")])],1)])})),i("el-button",{on:{click:function(e){return t.form.option.push({})}}},[t._v("新增配置")])],2):t._e(),i("el-form-item",{attrs:{label:"update"===t.drawer.type?"配置值":"初始值"}},["select"===t.form.element?i("el-select",{model:{value:t.form.value,callback:function(e){t.$set(t.form,"value",e)},expression:"form.value"}},t._l(t.form.option,(function(e,t){return i("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1):t._e(),"input"===t.form.element?i("el-input",{model:{value:t.form.value,callback:function(e){t.$set(t.form,"value",e)},expression:"form.value"}}):t._e(),"imageSelect"===t.form.element?i("image-select",{model:{value:t.form.value,callback:function(e){t.$set(t.form,"value",e)},expression:"form.value"}}):t._e()],1),i("el-form-item",{attrs:{label:"描述"}},[i("el-input",{model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),i("el-form-item",{attrs:{label:"验证规则"}},[i("el-input",{model:{value:t.form.rule,callback:function(e){t.$set(t.form,"rule",e)},expression:"form.rule"}})],1)],1)],1)],1)],1)],1)}),[],!1,(function(e){for(let t in na)this[t]=na[t]}),"d3fdc27c",null,null).exports;const da={};const pa=[{name:"Login",path:"/login",component:ze,meta:{tab:!1}},{path:"/",component:Ie,redirect:"/analysis",meta:{title:"首页",tab:!1},children:[{name:"Analysis",path:"analysis",component:ra,meta:{title:"首页",breadcrumb:!1,closable:!1}},{name:"Profile",path:"profile",component:st,meta:{title:"个人中心"}},{name:"Song",path:"song",component:bt,meta:{title:"歌曲管理"}},{name:"SongCategory",path:"song/category",component:kt,meta:{title:"歌曲分类"}},{name:"User",path:"user",component:Kt,meta:{title:"用户管理"}},{name:"Picture",path:"picture",component:vt,meta:{title:"图片管理"}},{name:"Crowdfunding",path:"crowdfunding",component:Lt,meta:{title:"众筹管理"}},{name:"Order",path:"order",component:Ct,meta:{title:"订单管理"}},{name:"Promote",path:"promote",component:It,meta:{title:"推广管理"}},{name:"Wallet",path:"wallet",component:Qt,meta:{title:"用户钱包"}},{name:"WalletTrade",path:"walletTrade",component:Bt,meta:{title:"交易流水"}},{name:"WalletDetail",path:"walletDetail",component:Vt,meta:{title:"余额明细"}},{name:"AuthAdmin",path:"auth/admin",component:je,meta:{title:"管理员管理"}},{name:"AuthRole",path:"auth/role",component:Fe,meta:{title:"角色管理"}},{name:"AuthPermission",path:"auth/permission",component:He,meta:{title:"权限管理"}},{name:"AdminLog",path:"system/AdminLog",component:Et,meta:{title:"管理员日志"}},{name:"UserLog",path:"system/userLog",component:Pt,meta:{title:"用户日志"}},{name:"ExceptionLog",path:"system/exceptionLog",component:Ot,meta:{title:"异常日志"}},{name:"BusinessLog",path:"system/businessLog",component:T({name:"BusinessLog",mixins:[Ne,rt],data:()=>({headers:[{label:"id",prop:"id"},{label:"业务类型",prop:"type"},{label:"请求内容",prop:"request",overflow:!0},{label:"业务内容",prop:"content",overflow:!0},{label:"响应内容",prop:"response",overflow:!0},{label:"ip",prop:"ip"},{label:"url",prop:"url",overflow:!0},{label:"创建时间",prop:"created_at",type:"date",format:"YYYY-MM-DD HH:mm:ss"}],data:[]}),mounted(){this.getBusinessLogList()},methods:{async getBusinessLogList(e={page:1,limit:10}){this.loading=!0;try{0!==this.dateTime.length&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);Object.assign(e,this.$libs.filterNullObject(this.query));let t=await this.$api.businessLog.batchQuery();this.data=t.data.data,this.total=t.data.total}catch(t){}finally{this.loading=!1}},async showPayload(e){this.selectItem=JSON.parse(JSON.stringify(e));try{this.selectItem.request=JSON.parse(e.request),this.selectItem.content=JSON.parse(e.content),this.selectItem.content=JSON.stringify(this.selectItem,null,2)}catch(t){}this.drawer.visible=!0}}},(function(){var e=this,t=this,a=t.$createElement,i=t._self._c||a;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-search-card",{scopedSlots:t._u([{key:"footer",fn:function(){return[i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.getBusinessLogList()}}},[t._v("查询")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(e){t.resetQuery(),t.dateTime=[],t.getBusinessLogList()}}},[t._v("重置")])]},proxy:!0}])},[i("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"选择时间"}},[i("el-date-picker",{attrs:{type:"datetimerange","picker-options":t.pickerOptions,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",align:"right","value-format":"timestamp"},model:{value:t.dateTime,callback:function(e){t.dateTime=e},expression:"dateTime"}})],1)],1)],1),i("k-table",{attrs:{headers:t.headers,data:t.data,"is-pagination":"",total:t.total,loading:t.loading,toolbar:"",reload:t.getBusinessLogList},on:{changePage:t.getBusinessLogList,"row-click":t.showPayload},scopedSlots:t._u([{key:"item.type",fn:function(e){var a=e.scope;return t._l(t.$dict.businessLogType,(function(e,s){return a.row.type===e.value?i("span",{key:s},[t._v(t._s(e.label))]):t._e()}))}}])})],1),i("k-drawer",{attrs:{visible:t.drawer.visible,size:"45%","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.drawer,"visible",e)},fullscreen:function(t){e.drawer.span=t?12:20}}},[i("pre",[t._v(t._s(t.selectItem.content))])])],1)}),[],!1,(function(e){for(let t in da)this[t]=da[t]}),"43cb62e0",null,null).exports,meta:{title:"业务日志"}},{name:"SystemSetting",path:"system/setting",component:ca,meta:{title:"系统设置"}},...Ge]}];var ua=new class extends et{}("admin");var ma=new class extends et{queryAll(e){return Ze.get(`${this.path}/queryAll`,{params:e})}}("authPermission");var ha=new class extends et{queryAll(e){return Ze.get(`${this.path}/queryAll`,{params:e})}}("authRole");var _a=new class extends et{verify(){return Ze.get(`${this.path}/captcha`)}login(e){return Ze.post(`${this.path}/login`,e)}logout(){return Ze.get(`${this.path}/logout`)}profile(){return Ze.get(`${this.path}/profile`)}resetPassword(e){return Ze.post(`${this.path}/resetPassword`,e)}};var fa=new class extends et{}("picture");var ga=new class extends et{}("tag");var ba=new class extends et{}("category");var ya=new class extends et{cancel(e){return Ze.post(`${this.path}/cancel`,e)}}("order");var va=new class extends et{}("promote");var wa=new class extends et{}("crowdfunding");var ka=new class extends et{}("orderLog");var xa=new class extends et{}("orderGoods");var $a=new class extends et{}("adminLog");var Ca=new class extends et{}("userLog");var Sa=new class extends et{}("exceptionLog");var La=new class extends et{disable(e){return Ze.post(`${this.path}/disable`,e)}logout(e){return Ze.post(`${this.path}/logout`,e)}}("user");var Ta=new class extends et{index(){return Ze.get(`${this.path}`)}wallet(){return Ze.get(`${this.path}/wallet`)}walletTop(){return Ze.get(`${this.path}/walletTop`)}}("analysis");var za=new class extends et{}("walletTrade");var qa=new class extends et{}("walletDetail");var Aa=new class extends et{updateValue(e){return Ze.post(`${this.path}/updateValue`,e)}}("setting");var Ia=new class extends et{}("payment");var Da=new class extends et{}("businessLog"),Pa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",admin:ua,authPermission:ma,authRole:ha,login:_a,song:_t,picture:fa,tag:ga,category:ba,order:ya,promote:va,crowdfunding:wa,orderLog:ka,orderGoods:xa,adminLog:$a,userLog:Ca,exceptionLog:Sa,user:La,analysis:Ta,wallet:Ht,walletTrade:za,walletDetail:qa,setting:Aa,payment:Ia,businessLog:Da,oss:ot});var Na={namespaced:!0,state:{tabs:[],cachedViews:[],currentTab:{}},mutations:{},actions:{async fixedTab({state:e},t){e.tabs.find((e=>e.name===t.name))||(e.tabs.splice(0,0,t),e.cachedViews.push(t.cacheTab))},async addTab({state:e,dispatch:t},a){let i=e.tabs.find((e=>e.name===a.name));i||(e.tabs.push(a),e.cachedViews.push(a.cacheTab)),t("setCurrentTab",i||a)},async setCurrentTab({state:e},t){e.currentTab=Object.assign({},t)},async deleteTab({state:e,commit:t,dispatch:a},i){let s="number"==typeof i?i:e.tabs.findIndex((e=>e.name===i)),r=e.tabs;if(!1===r[s].closable)return;let l=e.currentTab;if(r[s].name===l.name){let e=r[s+1]||r[s-1];e&&a("setCurrentTab",e)}e.tabs.splice(s,1),e.cachedViews.splice(s,1)},async deleteCachedView({state:e,dispatch:t},a){let i="number"==typeof a?a:e.cachedViews.findIndex((e=>e===a.name));e.cachedViews.splice(i,1)},async addCachedView({state:e,dispatch:t},a){e.cachedViews.find((e=>e===a.name))||e.cachedViews.push(a.cacheTab)}}};const Oa={formatTreeData:function e(t,a=0,i=null,s=null){let r=[];for(let l of t){let o=JSON.parse(JSON.stringify(l));if(o.parent_id===a){i&&(o[i]=o[s],o.key=o.id,o.value=o.id);let a=e(t,o.id,i,s);a.length&&(o.children=a),r.push(o)}}return r},getTreeParent:function(e){let t=[],a=e=>{for(let i of e)i.children&&i.children.length>0&&(t.push(i),a(i.children))};return a(e),t},formatSecond:function(e,t=" "){let a=[[7,5],[30,3],[91,4],[365,1e9]],i=["周","月","季","年"];for(let r=0;r<a.length;r++){let s=Math.round(e/86400/a[r][0]*100)/100;if(s>=1&&s<a[r][1])return{str:s+t+i[r],value:s,key:a[r][0]}}let s=Math.round(e/86400*1e3)/1e3;return s?{str:s+t+"天",value:s,key:7}:{str:"0"+t+"天",value:s,key:365}},getAssignKeyData:function(e,t){for(let a of Object.keys(e))a in t&&(e[a]=t[a]);return e},arrayMerge:function e(t){return[].concat(...t.map((t=>Array.isArray(t)?e(t):t)))},uniqueArray:function(e){return Array.from(new Set(e))},filterNonUnique:function(e){return e=>e.filter((t=>e.indexOf(t)===e.lastIndexOf(t)))},filterUnique:function(e){return e.filter((t=>e.indexOf(t)!==e.lastIndexOf(t)))},filterNullObject:function(e,t=!1){let a={};for(let i in e)e.hasOwnProperty(i)&&null!=e[i]&&(t||!1===e[i]||(a[i]=e[i]));return a},videoCover:async function(e,t=0,a=0,i=!1){return new Promise(((s,r)=>{try{let l=document.createElement("video");l.setAttribute("crossOrigin","anonymous"),l.currentTime=t,l.autoplay=!0,l.muted=!0,l.loop=!0,e instanceof File?l.src=window.URL.createObjectURL(e):l.src=e,l.play().then((e=>{})).catch((e=>{r(e)})),l.addEventListener("loadeddata",(function(){setTimeout((()=>{let e=document.createElement("canvas"),t=l.videoWidth/l.videoHeight;e.width=l.videoWidth/2,e.height=e.width/t,e.getContext("2d").drawImage(l,0,0,e.width,e.height);let a=null;i?e.toBlob((e=>{a=new File([e],"cover.png",{type:e.type}),s(a)})):(a=e.toDataURL(),s(a)),l.pause(),l=null,e=null}),a)}),!0)}catch(l){r(l)}}))},formatBr:function(e){return e.replace(/(\r\n)|(\n)/g,"<br>")},formatFormData:function(e){let t=new FormData;for(let a in e)if(Array.isArray(e[a]))for(let i of e[a])t.append(a+"[]",i);else t.append(a,e[a]);return t},getDayTimeSlot:function(){let e=this,t=new Date;return t.getHours()>=0&&t.getHours()<12?e.hoursTip="上午":t.getHours()>=12&&t.getHours()<18?e.hoursTip="下午":e.hoursTip="晚上",e.hoursTip}},ja={menu:[{id:2,parent_id:0,route:"",permission_name:"权限管理",menu_icon:"business",children:[{id:201,parent_id:2,route:"auth/admin",permission_name:"管理员管理",menu_icon:""},{id:202,parent_id:2,route:"auth/role",permission_name:"角色管理",menu_icon:""},{id:203,parent_id:2,route:"auth/permission",permission_name:"权限规则",menu_icon:""}]}]};var Ea={namespaced:!0,state:{theme:{dark:!1,aside:{dark:!0},color:{}}},getters:{asideTheme:e=>e.theme.aside.dark},mutations:{setAsideTheme(e,t){e.theme.aside.dark=t}},localSetting:e=>{let t=localStorage.getItem("settings");t&&(e.state.settings=Object.assign(e.state.settings,JSON.parse(t))),e.subscribe((async(e,t)=>{let a=e.type.split("/");a[0]&&"settings"===a[0]&&localStorage.setItem("settings",JSON.stringify(t.settings))}))}};c.use(k);const Fa={Authorization:{token:""},user:{},permission:{route:[],menu:[...ja.menu],button:[]},config:{},home:"/"},Ua={checkRoute:e=>t=>e.permission.route.includes(t)||"root"===e.user.username||"/"===t||"/403"===t||"/404"===t,checkButton:e=>t=>e.permission.button.includes(t)||"root"===e.user.username,getUser:e=>!!Object.keys(e.user).length&&e.user},Ba={setToken(e,t){e.Authorization.token=t},setUser(e,t){e.user=o(o({},e.user),t)},setPermission(e){if("root"===e.user.username)e.permission.menu=ja.menu;else{let t=Object.values(e.user.permission),a=t.filter((e=>2===e.permission_type&&1===e.menu_show)),i=t.filter((e=>3===e.permission_type)),s=t.filter((e=>4===e.permission_type));e.permission.menu=Oa.formatTreeData(a,0),e.permission.route=i.map((e=>e.route)),e.permission.button=s.map((e=>e.button_key)),e.home=e.permission.route[0]}}},Ra={async userInfo({commit:e,state:t}){try{let a=(await _a.profile()).data;e("setUser",a),e("setPermission"),t.config=a.setting?a.setting:{}}catch(a){return Promise.reject(a)}},async login({dispatch:e,commit:t,state:a},i){try{let s=(await _a.login(i)).data;if(localStorage.setItem("token",s),t("setToken",s),f.exports.Message.success("登录成功"),await e("userInfo"),!a.permission.route.length&&"root"!==a.user.username)return void f.exports.Message.warning("无权限，请联系管理员");await Va.push(a.home)}catch(s){return Promise.reject(s)}},async logout({dispatch:e,commit:t,state:a}){try{await _a.logout(),localStorage.removeItem("token"),f.exports.Message.success("退出成功"),setTimeout((()=>{self.location.href="/manage"}),1e3)}catch(i){}}},Wa=new k.Store({state:Fa,getters:Ua,mutations:Ba,actions:Ra,modules:{tabBar:Na,settings:Ea},plugins:[Ea.localSetting]});c.use(x);const Va=new x({routes:[...pa],mode:"history",base:"manage/"});Va.beforeEach(((e,t,a)=>{let i=localStorage.getItem("token");if("/login"===e.path&&!i)return a();if(!i)return a("/login");if(0!==Object.keys(Wa.state.user).length)return"/login"===e.path?a("/"):Wa.getters.checkRoute(e.path)?a():a("/404");{let t=f.exports.Loading.service({background:"#FFFFFF"});Wa.dispatch("userInfo").then((()=>Wa.getters.checkRoute(e.path)?a():a("/404"))).catch((e=>{})).finally((()=>{t.close()}))}})),Va.afterEach(((e,t)=>{if(e.meta&&!1===e.meta.tab)return;let a={title:e.meta.title,name:e.name,path:e.path,closable:!(e.meta&&!1===e.meta.closable),cacheTab:e.name};Wa.dispatch("tabBar/addTab",Object.assign({},a)).then((e=>{}))}));var Ha={confirmWarning:function(e=""){return f.exports.MessageBox.confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})},qrcode:async function(e){try{return await $.toDataURL(e)}catch(t){return console.log(t),""}}};c.use(C),c.use((e=>{e.component("k-aside",D),e.component("k-header",O),e.component("k-breadcrumb",ne),e.component("k-menu",ue),e.component("k-table",F),e.component("k-sidebar",B),e.component("k-tabbar",le),e.component("k-cropper",V),e.component("k-preview",Z),e.component("k-checkbox",te),e.component("k-radio",ie),e.component("k-drawer",_e),e.component("k-card",Ce),e.component("k-search-card",xe),e.component("k-descriptions",be),e.component("k-descriptions-item",ve),e.component("k-upload-image",M),e.component("k-upload-video",K),e.component("remote-script",we)})),c.use((e=>{e.directive("permission",Se),e.directive("throttle",Le)})),S.locale("zh-cn"),c.prototype.$dayjs=S,c.prototype.$xss=L,c.prototype.$config=Xe,c.prototype.$tool=Ha,c.prototype.$libs=Oa,c.prototype.$api=Pa,c.prototype.$dict={pictureType:[{label:"Logo类",value:3},{label:"歌曲封面",value:1},{label:"推广图片",value:2}],orderStatus:[{label:"创建",value:"CREATE"},{label:"等待支付",value:"WAITPAY"},{label:"完成",value:"SUCCESS"},{label:"取消",value:"CANCEL"},{label:"退款",value:"REFUND"}],payType:{WECHAT:{label:"微信",value:1},WALLET:{label:"钱包",value:8},MULTI:{label:"组合",value:9}},payStatus:{CREATE:"CREATE",WAITPAY:"WAITPAY",SUCCESS:"SUCCESS",CANCEL:"CANCEL",REFUND:"REFUND",FAIL:"FAIL"},tradeType:[{label:"充值",value:1},{label:"提现",value:2},{label:"付款",value:3},{label:"收款",value:4},{label:"众筹充值",value:5},{label:"手动增加余额",value:6},{label:"手动减少余额",value:7}],tradeStatus:[{label:"创建",value:"CREATE"},{label:"等待支付",value:"WAITPAY"},{label:"完成",value:"SUCCESS"},{label:"取消",value:"CANCEL"},{label:"退款",value:"REFUND"}],settingType:[{label:"站点设置",value:1},{label:"业务设置",value:2}],element:["input","select","imageSelect","radio","checkbox"],validateRule:[{rule:"required",isValue:!1},{rule:"nullable",isValue:!1},{rule:"numeric",isValue:!1},{rule:"integer",isValue:!1},{rule:"array",isValue:!1},{rule:"min",isValue:!0},{rule:"max",isValue:!0},{rule:"gt",isValue:!0},{rule:"lt",isValue:!0},{rule:"in",isValue:!0},{rule:"between",isValue:!0}],businessLogType:[{label:"sms",value:1}]},new c({el:"#app",store:Wa,router:Va,render:e=>e(q)});
