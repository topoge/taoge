import{t as c}from"./tableFlow.31edb31e.js";import m from"./WalletTrade.db3e0ccf.js";import u from"./WalletDetail.cc6fc8dd.js";import{n as d,w as s}from"./index.621e7bf7.js";import"./datePicker.1a087a29.js";import"./vendor.c31495b0.js";var p=function(){var l=this,e=this,r=e.$createElement,t=e._self._c||r;return t("el-row",[t("el-col",{attrs:{span:24}},[t("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.getWalletList()}}},[e._v("\u67E5\u8BE2")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(a){e.resetQuery(),e.dateTime=[],e.getWalletList()}}},[e._v("\u91CD\u7F6E")])]},proxy:!0}])},[t("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(a){a.preventDefault()}}},[t("el-form-item",{attrs:{label:"\u7528\u6237\u624B\u673A\u53F7"}},[t("el-input",{model:{value:e.query.mobile,callback:function(a){e.$set(e.query,"mobile",a)},expression:"query.mobile"}})],1)],1)],1),t("k-table",{attrs:{"table-name":"\u94B1\u5305\u6570\u636E",headers:e.headers,data:e.data,"is-pagination":"",total:e.total,loading:e.loading,"zoom-height":130,toolbar:"",reload:e.getWalletList},on:{changePage:function(a){l.page=a,l.getWalletList()},"sort-change":function(a){l.sortHandle(a),l.getWalletList()}},scopedSlots:e._u([{key:"header",fn:function(){return[t("span",[e._v("\u603B\u4F59\u989D\uFF1A"+e._s(e.walletData.sum_balance))]),t("el-divider",{attrs:{direction:"vertical"}}),t("span",[e._v("\u603B\u51BB\u7ED3\u91D1\u989D\uFF1A"+e._s(e.walletData.frozen_amount))])]},proxy:!0},{key:"item.balance",fn:function(a){var i=a.scope;return[t("div",{staticClass:"balance-action"},[t("i",{staticClass:"el-icon-remove-outline",on:{click:function(n){e.selectItem=i.row,e.dialogAmount.type=!1,e.dialogAmount.visible=!0}}}),t("span",[e._v(e._s(i.row.balance))]),t("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(n){e.selectItem=i.row,e.dialogAmount.type=!0,e.dialogAmount.visible=!0}}})])]}},{key:"item.user",fn:function(a){var i=a.scope;return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.row.mobile,placement:"top-start"}},[t("span",[e._v(e._s(i.row.nickname?i.row.nickname:i.row.mobile))])])]}},{key:"item.action",fn:function(a){var i=a.scope;return[t("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"primary",plain:""},on:{click:function(n){e.selectItem=i.row,e.drawerDetail.title=e.selectItem.wallet_no,e.drawerDetail.visible=!0}}},[e._v("\u94B1\u5305\u660E\u7EC6")]),t("el-button",{staticClass:"smini-btn",attrs:{size:"mini",type:"success",plain:""},on:{click:function(n){e.selectItem=i.row,e.drawerTrade.title=e.selectItem.wallet_no,e.drawerTrade.visible=!0}}},[e._v("\u4EA4\u6613\u6D41\u6C34")])]}}])})],1),t("k-drawer",{attrs:{visible:e.drawerTrade.visible,title:e.drawer.title+"/\u4EA4\u6613\u6D41\u6C34",size:"55%","destroy-on-close":""},on:{"update:visible":function(a){return e.$set(e.drawerTrade,"visible",a)}}},[e.drawerTrade.visible?t("wallet-trade",{attrs:{"is-component":"","wallet-no":e.selectItem.wallet_no}}):e._e()],1),t("k-drawer",{attrs:{visible:e.drawerDetail.visible,title:e.drawer.title+"/\u4F59\u989D\u660E\u7EC6",size:"55%","destroy-on-close":""},on:{"update:visible":function(a){return e.$set(e.drawerDetail,"visible",a)}}},[e.drawerDetail.visible?t("wallet-detail",{attrs:{"is-component":"","wallet-no":e.selectItem.wallet_no}}):e._e()],1),t("el-dialog",{attrs:{title:e.dialogAmount.title,visible:e.dialogAmount.visible,width:"20%","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(a){return e.$set(e.dialogAmount,"visible",a)},closed:function(a){e.form.amount=0}}},[t("el-form",{attrs:{"label-width":"80px"},nativeOn:{submit:function(a){a.preventDefault()}}},[t("el-form-item",{attrs:{label:e.dialogAmount.type?"\u589E\u52A0\u4F59\u989D":"\u51CF\u5C11\u4F59\u989D"}},[t("el-input-number",{attrs:{min:0,precision:2,max:e.dialogAmount.type?1e4:e.selectItem.balance-e.selectItem.frozen_amount,step:100,label:"\u63CF\u8FF0\u6587\u5B57"},model:{value:e.form.amount,callback:function(a){e.$set(e.form,"amount",a)},expression:"form.amount"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(a){e.dialogAmount.visible=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"primary",disabled:e.saveLoading,loading:e.saveLoading},on:{click:function(a){e.dialogAmount.type?e.addBalance():e.subtractBalance()}}},[e._v("\u4FDD \u5B58")])],1)],1)],1)},f=[];const b={name:"Wallet",components:{WalletDetail:u,WalletTrade:m},mixins:[c],props:{isComponent:{type:Boolean,default:!1},mobile:{type:String}},data(){return{dialogAmount:{type:!0,title:"",visible:!1},drawerTrade:{visible:!1,title:""},drawerDetail:{visible:!1,title:""},headers:[{label:"id",prop:"id",width:80},{label:"\u94B1\u5305\u7F16\u53F7",prop:"wallet_no",tooltip:!0},{label:"\u94B1\u5305\u4F59\u989D",prop:"balance",sortable:"custom"},{label:"\u603B\u6536\u5165",prop:"income_amount"},{label:"\u603B\u652F\u4ED8\u51FA",prop:"outcome_amount"},{label:"\u51BB\u7ED3\u91D1\u989D",prop:"frozen_amount"},{label:"\u6240\u5C5E\u7528\u6237",prop:"user",func:l=>l.nickname?l.nickname:l.mobile},{label:"\u64CD\u4F5C",prop:"action",width:this.isComponent?155:"auto"}],data:[],query:{mobile:this.mobile?this.mobile:null},form:{amount:0},walletData:{}}},mounted(){this.getWalletList(),this.getAnalysisWallet()},methods:{async getWalletList(){this.loading=!0;try{let l=this.queryMerge(),e=await this.$api.wallet.batchQuery(l);this.data=e.data.data,this.total=e.data.total}catch{}finally{this.loading=!1}},async getAnalysisWallet(){try{let l=await this.$api.analysis.wallet();this.walletData=l.data}catch{}},async addBalance(){if(this.form.amount<=0){this.$message.warning("\u91D1\u989D\u5FC5\u987B\u5927\u4E8E0");return}this.saveLoading=!0;try{let l=await s.increment({user_id:this.selectItem.user_id,amount:this.form.amount});this.selectItem.balance=Number(this.selectItem.balance)+this.form.amount,this.dialogAmount.visible=!1,this.$message.success("\u589E\u52A0\u6210\u529F")}catch{}finally{this.saveLoading=!1}},async subtractBalance(){if(this.form.amount<=0){this.$message.warning("\u91D1\u989D\u5FC5\u987B\u5927\u4E8E0");return}this.saveLoading=!0;try{let l=await s.decrement({user_id:this.selectItem.user_id,amount:this.form.amount});this.selectItem.balance=this.selectItem.balance-this.form.amount,this.dialogAmount.visible=!1,this.$message.success("\u51CF\u5C11\u6210\u529F")}catch{}finally{this.saveLoading=!1}}}},o={};var v=d(b,p,f,!1,h,"12a5ef21",null,null);function h(l){for(let e in o)this[e]=o[e]}var A=function(){return v.exports}();export{A as default};
