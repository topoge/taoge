import{t as d}from"./tableFlow.31edb31e.js";import{d as c}from"./datePicker.1a087a29.js";import{n as p}from"./index.621e7bf7.js";import"./vendor.c31495b0.js";var u=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("el-row",[t("el-col",{attrs:{span:24}},[t("k-search-card",{scopedSlots:e._u([{key:"footer",fn:function(){return[t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.getOrderList()}}},[e._v("\u67E5\u8BE2")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini"},on:{click:function(a){e.resetQuery(),e.dateTime=[],e.getOrderList()}}},[e._v("\u91CD\u7F6E")])]},proxy:!0}])},[t("el-form",{staticStyle:{display:"flex","flex-flow":"row wrap",gap:"10px"},attrs:{inline:!0,size:"small"},nativeOn:{submit:function(a){a.preventDefault()}}},[t("el-form-item",{attrs:{label:"\u8BA2\u5355\u7C7B\u578B"}},[t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"\u8BF7\u9009\u62E9",size:"small"},model:{value:e.query.order_type,callback:function(a){e.$set(e.query,"order_type",a)},expression:"query.order_type"}},[t("el-option",{attrs:{label:"\u666E\u901A\u8BA2\u5355",value:1}}),t("el-option",{attrs:{label:"\u4EE3\u4ED8\u8BA2\u5355",value:2}})],1)],1),t("el-form-item",{attrs:{label:"\u8BA2\u5355\u72B6\u6001"}},[t("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"\u8BF7\u9009\u62E9",size:"small"},model:{value:e.query.order_status,callback:function(a){e.$set(e.query,"order_status",a)},expression:"query.order_status"}},e._l(e.orderStatus,function(a,r){return t("el-option",{key:r,attrs:{label:a.label,value:a.value}})}),1)],1),t("el-form-item",{attrs:{label:"\u8BA2\u5355\u7F16\u53F7"}},[t("el-input",{attrs:{maxlength:"64"},model:{value:e.query.order_no,callback:function(a){e.$set(e.query,"order_no",a)},expression:"query.order_no"}})],1),t("el-form-item",{attrs:{label:"\u9009\u62E9\u65F6\u95F4"}},[t("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4",align:"right","value-format":"timestamp"},model:{value:e.dateTime,callback:function(a){e.dateTime=a},expression:"dateTime"}})],1),t("el-form-item",{attrs:{label:"\u8BA2\u5355\u6807\u9898"}},[t("el-input",{attrs:{maxlength:"32"},model:{value:e.query.subject,callback:function(a){e.$set(e.query,"subject",a)},expression:"query.subject"}})],1),t("el-form-item",{attrs:{label:"\u7528\u6237\u624B\u673A\u53F7"}},[t("el-input",{model:{value:e.query.mobile,callback:function(a){e.$set(e.query,"mobile",a)},expression:"query.mobile"}})],1)],1)],1),t("k-table",{attrs:{"table-name":"\u8BA2\u5355\u6570\u636E",headers:e.headers,data:e.data,"show-expand":"","is-pagination":"",total:e.total,"zoom-height":e.isComponent?140:130,toolbar:"",reload:e.getOrderList,loading:e.loading},on:{changePage:e.getOrderList,"expand-change":e.showOrderLog},scopedSlots:e._u([{key:"item.order_type",fn:function(a){var r=a.scope;return[r.row.order_type===1?t("el-tag",{attrs:{size:"mini"}},[e._v("\u666E\u901A\u8BA2\u5355")]):e._e(),r.row.order_type===2?t("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("\u4F17\u7B79\u8BA2\u5355")]):e._e()]}},{key:"item.nickname",fn:function(a){var r=a.scope;return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:r.row.mobile,placement:"top-start"}},[t("span",[e._v(e._s(r.row.nickname?r.row.nickname:r.row.mobile))])])]}},{key:"item.order_status",fn:function(a){var r=a.scope;return[r.row.order_status==="CREATE"?t("el-tag",{attrs:{size:"mini",type:""}},[e._v("\u521B\u5EFA")]):e._e(),r.row.order_status==="SUCCESS"?t("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("\u5B8C\u6210")]):e._e(),r.row.order_status==="WAITPAY"?t("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("\u7B49\u5F85\u652F\u4ED8")]):e._e(),r.row.order_status==="CANCEL"?t("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("\u53D6\u6D88")]):e._e(),r.row.order_status==="REFUND"?t("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("\u9000\u6B3E")]):e._e()]}},{key:"item.action",fn:function(a){var r=a.scope;return[t("el-button",{staticClass:"smini-btn",attrs:{size:"mini",plain:"",type:"warning",disabled:r.row.order_status!=="CREATE"&&r.row.order_status!=="WAITPAY"},on:{click:function(i){return e.cancelOrder(r.row)}}},[e._v("\u53D6\u6D88\u8BA2\u5355")])]}},{key:"expand-item",fn:function(a){return a.scope,[t("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.expandLoading,expression:"expandLoading"}]},[t("el-divider",{attrs:{"content-position":"left"}},[e._v("\u8BA2\u5355\u65E5\u5FD7")]),e._l(e.orderLog,function(r,i){return t("k-descriptions",{key:i,attrs:{bottom:"2px",divider:e.orderLog.length!==i+1}},[t("k-descriptions-item",{attrs:{label:"\u65F6\u95F4"}},[e._v(e._s(e.$dayjs.unix(r.created_at).format("YYYY-MM-DD HH:mm:ss")))]),t("k-descriptions-item",{attrs:{label:"\u72B6\u6001"}},[r.order_status==="CREATE"?t("el-tag",{attrs:{size:"mini",type:""}},[e._v("\u521B\u5EFA")]):e._e(),r.order_status==="SUCCESS"?t("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("\u5B8C\u6210")]):e._e(),r.order_status==="WAITPAY"?t("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("\u7B49\u5F85\u652F\u4ED8")]):e._e(),r.order_status==="CANCEL"?t("el-tag",{attrs:{size:"mini",type:"info"}},[e._v("\u53D6\u6D88")]):e._e(),r.order_status==="REFUND"?t("el-tag",{attrs:{size:"mini",type:"danger"}},[e._v("\u9000\u6B3E")]):e._e()],1),t("k-descriptions-item",{attrs:{label:"\u64CD\u4F5C"}},[e._v(e._s(r.action))]),r.admin_id?t("k-descriptions-item",{attrs:{label:"\u64CD\u4F5C\u4EBA"}},[e._v(e._s("\u7BA1\u7406\u5458-"+r.username))]):e._e(),r.user_id?t("k-descriptions-item",{attrs:{label:"\u64CD\u4F5C\u4EBA"}},[e._v(e._s("\u7528\u6237-"+(r.nickname?r.nickname:r.mobile)))]):e._e(),!r.user_id&&!r.admin_id?t("k-descriptions-item",{attrs:{label:"\u64CD\u4F5C\u4EBA"}},[e._v("\u7CFB\u7EDF")]):e._e()],1)}),e.selectItem.order_type===1?[t("el-divider",{attrs:{"content-position":"left"}},[e._v("\u8BA2\u5355\u6B4C\u66F2")]),e._l(e.orderGoods,function(r,i){return t("k-descriptions",{key:"goods"+i,attrs:{bottom:"0"}},[t("k-descriptions-item",{attrs:{label:"\u6B4C\u66F2\u540D\u79F0"}},[e._v(e._s(r.song_name))]),t("k-descriptions-item",{attrs:{label:"\u4EF7\u683C"}},[t("el-tag",{attrs:{size:"mini"}},[e._v(e._s(r.goods_price))])],1),t("k-descriptions-item",{attrs:{label:"\u97F3\u4E50"}},[t("span",{staticClass:"material-icons",on:{click:function(o){e.previewSong=r,e.preview.visible=!0}}},[e._v("play_circle_outline")])])],1)})]:e._e(),e.selectItem.order_type===2?[t("el-divider",{attrs:{"content-position":"left"}},[e._v("\u4F17\u7B79\u4FE1\u606F")]),t("k-descriptions",{attrs:{bottom:"0"}},[t("k-descriptions-item",{attrs:{label:"\u4F17\u7B79\u6807\u9898"}},[e._v(e._s(e.selectItem.crowdfunding.subject))]),t("k-descriptions-item",{attrs:{label:"\u4F17\u7B79\u7F16\u53F7"}},[e._v(e._s(e.selectItem.crowdfunding.crowdfunding_no))]),t("k-descriptions-item",{attrs:{label:"\u4F17\u7B79\u91D1\u989D"}},[t("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.selectItem.crowdfunding.amount))])],1),t("k-descriptions-item",{attrs:{label:"\u5DF2\u7B79\u91D1\u989D"}},[t("el-tag",{attrs:{size:"mini",type:"success"}},[e._v(e._s(new e.Decimal(e.selectItem.crowdfunding.amount).sub(new e.Decimal(e.selectItem.crowdfunding.unpaid_amount).sub(new e.Decimal(e.selectItem.crowdfunding.lock_amount)))))])],1)],1)]:e._e(),t("el-divider",{attrs:{"content-position":"left"}},[e._v("\u652F\u4ED8\u4FE1\u606F")]),e._l(e.paymentList,function(r,i){return t("k-descriptions",{key:i+"payInfo",attrs:{bottom:"0"}},[t("k-descriptions-item",{attrs:{label:"\u652F\u4ED8\u65B9\u5F0F"}},e._l(e.$dict.payType,function(o,n){return r.pay_type===o.value?t("span",{key:n+"payType"},[e._v(e._s(o.label))]):e._e()}),0),t("k-descriptions-item",{attrs:{label:"\u652F\u4ED8\u4EA4\u6613\u53F7","label-width":"85px"}},[e._v(e._s(r.trade_no))]),t("k-descriptions-item",{attrs:{label:"\u652F\u4ED8\u91D1\u989D"}},[t("el-tag",{attrs:{size:"mini"}},[e._v(e._s(r.pay_amount))])],1),t("k-descriptions-item",{attrs:{label:"\u652F\u4ED8\u72B6\u6001"}},e._l(e.$dict.payStatus,function(o,n){return r.pay_status===o?t("span",{key:n+"payStatus"},[e._v(e._s(o))]):e._e()}),0)],1)})],2)]}}])})],1),t("k-preview",{attrs:{show:e.preview.visible,title:e.previewSong.song_name,type:"audio",src:e.previewSong.file},on:{"update:show":function(a){return e.$set(e.preview,"visible",a)}}})],1)},_=[];const m={name:"Order",mixins:[d,c],props:{isComponent:{type:Boolean,default:!1},crowdfundingId:{type:Number},userMobile:{type:String}},data(){return{preview:{visible:!1},headers:[{label:"id",prop:"id",width:50},{label:"\u8BA2\u5355\u7C7B\u578B",prop:"order_type",width:80},{label:"\u8BA2\u5355\u7F16\u53F7",prop:"order_no",tooltip:!0},{label:"\u8BA2\u5355\u6807\u9898",prop:"subject",tooltip:!0},{label:"\u8BA2\u5355\u91D1\u989D",prop:"total_amount"},{label:"\u652F\u4ED8\u91D1\u989D",prop:"pay_amount"},{label:"\u521B\u5EFA\u4EBA",prop:"nickname"},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"created_at",type:"date",format:"YYYY-MM-DD HH:mm:ss",tooltip:this.isComponent},{label:"\u8BA2\u5355\u72B6\u6001",prop:"order_status"},{label:"\u64CD\u4F5C",prop:"action"}],data:[],dateTime:[],query:{crowdfunding_id:this.crowdfundingId?this.crowdfundingId:null,order_type:null,order_status:null,order_no:null,start_time:null,end_time:null,subject:null,mobile:this.userMobile?this.userMobile:null},orderStatus:[{label:"\u521B\u5EFA",value:"CREATE"},{label:"\u7B49\u5F85\u652F\u4ED8",value:"WAITPAY"},{label:"\u5B8C\u6210",value:"SUCCESS"},{label:"\u53D6\u6D88",value:"CANCEL"},{label:"\u9000\u6B3E",value:"REFUND"}],orderLog:[],orderGoods:[],paymentList:[],expandLoading:!1,previewSong:{}}},mounted(){this.getOrderList()},methods:{async getOrderList(e={page:1,limit:10}){this.loading=!0;try{this.dateTime.length!==0&&(this.query.start_time=this.dateTime[0]/1e3,this.query.end_time=this.dateTime[1]/1e3);let s=Object.assign(e,this.$libs.filterNullObject(this.query)),t=await this.$api.order.batchQuery(s);this.data=t.data.data,this.total=t.data.total}catch{}finally{this.loading=!1}},async cancelOrder(e){this.$tool.confirmWarning("\u786E\u5B9A\u8981\u53D6\u6D88"+e.subject+"\u8BA2\u5355\u5417\uFF1F").then(async()=>{try{let s=await this.$api.order.cancel({id:e.id});e.order_status="CANCEL",this.$message.success("\u8BA2\u5355\u53D6\u6D88\u6210\u529F")}catch(s){console.log(s)}}).catch(s=>{})},async showOrderLog(e,s){e&&(this.selectItem=s,this.expandLoading=!0,await this.getOrderLog(s.id),s.order_type===1&&await this.getOrderGoods(s.id),await this.getOrderPayment(s.id),this.expandLoading=!1)},async getOrderLog(e){try{let s=await this.$api.orderLog.batchQuery({order_id:e});this.orderLog=s.data.data}catch{}finally{}},async getOrderGoods(e){try{let s=await this.$api.orderGoods.batchQuery({order_id:e});this.orderGoods=s.data.data}catch{}},async getOrderPayment(e){try{let s=await this.$api.payment.batchQuery({order_id:e});this.paymentList=s.data.data}catch{}}}},l={};var y=p(m,u,_,!1,v,"6f6562eb",null,null);function v(e){for(let s in l)this[s]=l[s]}var w=function(){return y.exports}();export{w as default};
