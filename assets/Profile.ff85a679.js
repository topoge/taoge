var n=Object.defineProperty;var r=Object.getOwnPropertySymbols;var d=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable;var i=(e,a,t)=>a in e?n(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,o=(e,a)=>{for(var t in a||(a={}))d.call(a,t)&&i(e,t,a[t]);if(r)for(var t of r(a))p.call(a,t)&&i(e,t,a[t]);return e};import{t as c}from"./tableFlow.31edb31e.js";import{a as m}from"./vendor.c31495b0.js";import{B as v,r as f,n as u}from"./index.621e7bf7.js";class g extends v{setAvatar(a){return f.post(`${this.path}/setAvatar`,a)}}var h=new g("profile"),_=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("el-row",[t("el-col",{attrs:{span:24}},[t("el-card",{attrs:{shadow:"nover"}},[t("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"20px"}},[t("div",{staticClass:"avatar"}),t("div",{staticClass:"avatar"},[t("el-image",{directives:[{name:"loading",rawName:"v-loading",value:e.uploading,expression:"uploading"}],staticStyle:{width:"100px",height:"100px"},attrs:{src:e.getUser.avatar?e.$config.staticUrl()+e.getUser.avatar:"",onerror:"this.src='/default_avatar.png'","preview-src-list":[e.getUser.avatar?e.$config.staticUrl()+e.getUser.avatar:"/default_avatar.png"]}}),t("div",{staticClass:"btn"},[t("k-upload-image",{ref:"upload",attrs:{accept:"image/jpeg,image/png,image/gif",upload:e.uploadImage,croppedCanvas:{width:100,height:100}},scopedSlots:e._u([{key:"trigger",fn:function(){return[t("div",{staticClass:"edit"},[t("span",{staticClass:"material-icons"},[e._v("edit")]),e._v("\u4FEE\u6539 ")])]},proxy:!0}])})],1)],1),t("div",[t("h2",[e._v(e._s(e.$libs.getDayTimeSlot())+"\u597D "+e._s(e.getUser.nickname?e.getUser.nickname:e.getUser.username))])])]),t("div",[t("span",{staticClass:"merchant-name"},[e._v(e._s(e.getUser?e.getUser.mobile:""))]),t("el-button",{staticStyle:{"margin-top":"20px"},attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(s){e.dialog.visible=!0}}},[e._v("\u4FEE\u6539\u5BC6\u7801")])],1)])],1),t("k-cropper"),t("el-dialog",{attrs:{title:e.dialog.title,visible:e.dialog.visible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(s){return e.$set(e.dialog,"visible",s)}}},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"small"}},[t("el-form-item",{attrs:{label:"\u539F\u5BC6\u7801"}},[t("el-input",{attrs:{type:"password"},model:{value:e.form.oldPassword,callback:function(s){e.$set(e.form,"oldPassword",s)},expression:"form.oldPassword"}})],1),t("el-form-item",{attrs:{label:"\u65B0\u5BC6\u7801"}},[t("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(s){e.$set(e.form,"password",s)},expression:"form.password"}})],1),t("el-form-item",{attrs:{label:"\u786E\u8BA4\u5BC6\u7801"}},[t("el-input",{attrs:{type:"password"},model:{value:e.password,callback:function(s){e.password=s},expression:"password"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(s){e.dialog.visible=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"primary",loading:e.saveLoading},on:{click:e.resetPassword}},[e._v("\u4FDD \u5B58")])],1)],1)],1)},w=[];const b={name:"Profile",mixins:[c],data(){return{dialog:{title:"\u4FEE\u6539\u5BC6\u7801",type:"",visible:!1},uploading:!1,form:{avatar:null,oldPassword:"",password:""},password:""}},computed:o({},m(["getUser"])),methods:{resetPassword(){if(this.password!==this.form.password){this.$message.warning("\u4E24\u6B21\u5BC6\u7801\u4E0D\u4E00\u81F4");return}this.saveLoading=!0;let e=Object.assign({},this.form);this.$api.login.resetPassword(e).then(a=>{this.dialog.visible=!1,this.saveLoading=!1,localStorage.removeItem("token"),this.$message.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55"),setTimeout(()=>{this.$router.push("/login")},1e3)}).catch(a=>{this.saveLoading=!1})},async uploadImage(e){this.uploading=!0;try{let a=new FormData;a.append("avatar",e);let t=await h.setAvatar(a);this.$store.commit("setUser",t.data),this.$message.success("\u4FEE\u6539\u6210\u529F")}catch{}finally{this.uploading=!1}}}},l={};var y=u(b,_,w,!1,x,"8bc2dada",null,null);function x(e){for(let a in l)this[a]=l[a]}var C=function(){return y.exports}();export{C as default};
