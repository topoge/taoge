import{t as $}from"./tableFlow.31edb31e.js";import{A as m}from"./AttachmentDialog.c144c957.js";import{n as f}from"./index.621e7bf7.js";import w from"./Song.ce9376ee.js";import"./Attachment.3fb88322.js";import"./datePicker.1a087a29.js";import"./vendor.c31495b0.js";import"./TreeSelect.ebdd8ea4.js";var k=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],S=function(t){return k.map(function(e){return e.toLowerCase()}).indexOf(t.toLowerCase())!==-1},C=function(t,e,o){Object.keys(e).filter(S).forEach(function(i){var n=e[i];typeof n=="function"&&(i==="onInit"?n(t,o):o.on(i.substring(2),function(r){return n(r,o)}))})},P=function(t,e){var o=t.$props.modelEvents?t.$props.modelEvents:null,i=Array.isArray(o)?o.join(" "):o;e.on(i||"change input undo redo",function(){t.$emit("input",e.getContent({format:t.$props.outputFormat}))})},j=function(t,e,o){var i=e.$props.value?e.$props.value:"",n=e.$props.initialValue?e.$props.initialValue:"";o.setContent(i||(e.initialized?e.cache:n)),e.$watch("value",function(r,a){o&&typeof r=="string"&&r!==a&&r!==o.getContent({format:e.$props.outputFormat})&&o.setContent(r)}),e.$listeners.input&&P(e,o),C(t,e.$listeners,o),e.initialized=!0},v=0,h=function(t){var e=Date.now(),o=Math.floor(Math.random()*1e9);return v++,t+"_"+o+v+String(e)},E=function(t){return t!==null&&t.tagName.toLowerCase()==="textarea"},g=function(t){return typeof t=="undefined"||t===""?[]:Array.isArray(t)?t:t.split(" ")},I=function(t,e){return g(t).concat(g(e))},L=function(t){return t==null},b=function(){return{listeners:[],scriptId:h("tiny-script"),scriptLoaded:!1}},z=function(){var t=b(),e=function(n,r,a,u){var s=r.createElement("script");s.referrerPolicy="origin",s.type="application/javascript",s.id=n,s.src=a;var d=function(){s.removeEventListener("load",d),u()};s.addEventListener("load",d),r.head&&r.head.appendChild(s)},o=function(n,r,a){t.scriptLoaded?a():(t.listeners.push(a),n.getElementById(t.scriptId)||e(t.scriptId,n,r,function(){t.listeners.forEach(function(u){return u()}),t.scriptLoaded=!0}))},i=function(){t=b()};return{load:o,reinitialize:i}},D=z(),A=function(){return typeof window!="undefined"?window:global},l=function(){var t=A();return t&&t.tinymce?t.tinymce:null},O={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],value:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(t){return t==="html"||t==="text"}}},c=globalThis&&globalThis.__assign||function(){return c=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},c.apply(this,arguments)},M=function(t,e,o){return t(o||"div",{attrs:{id:e}})},F=function(t,e){return t("textarea",{attrs:{id:e},style:{visibility:"hidden"}})},p=function(t){return function(){var e=c(c({},t.$props.init),{readonly:t.$props.disabled,selector:"#"+t.elementId,plugins:I(t.$props.init&&t.$props.init.plugins,t.$props.plugins),toolbar:t.$props.toolbar||t.$props.init&&t.$props.init.toolbar,inline:t.inlineEditor,setup:function(o){t.editor=o,o.on("init",function(i){return j(i,t,o)}),t.$props.init&&typeof t.$props.init.setup=="function"&&t.$props.init.setup(o)}});E(t.element)&&(t.element.style.visibility="",t.element.style.display=""),l().init(e)}},U={props:O,created:function(){this.elementId=this.$props.id||h("tiny-vue"),this.inlineEditor=this.$props.init&&this.$props.init.inline||this.$props.inline,this.initialized=!1},watch:{disabled:function(){this.editor.setMode(this.disabled?"readonly":"design")}},mounted:function(){if(this.element=this.$el,l()!==null)p(this)();else if(this.element&&this.element.ownerDocument){var t=this.$props.cloudChannel?this.$props.cloudChannel:"5",e=this.$props.apiKey?this.$props.apiKey:"no-api-key",o=L(this.$props.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+e+"/tinymce/"+t+"/tinymce.min.js":this.$props.tinymceScriptSrc;D.load(this.element.ownerDocument,o,p(this))}},beforeDestroy:function(){l()!==null&&l().remove(this.editor)},deactivated:function(){var t;this.inlineEditor||(this.cache=this.editor.getContent(),(t=l())===null||t===void 0||t.remove(this.editor))},activated:function(){!this.inlineEditor&&this.initialized&&p(this)()},render:function(t){return this.inlineEditor?M(t,this.elementId,this.$props.tagName):F(t,this.elementId)}},q=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("editor",t._g(t._b({attrs:{id:"tiny",init:t.tinymceInit}},"editor",t.$attrs,!1),t.$listeners)),o("k-cropper",{ref:"cropper",attrs:{openCropper:t.openCropper},on:{finishCrop:function(i){}}}),o("Attachment",{attrs:{visible:t.visible},on:{"update:visible":function(i){t.visible=i},select:t.selectImage}})],1)},B=[];const K={name:"KEditor",components:{Attachment:m,Editor:U},props:{upload:{type:Function},cropper:{type:Boolean}},watch:{visible(t){t?document.documentElement.style.setProperty("--tox-tinymce-index","2000"):document.documentElement.style.setProperty("--tox-tinymce-index","99999999")}},data(){return{visible:!1,openCropper:!1,data:"",picker_callback:null,tinymceInit:{selector:"#tiny",branding:!1,language_url:"https://cdn.jsdelivr.net/gh/topoge/taoge@master/tinymce/langs/zh_CN.js",language:"zh_CN",plugins:["emoticons","image","imagetools","code","link","preview"],menubar:!1,toolbar_sticky:!0,toolbar:"code |undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media template link anchor codesample | ltr rtl",quickbars_selection_toolbar:"bold italic | quicklink h2 h3 blockquote quickimage quicktable",automatic_uploads:!0,paste_data_images:!0,block_unsupported_drop:!1,imagetools_toolbar:"rotateleft rotateright | flipv fliph | imageoptions",file_picker_types:"image",file_picker_callback:(t,e,o)=>{o.filetype==="image"&&(this.visible=!0,this.picker_callback=t)},mobile:{theme:"mobile",plugins:["autosave","lists","autolink"]}}}},methods:{async selectImage(t){this.picker_callback(this.$config.staticUrl()+t.path,{title:t.att_name})}}},y={};var N=f(K,q,B,!1,R,"236f4d71",null,null);function R(t){for(let e in y)this[e]=y[e]}var x=function(){return N.exports}(),T=function(){var t=this,e=this,o=e.$createElement,i=e._self._c||o;return i("el-row",[i("el-col",{attrs:{span:24}},[i("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,loading:e.loading,toolbar:"",reload:e.getPromoteList},on:{changePage:e.getPromoteList},scopedSlots:e._u([{key:"header",fn:function(){return[i("el-row",{attrs:{type:"flex"}},[i("el-col",[i("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(n){return e.handleAction("create")}}},[e._v("\u65B0\u589E\u63A8\u5E7F")])],1)],1)]},proxy:!0},{key:"item.type",fn:function(n){var r=n.scope;return[r.row.type===1?i("el-tag",{attrs:{size:"mini",type:"primary"}},[e._v("\u5185\u5BB9")]):e._e(),r.row.type===2?i("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("\u94FE\u63A5")]):e._e(),r.row.type===3?i("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("\u6B4C\u66F2")]):e._e()]}},{key:"item.position",fn:function(n){var r=n.scope;return[r.row.position===1?i("span",[e._v("Banner")]):e._e()]}},{key:"item.image",fn:function(n){var r=n.scope;return[r.row.image?i("el-image",{staticClass:"table-logo",attrs:{src:e.$config.staticUrl()+r.row.image,lazy:"",fit:"contain",previewSrcList:[e.$config.staticUrl()+r.row.image]}}):e._e()]}},{key:"item.status",fn:function(n){var r=n.scope;return[i("el-switch",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{"active-value":1,"inactive-value":0},on:{change:function(a){return e.switchStatus("status",a,r.row)}},model:{value:r.row.status,callback:function(a){e.$set(r.row,"status",a)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(n){var r=n.scope;return[i("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(a){return e.handleAction("update",r.row)}}},[e._v("\u7F16\u8F91")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(a){return e.deletePromote(r)}}},[e._v("\u5220\u9664")])]}}])})],1),i("k-drawer",{attrs:{visible:e.drawer.visible,title:e.drawer.title,size:"45%"},on:{"update:visible":function(n){return e.$set(e.drawer,"visible",n)},fullscreen:function(n){t.drawer.span=n?12:20},closed:e.resetForm},scopedSlots:e._u([{key:"footer",fn:function(){return[i("el-button",{attrs:{size:"small"},on:{click:function(n){e.drawer.visible=!1}}},[e._v("\u53D6\u6D88")]),i("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",disabled:e.saveLoading,loading:e.saveLoading},on:{click:function(n){e.drawer.type==="update"?e.updatePromote():e.createPromote()}}},[e._v("\u4FDD\u5B58")])]},proxy:!0}])},[i("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.queryLoading,expression:"queryLoading"}],attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:e.drawer.span}},[i("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"\u63A8\u5E7F\u4F4D\u7F6E"}},[i("el-select",{model:{value:e.form.position,callback:function(n){e.$set(e.form,"position",n)},expression:"form.position"}},[i("el-option",{attrs:{value:1,label:"Banner"}})],1)],1),i("el-form-item",{attrs:{label:"\u5E7F\u544A\u7C7B\u578B"}},[i("el-select",{model:{value:e.form.type,callback:function(n){e.$set(e.form,"type",n)},expression:"form.type"}},[i("el-option",{attrs:{value:1,label:"\u5185\u5BB9"}}),i("el-option",{attrs:{value:2,label:"\u94FE\u63A5"}}),i("el-option",{attrs:{value:3,label:"\u6B4C\u66F2"}})],1)],1),i("el-form-item",{attrs:{label:"\u6807\u9898"}},[i("el-input",{model:{value:e.form.title,callback:function(n){e.$set(e.form,"title",n)},expression:"form.title"}})],1),i("el-form-item",{attrs:{label:"\u56FE\u7247"}},[i("k-upload-image",{ref:"upload",attrs:{accept:"image/jpeg,image/png","is-cropper":!1,disabled:!0,upload:function(){}},on:{delete:function(n){e.form.image=""},click:function(n){e.attachment.visible=!0}}})],1),e.form.type===3?i("el-form-item",{attrs:{label:"\u9009\u62E9\u6B4C\u66F2"}},[this.songDrawer.visible===!1?i("el-select",{on:{"visible-change":function(n){n&&(t.songDrawer.visible=!0)}},model:{value:e.form.song_id,callback:function(n){e.$set(e.form,"song_id",n)},expression:"form.song_id"}},[i("el-option",{attrs:{label:e.selectSong.song_name,value:e.selectSong.id}})],1):e._e()],1):e._e(),i("el-form-item",{attrs:{label:"\u94FE\u63A5"}},[i("el-input",{model:{value:e.form.url,callback:function(n){e.$set(e.form,"url",n)},expression:"form.url"}})],1),i("el-form-item",{attrs:{label:"\u5185\u5BB9"}},[e.drawer.visible?i("k-editor",{attrs:{upload:e.upload,cropper:""},model:{value:e.form.content,callback:function(n){e.$set(e.form,"content",n)},expression:"form.content"}}):e._e()],1),i("el-form-item",{attrs:{label:"\u662F\u5426\u542F\u7528"}},[i("el-radio-group",{model:{value:e.form.status,callback:function(n){e.$set(e.form,"status",n)},expression:"form.status"}},[i("el-radio",{attrs:{label:1}},[e._v("\u542F\u7528")]),i("el-radio",{attrs:{label:0}},[e._v("\u7981\u7528")])],1)],1)],1)],1)],1)],1),i("attachment",{attrs:{visible:e.attachment.visible},on:{"update:visible":function(n){return e.$set(e.attachment,"visible",n)},select:e.selcetImage}}),i("k-drawer",{attrs:{visible:e.songDrawer.visible,size:"55%"},on:{"update:visible":function(n){return e.$set(e.songDrawer,"visible",n)}}},[i("song",{attrs:{"is-component":""},on:{select:function(n){t.selectSong=n,t.form.song_id=n.id,t.songDrawer.visible=!1}}})],1)],1)},V=[];const G={name:"Promote",components:{Song:w,Attachment:m,KEditor:x},mixins:[$],data(){return{attachment:{visible:!1},songDrawer:{visible:!1},headers:[{label:"id",prop:"id"},{label:"\u7C7B\u578B",prop:"type"},{label:"\u4F4D\u7F6E",prop:"position"},{label:"\u6807\u9898",prop:"title"},{label:"\u56FE\u7247",prop:"image"},{label:"\u662F\u5426\u542F\u7528",prop:"status"},{label:"\u64CD\u4F5C",prop:"action"}],data:[],form:{type:1,platform:1,position:1,title:"",image:"",content:"",url:"",song_id:null,status:1},selectSong:{}}},mounted(){this.getPromoteList()},methods:{handleAction(t,e=null){this.drawer.type=t,t==="create"?this.drawer.title="\u65B0\u589E\u5E7F\u544A":t==="update"&&(this.selectItem=e,this.drawer.title="\u66F4\u65B0\u5E7F\u544A",this.getPromoteInfo()),this.drawer.visible=!0},async getPromoteInfo(){this.queryLoading=!0;try{let e=(await this.$api.promote.query(this.selectItem.id)).data;this.$libs.getAssignKeyData(this.form,e),this.$refs.upload.cropPreview=this.$config.staticUrl()+e.image,this.selectSong={id:e.song_id,song_name:e.song_name}}catch{}finally{this.queryLoading=!1}},async getPromoteList(t={page:1,limit:10}){this.loading=!0;let e=Object.assign(t,this.$libs.filterNullObject(this.query));try{let o=await this.$api.promote.batchQuery(e);this.data=o.data.data,this.total=o.data.total}catch{}finally{this.loading=!1}},async createPromote(){this.saveLoading=!0;try{let t=Object.assign({},this.form);t.id=0;let e=await this.$api.promote.create(t);this.data.unshift(this.$libs.getAssignKeyData(t,e.data)),this.drawer.visible=!1,this.$refs.upload.cropPreview="",this.$message.success("\u65B0\u589E\u6210\u529F")}catch{}finally{this.saveLoading=!1}},async updatePromote(){this.saveLoading=!0;let t=Object.assign({},this.form);t.id=this.selectItem.id;try{let e=await this.$api.promote.update(t),o=this.data.findIndex(i=>i.id===t.id);this.$set(this.data,o,this.$libs.getAssignKeyData(this.selectItem,t)),this.drawer.visible=!1,this.$message.success("\u66F4\u65B0\u6210\u529F")}catch{}finally{this.saveLoading=!1}},async deletePromote(t){let e=t.$index;t=t.row,this.$tool.confirmWarning("\u786E\u5B9A\u8981\u5220\u9664"+t.title+"\u5417\uFF1F").then(()=>{this.$api.promote.delete({id:t.id}).then(o=>{this.data.splice(e,1),this.$message.success("\u5220\u9664\u6210\u529F")})}).catch(o=>{})},async switchStatus(t,e,o){let i={id:o.id};i[t]=e,this.$api.promote.update(i).then(n=>{this.$message.success("\u66F4\u65B0\u6210\u529F")}).catch(n=>{o.status=e===0?1:0})},async selcetImage(t){this.form.image=t.path,this.$refs.upload.cropPreview=this.$config.staticUrl()+t.path},resetForm(){this.form=Object.assign({},this.defaultForm)},async upload(t,e,o){console.log(t.blobUri())}}},_={};var H=f(G,T,V,!1,Q,"683a0d72",null,null);function Q(t){for(let e in _)this[e]=_[e]}var ne=function(){return H.exports}();export{ne as default};
