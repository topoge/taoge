import{n as i}from"./index.621e7bf7.js";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"card"}},[s("el-tab-pane",{attrs:{label:"\u83DC\u5355"}},[s("el-tree",{key:"menu",ref:"menuTree",attrs:{data:e.permission.menu,"node-key":"id","show-checkbox":""}})],1),s("el-tab-pane",{attrs:{label:"\u9875\u9762"}},[s("el-tree",{key:"page",ref:"pageTree",attrs:{data:e.permission.page,"node-key":"id","show-checkbox":""}})],1),s("el-tab-pane",{attrs:{label:"\u6309\u94AE"}},[s("el-tree",{key:"button",ref:"buttonTree",attrs:{data:e.permission.button,"node-key":"id","show-checkbox":""}})],1),s("el-tab-pane",{attrs:{label:"\u63A5\u53E3"}},[s("el-tree",{key:"api",ref:"apiTree",attrs:{data:e.permission.api,"node-key":"id","show-checkbox":""}})],1)],1)},o=[];const c={name:"Permission",props:{checked:{type:Array,default:()=>[]}},data(){return{loading:!1,permission:{api:[],menu:[],page:[],button:[],parentApi:[],parentMenu:[],parentPage:[],parentButton:[]}}},watch:{checked(e,t){JSON.parse(JSON.stringify(e)).sort().toString()!==t.sort().toString()&&this.filterCheckedKeys(JSON.parse(JSON.stringify(e)))}},mounted(){this.getPermission()},methods:{async getPermission(){this.loading=!0;try{let t=(await this.$api.authPermission.queryAll()).data;this.handlePermission(t)}catch{}finally{this.loading=!1}},async handlePermission(e){let t=this.permission;t.api=[],t.menu=[],t.page=[],t.button=[];for(let s of e)switch(s.permission_type){case 1:{t.api.push(s);break}case 2:{t.menu.push(s);break}case 3:{t.page.push(s);break}case 4:{t.button.push(s);break}}t.api=this.$libs.formatTreeData(t.api,0,"label","permission_name"),t.parentApi=this.$libs.getTreeParent(t.api),t.menu=this.$libs.formatTreeData(t.menu,0,"label","permission_name"),t.parentMenu=this.$libs.getTreeParent(t.menu),t.page=this.$libs.formatTreeData(t.page,0,"label","permission_name"),t.parentPage=this.$libs.getTreeParent(t.page),t.button=this.$libs.formatTreeData(t.button,0,"label","permission_name"),t.parentButton=this.$libs.getTreeParent(t.button),this.checked&&this.filterCheckedKeys(this.checked)},filterCheckedKeys(e){this.$refs.apiTree.setCheckedKeys(e.filter(t=>this.permission.parentApi.findIndex(r=>r.id===t)<0)),this.$refs.menuTree.setCheckedKeys(e.filter(t=>this.permission.parentMenu.findIndex(r=>r.id===t)<0)),this.$refs.pageTree.setCheckedKeys(e.filter(t=>this.permission.parentPage.findIndex(r=>r.id===t)<0)),this.$refs.buttonTree.setCheckedKeys(e.filter(t=>this.permission.parentButton.findIndex(r=>r.id===t)<0))},getCheckedKeys(){let e=[];return e=e.concat(this.$refs.apiTree.getCheckedKeys()),e=e.concat(this.$refs.apiTree.getHalfCheckedKeys()),e=e.concat(this.$refs.menuTree.getCheckedKeys()),e=e.concat(this.$refs.menuTree.getHalfCheckedKeys()),e=e.concat(this.$refs.pageTree.getCheckedKeys()),e=e.concat(this.$refs.pageTree.getHalfCheckedKeys()),e=e.concat(this.$refs.buttonTree.getCheckedKeys()),e=e.concat(this.$refs.buttonTree.getHalfCheckedKeys()),e},getCheckedNodes(){let e=[];return e=e.concat(this.$refs.apiTree.getCheckedNodes()),e=e.concat(this.$refs.apiTree.getHalfCheckedNodes()),e=e.concat(this.$refs.menuTree.getCheckedNodes()),e=e.concat(this.$refs.menuTree.getHalfCheckedNodes()),e=e.concat(this.$refs.pageTree.getCheckedNodes()),e=e.concat(this.$refs.pageTree.getHalfCheckedNodes()),e=e.concat(this.$refs.buttonTree.getCheckedNodes()),e=e.concat(this.$refs.buttonTree.getHalfCheckedNodes()),e}}},a={};var d=i(c,n,o,!1,h,"370688b6",null,null);function h(e){for(let t in a)this[t]=a[t]}var p=function(){return d.exports}();export{p as P};
