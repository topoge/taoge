import{P as r}from"./Permission.157971ff.js";import{t as n}from"./tableFlow.31edb31e.js";import{n as c}from"./index.621e7bf7.js";import"./vendor.c31495b0.js";var d=function(){var e=this,l=e.$createElement,t=e._self._c||l;return t("el-row",[t("el-col",{attrs:{span:24}},[t("k-table",{attrs:{headers:e.headers,data:e.tableData,"is-pagination":"",total:e.total,loading:e.loading},on:{changePage:e.getRoleList},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-row",{attrs:{type:"flex"}},[t("el-col",[t("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(a){return e.handleAction("create")}}},[e._v("\u65B0\u589E\u89D2\u8272")])],1)],1)]},proxy:!0},{key:"item.role_type",fn:function(a){var s=a.scope;return[s.row.role_type===1?t("el-tag",{attrs:{size:"mini"}},[e._v("\u9ED8\u8BA4\u89D2\u8272")]):e._e()]}},{key:"item.status",fn:function(a){var s=a.scope;return[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(i){return e.switchStatus(i,s.row)}},model:{value:s.row.status,callback:function(i){e.$set(s.row,"status",i)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(a){var s=a.scope;return[t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(i){return e.handleAction("edit",s.row)}}},[e._v("\u7F16\u8F91")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(i){return e.deleteRole(s)}}},[e._v("\u5220\u9664")])]}}])})],1),t("el-dialog",{attrs:{title:e.dialog.title,visible:e.dialog.visible,width:"30%"},on:{"update:visible":function(a){return e.$set(e.dialog,"visible",a)},closed:e.resetForm}},[t("el-row",[t("el-col",{directives:[{name:"loading",rawName:"v-loading",value:e.queryLoading,expression:"queryLoading"}],attrs:{span:24}},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"small"}},[t("el-form-item",{attrs:{label:"\u89D2\u8272\u540D\u79F0"}},[t("el-input",{model:{value:e.form.role_name,callback:function(a){e.$set(e.form,"role_name",a)},expression:"form.role_name"}})],1),t("el-form-item",{attrs:{label:"\u7236\u7EA7\u89D2\u8272"}},[t("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9",disabled:""},model:{value:e.form.parent_id,callback:function(a){e.$set(e.form,"parent_id",a)},expression:"form.parent_id"}},[t("el-option",{attrs:{label:"\u9876\u7EA7\u5206\u7EC4",value:0}}),e._l(e.addRoleData.parentRole,function(a){return t("el-option",{key:a.value,attrs:{label:a.label,value:a.value}})})],2)],1),t("el-form-item",{attrs:{label:"\u89D2\u8272\u7EA7\u522B"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.role_level,callback:function(a){e.$set(e.form,"role_level",a)},expression:"form.role_level"}})],1),t("el-form-item",{attrs:{label:"\u89D2\u8272\u7C7B\u578B"}},[t("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9",disabled:""},model:{value:e.form.role_type,callback:function(a){e.$set(e.form,"role_type",a)},expression:"form.role_type"}},[t("el-option",{attrs:{label:"\u9ED8\u8BA4\u7C7B\u578B",value:1}})],1)],1),t("el-form-item",{attrs:{label:"\u63CF\u8FF0"}},[t("el-input",{model:{value:e.form.desc,callback:function(a){e.$set(e.form,"desc",a)},expression:"form.desc"}})],1),t("el-form-item",{attrs:{label:"\u72B6\u6001"}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.status,callback:function(a){e.$set(e.form,"status",a)},expression:"form.status"}})],1),t("el-form-item",{attrs:{label:"\u529F\u80FD\u6743\u9650"}},[t("Permission",{ref:"permission",attrs:{checked:e.form.permission}})],1)],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(a){e.dialog.visible=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"primary",loading:e.saveLoading},on:{click:function(a){e.dialog.type==="create"?e.createRole():e.updateRole()}}},[e._v("\u4FDD \u5B58")])],1)],1)],1)},u=[];const h={name:"AuthRole",components:{Permission:r},mixins:[n],data(){return{dialog:{title:"",type:"",visible:!1},form:{role_name:"",parent_id:0,role_level:1,role_type:1,desc:"",status:1,permission:[]},addRoleData:{parentRole:[]},headers:[{label:"\u89D2\u8272\u540D\u79F0",prop:"role_name"},{label:"\u7EA7\u522B",prop:"role_level"},{label:"\u5206\u7C7B",prop:"role_type"},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"created_at",type:"date"},{label:"\u72B6\u6001",prop:"status"},{label:"\u64CD\u4F5C",prop:"action"}],tableData:[],permission:[],group:[],role:[],treeData:[],selectRole:{},total:0}},mounted(){this.getRoleList()},methods:{showDialog(e){this.dialog.type=e,this.dialog.visible=!0},handleAction(e="create",l=null){this.action=e,e==="create"?(this.form.parent_id=0,this.form.role_level=1,this.dialog.title="\u65B0\u589E\u89D2\u8272"):e==="edit"&&(this.selectRole=l,this.getRoleInfo(),this.dialog.title="\u7F16\u8F91\u89D2\u8272"),this.showDialog(e)},async getRoleInfo(){this.queryLoading=!0;try{let e=await this.$api.authRole.query(this.selectRole.id);console.log(e.data);let l=e.data;this.$libs.getAssignKeyData(this.form,l)}catch(e){console.log(e)}finally{this.queryLoading=!1}},async getRoleList(e={page:1,limit:10}){this.loading=!0;let l=Object.assign(e,this.$libs.filterNullObject(this.query));try{let t=await this.$api.authRole.batchQuery(l);this.tableData=t.data.data,this.total=t.data.total,this.loading=!1}catch{}finally{this.loading=!1}},createRole(){this.saveLoading=!0,this.form.permission=this.$refs.permission.getCheckedKeys(),this.$api.authRole.create(this.form).then(e=>{this.$message.success("\u65B0\u589E\u6210\u529F"),this.dialog.visible=!1,this.tableData.unshift(e.data),this.saveLoading=!1}).catch(e=>{this.saveLoading=!1})},updateRole(){this.saveLoading=!0;let e=Object.assign({},this.form);e.id=this.selectRole.id,e.permission=this.$refs.permission.getCheckedKeys(),this.$api.authRole.update(e).then(l=>{this.$message.success("\u66F4\u65B0\u6210\u529F"),this.dialog.visible=!1;let t=this.tableData.findIndex(a=>a.id===e.id);this.$set(this.tableData,t,this.$libs.getAssignKeyData(this.selectRole,e)),this.saveLoading=!1}).catch(l=>{this.saveLoading=!1})},deleteRole(e){this.deleteLoading=!0;let l=e.row;this.$tool.confirmWarning("\u786E\u5B9A\u8981\u5220\u9664"+l.role_name+"\u5417\uFF1F").then(()=>{this.$api.authRole.delete({id:l.id}).then(t=>{this.$message.success("\u5220\u9664\u6210\u529F"),this.tableData.splice(e.$index,1),this.dialog.visible=!1,this.deleteLoading=!1}).catch(t=>{this.deleteLoading=!1})})},switchStatus(e,l){this.$api.authRole.update({id:l.id,status:e}).then(t=>{this.$message.success("\u66F4\u65B0\u6210\u529F")}).catch(t=>{l.status=e===0?1:0})}}},o={};var p=c(h,d,u,!1,m,"569d03cd",null,null);function m(e){for(let l in o)this[l]=o[l]}var _=function(){return p.exports}();export{_ as default};
