import{P as o}from"./Permission.157971ff.js";import{t as c}from"./tableFlow.31edb31e.js";import{n as d}from"./index.621e7bf7.js";import"./vendor.c31495b0.js";var m=function(){var s=this,e=this,i=e.$createElement,t=e._self._c||i;return t("el-row",[t("el-col",{attrs:{span:24}},[t("k-table",{attrs:{headers:e.headers,data:e.data,"is-pagination":"",total:e.total,loading:e.loading},on:{changePage:e.getAdminList},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-row",{attrs:{type:"flex"}},[t("el-col",[t("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(a){return e.handleAction("create")}}},[e._v("\u65B0\u589E\u7BA1\u7406\u5458")])],1)],1)]},proxy:!0},{key:"item.status",fn:function(a){var r=a.scope;return[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(l){return e.switchStatus(l,r.row)}},model:{value:r.row.status,callback:function(l){e.$set(r.row,"status",l)},expression:"scope.row.status"}})]}},{key:"item.action",fn:function(a){var r=a.scope;return[t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(l){return e.handleAction("update",r.row)}}},[e._v("\u7F16\u8F91")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(l){return e.deleteAdmin(r)}}},[e._v("\u5220\u9664")])]}}])})],1),t("k-drawer",{attrs:{title:e.drawer.title,visible:e.drawer.visible,size:"35%","destroy-on-close":""},on:{"update:visible":function(a){return e.$set(e.drawer,"visible",a)},fullscreen:function(a){s.drawer.span=a?12:20},closed:e.resetForm},scopedSlots:e._u([{key:"footer",fn:function(){return[t("el-button",{attrs:{size:"small"},on:{click:function(a){e.drawer.visible=!1}}},[e._v("\u53D6\u6D88")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",loading:e.saveLoading},on:{click:function(a){e.drawer.type==="update"?e.updateAdmin():e.createAdmin()}}},[e._v("\u4FDD\u5B58")])]},proxy:!0}])},[t("el-row",{attrs:{type:"flex",justify:"center"}},[t("el-col",{attrs:{span:e.drawer.span}},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"small"}},[t("el-form-item",{attrs:{label:"\u7528\u6237\u540D"}},[t("el-input",{model:{value:e.form.username,callback:function(a){e.$set(e.form,"username",a)},expression:"form.username"}})],1),t("el-form-item",{attrs:{label:"\u5BC6\u7801"}},[t("el-input",{model:{value:e.form.password,callback:function(a){e.$set(e.form,"password",a)},expression:"form.password"}})],1),t("el-form-item",{attrs:{label:"\u624B\u673A\u53F7"}},[t("el-input",{model:{value:e.form.mobile,callback:function(a){e.$set(e.form,"mobile",a)},expression:"form.mobile"}})],1),t("el-form-item",{attrs:{label:"\u8BBE\u7F6E\u89D2\u8272"}},[t("el-cascader",{attrs:{options:e.roleList,props:{multiple:!0,value:"id",checkStrictly:!0,emitPath:!1},"collapse-tags":"",clearable:""},model:{value:e.form.role,callback:function(a){e.$set(e.form,"role",a)},expression:"form.role"}})],1),t("el-form-item",{attrs:{label:"\u662F\u5426\u542F\u7528"}},[t("el-radio-group",{model:{value:e.form.status,callback:function(a){e.$set(e.form,"status",a)},expression:"form.status"}},[t("el-radio",{attrs:{label:1}},[e._v("\u542F\u7528")]),t("el-radio",{attrs:{label:0}},[e._v("\u7981\u7528")])],1)],1),t("el-form-item",{attrs:{label:"\u8BBE\u7F6E\u6743\u9650"}},[t("Permission",{ref:"permission",attrs:{checked:e.form.permission}})],1)],1)],1)],1)],1)],1)},u=[];const p={name:"AuthAdmin",components:{Permission:o},mixins:[c],data(){return{headers:[{label:"\u7528\u6237\u540D",prop:"username"},{label:"\u624B\u673A\u53F7",prop:"mobile"},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"created_at",type:"date"},{label:"\u72B6\u6001",prop:"status"},{label:"\u64CD\u4F5C",prop:"action"}],data:[],drawer:{title:"",type:"",span:20,visible:!1},form:{username:"",password:null,mobile:null,status:1,role:[],permission:[]},selectItem:{},roleList:[]}},mounted(){this.getAdminList()},methods:{handleAction(s,e=null){this.drawer.type=s,s==="create"?this.drawer.title="\u65B0\u589E\u7BA1\u7406\u5458":s==="update"&&(this.selectItem=e,this.getAdminInfo(),this.drawer.title="\u66F4\u65B0\u7BA1\u7406\u5458"),this.drawer.visible=!0,this.getRoleList()},async getAdminInfo(){let e=(await this.$api.admin.query(this.selectItem.id)).data;this.$libs.getAssignKeyData(this.form,e)},async getAdminList(s={page:1,limit:10}){this.loading=!0;let e=Object.assign(s,this.$libs.filterNullObject(this.query));try{let i=await this.$api.admin.batchQuery(e);this.data=i.data.data,this.total=i.data.total}catch{}finally{this.loading=!1}},async getRoleList(){let s=await this.$api.authRole.queryAll();this.roleList=this.$libs.formatTreeData(s.data,0,"label","role_name")},async createAdmin(){this.saveLoading=!0,this.form.permission=this.$refs.permission.getCheckedKeys();try{let s=await this.$api.admin.create(this.form);this.$message.success("\u65B0\u589E\u6210\u529F"),this.drawer.visible=!1,this.data.unshift(s.data)}catch{}finally{this.saveLoading=!1}},async updateAdmin(){this.saveLoading=!0;let s=Object.assign({},this.form);s.id=this.selectItem.id,s.permission=this.$refs.permission.getCheckedKeys();try{let e=await this.$api.admin.update(s);this.$message.success("\u66F4\u65B0\u6210\u529F"),this.drawer.visible=!1;let i=this.data.findIndex(t=>t.id===s.id);this.$set(this.data,i,this.$libs.getAssignKeyData(this.selectItem,s))}catch{}finally{this.saveLoading=!1}},async deleteAdmin(s){let e=s.$index;s=s.row,this.$tool.confirmWarning("\u786E\u5B9A\u8981\u5220\u9664"+s.username+"\u5417\uFF1F").then(()=>{this.$api.admin.delete({id:s.id}).then(i=>{this.$message.success("\u5220\u9664\u6210\u529F"),this.data.splice(e,1)})})},async switchStatus(s,e){this.$api.admin.update({id:e.id,status:s}).then(i=>{this.$message.success("\u66F4\u65B0\u6210\u529F")}).catch(i=>{e.status=s===0?1:0})}}},n={};var f=d(p,m,u,!1,h,"17a2d60a",null,null);function h(s){for(let e in n)this[e]=n[e]}var g=function(){return f.exports}();export{g as default};
