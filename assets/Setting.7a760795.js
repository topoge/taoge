import{t as m}from"./tableFlow.31edb31e.js";import{A as d}from"./AttachmentDialog.c144c957.js";import{n as r}from"./index.621e7bf7.js";import"./Attachment.3fb88322.js";import"./datePicker.1a087a29.js";import"./vendor.c31495b0.js";var v=function(){var l=this,e=l.$createElement,n=l._self._c||e;return n("div",[n("k-upload-image",{ref:"upload",attrs:{upload:function(){},disabled:!0},on:{delete:function(t){return l.$emit("input","")},click:l.uploadCover}}),n("Attachment",{attrs:{visible:l.attachment.visible},on:{"update:visible":function(t){return l.$set(l.attachment,"visible",t)},select:l.selcetImage}})],1)},h=[];const y={name:"ImageSelect",components:{Attachment:d},model:{prop:"value",event:"input"},props:{value:{required:!0,type:String}},data(){return{attachment:{visible:!1}}},mounted(){this.$refs.upload.cropPreview=this.$config.staticUrl()+this.value},methods:{async uploadCover(){this.attachment.visible=!0},async selcetImage(l){this.$emit("input",l.path),this.$refs.upload.cropPreview=this.$config.staticUrl()+l.path}}},c={};var g=r(y,v,h,!1,b,"2d87100c",null,null);function b(l){for(let e in c)this[e]=c[e]}var _=function(){return g.exports}(),x=function(){var l=this,e=this,n=e.$createElement,t=e._self._c||n;return t("k-card",[t("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between"}},[t("el-tabs",{attrs:{"tab-position":"left"},model:{value:e.activeName,callback:function(a){e.activeName=a},expression:"activeName"}},e._l(e.settingType,function(a,s){return t("el-tab-pane",{key:s,attrs:{lazy:"",label:e.$dict.settingType[e.$dict.settingType.findIndex(function(i){return i.value===a})].label,name:a.toString()}},[t("el-form",{ref:"valueForm",refInFor:!0,staticStyle:{"margin-left":"20px"},attrs:{model:e.valueForm,size:"small","label-width":"auto"}},e._l(e.setting,function(i,p){return i.type===a?t("el-form-item",{key:p,staticStyle:{"padding-right":"100px"},attrs:{label:i.name}},[i.element==="input"?t("el-input",{model:{value:i.value,callback:function(o){e.$set(i,"value",o)},expression:"settingItem.value"}}):e._e(),i.desc?t("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","align-items":"center","font-size":"12px",gap:"5px"}},[t("span",{staticClass:"material-icons-outlined",staticStyle:{"font-size":"12px"}},[e._v("info")]),e._v(" "+e._s(i.desc)+" ")]):e._e(),i.element==="select"?t("el-select",{model:{value:i.value,callback:function(o){e.$set(i,"value",o)},expression:"settingItem.value"}},e._l(i.option,function(o,f){return t("el-option",{key:f,attrs:{label:o.label,value:o.value}})}),1):e._e(),i.element==="imageSelect"?t("image-select",{model:{value:i.value,callback:function(o){e.$set(i,"value",o)},expression:"settingItem.value"}}):e._e(),t("el-button",{staticStyle:{position:"absolute",top:"1px",right:"-30px"},attrs:{type:"text",size:"mini"},on:{click:function(o){return e.handleAction("update",i)}}},[e._v("\u7F16\u8F91")])],1):e._e()}),1)],1)}),1),t("div",[t("el-button",{attrs:{slot:"reference",size:"mini",type:"primary",plain:""},on:{click:function(a){e.drawer.type="create",e.drawer.visible=!0}},slot:"reference"},[e._v("\u65B0\u589E\u914D\u7F6E")])],1)],1),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],staticStyle:{display:"inline-block","margin-left":"120px","margin-top":"20px"},attrs:{size:"mini",type:"primary",loading:e.saveLoading,disabled:e.saveLoading},on:{click:e.updateSettingValue}},[e._v("\u4FDD\u5B58")]),t("k-drawer",{attrs:{visible:e.drawer.visible,title:""+e.drawer.title,size:"35%","destroy-on-close":""},on:{"update:visible":function(a){return e.$set(e.drawer,"visible",a)},fullscreen:function(a){l.drawer.span=a?12:20},closed:e.resetForm},scopedSlots:e._u([{key:"footer",fn:function(){return[t("el-button",{attrs:{size:"small"},on:{click:function(a){e.drawer.visible=!1}}},[e._v("\u53D6\u6D88")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"small",type:"primary",disabled:e.saveLoading,loading:e.saveLoading},on:{click:function(a){e.drawer.type==="update"?e.updateSetting():e.createSetting()}}},[e._v("\u4FDD\u5B58")])]},proxy:!0}])},[t("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.queryLoading,expression:"queryLoading"}],attrs:{type:"flex",justify:"center"}},[t("el-col",{attrs:{span:e.drawer.span}},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"small"}},[t("el-form-item",{attrs:{label:"\u7C7B\u522B"}},[t("el-select",{model:{value:e.form.type,callback:function(a){e.$set(e.form,"type",a)},expression:"form.type"}},e._l(e.$dict.settingType,function(a,s){return t("el-option",{key:s,attrs:{label:a.label,value:a.value}})}),1)],1),t("el-form-item",{attrs:{label:"\u8BBE\u7F6E\u540D\u79F0"}},[t("el-input",{model:{value:e.form.name,callback:function(a){e.$set(e.form,"name",a)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"\u8BBE\u7F6E\u5C5E\u6027"}},[t("el-input",{model:{value:e.form.prop,callback:function(a){e.$set(e.form,"prop",a)},expression:"form.prop"}})],1),t("el-form-item",{attrs:{label:"\u7EC4\u4EF6\u5143\u7D20"}},[t("el-select",{model:{value:e.form.element,callback:function(a){e.$set(e.form,"element",a)},expression:"form.element"}},e._l(e.$dict.element,function(a,s){return t("el-option",{key:s,attrs:{label:a,value:a}})}),1)],1),e.form.element==="select"?t("el-form-item",{attrs:{label:"\u914D\u7F6E\u9879"}},[e._l(e.form.option,function(a,s){return t("el-form-item",{key:s},[t("div",{staticStyle:{display:"flex","flex-flow":"row nowrap",gap:"10px","justify-content":"flex-start"}},[t("span",{staticStyle:{display:"inline-block",width:"60px"}},[e._v("\u914D\u7F6E\u540D")]),t("el-input",{staticStyle:{width:"200px"},model:{value:a.label,callback:function(i){e.$set(a,"label",i)},expression:"item.label"}}),t("span",{staticStyle:{display:"inline-block",width:"20px"}},[e._v("\u503C")]),t("el-input",{staticStyle:{width:"200px"},model:{value:a.value,callback:function(i){e.$set(a,"value",i)},expression:"item.value"}}),t("el-button",{on:{click:function(i){i.preventDefault(),e.form.option.splice(e.form.option.indexOf(a),1)}}},[e._v("\u5220\u9664")])],1)])}),t("el-button",{on:{click:function(a){return e.form.option.push({})}}},[e._v("\u65B0\u589E\u914D\u7F6E")])],2):e._e(),t("el-form-item",{attrs:{label:e.drawer.type==="update"?"\u914D\u7F6E\u503C":"\u521D\u59CB\u503C"}},[e.form.element==="select"?t("el-select",{model:{value:e.form.value,callback:function(a){e.$set(e.form,"value",a)},expression:"form.value"}},e._l(e.form.option,function(a,s){return t("el-option",{key:s,attrs:{label:a.label,value:a.value}})}),1):e._e(),e.form.element==="input"?t("el-input",{model:{value:e.form.value,callback:function(a){e.$set(e.form,"value",a)},expression:"form.value"}}):e._e(),e.form.element==="imageSelect"?t("image-select",{model:{value:e.form.value,callback:function(a){e.$set(e.form,"value",a)},expression:"form.value"}}):e._e()],1),t("el-form-item",{attrs:{label:"\u63CF\u8FF0"}},[t("el-input",{model:{value:e.form.desc,callback:function(a){e.$set(e.form,"desc",a)},expression:"form.desc"}})],1),t("el-form-item",{attrs:{label:"\u9A8C\u8BC1\u89C4\u5219"}},[t("el-input",{model:{value:e.form.rule,callback:function(a){e.$set(e.form,"rule",a)},expression:"form.rule"}})],1)],1)],1)],1)],1)],1)},$=[];const w={name:"SystemSetting",components:{ImageSelect:_},mixins:[m],data(){return{drawer:{visible:!1,title:"\u6DFB\u52A0\u914D\u7F6E",type:"create",span:20},queryLoading:!1,saveLoading:!1,loading:!1,visible:!1,settingType:[],activeName:null,setting:[],form:{type:1,name:"",prop:"",value:"",element:"",option:[],rule:null,desc:""},selectItem:{},valueForm:{}}},mounted(){this.getSettingList()},methods:{handleAction(l,e=null){this.drawer.type=l,l==="create"?this.drawer.title="\u65B0\u589E\u914D\u7F6E":l==="update"&&(this.selectItem=e,this.getSettingInfo(e),this.drawer.title="\u66F4\u65B0\u914D\u7F6E"),this.drawer.visible=!0},async getSettingInfo(l){this.queryLoading=!0;try{let n=(await this.$api.setting.query(l.id)).data;n.option.length>0&&(n.option=JSON.parse(n.option)),this.$libs.getAssignKeyData(this.form,n)}catch(e){console.log(e)}finally{this.queryLoading=!1}},async getSettingList(){this.loading=!0;try{let e=(await this.$api.setting.queryAll()).data;for(let t of e)t.option.length>0&&(t.option=JSON.parse(t.option));this.setting=e.map(t=>({id:t.id,type:t.type,name:t.name,element:t.element,desc:t.desc,option:t.option,value:t.value}));let n=this.setting.map(t=>t.type);this.settingType=Array.from(new Set(n)),this.activeName=this.settingType[0].toString()}catch(l){console.log(l)}finally{this.loading=!1}},async createSetting(){this.saveLoading=!0;let l=Object.assign({},this.form);try{let e=await this.$api.setting.create(l);this.settingType.push(l.type),this.settingType=Array.from(new Set(this.settingType)),this.setting.push(e.data),this.drawer.visible=!1,this.$message.success("\u65B0\u589E\u6210\u529F")}catch{}finally{this.saveLoading=!1}},async updateSetting(){this.saveLoading=!0;let l=Object.assign({},this.form);l.id=this.selectItem.id;try{let e=await this.$api.setting.update(l),n=this.setting.findIndex(t=>t.id===l.id);this.$set(this.setting,n,this.$libs.getAssignKeyData(this.selectItem,l)),this.drawer.visible=!1,this.$message.success("\u66F4\u65B0\u6210\u529F")}catch(e){console.log(e)}finally{this.saveLoading=!1}},async updateSettingValue(){this.$tool.confirmWarning("\u4F60\u786E\u5B9A\u8981\u66F4\u65B0\u7CFB\u7EDF\u8BBE\u7F6E\u5417\uFF1F\u53EF\u80FD\u4F1A\u5F71\u54CD\u5230\u7CFB\u7EDF\u8FD0\u884C!").then(async()=>{this.saveLoading=!0;try{let l=Object.assign({},this.setting),e=await this.$api.setting.updateValue(l);this.$message.success("\u66F4\u65B0\u6210\u529F")}catch{}finally{this.saveLoading=!1}}).catch(l=>{})}}},u={};var S=r(w,x,$,!1,k,"366d75c0",null,null);function k(l){for(let e in u)this[e]=u[e]}var F=function(){return S.exports}();export{F as default};
