import{t as n}from"./tableFlow.31edb31e.js";import{n as c}from"./index.621e7bf7.js";import"./vendor.c31495b0.js";var d=function(){var r=this,e=this,s=e.$createElement,t=e._self._c||s;return t("el-row",[t("el-col",{attrs:{span:24}},[t("k-table",{attrs:{headers:e.headers,data:e.treeData,"row-key":"id","highlight-current-row":!0,"is-pagination":"",total:e.total},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(a){return e.handleAction("create")}}},[e._v("\u65B0\u589E\u5206\u7C7B")])]},proxy:!0},{key:"item.is_top",fn:function(a){var i=a.scope;return[t("el-switch",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{"active-color":"#f56c6c","active-value":1,"inactive-value":0},on:{change:function(l){return e.switchStatus("is_top",l,i.row)}},model:{value:i.row.is_top,callback:function(l){e.$set(i.row,"is_top",l)},expression:"scope.row.is_top"}})]}},{key:"item.action",fn:function(a){var i=a.scope;return[t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(l){return e.handleAction("createChild",i.row)}}},[e._v("\u65B0\u589E\u5B50\u5206\u7C7B")]),t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(l){return e.handleAction("update",i.row)}}},[e._v("\u7F16\u8F91")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{type:"danger",size:"mini",plain:""},on:{click:function(l){return e.deleteCategory(i.row)}}},[e._v("\u5220\u9664")])]}}])})],1),t("k-drawer",{attrs:{visible:e.drawer.visible,title:e.drawer.title,size:"35%","destroy-on-close":""},on:{"update:visible":function(a){return e.$set(e.drawer,"visible",a)},fullscreen:function(a){r.drawer.span=a?12:20},closed:e.resetForm},scopedSlots:e._u([{key:"footer",fn:function(){return[t("el-button",{attrs:{size:"mini"},on:{click:function(a){e.drawer.visible=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{directives:[{name:"throttle",rawName:"v-throttle"}],attrs:{size:"mini",type:"primary",loading:e.saveLoading},on:{click:function(a){e.drawer.type==="update"?e.updateCategory():e.createCategory()}}},[e._v("\u4FDD \u5B58")])]},proxy:!0}])},[t("el-row",{attrs:{type:"flex",justify:"center"}},[t("el-col",{attrs:{span:e.drawer.span}},[t("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px",size:"small"}},[t("el-form-item",{attrs:{label:"\u7236\u7EA7\u5206\u7C7B"}},[t("el-select",{attrs:{disabled:""},model:{value:e.form.parent_id,callback:function(a){e.$set(e.form,"parent_id",a)},expression:"form.parent_id"}},[t("el-option",{attrs:{label:"\u9876\u7EA7\u5206\u7C7B",value:0}}),t("el-option",{attrs:{label:e.selectItem.cate_name,value:e.selectItem.id}})],1)],1),t("el-form-item",{attrs:{label:"\u5206\u7C7B\u7EA7\u522B"}},[t("el-select",{attrs:{placeholder:"\u8BF7\u9009\u62E9",disabled:""},model:{value:e.form.level,callback:function(a){e.$set(e.form,"level",a)},expression:"form.level"}},[t("el-option",{attrs:{label:"\u9876\u7EA7\u6743\u9650",value:1}})],1)],1),t("el-form-item",{attrs:{label:"\u6392\u5E8F"}},[t("el-input-number",{attrs:{min:0,max:255,label:"\u6392\u5E8F",size:"mini"},model:{value:e.form.sort,callback:function(a){e.$set(e.form,"sort",a)},expression:"form.sort"}})],1),t("el-form-item",{attrs:{label:"\u7F6E\u9876\u663E\u793A"}},[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.is_top,callback:function(a){e.$set(e.form,"is_top",a)},expression:"form.is_top"}})],1),t("el-form-item",{attrs:{label:"\u5206\u7C7B\u540D\u79F0",required:""}},[t("el-input",{model:{value:e.form.cate_name,callback:function(a){e.$set(e.form,"cate_name",a)},expression:"form.cate_name"}})],1),t("el-form-item",{attrs:{label:"\u63CF\u8FF0"}},[t("el-input",{model:{value:e.form.desc,callback:function(a){e.$set(e.form,"desc",a)},expression:"form.desc"}})],1),t("el-form-item",{attrs:{label:"\u662F\u5426\u542F\u7528"}},[t("el-radio-group",{model:{value:e.form.status,callback:function(a){e.$set(e.form,"status",a)},expression:"form.status"}},[t("el-radio",{attrs:{label:1}},[e._v("\u542F\u7528")]),t("el-radio",{attrs:{label:0}},[e._v("\u7981\u7528")])],1)],1)],1)],1)],1)],1)],1)},u=[];const p={name:"SongCategory",mixins:[n],data(){return{headers:[{label:"\u5206\u7C7B\u540D\u79F0",prop:"cate_name"},{label:"\u5206\u7C7B\u7EA7\u522B",prop:"level"},{label:"\u7F6E\u9876\u663E\u793A",prop:"is_top"},{label:"\u63CF\u8FF0",prop:"desc",tooltip:!0},{label:"\u64CD\u4F5C",prop:"action"}],treeData:[],categoryList:[],form:{type:1,cate_name:"",desc:"",parent_id:"",level:1,sort:0,is_top:0,status:1}}},mounted(){this.getCategoryList()},methods:{handleAction(r="create",e=null){this.drawer.type=r,this.selectItem=e||{},r==="create"?(this.form.parent_id=0,this.form.level=1,this.drawer.title="\u65B0\u589E\u5206\u7C7B"):r==="createChild"?(this.form.parent_id=e.id,this.form.level=e.level+1,this.drawer.title="\u65B0\u589E\u5B50\u5206\u7C7B"):r==="update"&&(this.$libs.getAssignKeyData(this.form,e),this.drawer.title="\u7F16\u8F91\u5206\u7C7B"),this.drawer.visible=!0},async getCategoryList(){this.loading=!0;let e=(await this.$api.category.queryAll({type:1})).data;this.categoryList=e,this.setTreeData(e),this.loading=!1},async createCategory(){this.saveLoading=!0;try{let r=await this.$api.category.create(this.form);this.categoryList.push(r.data),await this.setTreeData(),this.drawer.visible=!1,this.$message.success("\u521B\u5EFA\u6210\u529F")}catch{}finally{this.saveLoading=!1}},async updateCategory(){this.saveLoading=!0;let r=Object.assign({},this.form);r.id=this.selectItem.id;try{let e=await this.$api.category.update(r);(async()=>{let s=this.categoryList,t=s.findIndex(a=>a.id===r.id);s[t]=r,await this.setTreeData(s)})(),this.drawer.visible=!1,this.$message.success("\u66F4\u65B0\u6210\u529F")}catch{}finally{this.saveLoading=!1}},async deleteCategory(r){this.$tool.confirmWarning("\u786E\u5B9A\u8981\u5220\u9664"+r.cate_name+"\u5417\uFF1F\u5C06\u4F1A\u8FDE\u540C\u5B50\u5206\u7C7B\u4E00\u8D77\u5220\u9664\uFF01").then(()=>{this.$api.category.delete({id:r.id}).then(e=>{(async()=>{let s=this.categoryList,t=s.findIndex(a=>a.id===r.id);s.splice(t,1),await this.setTreeData(s)})(),this.drawer.visible=!1,this.$message.success("\u5220\u9664\u6210\u529F")})}).catch(e=>{})},async setTreeData(r=this.categoryList){this.treeData=this.$libs.formatTreeData(JSON.parse(JSON.stringify(r)))},async switchStatus(r,e,s){let t={id:s.id};t[r]=e,this.$api.category.update(t).then(a=>{this.$message.success("\u66F4\u65B0\u6210\u529F")}).catch(a=>{s.status=e===0?1:0})}}},o={};var m=c(p,d,u,!1,f,"66f2bcae",null,null);function f(r){for(let e in o)this[e]=o[e]}var _=function(){return m.exports}();export{_ as default};
